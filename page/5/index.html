<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>zqhxuyuan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="zqhxuyuan">
<meta property="og:url" content="http://github.com/zqhxuyuan/page/5/index.html">
<meta property="og:site_name" content="zqhxuyuan">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="zqhxuyuan">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="zqhxuyuan" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="https://avatars1.githubusercontent.com/u/1088525?v=3&amp;s=180" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">任何忧伤,都抵不过世界的美丽</a></h1>
		</hgroup>

		
				


		
			<div id="switch-btn" class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div id="switch-area" class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives/">归档</a></li>
				        
							<li><a href="/tags/">标签</a></li>
				        
							<li><a href="/about/">关于</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<ul class="social">
							
								<li id="新浪微博"><a class="新浪微博" target="_blank" href="http://weibo.com/xuyuantree" title="新浪微博"></a></li>
					        
								<li id="GitHub"><a class="GitHub" target="_blank" href="http://github.com/zqhxuyuan" title="GitHub"></a></li>
					        
						</ul>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/apex/" style="font-size: 10px;">apex</a> <a href="/tags/cassandra/" style="font-size: 18.57px;">cassandra</a> <a href="/tags/clojure/" style="font-size: 10px;">clojure</a> <a href="/tags/drill/" style="font-size: 17.14px;">drill</a> <a href="/tags/druid/" style="font-size: 14.29px;">druid</a> <a href="/tags/elasticsearch/" style="font-size: 10px;">elasticsearch</a> <a href="/tags/geode/" style="font-size: 10px;">geode</a> <a href="/tags/graph/" style="font-size: 14.29px;">graph</a> <a href="/tags/hbase/" style="font-size: 15.71px;">hbase</a> <a href="/tags/ignite/" style="font-size: 10px;">ignite</a> <a href="/tags/kafka/" style="font-size: 20px;">kafka</a> <a href="/tags/ops/" style="font-size: 14.29px;">ops</a> <a href="/tags/redis/" style="font-size: 11.43px;">redis</a> <a href="/tags/scala/" style="font-size: 12.86px;">scala</a> <a href="/tags/spark/" style="font-size: 14.29px;">spark</a> <a href="/tags/storm/" style="font-size: 17.14px;">storm</a> <a href="/tags/timeseries/" style="font-size: 12.86px;">timeseries</a> <a href="/tags/work/" style="font-size: 12.86px;">work</a>
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">BIG(DATA)</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">任何忧伤,都抵不过世界的美丽</a></h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<a href="/" class="profilepic">
				<img lazy-src="https://avatars1.githubusercontent.com/u/1088525?v=3&amp;s=180" class="js-avatar">
			</a>
			<hgroup>
			  <h1 class="header-author"><a href="/" title="回到主页">任何忧伤,都抵不过世界的美丽</a></h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives/">归档</a></li>
		        
					<li><a href="/tags/">标签</a></li>
		        
					<li><a href="/about/">关于</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
						<ul class="social">
							
								<li id="新浪微博"><a class="新浪微博" target="_blank" href="http://weibo.com/xuyuantree" title="新浪微博"></a></li>
					        
								<li id="GitHub"><a class="GitHub" target="_blank" href="http://github.com/zqhxuyuan" title="GitHub"></a></li>
					        
						</ul>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-2015-11-29-StreamCQL-application" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/11/29/2015-11-29-StreamCQL-application/" class="article-date">
  	<time datetime="2015-11-28T16:00:00.000Z" itemprop="datePublished">2015-11-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/29/2015-11-29-StreamCQL-application/">StreamCQL源码阅读(4) 应用程序执行</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>StreamCQL应用程序执行流程</p>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Source/">Source</a>
	</div>


      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/storm/">storm</a></li></ul>
	</div>

      
        <p class="article-more-link">
          <a  href="/2015/11/29/2015-11-29-StreamCQL-application/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
</article>











    
        <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
        <script>
        var yiliaConfig = {
        fancybox: true,
        mathjax: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        open_in_new: false
        }
        </script>
        

  
    <article id="post-2015-11-27-StreamCQL-operator" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/11/27/2015-11-27-StreamCQL-operator/" class="article-date">
  	<time datetime="2015-11-26T16:00:00.000Z" itemprop="datePublished">2015-11-27</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/27/2015-11-27-StreamCQL-operator/">StreamCQL源码阅读(3) 拆分组合算子</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>StreamCQL的算子组成了Application</p>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Source/">Source</a>
	</div>


      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/storm/">storm</a></li></ul>
	</div>

      
        <p class="article-more-link">
          <a  href="/2015/11/27/2015-11-27-StreamCQL-operator/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
</article>











    
        <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
        <script>
        var yiliaConfig = {
        fancybox: true,
        mathjax: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        open_in_new: false
        }
        </script>
        

  
    <article id="post-2015-11-26-StreamCQL-schema" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/11/26/2015-11-26-StreamCQL-schema/" class="article-date">
  	<time datetime="2015-11-25T16:00:00.000Z" itemprop="datePublished">2015-11-26</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/26/2015-11-26-StreamCQL-schema/">StreamCQL源码阅读(2) 语法和语义解析</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>StreamCQL的Schema以及语法和语义解析</p>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Source/">Source</a>
	</div>


      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/storm/">storm</a></li></ul>
	</div>

      
        <p class="article-more-link">
          <a  href="/2015/11/26/2015-11-26-StreamCQL-schema/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
</article>











    
        <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
        <script>
        var yiliaConfig = {
        fancybox: true,
        mathjax: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        open_in_new: false
        }
        </script>
        

  
    <article id="post-2015-11-24-StreamCQL-task" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/11/24/2015-11-24-StreamCQL-task/" class="article-date">
  	<time datetime="2015-11-23T16:00:00.000Z" itemprop="datePublished">2015-11-24</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/24/2015-11-24-StreamCQL-task/">StreamCQL源码阅读(1) 提交任务</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>大数据上的流式SQL引擎—StreamCQL: <a href="http://www.csdn.net/article/2015-11-13/2826204">http://www.csdn.net/article/2015-11-13/2826204</a><br><a href="http://www.csdn.net/article/2015-12-22/2826541">http://www.csdn.net/article/2015-12-22/2826541</a><br>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Source/">Source</a>
	</div>


      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/storm/">storm</a></li></ul>
	</div>

      
        <p class="article-more-link">
          <a  href="/2015/11/24/2015-11-24-StreamCQL-task/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
</article>











    
        <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
        <script>
        var yiliaConfig = {
        fancybox: true,
        mathjax: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        open_in_new: false
        }
        </script>
        

  
    <article id="post-2015-11-17-Cassandra-BulkLoad" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/11/17/2015-11-17-Cassandra-BulkLoad/" class="article-date">
  	<time datetime="2015-11-16T16:00:00.000Z" itemprop="datePublished">2015-11-17</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/17/2015-11-17-Cassandra-BulkLoad/">Cassandra Migration Tool</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Cassandra BulkLoad 批量导数据工具(1)</p>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/bigdata/">bigdata</a>
	</div>


      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cassandra/">cassandra</a></li></ul>
	</div>

      
        <p class="article-more-link">
          <a  href="/2015/11/17/2015-11-17-Cassandra-BulkLoad/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
</article>











    
        <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
        <script>
        var yiliaConfig = {
        fancybox: true,
        mathjax: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        open_in_new: false
        }
        </script>
        

  
    <article id="post-2015-11-11-Cassandra-Stream" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/11/11/2015-11-11-Cassandra-Stream/" class="article-date">
  	<time datetime="2015-11-10T16:00:00.000Z" itemprop="datePublished">2015-11-11</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/11/2015-11-11-Cassandra-Stream/">Cassandra源码分析之Stream</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>大数据源码阅读系列之ApacheCassandra: sstable的stream流程</p>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Source/">Source</a>
	</div>


      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cassandra/">cassandra</a></li></ul>
	</div>

      
        <p class="article-more-link">
          <a  href="/2015/11/11/2015-11-11-Cassandra-Stream/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
</article>











    
        <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
        <script>
        var yiliaConfig = {
        fancybox: true,
        mathjax: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        open_in_new: false
        }
        </script>
        

  
    <article id="post-2015-11-10-Cassandra-Client" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/11/10/2015-11-10-Cassandra-Client/" class="article-date">
  	<time datetime="2015-11-09T16:00:00.000Z" itemprop="datePublished">2015-11-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/10/2015-11-10-Cassandra-Client/">Cassandra Client查询优化</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>大数据源码阅读系列之ApacheCassandra: Cassandra客户端的查询优化</p>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Source/">Source</a>
	</div>


      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cassandra/">cassandra</a></li></ul>
	</div>

      
        <p class="article-more-link">
          <a  href="/2015/11/10/2015-11-10-Cassandra-Client/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
</article>











    
        <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
        <script>
        var yiliaConfig = {
        fancybox: true,
        mathjax: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        open_in_new: false
        }
        </script>
        

  
    <article id="post-Cassandra-query" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/16/Cassandra-query/" class="article-date">
  	<time datetime="2015-10-15T16:00:00.000Z" itemprop="datePublished">2015-10-16</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/16/Cassandra-query/">Cassandra查询</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        
        <a id="more"></a>
<!-- MarkdownTOC -->
<ul>
<li>Query<ul>
<li>Range Query</li>
<li>问题1: 查询应用内最近的记录存在BUG: 查的不是最近而是最早</li>
<li>解决方式: 应用内最近记录使用Order By DESC</li>
<li>问题2: 查询全局范围最近的记录目前的表结构无法实现</li>
<li>拆表</li>
</ul>
</li>
<li>CLUSTERING ORDER BY</li>
<li>现实世界的查询: Tombstone<ul>
<li>tombstone太多查询中断</li>
<li>orderby+limit查询</li>
<li>timestamp限制不读取tombstone</li>
<li>orderby + timestamp</li>
<li>orderby+limit如果存活的记录数没有超过limit,是否会查询TTL的数据?</li>
<li>tombstone使用经验</li>
<li>Slice Query</li>
</ul>
</li>
<li>Paging Query</li>
<li>Read Time Out<ul>
<li>Future Interrupt</li>
</ul>
</li>
<li>More Abould Query: Token?</li>
<li>Node down effect</li>
<li>TTL<ul>
<li>TTL是针对行, 还是针对列</li>
<li>插入数据时using TTL</li>
<li>测试Table的default ttl</li>
<li>gc_grace_seconds</li>
<li>Delete操作</li>
</ul>
</li>
<li>读一致性</li>
<li>协调节点超时</li>
</ul>
<!-- /MarkdownTOC -->
<h2 id="Query">Query</h2><p><a href="http://www.planetcassandra.org/blog/we-shall-have-order/" target="_blank" rel="external">http://www.planetcassandra.org/blog/we-shall-have-order/</a><br><a href="http://www.planetcassandra.org/blog/composite-keys-in-apache-cassandra/" target="_blank" rel="external">http://www.planetcassandra.org/blog/composite-keys-in-apache-cassandra/</a><br><a href="http://www.datastax.com/dev/blog/cassandra-anti-patterns-queues-and-queue-like-datasets" target="_blank" rel="external">http://www.datastax.com/dev/blog/cassandra-anti-patterns-queues-and-queue-like-datasets</a>  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> velocity (</span><br><span class="line">  <span class="keyword">attribute</span> <span class="built_in">text</span>,       //属性值: zhangshan</span><br><span class="line">  partner_code <span class="built_in">text</span>,    //合作方: koudai</span><br><span class="line">  app_name <span class="built_in">text</span>,        //应用: koudai_ios</span><br><span class="line">  <span class="keyword">type</span> <span class="built_in">text</span>,            //属性名称: <span class="keyword">account</span></span><br><span class="line">  <span class="string">"timestamp"</span> <span class="built_in">bigint</span>,   //时间撮</span><br><span class="line">  <span class="keyword">event</span> <span class="built_in">text</span>,           //事件: <span class="keyword">JSON</span>串</span><br><span class="line">  sequence_id <span class="built_in">text</span>,     //序列号</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> ((<span class="keyword">attribute</span>), partner_code, app_name, <span class="keyword">type</span>, <span class="string">"timestamp"</span>)</span><br><span class="line">)</span></span><br></pre></td></tr></table></figure>
<p><strong>主键primary key</strong>: (attribute), partner_code, app_name, type, “timestamp”<br><strong>分区键partition key</strong>: attribute<br><strong>聚合键clustering key</strong>: partner_code, app_name, type, timestamp</p>
<blockquote>
<p>添加上timestampe的目的是为了排序: CassandraVelocityReadDaoImpl Line_133  </p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Collections.sort(velocities, <span class="keyword">new</span> Comparator&lt;VelocityDO&gt;() &#123;</span><br><span class="line">    @<span class="function">Override</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(VelocityDO velo1, VelocityDO velo2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (velo1.getTimestamp() - velo2.getTimestamp() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> velo1.getTimestamp() &lt; velo2.getTimestamp() ? -<span class="number">1</span> : <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>TODO: cluster key本身的目的就是为了order by使用的. 改进的方式是直接使用Cassandra自身的order by来排序! 就不需要使用上面的客户端排序了.</p>
<p>测试数据(下面除了timestamp和sequence_id不一样, 其他数据都是一样的, 注意插入顺序和timestamp的值没有关系): </p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">insert <span class="keyword">into</span> velocity(attribute,partner_code,app_name,<span class="keyword">type</span>,timestamp,<span class="keyword">event</span>,sequence_id)values(<span class="string">'test'</span>,<span class="string">'koudai'</span>,<span class="string">'koudai_ios'</span>,<span class="string">'account'</span>,<span class="number">1234567</span>,<span class="string">'event blob'</span>,<span class="string">'1234567'</span>);</span><br><span class="line">insert <span class="keyword">into</span> velocity(attribute,partner_code,app_name,<span class="keyword">type</span>,timestamp,<span class="keyword">event</span>,sequence_id)values(<span class="string">'test'</span>,<span class="string">'koudai'</span>,<span class="string">'koudai_ios'</span>,<span class="string">'account'</span>,<span class="number">12345</span>,<span class="string">'event blob'</span>,<span class="string">'12345'</span>);</span><br><span class="line">insert <span class="keyword">into</span> velocity(attribute,partner_code,app_name,<span class="keyword">type</span>,timestamp,<span class="keyword">event</span>,sequence_id)values(<span class="string">'test'</span>,<span class="string">'koudai'</span>,<span class="string">'koudai_ios'</span>,<span class="string">'account'</span>,<span class="number">123456</span>,<span class="string">'event blob'</span>,<span class="string">'123456'</span>);</span><br><span class="line">cqlsh:forseti&gt; <span class="keyword">select</span> * <span class="keyword">from</span> velocity <span class="keyword">where</span> attribute=<span class="string">'test'</span>;</span><br><span class="line"> attribute | partner_code | app_name   | <span class="keyword">type</span>    | timestamp | <span class="keyword">event</span>      | sequence_id</span><br><span class="line">-----------+--------------+------------+---------+-----------+------------+-------------</span><br><span class="line">      test |       koudai | koudai_ios | account |     <span class="number">12345</span> | <span class="keyword">event</span> blob |       <span class="number">12345</span></span><br><span class="line">      test |       koudai | koudai_ios | account |    <span class="number">123456</span> | <span class="keyword">event</span> blob |      <span class="number">123456</span></span><br><span class="line">      test |       koudai | koudai_ios | account |   <span class="number">1234567</span> | <span class="keyword">event</span> blob |     <span class="number">1234567</span></span><br></pre></td></tr></table></figure>
<p><strong>数据在Cassandra中是如何存储的?</strong>  </p>
<p><a href="http://www.slideshare.net/DataStax/understanding-how-cql3-maps-to-cassandras-internal-data-structure" target="_blank" rel="external">http://www.slideshare.net/DataStax/understanding-how-cql3-maps-to-cassandras-internal-data-structure</a><br><img src="http://img.blog.csdn.net/20151016173903670" alt="cassandra_mapping"></p>
<p>把所有的clustering key+非primary key的每一列column, value的值是这一列的值.</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">     |<span class="symbol">koudai:</span><span class="symbol">koudai_ios:</span><span class="symbol">account:</span><span class="number">12345</span><span class="symbol">:event|koudai</span><span class="symbol">:koudai_ios</span><span class="symbol">:account</span><span class="symbol">:</span><span class="number">12345</span><span class="symbol">:sequence_id|koudai</span><span class="symbol">:koudai_ios</span><span class="symbol">:account</span><span class="symbol">:</span><span class="number">123456</span><span class="symbol">:event|koudai</span><span class="symbol">:koudai_ios</span><span class="symbol">:account</span><span class="symbol">:</span><span class="number">123456</span><span class="symbol">:sequence_id</span></span><br><span class="line">test |event blob                           |<span class="number">12345</span>                                      |event blob                            |<span class="number">123456</span></span><br></pre></td></tr></table></figure>
<p>其中test是row-key, partition key=attribute的值,<br>列名: koudai:koudai_ios:account:12345:event之前几个<code>koudai:koudai_ios:account:12345</code>对应的分别是clustering key=partner_code:app_name:type:timestamp的值<br>最后一个<code>event</code>是event的列名, 同理koudai:koudai_ios:account:12345:sequence_id的sequence_id是sequence_id的列名. value是列对应的值. </p>
<p>由于相同的attribute(以及相同的合作方,应用,属性类型名称)可能有多个, 所以这些记录都会放在同一行里!(同一行指的是同一个partition key)</p>
<p>那么在查询应用时: <code>select * from velocity where attribute=? and partner_code=? and app_name=? and type=?</code>对应的查询是:<br><code>select * from velocity where attribute=&#39;test&#39; and partner_code=&#39;koudai&#39; and app_name=&#39;koudai_ios&#39; and type=&#39;account&#39;</code><br>这个查询会查出上面attribute=’test’的两条记录(12345,123456). 而且速度是很快的. 因为数据在底层都是通过clustering key进行排好序的. </p>
<blockquote>
<p>虽然上面where条件中没有指定timestamp, 但是按照clustering key的含义,只要是以clustering key作为查询条件, 都是会排序的. </p>
</blockquote>
<h3 id="Range_Query">Range Query</h3><p>The <strong>partition key</strong> must be defined in the WHERE clause and<br>the ORDER BY clause defines the <strong>clustering column</strong> to use for ordering.</p>
<p>SELECT * FROM users WHERE userID IN (102,104) ORDER BY age ASC;</p>
<p>userID 是partition key. age是cluster column.<br>所以我们可以知道users表的primary key是 PRIMARY KEY(userId, age)<br>出现在where中的必须是primary key或者index column.  </p>
<p>Cassandra does not support non-equal conditional operations on the partition key.<br>Use the token function for range queries on the partition key.<br>不支持在PartitionKey上执行不等于查询. 可以使用token函数执行基于partition key的范围查询</p>
<h3 id="问题1:_查询应用内最近的记录存在BUG:_查的不是最近而是最早">问题1: 查询应用内最近的记录存在BUG: 查的不是最近而是最早</h3><p>在没有排序的情况下, limit查询, 不会查询最新的, 而是最早的. 实际上没有指定排序就是升序,即按照cluster key升序.    </p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cqlsh:forseti&gt; select <span class="keyword">*</span> from velocity where attribute='test' limit 2;</span><br><span class="line"> attribute |<span class="string"> partner_code </span>|<span class="string"> app_name   </span>|<span class="string"> type    </span>|<span class="string"> timestamp </span>|<span class="string"> event      </span>|<span class="string"> sequence_id</span><br><span class="line">-----------+--------------+------------+---------+-----------+------------+-------------</span><br><span class="line">      test </span>|<span class="string">       koudai </span>|<span class="string"> koudai_ios </span>|<span class="string"> account </span>|<span class="string">     12345 </span>|<span class="string"> event blob </span>|<span class="string">       12345</span><br><span class="line">      test </span>|<span class="string">       koudai </span>|<span class="string"> koudai_ios </span>|<span class="string"> account </span>|<span class="string">    123456 </span>|<span class="string"> event blob </span>|<span class="string">      123456</span></span><br></pre></td></tr></table></figure>
<h3 id="解决方式:_应用内最近记录使用Order_By_DESC">解决方式: 应用内最近记录使用Order By DESC</h3><p>使用order by查询正确的方式是: 要指定所有的cluster key. 可以看到按照desc查询时, 查询的是最新的记录了(1234567).   </p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cqlsh:forseti&gt; <span class="keyword">select</span> * <span class="keyword">from</span> velocity </span><br><span class="line">  <span class="keyword">where</span> attribute=<span class="string">'test'</span> <span class="keyword">and</span> partner_code=<span class="string">'koudai'</span> <span class="keyword">and</span> app_name=<span class="string">'koudai_ios'</span> <span class="keyword">and</span> <span class="keyword">type</span>=<span class="string">'account'</span> </span><br><span class="line">  <span class="keyword">order</span> <span class="keyword">by</span> partner_code <span class="keyword">desc</span>,app_name <span class="keyword">desc</span>,<span class="keyword">type</span> <span class="keyword">desc</span>,timestamp <span class="keyword">desc</span> limit <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"> attribute | partner_code | app_name   | <span class="keyword">type</span>    | timestamp | <span class="keyword">event</span>      | sequence_id</span><br><span class="line">-----------+--------------+------------+---------+-----------+------------+-------------</span><br><span class="line">      test |       koudai | koudai_ios | account |   <span class="number">1234567</span> | <span class="keyword">event</span> blob |     <span class="number">1234567</span></span><br><span class="line">(<span class="number">1</span> rows)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这里order by多个字段, 每个字段都必须指定排序方式.</p>
</blockquote>
<h3 id="问题2:_查询全局范围最近的记录目前的表结构无法实现">问题2: 查询全局范围最近的记录目前的表结构无法实现</h3><p>全局查询时按照时间倒序排列, 也必须要指定前面的clustering key. 不能只有一个timestamp.<br>这就影响了数据的准确性. 加入partner_code=’abc’有10条记录, 但是它的ts=1, 而partner_code=’cde’,它们的ts=10. 查询的应该是cde,而不是abc.<br>如果不加上order by直接limit,会导致数据也不是按照时间逆序排列的!</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">select</span> * <span class="keyword">from</span> velocity <span class="keyword">where</span> <span class="keyword">attribute</span>=<span class="string">'test'</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">timestamp</span> <span class="keyword">desc</span> <span class="keyword">limit</span> <span class="number">10</span>;</span>  ×: 语法错误!</span><br><span class="line"><span class="operator"><span class="keyword">select</span> * <span class="keyword">from</span> velocity <span class="keyword">where</span> <span class="keyword">attribute</span>=<span class="string">'test'</span> <span class="keyword">order</span> <span class="keyword">by</span> partner_code <span class="keyword">desc</span>,app_name <span class="keyword">desc</span>,<span class="keyword">type</span> <span class="keyword">desc</span>,<span class="keyword">timestamp</span> <span class="keyword">desc</span> <span class="keyword">limit</span> <span class="number">10</span>;</span>  ×: 不符合业务逻辑,不是严格倒排,数据不准确</span><br></pre></td></tr></table></figure>
<p>可以设置WITH CLUSTERING ORDER BY (timestamp DESC)进行强制字段排序. 但是只能在建表的时候指定,不能使用alter修改表结构!</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> velocity_order (</span><br><span class="line">  <span class="keyword">attribute</span> <span class="built_in">text</span>,</span><br><span class="line">  partner_code <span class="built_in">text</span>,</span><br><span class="line">  app_name <span class="built_in">text</span>,</span><br><span class="line">  <span class="keyword">type</span> <span class="built_in">text</span>,</span><br><span class="line">  <span class="string">"timestamp"</span> <span class="built_in">bigint</span>,</span><br><span class="line">  <span class="keyword">event</span> <span class="built_in">text</span>,</span><br><span class="line">  sequence_id <span class="built_in">text</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> ((<span class="keyword">attribute</span>), partner_code, app_name, <span class="keyword">type</span>, <span class="string">"timestamp"</span>)</span><br><span class="line">) <span class="keyword">WITH</span> <span class="keyword">CLUSTERING</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> (<span class="string">"timestamp"</span> <span class="keyword">DESC</span>);</span></span><br><span class="line"></span><br><span class="line">Bad Request: Missing CLUSTERING ORDER for column partner_code</span><br></pre></td></tr></table></figure>
<p>使用CLUSTERING ORDER BY,必须包含所有的clustering key! 上面只指定一个timestamp字段是不行的! 要这么做:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> velocity_order (</span><br><span class="line">  <span class="keyword">attribute</span> <span class="built_in">text</span>,</span><br><span class="line">  partner_code <span class="built_in">text</span>,</span><br><span class="line">  app_name <span class="built_in">text</span>,</span><br><span class="line">  <span class="keyword">type</span> <span class="built_in">text</span>,</span><br><span class="line">  <span class="string">"timestamp"</span> <span class="built_in">bigint</span>,</span><br><span class="line">  <span class="keyword">event</span> <span class="built_in">text</span>,</span><br><span class="line">  sequence_id <span class="built_in">text</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> ((<span class="keyword">attribute</span>), partner_code, app_name, <span class="keyword">type</span>, <span class="string">"timestamp"</span>)</span><br><span class="line">) <span class="keyword">WITH</span> <span class="keyword">CLUSTERING</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> (partner_code <span class="keyword">DESC</span>, app_name <span class="keyword">DESC</span>, <span class="keyword">type</span> <span class="keyword">DESC</span>, <span class="string">"timestamp"</span> <span class="keyword">DESC</span>);</span></span><br></pre></td></tr></table></figure>
<p>这种方式在业务系统中, 对于全局的查询显然是不对的! 因为全局查询时要求按照timestamp倒序,其他字段比如partner_code等都不需要排序! </p>
<h3 id="拆表">拆表</h3><p>由于上面的全局查询无法查询最近的1000条记录, 需要将velocity拆分成三张表: 应用, 合作方, 全局. </p>
<blockquote>
<p>虽然写的时候要写张表, 但是写对于Cassandra来说是很快的. 只要能满足快速读的性能, 对于数据的冗余,是可以接受的.  </p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">应用:</span><br><span class="line"><span class="operator"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> velocity_app (</span><br><span class="line">  <span class="keyword">attribute</span> <span class="built_in">text</span>,       </span><br><span class="line">  partner_code <span class="built_in">text</span>,    </span><br><span class="line">  app_name <span class="built_in">text</span>,        </span><br><span class="line">  <span class="keyword">type</span> <span class="built_in">text</span>,            </span><br><span class="line">  <span class="string">"timestamp"</span> <span class="built_in">bigint</span>,   </span><br><span class="line">  <span class="keyword">event</span> <span class="built_in">text</span>,           </span><br><span class="line">  sequence_id <span class="built_in">text</span>,     </span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> ((<span class="keyword">attribute</span>, partner_code, app_name, <span class="keyword">type</span>), <span class="string">"timestamp"</span>)</span><br><span class="line">) </span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> velocity_app <span class="keyword">where</span> <span class="keyword">attribute</span>=? <span class="keyword">and</span> partner_code=? <span class="keyword">and</span> app_name=? <span class="keyword">and</span> <span class="keyword">type</span>=? <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">timestamp</span> <span class="keyword">desc</span> <span class="keyword">limit</span> <span class="number">1000</span>;</span></span><br><span class="line"></span><br><span class="line">合作方:</span><br><span class="line"><span class="operator"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> velocity_partner (</span><br><span class="line">  <span class="keyword">attribute</span> <span class="built_in">text</span>,       </span><br><span class="line">  partner_code <span class="built_in">text</span>,    </span><br><span class="line">  app_name <span class="built_in">text</span>,        </span><br><span class="line">  <span class="keyword">type</span> <span class="built_in">text</span>,            </span><br><span class="line">  <span class="string">"timestamp"</span> <span class="built_in">bigint</span>,   </span><br><span class="line">  <span class="keyword">event</span> <span class="built_in">text</span>,           </span><br><span class="line">  sequence_id <span class="built_in">text</span>,     </span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> ((<span class="keyword">attribute</span>, partner_code), <span class="string">"timestamp"</span>)</span><br><span class="line">) </span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> velocity_partner <span class="keyword">where</span> <span class="keyword">attribute</span>=? <span class="keyword">and</span> partner_code=? <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">timestamp</span> <span class="keyword">desc</span> <span class="keyword">limit</span> <span class="number">1000</span>;</span></span><br><span class="line"></span><br><span class="line">全局: </span><br><span class="line"><span class="operator"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> velocity_global (</span><br><span class="line">  <span class="keyword">attribute</span> <span class="built_in">text</span>,       </span><br><span class="line">  partner_code <span class="built_in">text</span>,    </span><br><span class="line">  app_name <span class="built_in">text</span>,        </span><br><span class="line">  <span class="keyword">type</span> <span class="built_in">text</span>,            </span><br><span class="line">  <span class="string">"timestamp"</span> <span class="built_in">bigint</span>,   </span><br><span class="line">  <span class="keyword">event</span> <span class="built_in">text</span>,           </span><br><span class="line">  sequence_id <span class="built_in">text</span>,     </span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> ((<span class="keyword">attribute</span>), <span class="string">"timestamp"</span>)</span><br><span class="line">) </span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> velocity_global <span class="keyword">where</span> <span class="keyword">attribute</span>=? <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">timestamp</span> <span class="keyword">desc</span> <span class="keyword">limit</span> <span class="number">1000</span>;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>这样就完了吗? 上面的建表语句如果加上<code>CLUSTERING ORDER BY</code>, 会不会提升性能?</p>
</blockquote>
<h2 id="CLUSTERING_ORDER_BY">CLUSTERING ORDER BY</h2><p><a href="http://docs.datastax.com/en/cql/3.1/cql/cql_reference/create_table_r.html?scroll=reference_ds_v3f_vfk_xj__ordering-results" target="_blank" rel="external">http://docs.datastax.com/en/cql/3.1/cql/cql_reference/create_table_r.html?scroll=reference_ds_v3f_vfk_xj__ordering-results</a>  </p>
<blockquote>
<p>You can order query results to make use of the on-disk sorting of columns. 使用存储在磁盘上的列是排序的这个特点来对查询的结果进行排序<br>You can order results in ascending or descending order. 因为列是排序的,你可以对结果进行升序或降序排列.<br>The ascending order will be more efficient than descending. If you need results in descending order, 如果你需要对结果降序排列<br>you can specify a <strong>clustering order</strong> to store columns on disk in the reverse order of the default. 你可以声明存储列时默认按照降序<br>Descending queries will then be <strong>faster</strong> than ascending ones. 这样降序查询会比升序要快</p>
<p>注意: 这里的列指的是Cassandra底层存储的结构对应的列, 而不是CQL中的列(或者通常意义的列).<br>Cassandra的列按照存储结构是指cluster key的值+非CK的名称. 相同的row-key/partition key不同的clust key放在同一行.<br>这些不同的cluster key组成partition key的一列. 列的个数是有限制的.   </p>
</blockquote>
<p><a href="http://www.planetcassandra.org/blog/we-shall-have-order/" target="_blank" rel="external">http://www.planetcassandra.org/blog/we-shall-have-order/</a>  </p>
<blockquote>
<p>In summary, when it comes to ordering your result sets in Cassandra, remember these points:<br>-The clustering column(s) determine the data’s on-disk sort order only within a partition key. 只有特定的partiton key下clust key是排序的<br>-Do not model your table with a “dummy” partition key (key that always has the same value). 如果你的partition key有相同的值, 不要这么设计<br>-It is not necessary to specify the ORDER BY clause on a query if your desired sort direction 如果CLUSTERING ORDER的顺序和你的查询顺序一样,<br> (“ASCending/DESCending”) already matches the CLUSTERING ORDER in the table definition. 查询时不需要指定order by.<br>-On a CREATE TABLE command, Cassandra will specify CLUSTERING ORDER for you in the table definition if you did not specify it yourself.<br> The default CLUSTERING ORDER on a table is comprised of your clustering keys in the “ASCending” sort direction. 默认是按照cluster key升序的<br>-Be mindful of the limit of two billion columns per wide row (partition), as well as the problems that accompany unbounded row growth. 列是有个数限制的<br>-For tables supporting queries for recent, time-based data, you may want to specify a “DESCending” sort direction in your table definition. 最近的记录在定义时使用降序<br>-Do not create a new cluster using the Byte Ordered Partitioner. 不要使用ByteOrderedPartitioner分区方式. </p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> velocity_app (</span><br><span class="line">  <span class="keyword">attribute</span> <span class="built_in">text</span>,       </span><br><span class="line">  partner_code <span class="built_in">text</span>,    </span><br><span class="line">  app_name <span class="built_in">text</span>,        </span><br><span class="line">  <span class="keyword">type</span> <span class="built_in">text</span>,            </span><br><span class="line">  <span class="string">"timestamp"</span> <span class="built_in">bigint</span>,   </span><br><span class="line">  <span class="keyword">event</span> <span class="built_in">text</span>,           </span><br><span class="line">  sequence_id <span class="built_in">text</span>,     </span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> ((<span class="keyword">attribute</span>, partner_code, app_name, <span class="keyword">type</span>), <span class="string">"timestamp"</span>)</span><br><span class="line">) <span class="keyword">WITH</span> <span class="keyword">CLUSTERING</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> (<span class="string">"timestamp"</span> <span class="keyword">DESC</span>)</span></span><br></pre></td></tr></table></figure>
<p>观点1: 在存储的时候就把最近的记录存在前面, 这样读取的时候可以不用指定order by timestamp desc.<br>观点2: 查询的时候还是要指定order by timestamp desc的! 只不过指定了CLUSTERING ORDER BY后, 倒序查询时会快点.<br>结论: 建表时指定了CLUSTERING ORDER BY, 查询时如果倒排, 就不需要再指定了order by desc, 当然指定了也没关系.<br>下面的查询可以看到没有指定order by timestamp desc, 查询出来的timestamp也是倒序排列的. </p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cqlsh:forseti&gt; select <span class="keyword">*</span> from velocity_app where attribute='test_55' and partner_code='koudai' and app_name='koudai_ios' and type='account' limit 2;</span><br><span class="line"> attribute |<span class="string"> partner_code </span>|<span class="string"> app_name   </span>|<span class="string"> type    </span>|<span class="string"> timestamp </span>|<span class="string"> event              </span>|<span class="string"> sequence_id</span><br><span class="line">-----------+--------------+------------+---------+-----------+--------------------+-------------</span><br><span class="line">   test_55 </span>|<span class="string">       koudai </span>|<span class="string"> koudai_ios </span>|<span class="string"> account </span>|<span class="string">  12346595 </span>|<span class="string"> raw event json str </span>|<span class="string">    12346595</span><br><span class="line">   test_55 </span>|<span class="string">       koudai </span>|<span class="string"> koudai_ios </span>|<span class="string"> account </span>|<span class="string">  12346594 </span>|<span class="string"> raw event json str </span>|<span class="string">    12346594</span></span><br></pre></td></tr></table></figure>
<h2 id="现实世界的查询:_Tombstone">现实世界的查询: Tombstone</h2><h3 id="tombstone太多查询中断">tombstone太多查询中断</h3><p>1.<strong>原先查询时没有指定order by, 经常会出现timeout的情况: 查询到10万个tombstone就会timeout, 这是因为查询被中断导致超时的.</strong>    </p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">select <span class="keyword">*</span> from velocity where attribute='58.246.57.66' and partner_code='testDemo' and app_name='testDemo' and type='ipAddress' limit 1000;</span><br><span class="line"></span><br><span class="line">Request did not complete within rpc_timeout.</span><br><span class="line">       Skipped 0/5 non-slice-intersecting sstables, included 0 due to tombstones |<span class="string"> 15:23:59,601 </span>|<span class="string"> 192.168.47.203 </span>|<span class="string">            830</span><br><span class="line">                                      Merging data from memtables and 5 sstables </span>|<span class="string"> 15:23:59,601 </span>|<span class="string"> 192.168.47.203 </span>|<span class="string">            838</span><br><span class="line"> Scanned over 100000 tombstones; query aborted (see tombstone_failure_threshold) </span>|<span class="string"> 15:23:59,929 </span>|<span class="string"> 192.168.47.203 </span>|<span class="string">         328301</span><br><span class="line"> Scanned over 100000 tombstones; query aborted (see tombstone_failure_threshold) </span>|<span class="string"> 15:24:00,068 </span>|<span class="string"> 192.168.47.222 </span>|<span class="string">         502772</span><br><span class="line">                                            Timed out; received 0 of 1 responses </span>|<span class="string"> 15:24:01,565 </span>|<span class="string"> 192.168.47.202 </span>|<span class="string">        2000874</span><br><span class="line">                                                                Request complete </span>|<span class="string"> 15:24:01,564 </span>|<span class="string"> 192.168.47.202 </span>|<span class="string">        2000993</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>为什么在查询的时候会出现tombstones?<br>因为默认指定了所有的查询条件除了timestamp外, 那么timestamp是按照升序排列的. 即按照插入记录的timestamp时间升序.<br>但是因为指定了TTL, 所以最先插入的数据在经过TTL后, 会变成tombstone.<br>查询时按照timestamp升序查询, 只要数据存在, 尽管是tombstone没有被真正删除, 也会被查询出来. </p>
</blockquote>
<p>对应使用JavaAPI时在system.log中报错:  </p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ERROR</span> [ReadStage:332] 2015-10-14 13:25:35,597 SliceQueryFilter.java (<span class="keyword">line</span> 206) Scanned over 100000 tombstones <span class="keyword">in</span> forseti.velocity; <span class="keyword">query</span> aborted (see tombstone_failure_threshold)</span><br><span class="line"><span class="keyword">ERROR</span> [ReadStage:332] 2015-10-14 13:25:35,597 CassandraDaemon.java (<span class="keyword">line</span> 258) Exception <span class="keyword">in</span> thread Thread[ReadStage:332,5,main]</span><br><span class="line">java.lang.RuntimeException: org.apache.cassandra.<span class="keyword">db</span>.filter.TombstoneOverwhelmingException</span><br><span class="line">        at org.apache.cassandra.service.StorageProxy<span class="label">$DroppableRunnable</span>.<span class="keyword">run</span>(StorageProxy.java:2016)</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor<span class="label">$Worker</span>.<span class="keyword">run</span>(ThreadPoolExecutor.java:615)</span><br><span class="line">        at java.lang.Thread.<span class="keyword">run</span>(Thread.java:744)</span><br></pre></td></tr></table></figure>
<p>如果tombstone太多,则查询会被中断, 否则查询方式的图例如下:  </p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">这些tombstone都不计入limit,    开始查询                 达到limit值,停止  -<span class="subst">-&gt;  </span>最终结果: 读取到了<span class="number">1000</span>条记录,并且有xxx个tombstone<span class="subst">!</span> </span><br><span class="line">---------------------------------------------------<span class="subst">-&gt;</span>|</span><br><span class="line">tombstone <span class="attribute">...</span><span class="built_in">.  </span>tombstone <span class="built_in">.. </span>| rc1 rc2 rc3 <span class="attribute">...</span><span class="built_in">. </span>rc1000 rc1001 rc1002 rc1003</span><br></pre></td></tr></table></figure>
<h3 id="orderby+limit查询">orderby+limit查询</h3><ol>
<li><strong>使用order by查询: 不仅解决了数据准确性的问题(查询最近记录), 还解决了超时的问题(tombstone太多)! 可谓一石二鸟!</strong><br>改为按照timestamp倒序查询, 可以看到tombstone cells=0. 耗费时间为62ms(62592). </li>
</ol>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> velocity <span class="keyword">where</span> attribute=<span class="string">'58.246.57.66'</span> <span class="keyword">and</span> partner_code=<span class="string">'testDemo'</span> <span class="keyword">and</span> app_name=<span class="string">'testDemo'</span> <span class="keyword">and</span> <span class="keyword">type</span>=<span class="string">'ipAddress'</span> </span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> partner_code <span class="keyword">desc</span>,app_name <span class="keyword">desc</span>,<span class="keyword">type</span> <span class="keyword">desc</span>,timestamp <span class="keyword">desc</span> limit <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line"> Skipped <span class="number">0</span>/<span class="number">5</span> non-slice-intersecting sstables, included <span class="number">0</span> due <span class="keyword">to</span> tombstones | <span class="number">15</span>:<span class="number">26</span>:<span class="number">13</span>,<span class="number">525</span> | <span class="number">192.168</span>.<span class="number">47.203</span> |            <span class="number">315</span></span><br><span class="line">                                Merging data <span class="keyword">from</span> memtables <span class="keyword">and</span> <span class="number">5</span> sstables | <span class="number">15</span>:<span class="number">26</span>:<span class="number">13</span>,<span class="number">525</span> | <span class="number">192.168</span>.<span class="number">47.203</span> |            <span class="number">323</span></span><br><span class="line">                                      <span class="keyword">Read</span> <span class="number">1001</span> live <span class="keyword">and</span> <span class="number">0</span> tombstone cells | <span class="number">15</span>:<span class="number">26</span>:<span class="number">13</span>,<span class="number">542</span> | <span class="number">192.168</span>.<span class="number">47.203</span> |          <span class="number">17706</span></span><br><span class="line">                                     Enqueuing response <span class="keyword">to</span> /<span class="number">192.168</span>.<span class="number">47.202</span> | <span class="number">15</span>:<span class="number">26</span>:<span class="number">13</span>,<span class="number">542</span> | <span class="number">192.168</span>.<span class="number">47.203</span> |          <span class="number">17852</span></span><br><span class="line">                                        Sending message <span class="keyword">to</span> /<span class="number">192.168</span>.<span class="number">47.202</span> | <span class="number">15</span>:<span class="number">26</span>:<span class="number">13</span>,<span class="number">542</span> | <span class="number">192.168</span>.<span class="number">47.203</span> |          <span class="number">18011</span></span><br><span class="line">                                     Message received <span class="keyword">from</span> /<span class="number">192.168</span>.<span class="number">47.203</span> | <span class="number">15</span>:<span class="number">26</span>:<span class="number">13</span>,<span class="number">551</span> | <span class="number">192.168</span>.<span class="number">47.202</span> |           null</span><br><span class="line">                                  Processing response <span class="keyword">from</span> /<span class="number">192.168</span>.<span class="number">47.203</span> | <span class="number">15</span>:<span class="number">26</span>:<span class="number">13</span>,<span class="number">551</span> | <span class="number">192.168</span>.<span class="number">47.202</span> |           null</span><br><span class="line">                                                          Request complete | <span class="number">15</span>:<span class="number">26</span>:<span class="number">13</span>,<span class="number">548</span> | <span class="number">192.168</span>.<span class="number">47.202</span> |          <span class="number">62592</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>这里为什么没有查询tombstone. 因为按照时间倒序查询, 最近的数据一定不会过期. 而TTL=3M, 没有过期的数据不止1000条,<br>所以在这1000条数据里都没有TTL的数据, 即没有tombstone.<br>那么如果没有过期的数据没有1000条, 我们要求limit 1000, 会不会查询存在于TTL中的数据(比如TTL的数据很多)?</p>
</blockquote>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">                                      到达limit值,可以看到没有一个tobstone</span><br><span class="line">                                       <span class="string">|&lt;----------------------------------- 倒排是从这里往前查询的</span></span><br><span class="line">tombstone ....  tombstone .. <span class="string">| rc1 rc2 rc3 .... rc1000 rc1001 rc1002 rc1003</span></span><br><span class="line"></span><br><span class="line">                               <span class="string">|&lt;------------------------ 存活的没有1000条呢? 会不会去查询tombstone?</span></span><br><span class="line">tombstone ....  tombstone .. <span class="string">| rc1 rc2 rc3 .... rc500 r501</span></span><br></pre></td></tr></table></figure>
<h3 id="timestamp限制不读取tombstone">timestamp限制不读取tombstone</h3><p>3.<strong>另外的一种解决方式是: 不适用order by,但是对timestamp进行了时间限制, 彻底解决不读取tombstone的问题!</strong><br>优化点2: 因为每条记录的TTL=3Month, 查询时使用条件: <code>timestamp&gt;(当前时间-3M)</code>, 就能保证<code>一定不会有tombstone的记录被查询到</code>!   </p>
<p>在system.log中会出现这样的日志: </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat /var/<span class="built_in">log</span>/cassandra/system.<span class="built_in">log</span> | grep <span class="string">"tombstone cells in forseti.velocity"</span> | tail </span><br><span class="line">WARN [ReadStage:<span class="number">303</span>] <span class="number">2015</span>-<span class="number">10</span>-<span class="number">14</span> <span class="number">12</span>:<span class="number">30</span>:<span class="number">25</span>,<span class="number">333</span> SliceQueryFilter.java (line <span class="number">231</span>) Read <span class="number">1001</span> live and <span class="number">1110</span> tombstone cells in forseti.velocity (see tombstone_warn_threshold). </span><br><span class="line"> <span class="number">1000</span> columns was requested, slices=[jiedaibao:jiedaibao_andro:accountPassword-jiedaibao:jiedaibao_andro:accountPassword:!]</span><br><span class="line">WARN [ReadStage:<span class="number">352</span>] <span class="number">2015</span>-<span class="number">10</span>-<span class="number">14</span> <span class="number">12</span>:<span class="number">30</span>:<span class="number">37</span>,<span class="number">635</span> SliceQueryFilter.java (line <span class="number">231</span>) Read <span class="number">1001</span> live and <span class="number">45075</span> tombstone cells in forseti.velocity (see tombstone_warn_threshold). </span><br><span class="line"> <span class="number">1000</span> columns was requested, slices=[koudai:weidian:payeeIdNumber-koudai:weidian:payeeIdNumber:!]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>上面的日志是对应用内的查询优化后(使用order+limit查询)打印的一些日志, 而按照我们的理解:<br>倒排后limit 1000条记录, 如果没有过期的有不止1000条, 那么是不会有tombstone出现的. 那么为什么会出现查到了1001条,仍然有tombstone呢?<br>难道这些查询记录是合作方,全局的吗, 那么为什么slices包括了partner_code:app_name:type.<br>注意: slices是个范围查询[xxx-yyy]的格式. slice里的是cluser key,没有partition key:attribute和timestamp.</p>
</blockquote>
<p>这种情况是怎么出现的呢? 虽然能够正常查询出来, 但同时带有tombstone.<br>从下面的查询可以看到tombstone的数量对查询的速度还是有一定的影响的: 没有tombstone时是32ms, 2600个tombstone时55ms.  </p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">时间需要有客户端传入, 目前cql虽然能够获取当前时间戳,但不支持时间戳的加减.  </span><br><span class="line"></span><br><span class="line">如果把时间刚好定位在三个月之前的那个时间点(或者之后), 则不会查询到tombstone. </span><br><span class="line">Read <span class="number">1001</span> live <span class="literal">and</span> <span class="number">0</span> tombstone cells,, <span class="number">32</span>ms</span><br><span class="line"></span><br><span class="line">稍微过几秒, 会有少量的tombstone.</span><br><span class="line">Read <span class="number">1001</span> live <span class="literal">and</span> <span class="number">45</span> tombstone cells,, <span class="number">33</span>ms</span><br><span class="line"></span><br><span class="line">select * from velocity where attribute='<span class="number">58.246</span>.<span class="number">57.66</span>' <span class="literal">and</span> partner_code='testDemo' <span class="literal">and</span> app_name='testDemo' <span class="literal">and</span> type='ipAddress' </span><br><span class="line"><span class="literal">and</span> timestamp&gt;<span class="number">1437645780000</span> limit <span class="number">1000</span><span class="comment">;</span></span><br><span class="line">Read <span class="number">1001</span> live <span class="literal">and</span> <span class="number">519</span> tombstone cells,, <span class="number">44</span>ms</span><br><span class="line"></span><br><span class="line"><span class="label">半个小时:</span>  </span><br><span class="line">select * from velocity where attribute='<span class="number">58.246</span>.<span class="number">57.66</span>' <span class="literal">and</span> partner_code='testDemo' <span class="literal">and</span> app_name='testDemo' <span class="literal">and</span> type='ipAddress' </span><br><span class="line"><span class="literal">and</span> timestamp&gt;<span class="number">1437643644000</span> limit <span class="number">1000</span><span class="comment">;</span></span><br><span class="line">Read <span class="number">1001</span> live <span class="literal">and</span> <span class="number">2661</span> tombstone cells,,<span class="number">55</span>ms</span><br></pre></td></tr></table></figure>
<h3 id="orderby_+_timestamp">orderby + timestamp</h3><p>把order by和timestamp的时间限制结合起来: 虽然有时候两者差不多, 但总体来说没有orderby还是高一点.<br>并且order by+timestamp不会有tombstone被查询出来. 而只有timestamp是会有tombstone的.<br>经过测试, 只有order by也不会有tombstone.  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">1.只有timestamp</span><br><span class="line"><span class="operator"><span class="keyword">select</span> * <span class="keyword">from</span> velocity <span class="keyword">where</span> <span class="keyword">attribute</span>=<span class="string">'58.246.57.66'</span> <span class="keyword">and</span> partner_code=<span class="string">'testDemo'</span> <span class="keyword">and</span> app_name=<span class="string">'testDemo'</span> <span class="keyword">and</span> <span class="keyword">type</span>=<span class="string">'ipAddress'</span> <span class="keyword">and</span> <span class="keyword">timestamp</span>&gt;<span class="number">1437710925000</span> <span class="keyword">limit</span> <span class="number">1000</span>;</span></span><br><span class="line">Read 1001 live and 111 tombstone cells</span><br><span class="line">111: 38ms, </span><br><span class="line">162: 71ms,</span><br><span class="line">207: 51ms</span><br><span class="line">2241: 79ms</span><br><span class="line"></span><br><span class="line">2.只有order by </span><br><span class="line"><span class="operator"><span class="keyword">select</span> * <span class="keyword">from</span> velocity <span class="keyword">where</span> <span class="keyword">attribute</span>=<span class="string">'58.246.57.66'</span> <span class="keyword">and</span> partner_code=<span class="string">'testDemo'</span> <span class="keyword">and</span> app_name=<span class="string">'testDemo'</span> <span class="keyword">and</span> <span class="keyword">type</span>=<span class="string">'ipAddress'</span> <span class="keyword">order</span> <span class="keyword">by</span> partner_code <span class="keyword">desc</span>,app_name <span class="keyword">desc</span>,<span class="keyword">type</span> <span class="keyword">desc</span>,<span class="keyword">timestamp</span> <span class="keyword">desc</span> <span class="keyword">limit</span> <span class="number">1000</span>;</span></span><br><span class="line">Read 1001 live and 0 tombstone cells</span><br><span class="line">39ms, </span><br><span class="line">ø</span><br><span class="line">3.order by + timestamp</span><br><span class="line"><span class="operator"><span class="keyword">select</span> * <span class="keyword">from</span> velocity <span class="keyword">where</span> <span class="keyword">attribute</span>=<span class="string">'58.246.57.66'</span> <span class="keyword">and</span> partner_code=<span class="string">'testDemo'</span> <span class="keyword">and</span> app_name=<span class="string">'testDemo'</span> <span class="keyword">and</span> <span class="keyword">type</span>=<span class="string">'ipAddress'</span> <span class="keyword">and</span> <span class="keyword">timestamp</span>&gt;<span class="number">1437710925000</span> <span class="keyword">order</span> <span class="keyword">by</span> partner_code <span class="keyword">desc</span>,app_name <span class="keyword">desc</span>,<span class="keyword">type</span> <span class="keyword">desc</span>,<span class="keyword">timestamp</span> <span class="keyword">desc</span> <span class="keyword">limit</span> <span class="number">1000</span>;</span></span><br><span class="line">Read 1001 live and 0 tombstone cells</span><br><span class="line">33ms</span><br></pre></td></tr></table></figure>
<p>查询只有几条alive, 但是tombstone超过1万条的记录: </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cat /var/<span class="built_in">log</span>/cassandra/system.<span class="built_in">log</span> | grep <span class="string">"Read [0-9] live and [0-9][0-9][0-9][0-9][0-9] tombstone cells in forseti.velocity"</span></span><br><span class="line"></span><br><span class="line"> WARN [ReadStage:<span class="number">403</span>] <span class="number">2015</span>-<span class="number">10</span>-<span class="number">17</span> <span class="number">15</span>:<span class="number">06</span>:<span class="number">22</span>,<span class="number">030</span> SliceQueryFilter.java (line <span class="number">231</span>) Read <span class="number">1</span> live and <span class="number">26295</span> tombstone cells in forseti.velocity (see tombstone_warn_threshold). <span class="number">1000</span> columns was requested, slices=[testDemo:testDemo:accountMobile-testDemo:testDemo:accountMobile:!]</span><br><span class="line"></span><br><span class="line"> WARN [ReadStage:<span class="number">7030</span>] <span class="number">2015</span>-<span class="number">10</span>-<span class="number">17</span> <span class="number">15</span>:<span class="number">05</span>:<span class="number">33</span>,<span class="number">481</span> SliceQueryFilter.java (line <span class="number">231</span>) Read <span class="number">0</span> live and <span class="number">26295</span> tombstone cells in forseti.velocity (see tombstone_warn_threshold). <span class="number">1000</span> columns was requested, slices=[testDemo:testDemo:accountMobile-testDemo:testDemo:accountMobile:!]</span><br><span class="line"> WARN [ReadStage:<span class="number">6968</span>] <span class="number">2015</span>-<span class="number">10</span>-<span class="number">18</span> <span class="number">12</span>:<span class="number">12</span>:<span class="number">39</span>,<span class="number">221</span> SliceQueryFilter.java (line <span class="number">231</span>) Read <span class="number">1</span> live and <span class="number">15990</span> tombstone cells in forseti.velocity (see tombstone_warn_threshold). <span class="number">1000</span> columns was requested, slices=[testDemo:testDemo:ipAddress-testDemo:testDemo:ipAddress:!]</span><br><span class="line"> WARN [ReadStage:<span class="number">7024</span>] <span class="number">2015</span>-<span class="number">10</span>-<span class="number">21</span> <span class="number">15</span>:<span class="number">46</span>:<span class="number">03</span>,<span class="number">710</span> SliceQueryFilter.java (line <span class="number">231</span>) Read <span class="number">2</span> live and <span class="number">60159</span> tombstone cells in forseti.velocity (see tombstone_warn_threshold). <span class="number">1</span> columns was requested, slices=[testDemo:testDemo:ipAddress:<span class="number">1437580800000</span>:!-testDemo:testDemo:ipAddress:!]</span><br><span class="line"> WARN [ReadStage:<span class="number">7038</span>] <span class="number">2015</span>-<span class="number">10</span>-<span class="number">21</span> <span class="number">15</span>:<span class="number">47</span>:<span class="number">02</span>,<span class="number">929</span> SliceQueryFilter.java (line <span class="number">231</span>) Read <span class="number">6</span> live and <span class="number">60333</span> tombstone cells in forseti.velocity (see tombstone_warn_threshold). <span class="number">5</span> columns was requested, slices=[testDemo:testDemo:ipAddress:<span class="number">1437580800000</span>:!-testDemo:testDemo:ipAddress:!]</span><br></pre></td></tr></table></figure>
<h3 id="orderby+limit如果存活的记录数没有超过limit,是否会查询TTL的数据?">orderby+limit如果存活的记录数没有超过limit,是否会查询TTL的数据?</h3><p>TombstoneQueryTest:  插入103条, Delete 50条.  </p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> velocity <span class="keyword">where</span> attribute=<span class="string">'test2'</span> <span class="keyword">and</span> partner_code=<span class="string">'koudai'</span> <span class="keyword">and</span> app_name=<span class="string">'koudai_ios'</span> <span class="keyword">and</span> <span class="keyword">type</span>=<span class="string">'account'</span> </span><br><span class="line"></span><br><span class="line">limit <span class="number">10</span>;   </span><br><span class="line">limit <span class="number">100</span>; </span><br><span class="line">上面默认升序查询, 有多少个tombstone cells都是一样的, 只不过live的数量跟limit有关系: </span><br><span class="line"><span class="keyword">Read</span> <span class="number">11</span> live <span class="keyword">and</span> <span class="number">15</span> tombstone cells</span><br><span class="line"><span class="keyword">Read</span> <span class="number">95</span> live <span class="keyword">and</span> <span class="number">15</span> tombstone cells</span><br><span class="line"></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> partner_code <span class="keyword">desc</span>,app_name <span class="keyword">desc</span>,<span class="keyword">type</span> <span class="keyword">desc</span>,timestamp <span class="keyword">desc</span> limit <span class="number">30</span>; <span class="comment">//降序查询, 查询部分存活. 即全部存活的不止30个. </span></span><br><span class="line"><span class="keyword">Read</span> <span class="number">31</span> live <span class="keyword">and</span> <span class="number">0</span> tombstone cells</span><br><span class="line"></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> partner_code <span class="keyword">desc</span>,app_name <span class="keyword">desc</span>,<span class="keyword">type</span> <span class="keyword">desc</span>,timestamp <span class="keyword">desc</span> limit <span class="number">100</span>; <span class="comment">//降序查询, 全部存活. 但是全部存活的都没有满足limit, 会去查询TTL的吗?</span></span><br><span class="line"><span class="keyword">Read</span> <span class="number">90</span> live <span class="keyword">and</span> <span class="number">30</span> tombstone cells</span><br><span class="line">在经过<span class="number">50</span>m, 失效了<span class="number">5</span>条记录, tombstones=<span class="number">5</span>*<span class="number">3</span>=<span class="number">15</span></span><br><span class="line"><span class="keyword">Read</span> <span class="number">85</span> live <span class="keyword">and</span> <span class="number">45</span> tombstone cells</span><br></pre></td></tr></table></figure>
<h3 id="tombstone使用经验">tombstone使用经验</h3><p><a href="http://yangzhe1991.org/blog/2015/05/using-cassandra-for-one-year/" target="_blank" rel="external">http://yangzhe1991.org/blog/2015/05/using-cassandra-for-one-year/</a>  </p>
<blockquote>
<p>LSM类的数据库都是把删除替换为写入一个标记，叫tombstone。HBase也差不多的原理，删除数据的话把tombstone写到log里，<br>compaction的时候如果遇到tombstone就可以不用保留已经被删的数据，读数据的时候遇到tombstone就屏蔽掉数据并且跳过，最后返回所有没删的数据。<br>但是，C<em>因为并不是靠单个region server来读写数据，而是N个节点同时读写，所以跟HBase最大的区别，就是每个节点维护tombstone的时候不能只考虑自己。<br>于是某单个节点读数据的时候读到tombstone后，不能屏蔽掉data然后跳过，而是要`<em>*把tombstone也返回给接受client请求的那个coordinator</em></em>`，<br>因为你不知道其他节点是否写入了这个tombstone（因为写入W个就算成功）。<br>而且在compaction的时候不能判断说当前节点跟这个tombstone有关的数据都删完了就把自己也删了，<br>因为你不确定别的节点有没有这个tombstone——如果别的节点在写tombstone的时候没写成（毕竟写W个节点就算成功，最多N-W个节点没有这个tombstone），<br>自己又在compaction的时候把tombstone删了，那么再读数据的时候有节点有这行数据，又没有节点有这行数据的tombstone，于是这个数据就复活了……  </p>
<p>处理这两个tombstone导致的问题，解决方案就是，首先避免大量tombstone的生成。如果不能避免量删column key，那么一定要<code>**避免对column key做范围查找**</code>。<br>(对column key做范围查找指的是查询一个row key的多个column, 对相同的partition key, 可以很多个column)<br>因为读的时候会把所有范围内包含的tombstone返回给coordinator，而tombstone又不是有效的返回数据不能用来分页，<br>导致<code>可能client设limit 100，期望读100行数据，但对节点来说是100行数据+中间穿插的1000个tombstone，gc压力、响应时间跟读1100行数据差不多</code>。<br>所以C*默认会在一次读取遇到几万个tombstone的时候强制终止读取数据抛异常。  </p>
</blockquote>
<p>partition key的使用经验:  </p>
<blockquote>
<p>C*不对column key做bloom filter的优化, 只对row key做BF优化。而HBase我记得是可以有的。<br>于是这就导致如果读特定某行数据，如果table的定义是所有primary key都是partition key，那么可能bloom filter过滤完只需要读一个SSTable，<br>但如果有column key，而且<code>partition key下面有非常多行数据，那么bloom filter对column key不起作用</code>，<br>这个partition key下面的数据分布在多个SSTable里，就需要读所有这些SSTable，影响性能。<br>因此，<code>如果对范围查询没需求，那么就尽量把所有主键都设成partition key</code>  </p>
</blockquote>
<p><a href="http://yangzhe1991.org/blog/2014/08/cassandra删除数据的坑" target="_blank" rel="external">http://yangzhe1991.org/blog/2014/08/cassandra删除数据的坑</a></p>
<blockquote>
<p>Cassandra通过写一条“tombstone”来标记一个数据被删除了。<br>被标记的数据默认要10天(配置文件中的gc_grace_seconds)后且被compaction或cleanup<strong>执行到对应的SSTable</strong>时才会被真正从磁盘删除<br>在select数据的时候，在每个SSTable遇到的<code>所有符合查询条件的tombstone要放内存中</code>从而在合并每个SSTable文件的数据时判断<br>哪些column数据没被删能最终返回，tombstone太多会导致heap被大量占用需要各种GC从而影响性能<br>因此如果经常删除一个row key下的column key(比如因为TTL自动过期,逻辑意义上的一行对应的存储列就会被标记为tombstone)，  </p>
<p>同时又有一次select一个row key下多个column key的需求，很容易遇到这种情况，tombstone很多的时候即使不到10w最终成功读取了，<br>这次读取也会很慢，并很快导致触发年轻代GC(读取到内存中,首先放到Eden,如果量太大,Eden区很快满了触发YGC)从而拖慢整个节点的响应速度。  </p>
</blockquote>
<h3 id="Slice_Query">Slice Query</h3><p><a href="http://www.datastax.com/dev/blog/cassandra-anti-patterns-queues-and-queue-like-datasets" target="_blank" rel="external">http://www.datastax.com/dev/blog/cassandra-anti-patterns-queues-and-queue-like-datasets</a></p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">A slice query will keep reading columns <span class="keyword">until</span> <span class="constant">one</span> <span class="operator">of</span> <span class="operator">the</span> following condition is met (assuming regular, non-reverse order):  </span><br><span class="line">  - <span class="operator">the</span> specified limit <span class="operator">of</span> live columns has been <span class="built_in">read</span> 只有存活的列才会被计入limit</span><br><span class="line">  - <span class="operator">a</span> column beyond <span class="operator">the</span> finish column has been <span class="built_in">read</span> (<span class="keyword">if</span> specified)</span><br><span class="line">  - all columns <span class="operator">in</span> <span class="operator">the</span> row have been <span class="built_in">read</span> 这一行所有的列都读取完毕</span><br></pre></td></tr></table></figure>
<p><a href="http://aryanet.com/blog/cassandra-garbage-collector-tuning" target="_blank" rel="external">http://aryanet.com/blog/cassandra-garbage-collector-tuning</a>  </p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">When you have rows <span class="keyword">with</span> dynamic columns(动态的列,即相同分区键不同CK,可以认为一个动态的列是传统意义的一行数据) <span class="keyword">and</span> your <span class="type">application</span> deletes those columns(删除列), </span><br><span class="line">Cassandra will apply a tombstones <span class="function_start"><span class="keyword">on</span></span> those columns <span class="keyword">until</span> next compaction runs <span class="keyword">and</span> cleans up expired tombstones passed gc_grace_seconds. </span><br><span class="line">When your client <span class="keyword">does</span> a slice query(切片查询) <span class="keyword">to</span> <span class="command">read</span> a few columns(范围查询时查询多列), even <span class="keyword">if</span> majority <span class="keyword">of</span> columns were perviously deleted, </span><br><span class="line">Cassandra will have <span class="keyword">to</span> <span class="command">read</span> <span class="keyword">and</span> scan all <span class="keyword">the</span> tombstones <span class="keyword">in</span> order <span class="keyword">to</span> find [<span class="keyword">as</span> may non deleted columns** <span class="keyword">as</span> you requested <span class="keyword">in</span> your slice query.</span><br></pre></td></tr></table></figure>
<h2 id="Paging_Query">Paging Query</h2><p><a href="https://ahappyknockoutmouse.wordpress.com/2014/11/12/246/" target="_blank" rel="external">https://ahappyknockoutmouse.wordpress.com/2014/11/12/246/</a><br><a href="http://www.datastax.com/dev/blog/client-side-improvements-in-cassandra-2-0" target="_blank" rel="external">http://www.datastax.com/dev/blog/client-side-improvements-in-cassandra-2-0</a>  </p>
<ol>
<li>I have some difficulties with paging through a row set, is there some examples available?</li>
</ol>
<blockquote>
<p>Prior to Cassandra 2.0, tricks were used to page through a large result set. However, Cassandra 2.0 has auto paging. 自动分页功能<br>Instead of using token function to create paging, it is now a built-in feature. 不适用token函数来分页,而是只用内置的自动分页功能.<br>Now developers can iterate over the entire result set, without having to care that it’s size is larger the the memory. 迭代全部数据,不需要关心数据大小能够放到内存中<br>As the client code iterates over the results, some extra rows can be fetched, while old ones are dropped. 客户端迭代结果时,额外的行会被获取,旧的行会被丢弃<br>Looking at this in Java, note that SELECT statement returns all rows, and the number of rows retrieved is set to 100.<br>I’ve shown a simple statement here, but the same code can be written with a prepared statement, couple with a bound statement.<br>It is possible to disable automatic paging if it is not desired. It is also important to test various fetch size settings,<br>since you will want to keep the memorize small enough, but not so small that too many round-trips to the database are taken. </p>
</blockquote>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Statement</span> <span class="type">stmt</span> = new <span class="type">SimpleStatement</span>(<span class="string">"select * FROM raw_weather_data WHERE wsid= '725474:99999' AND year = 2005 AND month = 6"</span>);</span><br><span class="line"><span class="type">stmt</span>.setFetchSize(<span class="number">100</span>);</span><br><span class="line"><span class="type">ResultSet</span> rs = session.execute(<span class="type">stmt</span>);</span><br><span class="line"><span class="type">Iterator</span>&lt;<span class="type">Row</span>&gt; iter = rs.<span class="keyword">iterator</span>();</span><br><span class="line"><span class="keyword">while</span> (!rs.isFullyFetched()) &#123;</span><br><span class="line">   rs.fetchMoreResults();</span><br><span class="line">   <span class="type">Row</span> row = iter.next();</span><br><span class="line">   <span class="type">System</span>.<span class="keyword">out</span>.println(row);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Read_Time_Out">Read Time Out</h2><p>cassandra.yaml中和timeout相关的配置项:  </p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">cross_node_timeout</span>: <span class="string">false</span></span><br><span class="line"><span class="attribute">read_request_timeout_in_ms</span>: <span class="string">2000      读取一条记录的超时为2秒</span></span><br><span class="line"><span class="attribute">range_request_timeout_in_ms</span>: <span class="string">15000    读取多条记录的超时为15秒</span></span><br><span class="line"><span class="attribute">write_request_timeout_in_ms</span>: <span class="string">10000    写请求的超时为10秒</span></span><br><span class="line"><span class="attribute">request_timeout_in_ms</span>: <span class="string">5000           请求超时为5秒</span></span><br><span class="line"><span class="attribute">truncate_request_timeout_in_ms</span>: <span class="string">60000 清空表数据的超时为1分钟</span></span><br><span class="line"><span class="attribute">cas_contention_timeout_in_ms</span>: <span class="string">1000</span></span><br></pre></td></tr></table></figure>
<p>1.read timeout选项:读取一条记录的超时时间为2s, 超过2s这条记录没有返回,就中断查询.<br>示例: tombstone数量超过10万条.  </p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> velocity <span class="keyword">where</span> attribute=<span class="string">'58.246.57.66'</span> <span class="keyword">and</span> partner_code=<span class="string">'testDemo'</span> <span class="keyword">and</span> app_name=<span class="string">'testDemo'</span> <span class="keyword">and</span> <span class="keyword">type</span>=<span class="string">'ipAddress'</span> limit <span class="number">1000</span>;</span><br><span class="line">Request did <span class="keyword">not</span> complete within rpc_timeout.</span><br><span class="line"> Scanned over <span class="number">100000</span> tombstones; query aborted (see tombstone_failure_threshold) | <span class="number">15</span>:<span class="number">24</span>:<span class="number">00</span>,<span class="number">068</span> | <span class="number">192.168</span>.<span class="number">47.222</span> |         <span class="number">502772</span></span><br><span class="line">                                            Timed <span class="keyword">out</span>; received <span class="number">0</span> <span class="keyword">of</span> <span class="number">1</span> responses | <span class="number">15</span>:<span class="number">24</span>:<span class="number">01</span>,<span class="number">565</span> | <span class="number">192.168</span>.<span class="number">47.202</span> |        <span class="number">2000874</span></span><br><span class="line">                                                                Request complete | <span class="number">15</span>:<span class="number">24</span>:<span class="number">01</span>,<span class="number">564</span> | <span class="number">192.168</span>.<span class="number">47.202</span> |        <span class="number">2000993</span></span><br></pre></td></tr></table></figure>
<p>2.range_request_timeout_in_ms=15s: 范围查询的超时时间为15s.<br>示例: truncate一张表的数据, 然后查询limit 1. 或者count(*)查询全部数据:  </p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cqlsh:forseti&gt; select * from activity_detail limit 1<span class="comment">;</span></span><br><span class="line">Request did not complete within rpc_timeout.</span><br><span class="line"> Executing seq scan across 15 sstables for (max(-<span class="number">845199564809</span><span class="number">2911156</span>), max(-<span class="number">83995602364</span><span class="number">95679024</span>)] | <span class="number">09:35:20,165</span> | <span class="number">192.168.47.203</span> |            197</span><br><span class="line">                                       Timed out<span class="comment">; received 0 of 1 responses for range 144 of 3329 | 09:35:35,149 | 192.168.47.202 |       15148870</span></span><br><span class="line">                                                                                 Request complete | <span class="number">09:35:35,149</span> | <span class="number">192.168.47.202</span> |       <span class="number">15149076</span></span><br><span class="line"></span><br><span class="line">cqlsh:forseti&gt; select count(*) from activity_detail<span class="comment">;</span></span><br><span class="line">Request did not complete within rpc_timeout.</span><br><span class="line"> Executing seq scan across 15 sstables for (max(-<span class="number">92094347386</span><span class="number">68044748</span>), max(-<span class="number">91949352864</span><span class="number">58247645</span>)] | <span class="number">09:39:28,45</span>3 | <span class="number">192.168.47.203</span> |            154</span><br><span class="line">                                        Timed out<span class="comment">; received 0 of 1 responses for range 10 of 3329 | 09:39:43,435 | 192.168.47.202 |       15010833</span></span><br><span class="line">                                                                                 Request complete | <span class="number">09:39:43,43</span>4 | <span class="number">192.168.47.202</span> |       <span class="number">15010948</span></span><br></pre></td></tr></table></figure>
<p>3.查询就是会超时怎么办,而且不是因为tombstone太多,没办法加限制条件</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"> activity                                                                                                                |<span class="string"> timestamp    </span>|<span class="string"> source         </span>|<span class="string"> source_elapsed</span><br><span class="line">-------------------------------------------------------------------------------------------------------------------------+--------------+----------------+----------------</span><br><span class="line">                                                                                                      execute_cql3_query </span>|<span class="string"> 15:38:26,989 </span>|<span class="string"> 192.168.48.159 </span>|<span class="string">              0</span><br><span class="line"> Parsing SELECT * from android_device_session where session_id = 'Android_....................................' limit 1; </span>|<span class="string"> 15:38:26,989 </span>|<span class="string"> 192.168.48.159 </span>|<span class="string">             51</span><br><span class="line">                                                                                                     Preparing statement </span>|<span class="string"> 15:38:26,989 </span>|<span class="string"> 192.168.48.159 </span>|<span class="string">            154</span><br><span class="line">                                                              Executing single-partition query on android_device_session </span>|<span class="string"> 15:38:26,989 </span>|<span class="string"> 192.168.48.159 </span>|<span class="string">            305</span><br><span class="line">                                                                                            Acquiring sstable references </span>|<span class="string"> 15:38:26,989 </span>|<span class="string"> 192.168.48.159 </span>|<span class="string">            315</span><br><span class="line">                                                                                             Merging memtable tombstones </span>|<span class="string"> 15:38:26,989 </span>|<span class="string"> 192.168.48.159 </span>|<span class="string">            347</span><br><span class="line">                                                                             Bloom filter allows skipping sstable 542646 </span>|<span class="string"> 15:38:26,989 </span>|<span class="string"> 192.168.48.159 </span>|<span class="string">            382</span><br><span class="line">                                                                             Bloom filter allows skipping sstable 542645 </span>|<span class="string"> 15:38:26,989 </span>|<span class="string"> 192.168.48.159 </span>|<span class="string">            394</span><br><span class="line">                                                                             Bloom filter allows skipping sstable 542640 </span>|<span class="string"> 15:38:26,989 </span>|<span class="string"> 192.168.48.159 </span>|<span class="string">            404</span><br><span class="line">                                                                             Bloom filter allows skipping sstable 542635 </span>|<span class="string"> 15:38:26,989 </span>|<span class="string"> 192.168.48.159 </span>|<span class="string">            418</span><br><span class="line">                                                                             Bloom filter allows skipping sstable 542631 </span>|<span class="string"> 15:38:26,989 </span>|<span class="string"> 192.168.48.159 </span>|<span class="string">            431</span><br><span class="line">                                                                             Bloom filter allows skipping sstable 542546 </span>|<span class="string"> 15:38:26,989 </span>|<span class="string"> 192.168.48.159 </span>|<span class="string">            441</span><br><span class="line">                                                                                        Key cache hit for sstable 542489 </span>|<span class="string"> 15:38:26,989 </span>|<span class="string"> 192.168.48.159 </span>|<span class="string">            456</span><br><span class="line">                                                                             Seeking to partition beginning in data file </span>|<span class="string"> 15:38:26,989 </span>|<span class="string"> 192.168.48.159 </span>|<span class="string">            461</span><br><span class="line">                                                                             Bloom filter allows skipping sstable 541100 </span>|<span class="string"> 15:38:26,989 </span>|<span class="string"> 192.168.48.159 </span>|<span class="string">            817</span><br><span class="line">                                                                                        Key cache hit for sstable 539754 </span>|<span class="string"> 15:38:26,989 </span>|<span class="string"> 192.168.48.159 </span>|<span class="string">            838</span><br><span class="line">                                                                             Seeking to partition beginning in data file </span>|<span class="string"> 15:38:26,989 </span>|<span class="string"> 192.168.48.159 </span>|<span class="string">            844</span><br><span class="line">                                                                             Bloom filter allows skipping sstable 538761 </span>|<span class="string"> 15:38:26,990 </span>|<span class="string"> 192.168.48.159 </span>|<span class="string">           1050</span><br><span class="line">                                                                             Bloom filter allows skipping sstable 528588 </span>|<span class="string"> 15:38:26,990 </span>|<span class="string"> 192.168.48.159 </span>|<span class="string">           1064</span><br><span class="line">                                                                             Bloom filter allows skipping sstable 540223 </span>|<span class="string"> 15:38:26,990 </span>|<span class="string"> 192.168.48.159 </span>|<span class="string">           1079</span><br><span class="line">                                                                             Bloom filter allows skipping sstable 500552 </span>|<span class="string"> 15:38:26,990 </span>|<span class="string"> 192.168.48.159 </span>|<span class="string">           1090</span><br><span class="line">                                                                             Bloom filter allows skipping sstable 436090 </span>|<span class="string"> 15:38:26,990 </span>|<span class="string"> 192.168.48.159 </span>|<span class="string">           1100</span><br><span class="line">                                                                             Bloom filter allows skipping sstable 375563 </span>|<span class="string"> 15:38:26,990 </span>|<span class="string"> 192.168.48.159 </span>|<span class="string">           1111</span><br><span class="line">                                                                                        Key cache hit for sstable 275761 </span>|<span class="string"> 15:38:26,990 </span>|<span class="string"> 192.168.48.159 </span>|<span class="string">           1130</span><br><span class="line">                                                                             Seeking to partition beginning in data file </span>|<span class="string"> 15:38:26,990 </span>|<span class="string"> 192.168.48.159 </span>|<span class="string">           1138</span><br><span class="line">                                                                                        Key cache hit for sstable 180212 </span>|<span class="string"> 15:38:26,990 </span>|<span class="string"> 192.168.48.159 </span>|<span class="string">           1362</span><br><span class="line">                                                                             Seeking to partition beginning in data file </span>|<span class="string"> 15:38:26,990 </span>|<span class="string"> 192.168.48.159 </span>|<span class="string">           1370</span><br><span class="line">                                                                                    Timed out; received 0 of 1 responses </span>|<span class="string"> 15:38:28,989 </span>|<span class="string"> 192.168.48.159 </span>|<span class="string">        2000450</span><br><span class="line">                                                                                                        Request complete </span>|<span class="string"> 15:38:28,989 </span>|<span class="string"> 192.168.48.159 </span>|<span class="string">        2000522</span></span><br></pre></td></tr></table></figure>
<h3 id="Future_Interrupt">Future Interrupt</h3><p>查询方式修改为Future, 但还是存在超过500ms的查询:  </p>
<p><img src="http://img.blog.csdn.net/20151115162040546" alt="velocity_500ms"></p>
<p>一般在监控上超过50ms, zabbix的查询时间就会升高, 而opscenter就会有抖动:  </p>
<p><img src="http://img.blog.csdn.net/20151115163846920" alt="slow_zabbix">  </p>
<p><img src="http://img.blog.csdn.net/20151115163859694" alt="slow_monitor"></p>
<p><img src="http://img.blog.csdn.net/20151115163912127" alt="slow_ops"></p>
<h2 id="More_Abould_Query:_Token?">More Abould Query: Token?</h2><p>Cassandra中的partition key会映射到集群节点VNodes组成的Token中.  通过对partition key计算hash,映射到token环的特定位置.  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">cqlsh:forseti&gt; <span class="function">select <span class="title">token</span><span class="params">(attribute)</span> from velocity limit 1</span>;</span><br><span class="line"> token(attribute)</span><br><span class="line">----------------------</span><br><span class="line"> -<span class="number">9223372016580570173</span></span><br><span class="line">(<span class="number">1</span> rows)</span><br><span class="line"></span><br><span class="line">Tracing session: <span class="number">3</span>d1450b0-<span class="number">7e16</span>-<span class="number">11e5</span>-<span class="number">971e-2</span>bcdca057dae</span><br><span class="line"> activity                                                                                        | timestamp    | source         | source_elapsed</span><br><span class="line">-------------------------------------------------------------------------------------------------+--------------+----------------+----------------</span><br><span class="line">                                                                              execute_cql3_query | <span class="number">16</span>:<span class="number">22</span>:<span class="number">48</span>,<span class="number">380</span> | <span class="number">192.168</span><span class="number">.47</span><span class="number">.202</span> |              <span class="number">0</span></span><br><span class="line">                                          <span class="function">Parsing select <span class="title">token</span><span class="params">(attribute)</span> from velocity limit 1</span>; | <span class="number">16</span>:<span class="number">22</span>:<span class="number">48</span>,<span class="number">380</span> | <span class="number">192.168</span><span class="number">.47</span><span class="number">.202</span> |             <span class="number">81</span></span><br><span class="line">                                                                             Preparing statement | <span class="number">16</span>:<span class="number">22</span>:<span class="number">48</span>,<span class="number">381</span> | <span class="number">192.168</span><span class="number">.47</span><span class="number">.202</span> |            <span class="number">288</span></span><br><span class="line">                                                                   Determining replicas to query | <span class="number">16</span>:<span class="number">22</span>:<span class="number">48</span>,<span class="number">381</span> | <span class="number">192.168</span><span class="number">.47</span><span class="number">.202</span> |            <span class="number">651</span></span><br><span class="line">                                                           Message received from /<span class="number">192.168</span><span class="number">.47</span><span class="number">.202</span> | <span class="number">16</span>:<span class="number">22</span>:<span class="number">48</span>,<span class="number">382</span> | <span class="number">192.168</span><span class="number">.47</span><span class="number">.222</span> |             <span class="number">61</span></span><br><span class="line"> Executing seq scan across <span class="number">6</span> sstables <span class="keyword">for</span> [min(-<span class="number">9223372036854775808</span>), max(-<span class="number">9218212468661360888</span>)] | <span class="number">16</span>:<span class="number">22</span>:<span class="number">48</span>,<span class="number">383</span> | <span class="number">192.168</span><span class="number">.47</span><span class="number">.222</span> |            <span class="number">372</span></span><br><span class="line">                                                            Enqueuing request to /<span class="number">192.168</span><span class="number">.47</span><span class="number">.222</span> | <span class="number">16</span>:<span class="number">22</span>:<span class="number">48</span>,<span class="number">384</span> | <span class="number">192.168</span><span class="number">.47</span><span class="number">.202</span> |           <span class="number">3252</span></span><br><span class="line">                                                              Sending message to /<span class="number">192.168</span><span class="number">.47</span><span class="number">.222</span> | <span class="number">16</span>:<span class="number">22</span>:<span class="number">48</span>,<span class="number">384</span> | <span class="number">192.168</span><span class="number">.47</span><span class="number">.202</span> |           <span class="number">3460</span></span><br><span class="line">                                                     Seeking to partition beginning in data file | <span class="number">16</span>:<span class="number">22</span>:<span class="number">48</span>,<span class="number">386</span> | <span class="number">192.168</span><span class="number">.47</span><span class="number">.222</span> |           <span class="number">3476</span></span><br><span class="line">                                                               Read <span class="number">1</span> live and <span class="number">0</span> tombstone cells | <span class="number">16</span>:<span class="number">22</span>:<span class="number">48</span>,<span class="number">386</span> | <span class="number">192.168</span><span class="number">.47</span><span class="number">.222</span> |           <span class="number">4165</span></span><br><span class="line">                                                     Seeking to partition beginning in data file | <span class="number">16</span>:<span class="number">22</span>:<span class="number">48</span>,<span class="number">387</span> | <span class="number">192.168</span><span class="number">.47</span><span class="number">.222</span> |           <span class="number">4204</span></span><br><span class="line">                                                               Read <span class="number">1</span> live and <span class="number">0</span> tombstone cells | <span class="number">16</span>:<span class="number">22</span>:<span class="number">48</span>,<span class="number">387</span> | <span class="number">192.168</span><span class="number">.47</span><span class="number">.222</span> |           <span class="number">4239</span></span><br><span class="line">                                                                    Scanned <span class="number">1</span> rows and matched <span class="number">1</span> | <span class="number">16</span>:<span class="number">22</span>:<span class="number">48</span>,<span class="number">387</span> | <span class="number">192.168</span><span class="number">.47</span><span class="number">.222</span> |           <span class="number">4341</span></span><br><span class="line">                                                           Enqueuing response to /<span class="number">192.168</span><span class="number">.47</span><span class="number">.202</span> | <span class="number">16</span>:<span class="number">22</span>:<span class="number">48</span>,<span class="number">390</span> | <span class="number">192.168</span><span class="number">.47</span><span class="number">.222</span> |           <span class="number">8042</span></span><br><span class="line">                                                              Sending message to /<span class="number">192.168</span><span class="number">.47</span><span class="number">.202</span> | <span class="number">16</span>:<span class="number">22</span>:<span class="number">48</span>,<span class="number">391</span> | <span class="number">192.168</span><span class="number">.47</span><span class="number">.222</span> |           <span class="number">8272</span></span><br><span class="line">                                                           Message received from /<span class="number">192.168</span><span class="number">.47</span><span class="number">.222</span> | <span class="number">16</span>:<span class="number">22</span>:<span class="number">48</span>,<span class="number">393</span> | <span class="number">192.168</span><span class="number">.47</span><span class="number">.202</span> |          <span class="number">12316</span></span><br><span class="line">                                                        Processing response from /<span class="number">192.168</span><span class="number">.47</span><span class="number">.222</span> | <span class="number">16</span>:<span class="number">22</span>:<span class="number">48</span>,<span class="number">393</span> | <span class="number">192.168</span><span class="number">.47</span><span class="number">.202</span> |          <span class="number">12407</span></span><br><span class="line">                                                                                Request complete | <span class="number">16</span>:<span class="number">22</span>:<span class="number">48</span>,<span class="number">392</span> | <span class="number">192.168</span><span class="number">.47</span><span class="number">.202</span> |          <span class="number">12789</span></span><br></pre></td></tr></table></figure>
<h2 id="Node_down_effect">Node down effect</h2><p>seeds只设置一个节点52, 当52当掉, 即使使用CQL连接53, 也会报错: <code>Unable to complete request: one or more nodes were unavailable.</code></p>
<p>使用API查询时: <code>com.datastax.driver.core.exceptions.UnavailableException: Not enough replica available for query at consistency ONE (1 required but only 0 alive)</code></p>
<p>这是因为副本数=1(keyspace里面设置的). 如果seeds设置两个节点52,53. 当掉52之后, 还是会出现上面的异常.  </p>
<h2 id="TTL">TTL</h2><p><a href="http://docs.datastax.com/en/cql/3.1/cql/cql_using/use_expire_c.html" target="_blank" rel="external">http://docs.datastax.com/en/cql/3.1/cql/cql_using/use_expire_c.html</a><br><a href="http://engblog.polyvore.com/2015/03/cassandra-compaction-and-tombstone.html" target="_blank" rel="external">http://engblog.polyvore.com/2015/03/cassandra-compaction-and-tombstone.html</a>  </p>
<blockquote>
<p>Data in a column, other than a counter column, can have an optional expiration period called TTL (time to live).<br>The client request specifies a TTL value, defined in seconds, for the data.<br>TTL data is marked with a tombstone after the requested amount of time has expired.<br>A tombstone exists for gc_grace_seconds. After data is marked with a tombstone,<br>the data is automatically removed during the normal compaction and repair processes.<br>If you want to change the TTL of expiring data, you have to re-insert the data with a new TTL.</p>
</blockquote>
<p><strong>列</strong>中的数据可以有一个可选的TTL间隔. 当指定的时间过去后,TTL数据(指定的列)会被标记为墓碑.<br>墓碑标记的存活时间为gc_grace_seconds. 如果这个配置=0, 则在整理和修复时会被删除.<br>如果这个配置不为0, 则还会再存活gc_grace_seconds时间. 在这个时间之后, 在整理时才会被删除.<br>如果想要更新TTL的时间, 只能使用新的TTL重新插入数据(C*中的insert是插入或更新,取决于这条数据是否已经存在). </p>
<blockquote>
<p>Since all Cassandra SSTable entries are immutable, any updates or deletes to a row requires a new SSTable entry to be recorded.<br>Values which are deleted are replaced by a tombstone record for the length of time configured in gc_grace_seconds.<br>Cassandra reconciles(使一致) updates by determining the most recent data, and then only returns the valid data to the client.<br>被删除的记录会用tombstone替代, 并且会存活gc_grace_seconds一段时间. </p>
</blockquote>
<p>This means that:  </p>
<ul>
<li>Deletions and storage space recovery are lazy 删除和磁盘空间恢复是懒执行的</li>
<li>A row can fragment across more than one SSTable 一条记录会分段在不止一个SSTable文件中</li>
<li>A tombstone is a fragment of a row 墓碑标记也是一行记录的一个分片(删除后flush到磁盘,这条记录被标记为tombstone)</li>
<li>Reading a row requires reconciling all SSTable entries, and determining the most recent set of data before returning data to the caller.</li>
<li>Increased row fragments spread across multiple SSTables increases response latency.</li>
</ul>
<p><strong>the most recent set of data</strong>: 最近的数据集, 新插入的是最细的.   </p>
<p>tombstone只有出现TTL过期(3Month), 以及DELTE操作(我们的场景没有DELETE).<br>现在的velocity的gc_grace_seconds已经设置为0. 一旦TTL过期, 就会被删除.<br>而记录在达到TTL时, 只有在下一次Compaction的时候, 才会被真正删除.  </p>
<p>因为每条记录都设置了TTL=3Month. 所以每经过一秒钟, 都会有满足TTL的记录存在.<br>所以被标记为tombstone(满足TTL)的记录存活的时间是: TTL到期的那一刻, 到下一次Compaction时.  </p>
<p>那么问题转到SSTable文件什么时候会被Compaction?</p>
<p><a href="http://www.datastax.com/dev/blog/leveled-compaction-in-apache-cassandra" target="_blank" rel="external">http://www.datastax.com/dev/blog/leveled-compaction-in-apache-cassandra</a><br><a href="http://www.datastax.com/dev/blog/when-to-use-leveled-compaction" target="_blank" rel="external">http://www.datastax.com/dev/blog/when-to-use-leveled-compaction</a>  </p>
<blockquote>
<p>LeveledCompactionStrategy (LCS): The leveled compaction strategy creates SSTables of a fixed,<br>relatively small size (160 MB by default) that are grouped into levels.<br>Within each level, SSTables are guaranteed to be non-overlapping(不会重叠).<br>Each level (L0, L1, L2 and so on) is 10 times as large as the previous(每一级都都是前一级别10倍).<br>Disk I/O is more uniform(一致) and predictable on higher than on lower levels(高的级别比低级别更一致) as<br>SSTables are continuously(持续) being compacted into progressively(逐步) larger levels.<br>At each level, row keys are merged into non-overlapping SSTables.<br>This can improve performance for reads, because Cassandra can determine<br>which SSTables in each level to check for the existence of row key data. </p>
</blockquote>
<p>Compaction的子属性配置: <a href="http://docs.datastax.com/en/cql/3.1/cql/cql_reference/compactSubprop.html?scroll=compactSubprop__compactionSubpropertiesLCS" target="_blank" rel="external">http://docs.datastax.com/en/cql/3.1/cql/cql_reference/compactSubprop.html?scroll=compactSubprop__compactionSubpropertiesLCS</a></p>
<p><a href="http://stackoverflow.com/questions/29132033/cassandra-low-read-performance-with-high-sstable-count" target="_blank" rel="external">http://stackoverflow.com/questions/29132033/cassandra-low-read-performance-with-high-sstable-count</a><br>If you are updating data within the same partition frequently and at different times, 对相同的partition在不同的时间段做频繁的更新<br>you could consider using LeveledCompactionStrategy. 可以使用分层级的整理压紧策略<br>LCS will keep data from the same partition together in the same SSTable within a level 在一个层级中将相同的分区数据放在同一个SSTable文件<br>which greatly improves read performance, at the cost of more Disk I/O doing compaction. 可以提升读性能(因为只读一个文件),但是整理时需要更多的IO操作<br>In my experience, the extra compaction disk I/O more than pays off in read performance if you have a high ratio of reads to writes.</p>
<h3 id="TTL是针对行,_还是针对列">TTL是针对行, 还是针对列</h3><p><code>INSERT INTO users (user_name, password) VALUES (&#39;cbrown&#39;, &#39;ch@ngem4a&#39;) USING TTL 86400;</code></p>
<p>问: 使用TTL后, 经过86400秒后, 这条数据(一行)在CQL中不会被查询到. 那么上面说的Column是什么意思,为什么不是Row?<br>答: Cassandra的Column实际上就是传统DB中认为的一行!  </p>
<p><a href="http://cjwebb.github.io/blog/2015/03/02/cassandra-ttl-is-per-column/" target="_blank" rel="external">http://cjwebb.github.io/blog/2015/03/02/cassandra-ttl-is-per-column/</a><br>这篇文章在第一次插入时制定了一个TTL, 然后使用insert into只更新其中的一个字段,并使用新的TTL.<br>这样对于两个不同的字段, 它们的TTL时间就不同. 因此这条记录的两个字段, 会在不同的时间点失效.<br>那么问题是: 如果这两个字段都失效后, 这条记录还可不可见, 还是说可见, 但是两个字段为NULL. -&gt; 不可见! </p>
<h3 id="插入数据时using_TTL">插入数据时using TTL</h3><p>建表时指定default_time_to_live=0,<br>在插入时不指定ttl(test), 表示数据不会过期. 查询时ttl为null<br>在插入时指定ttl(test3), 则这一行数据在经过TTL后会过期被删除. </p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cqlsh:forseti&gt; select ttl(event) from velocity where attribute=<span class="emphasis">'test'</span> limit 1;</span><br><span class="line"><span class="header"> ttl(event)</span><br><span class="line">------------</span></span><br><span class="line"><span class="code">       null</span></span><br><span class="line"></span><br><span class="line">cqlsh:forseti&gt; select ttl(event) from velocity where attribute=<span class="emphasis">'test3'</span> limit 1;</span><br><span class="line"><span class="header"> ttl(event)</span><br><span class="line">------------</span></span><br><span class="line"><span class="code">       3544</span></span><br></pre></td></tr></table></figure>
<h3 id="测试Table的default_ttl">测试Table的default ttl</h3><p>1.创建表时指定默认的TTL, 插入数据时不用using TTL  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> velocity_test (</span><br><span class="line">  <span class="keyword">attribute</span> <span class="built_in">text</span>,       </span><br><span class="line">  partner_code <span class="built_in">text</span>,    </span><br><span class="line">  app_name <span class="built_in">text</span>,        </span><br><span class="line">  <span class="keyword">type</span> <span class="built_in">text</span>,            </span><br><span class="line">  <span class="string">"timestamp"</span> <span class="built_in">bigint</span>,   </span><br><span class="line">  <span class="keyword">event</span> <span class="built_in">text</span>,           </span><br><span class="line">  sequence_id <span class="built_in">text</span>,     </span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> ((<span class="keyword">attribute</span>, partner_code, app_name, <span class="keyword">type</span>), <span class="string">"timestamp"</span>)</span><br><span class="line">) <span class="keyword">WITH</span></span><br><span class="line">  bloom_filter_fp_chance=<span class="number">0.100000</span> <span class="keyword">AND</span></span><br><span class="line">  <span class="keyword">caching</span>=<span class="string">'ALL'</span> <span class="keyword">AND</span></span><br><span class="line">  <span class="keyword">comment</span>=<span class="string">''</span> <span class="keyword">AND</span></span><br><span class="line">  dclocal_read_repair_chance=<span class="number">0.000000</span> <span class="keyword">AND</span></span><br><span class="line">  gc_grace_seconds=<span class="number">0</span> <span class="keyword">AND</span></span><br><span class="line">  index_interval=<span class="number">128</span> <span class="keyword">AND</span></span><br><span class="line">  read_repair_chance=<span class="number">0.100000</span> <span class="keyword">AND</span></span><br><span class="line">  replicate_on_write=<span class="string">'true'</span> <span class="keyword">AND</span></span><br><span class="line">  populate_io_cache_on_flush=<span class="string">'false'</span> <span class="keyword">AND</span></span><br><span class="line">  default_time_to_live=<span class="number">3600</span> <span class="keyword">AND</span></span><br><span class="line">  speculative_retry=<span class="string">'99.0PERCENTILE'</span> <span class="keyword">AND</span></span><br><span class="line">  memtable_flush_period_in_ms=<span class="number">0</span> <span class="keyword">AND</span></span><br><span class="line">  compaction=&#123;<span class="string">'unchecked_tombstone_compaction'</span>: <span class="string">'true'</span>, <span class="string">'tombstone_threshold'</span>: <span class="string">'0.1'</span>, <span class="string">'class'</span>: <span class="string">'LeveledCompactionStrategy'</span>&#125; <span class="keyword">AND</span></span><br><span class="line">  compression=&#123;<span class="string">'sstable_compression'</span>: <span class="string">'LZ4Compressor'</span>&#125;;</span></span><br></pre></td></tr></table></figure>
<p>使用CassandraClient或者原始API插入数据后, 查看非primary key的ttl:  </p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cqlsh:forseti&gt; <span class="keyword">select</span> ttl(<span class="keyword">event</span>) <span class="keyword">from</span> velocity_test <span class="keyword">where</span> attribute=<span class="string">'test'</span> <span class="keyword">and</span> partner_code=<span class="string">'koudai'</span> <span class="keyword">and</span> app_name=<span class="string">'koudai_ios'</span> <span class="keyword">and</span> <span class="keyword">type</span>=<span class="string">'account'</span> limit <span class="number">1</span>;</span><br><span class="line"> ttl(<span class="keyword">event</span>)</span><br><span class="line">------------</span><br><span class="line">       <span class="number">3310</span></span><br><span class="line">(<span class="number">1</span> rows)</span><br></pre></td></tr></table></figure>
<p>2.修改Table的 default_time_to_live   </p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">alter table velocity_test <span class="keyword">with</span>  default_time_to_live = <span class="number">1800</span>;</span><br><span class="line"></span><br><span class="line">cqlsh:forseti&gt; <span class="keyword">select</span> ttl(<span class="keyword">event</span>) <span class="keyword">from</span> velocity_test <span class="keyword">where</span> attribute=<span class="string">'test'</span> <span class="keyword">and</span> partner_code=<span class="string">'koudai'</span> <span class="keyword">and</span> app_name=<span class="string">'koudai_ios'</span> <span class="keyword">and</span> <span class="keyword">type</span>=<span class="string">'account'</span> limit <span class="number">1</span>;</span><br><span class="line"> ttl(<span class="keyword">event</span>)</span><br><span class="line">------------</span><br><span class="line">       <span class="number">2796</span></span><br><span class="line">(<span class="number">1</span> rows)</span><br><span class="line"></span><br><span class="line">cqlsh:forseti&gt; alter table velocity_test <span class="keyword">with</span>  default_time_to_live = <span class="number">1800</span>;</span><br><span class="line">cqlsh:forseti&gt; <span class="keyword">select</span> ttl(<span class="keyword">event</span>) <span class="keyword">from</span> velocity_test <span class="keyword">where</span> attribute=<span class="string">'test'</span> <span class="keyword">and</span> partner_code=<span class="string">'koudai'</span> <span class="keyword">and</span> app_name=<span class="string">'koudai_ios'</span> <span class="keyword">and</span> <span class="keyword">type</span>=<span class="string">'account'</span> limit <span class="number">1</span>;</span><br><span class="line"> ttl(<span class="keyword">event</span>)</span><br><span class="line">------------</span><br><span class="line">       <span class="number">2782</span></span><br><span class="line">(<span class="number">1</span> rows)</span><br></pre></td></tr></table></figure>
<p>3.只有新插入的数据(test2)才会使用刚刚更新的default_time_to_live, 而原有的数据(test)则不会更新!</p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cqlsh:forseti&gt; <span class="keyword">select</span> ttl(<span class="keyword">event</span>) <span class="keyword">from</span> velocity_test <span class="keyword">where</span> attribute=<span class="string">'test2'</span> <span class="keyword">and</span> partner_code=<span class="string">'koudai'</span> <span class="keyword">and</span> app_name=<span class="string">'koudai_ios'</span> <span class="keyword">and</span> <span class="keyword">type</span>=<span class="string">'account'</span> limit <span class="number">1</span>;</span><br><span class="line"> ttl(<span class="keyword">event</span>)</span><br><span class="line">------------</span><br><span class="line">       <span class="number">1772</span></span><br><span class="line">(<span class="number">1</span> rows)</span><br></pre></td></tr></table></figure>
<p><strong>小结</strong></p>
<ul>
<li>修改表结构的default_time_to_live并不会改变原有数据的TTL, 只对新插入的数据有影响.  </li>
<li>在插入时指定TTL和设置表结构的default_time_to_live的效果都是一样的,数据在经过TTL后会过期被删除.  </li>
<li>插入时指定TTL通常要在代码中指定, 如果通过default_time_to_live, 则在插入时可以不用指定using ttl.</li>
</ul>
<h3 id="gc_grace_seconds">gc_grace_seconds</h3><blockquote>
<p>Specifies the time to wait before garbage collecting tombstones (deletion markers).<br>The default value allows a great deal of time for consistency to be achieved prior to deletion.<br>In many deployments this interval can be reduced, and in a single-node cluster it can be safely set to zero.</p>
</blockquote>
<p>设置gc_grace_seconds是为了在真正物理删除之前, 确保数据的一致性(默认是10天).<br>如果设置为0, 则在compact时, 因为TTL被标记为墓碑的记录, 会被立即删除.  </p>
<h3 id="Delete操作">Delete操作</h3><p><a href="http://docs.datastax.com/en/cql/3.1/cql/cql_using/use_delete.html" target="_blank" rel="external">http://docs.datastax.com/en/cql/3.1/cql/cql_using/use_delete.html</a>  </p>
<blockquote>
<p>CQL provides the DELETE command to delete a column or row.<br>Deleted values are removed completely by the first compaction following deletion.</p>
</blockquote>
<p>Cassandra是支持删除的! 但是删除并不会立即发生, 而是在执行delete操作之后的第一次整理时. </p>
<h2 id="读一致性">读一致性</h2><p>问题：查询时前几次没查询到，后面突然就可以查询到。</p>
<p>问题还原：  </p>
<ol>
<li>默认策略为ONE，只查询到一条记录</li>
<li>修改策略为QUORUM，查询到三条记录</li>
<li>修改策略为ONE，可以查询到三条记录</li>
</ol>
<p>记录的时间：  </p>
<table>
<thead>
<tr>
<th>no</th>
<th>sequence_id</th>
<th>timestamp</th>
<th>date -r</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1458614825458434F3079346B9597753</td>
<td>1458614825</td>
<td>2016年 3月22日 星期二 10时47分05秒</td>
</tr>
<tr>
<td>2</td>
<td>1455455063813744F307919065153577</td>
<td>1455455063</td>
<td>2016年 2月14日 星期日 21时04分23秒</td>
</tr>
<tr>
<td>3</td>
<td>1455454988601891F307919021350725</td>
<td>1455454988</td>
<td>2016年 2月14日 星期日 21时03分08秒</td>
</tr>
</tbody>
</table>
<ol>
<li>查询到一条时总是返回最近的记录</li>
<li>查询到多条时，按照时间升序</li>
</ol>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line">cqlsh:forseti&gt; select sequence_id,attribute from velocity where attribute='450602197704245112';</span><br><span class="line"></span><br><span class="line"> sequence_id                      |<span class="string"> attribute</span><br><span class="line">----------------------------------+--------------------</span><br><span class="line"> 1458614825458434F3079346B9597753 </span>|<span class="string"> 450602197704245112</span><br><span class="line"></span><br><span class="line"> activity                                                                                             </span>|<span class="string"> timestamp    </span>|<span class="string"> source         </span>|<span class="string"> source_elapsed</span><br><span class="line">------------------------------------------------------------------------------------------------------+--------------+----------------+----------------</span><br><span class="line">                                                                                   execute_cql3_query </span>|<span class="string"> 09:47:41,507 </span>|<span class="string"> 192.168.47.202 </span>|<span class="string">              0</span><br><span class="line"> Parsing select sequence_id,attribute from velocity where attribute='450602197704245112' LIMIT 10000; </span>|<span class="string"> 09:47:41,508 </span>|<span class="string"> 192.168.47.202 </span>|<span class="string">           1453</span><br><span class="line">                                                                                  Preparing statement </span>|<span class="string"> 09:47:41,509 </span>|<span class="string"> 192.168.47.202 </span>|<span class="string">           2438</span><br><span class="line">                                                                   Sending message to /192.168.47.221 </span>|<span class="string"> 09:47:41,510 </span>|<span class="string"> 192.168.47.202 </span>|<span class="string">           2825</span><br><span class="line">                                                                Message received from /192.168.47.202 </span>|<span class="string"> 09:47:41,523 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">             39</span><br><span class="line">                                                         Executing single-partition query on velocity </span>|<span class="string"> 09:47:41,523 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">            267</span><br><span class="line">                                                                         Acquiring sstable references </span>|<span class="string"> 09:47:41,523 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">            314</span><br><span class="line">                                                                          Merging memtable tombstones </span>|<span class="string"> 09:47:41,523 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">            358</span><br><span class="line">                                                          Bloom filter allows skipping sstable 829683 </span>|<span class="string"> 09:47:41,523 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">            462</span><br><span class="line">                                                            →→→→   Sending message to /192.168.47.205 </span>|<span class="string"> 09:47:41,526 </span>|<span class="string"> 192.168.47.202 </span>|<span class="string">          19083</span><br><span class="line">                                                                Message received from /192.168.47.221 </span>|<span class="string"> 09:47:41,530 </span>|<span class="string"> 192.168.47.202 </span>|<span class="string">          22909</span><br><span class="line">                                                             Processing response from /192.168.47.221 </span>|<span class="string"> 09:47:41,530 </span>|<span class="string"> 192.168.47.202 </span>|<span class="string">          23374</span><br><span class="line">                                              Partition index with 0 entries found for sstable 829120 </span>|<span class="string"> 09:47:41,533 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">          10514</span><br><span class="line">                                                          Seeking to partition beginning in data file </span>|<span class="string"> 09:47:41,533 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">          10553</span><br><span class="line">                                                          Bloom filter allows skipping sstable 829524 </span>|<span class="string"> 09:47:41,534 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">          11161</span><br><span class="line">                            Skipped 0/6 non-slice-intersecting sstables, included 0 due to tombstones </span>|<span class="string"> 09:47:41,534 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">          11234</span><br><span class="line">                                                           Merging data from memtables and 1 sstables </span>|<span class="string"> 09:47:41,534 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">          11271</span><br><span class="line">                                                                    Read 1 live and 0 tombstone cells </span>|<span class="string"> 09:47:41,534 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">          11346</span><br><span class="line">                                                                Enqueuing response to /192.168.47.202 </span>|<span class="string"> 09:47:41,534 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">          11482</span><br><span class="line">                                                                   Sending message to /192.168.47.202 </span>|<span class="string"> 09:47:41,534 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">          11655</span><br><span class="line">                                                                                     Request complete </span>|<span class="string"> 09:47:41,530 </span>|<span class="string"> 192.168.47.202 </span>|<span class="string">          23614</span><br><span class="line"></span><br><span class="line">cqlsh:forseti&gt; CONSISTENCY QUORUM</span><br><span class="line">Consistency level set to QUORUM.</span><br><span class="line">cqlsh:forseti&gt; select sequence_id,attribute from velocity where attribute='450602197704245112';</span><br><span class="line"></span><br><span class="line"> sequence_id                      </span>|<span class="string"> attribute</span><br><span class="line">----------------------------------+--------------------</span><br><span class="line"> 1455454988601891F307919021350725 </span>|<span class="string"> 450602197704245112</span><br><span class="line"> 1455455063813744F307919065153577 </span>|<span class="string"> 450602197704245112</span><br><span class="line"> 1458614825458434F3079346B9597753 </span>|<span class="string"> 450602197704245112</span><br><span class="line"></span><br><span class="line"> activity                                                                                             </span>|<span class="string"> timestamp    </span>|<span class="string"> source         </span>|<span class="string"> source_elapsed</span><br><span class="line">------------------------------------------------------------------------------------------------------+--------------+----------------+----------------</span><br><span class="line">                                                                                   execute_cql3_query </span>|<span class="string"> 09:51:27,836 </span>|<span class="string"> 192.168.47.202 </span>|<span class="string">              0</span><br><span class="line"> Parsing select sequence_id,attribute from velocity where attribute='450602197704245112' LIMIT 10000; </span>|<span class="string"> 09:51:27,836 </span>|<span class="string"> 192.168.47.202 </span>|<span class="string">            137</span><br><span class="line">                                                                                  Preparing statement </span>|<span class="string"> 09:51:27,836 </span>|<span class="string"> 192.168.47.202 </span>|<span class="string">            218</span><br><span class="line">                                                                   Sending message to /192.168.47.221 </span>|<span class="string"> 09:51:27,836 </span>|<span class="string"> 192.168.47.202 </span>|<span class="string">            576</span><br><span class="line">                                                                   Sending message to /192.168.47.203 </span>|<span class="string"> 09:51:27,836 </span>|<span class="string"> 192.168.47.202 </span>|<span class="string">            584</span><br><span class="line">                                                                   Sending message to /192.168.47.205 </span>|<span class="string"> 09:51:27,836 </span>|<span class="string"> 192.168.47.202 </span>|<span class="string">            589</span><br><span class="line">                                                                Message received from /192.168.47.221 </span>|<span class="string"> 09:51:27,838 </span>|<span class="string"> 192.168.47.202 </span>|<span class="string">           2411</span><br><span class="line">                                                             Processing response from /192.168.47.221 </span>|<span class="string"> 09:51:27,838 </span>|<span class="string"> 192.168.47.202 </span>|<span class="string">           2538</span><br><span class="line">                                                                Message received from /192.168.47.205 </span>|<span class="string"> 09:51:27,839 </span>|<span class="string"> 192.168.47.202 </span>|<span class="string">           2878</span><br><span class="line">                                                             Processing response from /192.168.47.205 </span>|<span class="string"> 09:51:27,839 </span>|<span class="string"> 192.168.47.202 </span>|<span class="string">           2916</span><br><span class="line">                                                                Message received from /192.168.47.203 </span>|<span class="string"> 09:51:27,841 </span>|<span class="string"> 192.168.47.202 </span>|<span class="string">           4825</span><br><span class="line">                                                             Processing response from /192.168.47.203 </span>|<span class="string"> 09:51:27,841 </span>|<span class="string"> 192.168.47.202 </span>|<span class="string">           4966</span><br><span class="line">                                                                Message received from /192.168.47.202 </span>|<span class="string"> 09:51:27,846 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">             58</span><br><span class="line">                                                         Executing single-partition query on velocity </span>|<span class="string"> 09:51:27,846 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">            139</span><br><span class="line">                                                                         Acquiring sstable references </span>|<span class="string"> 09:51:27,846 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">            150</span><br><span class="line">                                                                          Merging memtable tombstones </span>|<span class="string"> 09:51:27,846 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">            182</span><br><span class="line">                                              Partition index with 0 entries found for sstable 830589 </span>|<span class="string"> 09:51:27,846 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">            294</span><br><span class="line">                                                          Seeking to partition beginning in data file </span>|<span class="string"> 09:51:27,846 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">            300</span><br><span class="line">                                                                     Key cache hit for sstable 829120 </span>|<span class="string"> 09:51:27,846 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">            487</span><br><span class="line">                                                          Seeking to partition beginning in data file </span>|<span class="string"> 09:51:27,846 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">            491</span><br><span class="line">                            Skipped 0/5 non-slice-intersecting sstables, included 0 due to tombstones </span>|<span class="string"> 09:51:27,846 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">            755</span><br><span class="line">                                                           Merging data from memtables and 2 sstables </span>|<span class="string"> 09:51:27,846 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">            762</span><br><span class="line">                                                                    Read 3 live and 0 tombstone cells </span>|<span class="string"> 09:51:27,847 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">            810</span><br><span class="line">                                                                Message received from /192.168.47.202 </span>|<span class="string"> 09:51:27,847 </span>|<span class="string"> 192.168.47.205 </span>|<span class="string">             46</span><br><span class="line">                                                                Enqueuing response to /192.168.47.202 </span>|<span class="string"> 09:51:27,847 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">            899</span><br><span class="line">                                                         Executing single-partition query on velocity </span>|<span class="string"> 09:51:27,847 </span>|<span class="string"> 192.168.47.205 </span>|<span class="string">            176</span><br><span class="line">                                                                   Sending message to /192.168.47.202 </span>|<span class="string"> 09:51:27,847 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">           1086</span><br><span class="line">                                                                         Acquiring sstable references </span>|<span class="string"> 09:51:27,847 </span>|<span class="string"> 192.168.47.205 </span>|<span class="string">            215</span><br><span class="line">                                                                          Merging memtable tombstones </span>|<span class="string"> 09:51:27,847 </span>|<span class="string"> 192.168.47.205 </span>|<span class="string">            271</span><br><span class="line">                                                                     Key cache hit for sstable 804150 </span>|<span class="string"> 09:51:27,847 </span>|<span class="string"> 192.168.47.205 </span>|<span class="string">            386</span><br><span class="line">                                                          Seeking to partition beginning in data file </span>|<span class="string"> 09:51:27,847 </span>|<span class="string"> 192.168.47.205 </span>|<span class="string">            395</span><br><span class="line">                                                                     Key cache hit for sstable 796552 </span>|<span class="string"> 09:51:27,848 </span>|<span class="string"> 192.168.47.205 </span>|<span class="string">            775</span><br><span class="line">                                                          Seeking to partition beginning in data file </span>|<span class="string"> 09:51:27,848 </span>|<span class="string"> 192.168.47.205 </span>|<span class="string">            788</span><br><span class="line">                            Skipped 0/6 non-slice-intersecting sstables, included 0 due to tombstones </span>|<span class="string"> 09:51:27,848 </span>|<span class="string"> 192.168.47.205 </span>|<span class="string">           1094</span><br><span class="line">                                                           Merging data from memtables and 2 sstables </span>|<span class="string"> 09:51:27,848 </span>|<span class="string"> 192.168.47.205 </span>|<span class="string">           1107</span><br><span class="line">                                                                    Read 3 live and 0 tombstone cells </span>|<span class="string"> 09:51:27,848 </span>|<span class="string"> 192.168.47.205 </span>|<span class="string">           1181</span><br><span class="line">                                                                Enqueuing response to /192.168.47.202 </span>|<span class="string"> 09:51:27,848 </span>|<span class="string"> 192.168.47.205 </span>|<span class="string">           1393</span><br><span class="line">                                                                   Sending message to /192.168.47.202 </span>|<span class="string"> 09:51:27,848 </span>|<span class="string"> 192.168.47.205 </span>|<span class="string">           1648</span><br><span class="line">                                                                Message received from /192.168.47.202 </span>|<span class="string"> 09:51:27,851 </span>|<span class="string"> 192.168.47.203 </span>|<span class="string">             40</span><br><span class="line">                                                         Executing single-partition query on velocity </span>|<span class="string"> 09:51:27,851 </span>|<span class="string"> 192.168.47.203 </span>|<span class="string">            147</span><br><span class="line">                                                                         Acquiring sstable references </span>|<span class="string"> 09:51:27,851 </span>|<span class="string"> 192.168.47.203 </span>|<span class="string">            181</span><br><span class="line">                                                                          Merging memtable tombstones </span>|<span class="string"> 09:51:27,851 </span>|<span class="string"> 192.168.47.203 </span>|<span class="string">            217</span><br><span class="line">                     Partition index lookup complete (bloom filter false positive) for sstable 760553 </span>|<span class="string"> 09:51:27,851 </span>|<span class="string"> 192.168.47.203 </span>|<span class="string">            325</span><br><span class="line">                                              Partition index with 0 entries found for sstable 757598 </span>|<span class="string"> 09:51:27,852 </span>|<span class="string"> 192.168.47.203 </span>|<span class="string">            796</span><br><span class="line">                                                          Seeking to partition beginning in data file </span>|<span class="string"> 09:51:27,852 </span>|<span class="string"> 192.168.47.203 </span>|<span class="string">            810</span><br><span class="line">                                              Partition index with 0 entries found for sstable 747846 </span>|<span class="string"> 09:51:27,854 </span>|<span class="string"> 192.168.47.203 </span>|<span class="string">           2813</span><br><span class="line">                                                          Seeking to partition beginning in data file </span>|<span class="string"> 09:51:27,854 </span>|<span class="string"> 192.168.47.203 </span>|<span class="string">           2829</span><br><span class="line">                            Skipped 0/5 non-slice-intersecting sstables, included 0 due to tombstones </span>|<span class="string"> 09:51:27,855 </span>|<span class="string"> 192.168.47.203 </span>|<span class="string">           3659</span><br><span class="line">                                                           Merging data from memtables and 2 sstables </span>|<span class="string"> 09:51:27,855 </span>|<span class="string"> 192.168.47.203 </span>|<span class="string">           3678</span><br><span class="line">                                                                    Read 3 live and 0 tombstone cells </span>|<span class="string"> 09:51:27,855 </span>|<span class="string"> 192.168.47.203 </span>|<span class="string">           3735</span><br><span class="line">                                                                Enqueuing response to /192.168.47.202 </span>|<span class="string"> 09:51:27,855 </span>|<span class="string"> 192.168.47.203 </span>|<span class="string">           3817</span><br><span class="line">                                                                   Sending message to /192.168.47.202 </span>|<span class="string"> 09:51:27,855 </span>|<span class="string"> 192.168.47.203 </span>|<span class="string">           3904</span><br><span class="line">                                                                                     Request complete </span>|<span class="string"> 09:51:27,841 </span>|<span class="string"> 192.168.47.202 </span>|<span class="string">           5142</span><br><span class="line">cqlsh:forseti&gt; CONSISTENCY ONE</span><br><span class="line">Consistency level set to ONE.</span><br><span class="line">cqlsh:forseti&gt; select sequence_id,attribute from velocity where attribute='450602197704245112';</span><br><span class="line"></span><br><span class="line"> sequence_id                      </span>|<span class="string"> attribute</span><br><span class="line">----------------------------------+--------------------</span><br><span class="line"> 1455454988601891F307919021350725 </span>|<span class="string"> 450602197704245112</span><br><span class="line"> 1455455063813744F307919065153577 </span>|<span class="string"> 450602197704245112</span><br><span class="line"> 1458614825458434F3079346B9597753 </span>|<span class="string"> 450602197704245112</span><br><span class="line"></span><br><span class="line"> activity                                                                                             </span>|<span class="string"> timestamp    </span>|<span class="string"> source         </span>|<span class="string"> source_elapsed</span><br><span class="line">------------------------------------------------------------------------------------------------------+--------------+----------------+----------------</span><br><span class="line">                                                                                   execute_cql3_query </span>|<span class="string"> 09:52:15,416 </span>|<span class="string"> 192.168.47.202 </span>|<span class="string">              0</span><br><span class="line"> Parsing select sequence_id,attribute from velocity where attribute='450602197704245112' LIMIT 10000; </span>|<span class="string"> 09:52:15,416 </span>|<span class="string"> 192.168.47.202 </span>|<span class="string">             71</span><br><span class="line">                                                                                  Preparing statement </span>|<span class="string"> 09:52:15,416 </span>|<span class="string"> 192.168.47.202 </span>|<span class="string">            186</span><br><span class="line">                                                                   Sending message to /192.168.47.221 </span>|<span class="string"> 09:52:15,416 </span>|<span class="string"> 192.168.47.202 </span>|<span class="string">            463</span><br><span class="line">                                                                Message received from /192.168.47.221 </span>|<span class="string"> 09:52:15,418 </span>|<span class="string"> 192.168.47.202 </span>|<span class="string">           2359</span><br><span class="line">                                                             Processing response from /192.168.47.221 </span>|<span class="string"> 09:52:15,418 </span>|<span class="string"> 192.168.47.202 </span>|<span class="string">           2448</span><br><span class="line">                                                                Message received from /192.168.47.202 </span>|<span class="string"> 09:52:15,426 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">             34</span><br><span class="line">                                                         Executing single-partition query on velocity </span>|<span class="string"> 09:52:15,426 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">            118</span><br><span class="line">                                                                         Acquiring sstable references </span>|<span class="string"> 09:52:15,426 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">            144</span><br><span class="line">                                                                          Merging memtable tombstones </span>|<span class="string"> 09:52:15,426 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">            178</span><br><span class="line">                                                                     Key cache hit for sstable 830589 </span>|<span class="string"> 09:52:15,426 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">            226</span><br><span class="line">                                                          Seeking to partition beginning in data file </span>|<span class="string"> 09:52:15,426 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">            238</span><br><span class="line">                                                                     Key cache hit for sstable 829120 </span>|<span class="string"> 09:52:15,426 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">            535</span><br><span class="line">                                                          Seeking to partition beginning in data file </span>|<span class="string"> 09:52:15,426 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">            543</span><br><span class="line">                            Skipped 0/5 non-slice-intersecting sstables, included 0 due to tombstones </span>|<span class="string"> 09:52:15,427 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">            885</span><br><span class="line">                                                           Merging data from memtables and 2 sstables </span>|<span class="string"> 09:52:15,427 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">            901</span><br><span class="line">                                                                    Read 3 live and 0 tombstone cells </span>|<span class="string"> 09:52:15,427 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">            986</span><br><span class="line">                                                                Enqueuing response to /192.168.47.202 </span>|<span class="string"> 09:52:15,427 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">           1074</span><br><span class="line">                                                                   Sending message to /192.168.47.202 </span>|<span class="string"> 09:52:15,427 </span>|<span class="string"> 192.168.47.221 </span>|<span class="string">           1303</span><br><span class="line">                                                                                     Request complete </span>|<span class="string"> 09:52:15,418 </span>|<span class="string"> 192.168.47.202 </span>|<span class="string">           2607</span></span><br></pre></td></tr></table></figure>
<p><strong>现象</strong>：  </p>
<ol>
<li>策略为ONE时，只会发送请求给一个节点（221），这个节点只读取了一个sstable(829120)就返回结果给客户端（协调者）了</li>
<li>策略为QUORUM时，发送请求给三个节点，其中221节点读取出来了2个sstable(829120和830589)。<br>其中829120在上一次读取过了，因此会在key cache中，830589在Partition index。<br>不管是key cache还是Partition index，最后都要seek file,因为数据是放在文件中的，缓存里的只有key<br>最后三个节点的数据都返回给客户端，即Sending message to /192.168.47.202</li>
<li>策略为ONE时，发送请求给221，但这个时候会读取2个sstable，并且都在key cache中</li>
</ol>
<p>其他问题：</p>
<ol>
<li>日志的顺序并不代表事件发生的顺序</li>
</ol>
<p>以第三次查询为例：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">09</span>:<span class="number">52</span>:<span class="number">15</span>,<span class="number">416</span></span><br><span class="line"></span><br><span class="line">Sending message to /<span class="number">192.168</span><span class="number">.47</span><span class="number">.221</span></span><br><span class="line"></span><br><span class="line"><span class="number">09</span>:<span class="number">52</span>:<span class="number">15</span>,<span class="number">418</span>：</span><br><span class="line"></span><br><span class="line"><span class="number">192.168</span><span class="number">.47</span><span class="number">.202</span>  Message received from /<span class="number">192.168</span><span class="number">.47</span><span class="number">.221</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.47</span><span class="number">.202</span>  Processing response from /<span class="number">192.168</span><span class="number">.47</span><span class="number">.221</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.47</span><span class="number">.202</span>  Request complete</span><br></pre></td></tr></table></figure>
<p>请求在09:52:15,418已经完成了，但是打印出来的09:52:15,42还有任务在做。  </p>
<p><strong>一点结论</strong>：</p>
<ol>
<li>sstable 829120只有一个live，而830589有2个live</li>
<li>说明要查询的行在221节点上分布在了两个sstable中</li>
<li>cqlsh连接的节点是作为协调节点，response最后都会发送给协调节点</li>
<li>策略为ONE，发送给一个节点，策略为QUORUM，发送给三个节点</li>
<li>查询的行的副本在221，205，203上</li>
</ol>
<p><strong>协调节点变化</strong>：  </p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">cqlsh:forseti&gt; select sequence_id,attribute from velocity where attribute='450602197704245112';</span><br><span class="line"></span><br><span class="line"> sequence_id                      |<span class="string"> attribute</span><br><span class="line">----------------------------------+--------------------</span><br><span class="line"> 1455454988601891F307919021350725 </span>|<span class="string"> 450602197704245112</span><br><span class="line"> 1455455063813744F307919065153577 </span>|<span class="string"> 450602197704245112</span><br><span class="line"> 1458614825458434F3079346B9597753 </span>|<span class="string"> 450602197704245112</span><br><span class="line"></span><br><span class="line"> activity                                                                                             </span>|<span class="string"> timestamp    </span>|<span class="string"> source         </span>|<span class="string"> source_elapsed</span><br><span class="line">------------------------------------------------------------------------------------------------------+--------------+----------------+----------------</span><br><span class="line">                                                                                   execute_cql3_query </span>|<span class="string"> 10:22:25,031 </span>|<span class="string"> 192.168.47.224 </span>|<span class="string">              0</span><br><span class="line"> Parsing select sequence_id,attribute from velocity where attribute='450602197704245112' LIMIT 10000; </span>|<span class="string"> 10:22:25,031 </span>|<span class="string"> 192.168.47.224 </span>|<span class="string">             78</span><br><span class="line">                                                                                  Preparing statement </span>|<span class="string"> 10:22:25,031 </span>|<span class="string"> 192.168.47.224 </span>|<span class="string">            180</span><br><span class="line">                                                                   Sending message to /192.168.47.205 </span>|<span class="string"> 10:22:25,032 </span>|<span class="string"> 192.168.47.224 </span>|<span class="string">            592</span><br><span class="line">                                                                Message received from /192.168.47.224 </span>|<span class="string"> 10:22:25,032 </span>|<span class="string"> 192.168.47.205 </span>|<span class="string">             76</span><br><span class="line">                                                         Executing single-partition query on velocity </span>|<span class="string"> 10:22:25,032 </span>|<span class="string"> 192.168.47.205 </span>|<span class="string">            302</span><br><span class="line">                                                                         Acquiring sstable references </span>|<span class="string"> 10:22:25,032 </span>|<span class="string"> 192.168.47.205 </span>|<span class="string">            336</span><br><span class="line">                                                                          Merging memtable tombstones </span>|<span class="string"> 10:22:25,032 </span>|<span class="string"> 192.168.47.205 </span>|<span class="string">            390</span><br><span class="line">                                                          Bloom filter allows skipping sstable 804350 </span>|<span class="string"> 10:22:25,032 </span>|<span class="string"> 192.168.47.205 </span>|<span class="string">            440</span><br><span class="line">                                                          Bloom filter allows skipping sstable 804346 </span>|<span class="string"> 10:22:25,032 </span>|<span class="string"> 192.168.47.205 </span>|<span class="string">            463</span><br><span class="line">                                                          Bloom filter allows skipping sstable 804342 </span>|<span class="string"> 10:22:25,032 </span>|<span class="string"> 192.168.47.205 </span>|<span class="string">            480</span><br><span class="line">                                                          Bloom filter allows skipping sstable 804341 </span>|<span class="string"> 10:22:25,032 </span>|<span class="string"> 192.168.47.205 </span>|<span class="string">            494</span><br><span class="line">                                                          Bloom filter allows skipping sstable 804315 </span>|<span class="string"> 10:22:25,032 </span>|<span class="string"> 192.168.47.205 </span>|<span class="string">            510</span><br><span class="line">                                                                     Key cache hit for sstable 804150 </span>|<span class="string"> 10:22:25,032 </span>|<span class="string"> 192.168.47.205 </span>|<span class="string">            539</span><br><span class="line">                                                          Seeking to partition beginning in data file </span>|<span class="string"> 10:22:25,032 </span>|<span class="string"> 192.168.47.205 </span>|<span class="string">            549</span><br><span class="line">                                                                     Key cache hit for sstable 796552 </span>|<span class="string"> 10:22:25,033 </span>|<span class="string"> 192.168.47.205 </span>|<span class="string">            899</span><br><span class="line">                                                          Seeking to partition beginning in data file </span>|<span class="string"> 10:22:25,033 </span>|<span class="string"> 192.168.47.205 </span>|<span class="string">            912</span><br><span class="line">                                                          Bloom filter allows skipping sstable 794792 </span>|<span class="string"> 10:22:25,033 </span>|<span class="string"> 192.168.47.205 </span>|<span class="string">           1218</span><br><span class="line">                            Skipped 0/8 non-slice-intersecting sstables, included 0 due to tombstones </span>|<span class="string"> 10:22:25,033 </span>|<span class="string"> 192.168.47.205 </span>|<span class="string">           1243</span><br><span class="line">                                                           Merging data from memtables and 2 sstables </span>|<span class="string"> 10:22:25,033 </span>|<span class="string"> 192.168.47.205 </span>|<span class="string">           1264</span><br><span class="line">                                                                    Read 3 live and 0 tombstone cells </span>|<span class="string"> 10:22:25,033 </span>|<span class="string"> 192.168.47.205 </span>|<span class="string">           1356</span><br><span class="line">                                                                Message received from /192.168.47.205 </span>|<span class="string"> 10:22:25,035 </span>|<span class="string"> 192.168.47.224 </span>|<span class="string">           3920</span><br><span class="line">                                                             Processing response from /192.168.47.205 </span>|<span class="string"> 10:22:25,035 </span>|<span class="string"> 192.168.47.224 </span>|<span class="string">           4004</span><br><span class="line">                                                                                     Request complete </span>|<span class="string"> 10:22:25,035 </span>|<span class="string"> 192.168.47.224 </span>|<span class="string">           4205</span></span><br></pre></td></tr></table></figure>
<p>用cqlsh连接其他节点，虽然协调节点发生变化，但是如果之前已经查询过了（在不同的节点查询），查询时都是会在key cache里。<br>比如连接224节点，协调者为224，默认策略为ONE，它联系的节点是205。这里的查询发生在上面第三步之后，所以实际和第三步<br>一样，也会查询到三条记录，并且都在key cache里。  </p>
<ol>
<li>所以协调节点变化，对查询结果没有影响，key cache保存在副本所在的节点上，并不是保存在协调节点上</li>
<li>协调节点变化，对于ONE时，选择最近的Replica节点会有变化，比如连接202时选择了221，连接224时选择了205</li>
<li>每次查询协调节点选择的Replica不是固定的，第一次选择205，下一次就可能选择203</li>
</ol>
<p><strong>疑问</strong>：  </p>
<p>官方文档中对于ONE的解释：</p>
<p>In a single data center cluster with a replication factor of 3, and a read consistency level of ONE,<br>the closest replica for the given row is contacted to fulfill the read request. In the background<br>a read repair is potentially initiated, based on the read_repair_chance setting of the table, for the other replicas.<br>只有最近副本的节点才会被联系，因此发送给一个节点和CQL的tracing对比起来是正常的。<br>下图中ONE的黑色箭头应该只有一个，蓝色的read repair应该有两个。因为请求并不会发送给三个节点，然后选择一个再返回！  </p>
<p><img src="http://img.blog.csdn.net/20160324150246681" alt="c_read_one"><br><img src="http://img.blog.csdn.net/20160324150302634" alt="c_read_quorum"></p>
<p>对于QUORUM的解释：  </p>
<p>In a single data center cluster with a replication factor of 3, and a read consistency level of QUORUM,<br>2 of the 3 replicas for the given row must respond to fulfill the read request. If the contacted replicas<br>have different versions of the row, the replica with the most recent version will return the requested data.<br>In the background, the third replica is checked for consistency with the first two, and if needed,<br>a read repair is initiated for the out-of-date replicas.<br>必须有2个副本做出响应，那么请求是只发给2个节点吗？ 而CQL的tracing显示是同时发送请求给三个节点的<br>不同版本的行，是指不同列吗，还是说相同列？ 因为我们这里返回多行数据，按照C的存储模型，是属于不同列的  </p>
<p>Coordinator发送请求给Replica有三种方式：</p>
<ol>
<li>direct read request</li>
<li>digest request</li>
<li>background read repair request</li>
</ol>
<p>The coordinator node contacts one replica node with a direct read request.<br>Then the coordinator sends a digest request to a number of replicas determined by the consistency level specified by the client.<br>The digest request checks the data in the replica node to make sure it is up to date.<br>Then the coordinator sends a digest request to all remaining replicas.<br>If any replica nodes have out of date data, a background read repair request is sent.<br>Read repair requests ensure that the requested row is made consistent on all replicas.</p>
<p>协调者联系一个节点发送direct read请求，然后根据客户端指定的一致性级别发送digest request给其他副本，比如副本数3，处理为QUORUM=2，<br>第一个Replica（R1）发送direct read，还剩余QUORUM-1=2-1=1个Replica（R2）会发送digest request。read请求是读取数据内容，而digest请求则读取数据概要。<br>digest请求会检查R2的数据是否是最新的，和什么比较呢，当然是和R1的数据进行比较，因为如果是同一份数据，概要信息是相同的（类似CRC校验）。<br>比较是发生在协调节点上，这个时候已经收到了R1的数据，但是因为策略为QUORUM，所以还不能把这个结果返回给客户端。<br>协调者发送digest请求后，并收到R2的概要数据，然后和R1计算出来的概要进行比较，如果不同，就会向R2发送read repair请求，不过这是在后台运行的。  </p>
<p>由于副本有三个，现在协调者向R1发送direct reead request，向R2发送digest request，还有一个副本，也要向它发送digest request。<br>Read repair确保请求的行在所有的Replicas上的数据都是一致的。  </p>
<p>问题1：如果R1虽然是最近的（发送direct read），但是不是最新的，R2是最新的，协调者比较R2的概要和R1计算出来的概要不同，会向R2发送read repair？  </p>
<p>问题2：Read repair是怎么将最新的数据更新？是从最新的Replica上读取数据，还是由协调者负责更新。<br>协调者不保存数据，但是它因为发送direct read请求，能接收到某个副本的数据内容，所以在协调者的内存上是数据的。  </p>
<h2 id="协调节点超时">协调节点超时</h2><p>读取超时，即使加上tracing on，也只会告诉你超时，不会有更详细的信息了。</p>
<figure class="highlight ocaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ReadTimeout</span>: code=<span class="number">1200</span> [<span class="type">Coordinator</span> node timed out waiting <span class="keyword">for</span> replica nodes' responses] </span><br><span class="line">message=<span class="string">"Operation timed out - received only 0 responses."</span> info=&#123;<span class="symbol">'received_responses'</span>: <span class="number">0</span>, <span class="symbol">'required_responses'</span>: <span class="number">1</span>, <span class="symbol">'consistency'</span>: <span class="symbol">'ONE'</span>&#125;</span><br><span class="line"><span class="type">Statement</span> trace did not complete within <span class="number">10</span> seconds</span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/work/">work</a>
	</div>


      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cassandra/">cassandra</a></li></ul>
	</div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
</article>











    
        <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
        <script>
        var yiliaConfig = {
        fancybox: true,
        mathjax: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        open_in_new: false
        }
        </script>
        

  
    <article id="post-Cassandra-hole" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/15/Cassandra-hole/" class="article-date">
  	<time datetime="2015-10-14T16:00:00.000Z" itemprop="datePublished">2015-10-15</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/15/Cassandra-hole/">Cassandra陷阱</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Cassandra的一些陷阱</p>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/work/">work</a>
	</div>


      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cassandra/">cassandra</a></li></ul>
	</div>

      
        <p class="article-more-link">
          <a  href="/2015/10/15/Cassandra-hole/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
</article>











    
        <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
        <script>
        var yiliaConfig = {
        fancybox: true,
        mathjax: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        open_in_new: false
        }
        </script>
        

  
    <article id="post-Cassandra-Daily" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/15/Cassandra-Daily/" class="article-date">
  	<time datetime="2015-10-14T16:00:00.000Z" itemprop="datePublished">2015-10-15</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/15/Cassandra-Daily/">Cassandra日常运维</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Cassandra日常运维, OpsCenter</p>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/work/">work</a>
	</div>


      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cassandra/">cassandra</a></li></ul>
	</div>

      
        <p class="article-more-link">
          <a  href="/2015/10/15/Cassandra-Daily/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
</article>











    
        <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
        <script>
        var yiliaConfig = {
        fancybox: true,
        mathjax: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        open_in_new: false
        }
        </script>
        

  
    <article id="post-Cassandra-exception" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/15/Cassandra-exception/" class="article-date">
  	<time datetime="2015-10-14T16:00:00.000Z" itemprop="datePublished">2015-10-15</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/15/Cassandra-exception/">Cassandra常见异常</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Cassandra异常</p>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/work/">work</a>
	</div>


      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cassandra/">cassandra</a></li></ul>
	</div>

      
        <p class="article-more-link">
          <a  href="/2015/10/15/Cassandra-exception/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
</article>











    
        <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
        <script>
        var yiliaConfig = {
        fancybox: true,
        mathjax: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        open_in_new: false
        }
        </script>
        

  
    <article id="post-Cassandra-Stress" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/15/Cassandra-Stress/" class="article-date">
  	<time datetime="2015-10-14T16:00:00.000Z" itemprop="datePublished">2015-10-15</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/15/Cassandra-Stress/">Cassandra压力测试</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        
        <a id="more"></a>
<!-- MarkdownTOC -->
<ul>
<li>cassandra-stress<ul>
<li>介绍</li>
<li>单节点测试<ul>
<li>写入测试</li>
<li>采用cql3协议写入</li>
<li>读取测试</li>
<li>没有预热读取</li>
<li>给定一段时间测试最大可以读取多少条记录</li>
<li>混合模式读大于写</li>
<li>混合模式写大于读</li>
</ul>
</li>
<li>自定义schema<ul>
<li>示例</li>
<li>只有写入</li>
<li>读写混合模式</li>
<li>只有读取</li>
</ul>
</li>
<li>G1测试</li>
<li>集群测试</li>
</ul>
</li>
<li>YCSB</li>
</ul>
<!-- /MarkdownTOC -->
<h2 id="cassandra-stress">cassandra-stress</h2><p>机器配置：SSD，RAID0，62G内存，24核CPU<br>默认JVM配置：-Xms8192M -Xmx8192M -Xmn2048M<br>C版本：2.2.6，–&gt; 3.6</p>
<blockquote>
<p>说明：Cassandra对于内存的计算方式是如果超过8G，则堆的最大内存只能配置8G，而新生代的内存为堆内存的1/4=2G</p>
</blockquote>
<p>准备测试目录，修改配置文件的directory选项，把localhost相关的地址改成实际地址，便于后面集群模式（确保集群seeds一致）：</p>
<table>
<thead>
<tr>
<th>节点数量</th>
<th>种子节点</th>
<th>集群名称</th>
<th>自定义配置文件</th>
</tr>
</thead>
<tbody>
<tr>
<td>单节点</td>
<td>10.21.21.10</td>
<td>TestBenchmark1</td>
<td>blogpost1.yaml</td>
</tr>
<tr>
<td>四节点</td>
<td>10.21.21.130</td>
<td>TestBenchmark</td>
<td>blogpost4.yaml</td>
</tr>
</tbody>
</table>
<blockquote>
<p>为什么单节点和多节点采用不同的集群名称，因为不止测试一次，可能要更改GC配置，再次测试，如果只用一个集群名称，从一个节点增加到四个节点后，如果要再测试一个节点的就比较麻烦。</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">wget http://<span class="number">192.168</span>.<span class="number">47.211</span>:<span class="number">8000</span>/apache-cassandra-<span class="number">2.2</span>.<span class="number">6</span>-bin.tar.gz &amp;&amp; tar zxf apache-cassandra-<span class="number">2.2</span>.<span class="number">6</span>-bin.tar.gz</span><br><span class="line"></span><br><span class="line">cluster=TestBenchmark1  <span class="comment">#TestBenchmark</span></span><br><span class="line">seeds=<span class="number">10.21</span>.<span class="number">21.10</span>       <span class="comment">#10.21.21.130</span></span><br><span class="line"></span><br><span class="line">mkdir <span class="built_in">test</span></span><br><span class="line">host=`ifconfig | grep <span class="string">"10.21.21."</span> | awk <span class="string">'/inet addr/&#123;sub("addr:",""); print $2&#125;'</span>`</span><br><span class="line">sed -i <span class="operator">-e</span> <span class="string">"s/localhost/<span class="variable">$host</span>/g"</span> apache-cassandra-<span class="number">2.2</span>.<span class="number">6</span>/conf/cassandra.yaml</span><br><span class="line">sed -i <span class="operator">-e</span> <span class="string">"s#localhost#<span class="variable">$host</span>#g"</span> apache-cassandra-<span class="number">2.2</span>.<span class="number">6</span>/conf/cassandra-env.sh</span><br><span class="line">sed -i <span class="operator">-e</span> <span class="string">"s/127.0.0.1/<span class="variable">$seeds</span>/g"</span> apache-cassandra-<span class="number">2.2</span>.<span class="number">6</span>/conf/cassandra.yaml</span><br><span class="line">sed -i <span class="operator">-e</span> <span class="string">"s/Test Cluster/<span class="variable">$cluster</span>/g"</span> apache-cassandra-<span class="number">2.2</span>.<span class="number">6</span>/conf/cassandra.yaml</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"data_file_directories: [/home/admin/test/data]"</span> &gt;&gt; apache-cassandra-<span class="number">2.2</span>.<span class="number">6</span>/conf/cassandra.yaml</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"saved_caches_directory: /home/admin/test/saved_caches"</span> &gt;&gt; apache-cassandra-<span class="number">2.2</span>.<span class="number">6</span>/conf/cassandra.yaml</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"commitlog_directory: /home/admin/test/commitlog"</span> &gt;&gt; apache-cassandra-<span class="number">2.2</span>.<span class="number">6</span>/conf/cassandra.yaml</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"auto_bootstrap: false"</span> &gt;&gt; apache-cassandra-<span class="number">2.2</span>.<span class="number">6</span>/conf/cassandra.yaml</span><br></pre></td></tr></table></figure>
<p>为了测试的准确性，不要在按照有Cassandra的当前节点做压力测试，可以在集群之外安装一个Cassandra，<br>但是注意不要启动他，使用cassandra-stress的-node连接到目标集群也可以测试。  </p>
<h3 id="介绍">介绍</h3><p>Cassandra从很早的版本就自带了cassandra-stress压力测试工具，它的使用方法在cassandra-stress后添加命令和选项。<br>其中常用的命令一般只用到：write、read、mixed、user。其中单纯的write和read只测试读和写，mixed则测试同时读写。<br>user是2.1之后新增的，通过自定义配置文件，在配置文件中可以指定insert和query查询语句。<br>命令command没有以<code>-</code>开头，而选项[options]有两种方式：<code>-选项名称 选项值</code>或者<code>选项名称=选项值</code>。  </p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> apache-cassandra-<span class="number">2.2</span>.<span class="number">6</span>/tools/bin/</span><br><span class="line">cassandra-stress <span class="keyword">command</span> [<span class="keyword">options</span>]</span><br></pre></td></tr></table></figure>
<p>常用的选项有</p>
<ol>
<li><code>线程数量</code>：-rate threads=? [limit=?]，比如<code>-rate threads=100</code></li>
<li><code>表结构设置</code>：<code>-schema [replication(?)] [keyspace=?] [compaction(?)] [compression=?]</code></li>
<li><code>日志设置</code>：-log level=verbose</li>
<li><code>运行模式</code>的几种示例，因为Cassandra本身提供了多种交互方式比如thrift协议，CQL协议等  <figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby">mode thrift [smart]</span><br><span class="line"></span>-<span class="ruby">mode native [unprepared] cql3 [compression=?]</span><br><span class="line"></span>-<span class="ruby">mode simplenative [prepared] cql3</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>在2.1.5之后，添加了一些选项（通常针对user命令）  </p>
<ol>
<li>profile=?：指定YAML配置文件，需要自己编写DML，插入，查询</li>
<li>ops(?)：指定操作类型和数量，比如ops(inserts=1)，或者ops(queries=2)，其中queries需要用指定的查询名称代替</li>
<li>n=?：指定操作数量，比如要写入10万条数据，n=100000； 要读取1000条数据，n=1000</li>
<li>truncate=?，是否需要清空表，可选项有：never(默认值),one,always</li>
<li>cl=?：一致性级别，可选项有：ONE,QUORUM,LOCAL_QUORUM,EACH_QUORUM,ALL,ANY,LOCAL_ONE(默认值)</li>
</ol>
<p>注意选项名称1=选项值必须放在-选项名称2 选项值前面，如果把选项名称1放在后面，会被认为作为选项名称2的子选项。<br>比如正确的用法：truncate=one -node xxx，而不能是：-node xxx truncate=one，后者会认为是-node的子选项。  </p>
<p>一个示例：写入100万条数据，一致性级别为Local_Quorum，客户端线程数=500个，32个列，副本数据=3个</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cassandra-stress write n=<span class="number">1000000</span> cl=LOCAL_QUORUM -rate threads=<span class="number">500</span> \</span><br><span class="line">    -col <span class="string">"size=fixed(2048)"</span> <span class="string">"n=fixed(32)"</span> -schema <span class="string">"replication(factor=3)"</span> -node <span class="number">192.168</span><span class="number">.10</span><span class="number">.12</span></span><br></pre></td></tr></table></figure>
<h3 id="单节点测试">单节点测试</h3><p>一键测试命令：nohup sh stress1.sh &gt; stress1.log 2&gt;&amp;1 &amp;</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">/home/admin/apache-cassandra-<span class="number">2.2</span>.<span class="number">6</span>/bin/nodetool -h <span class="number">10.21</span>.<span class="number">21.10</span> status</span><br><span class="line"><span class="built_in">cd</span> /home/admin/apache-cassandra-<span class="number">2.2</span>.<span class="number">6</span>/tools/bin</span><br><span class="line"><span class="comment">#标准测试</span></span><br><span class="line"><span class="comment">########</span></span><br><span class="line">./cassandra-stress write n=<span class="number">1000000</span> -node <span class="number">10.21</span>.<span class="number">21.10</span> -log file=SINGLENODE1_write_1M.log</span><br><span class="line">./cassandra-stress <span class="built_in">read</span> n=<span class="number">200000</span> -node <span class="number">10.21</span>.<span class="number">21.10</span> -log file=SINGLENODE2_<span class="built_in">read</span>_2.log</span><br><span class="line">./cassandra-stress <span class="built_in">read</span> n=<span class="number">200000</span> no-warmup -node <span class="number">10.21</span>.<span class="number">21.10</span> -log file=SINGLENODE3_<span class="built_in">read</span>_2_nowarm.log</span><br><span class="line">./cassandra-stress <span class="built_in">read</span> duration=<span class="number">3</span>m -node <span class="number">10.21</span>.<span class="number">21.10</span> -log file=SINGLENODE4_<span class="built_in">read</span>_3min.log</span><br><span class="line"></span><br><span class="line"><span class="comment">#混合模式</span></span><br><span class="line"><span class="comment">########</span></span><br><span class="line"><span class="comment">#./cassandra-stress write n=1 cl=one -mode native cql3 -log file=SINGLENODE_create_schema.log -node 10.21.21.10</span></span><br><span class="line"><span class="comment">#./cassandra-stress write n=1000000 cl=one -mode native cql3 -schema keyspace="keyspace1" -log file=SINGLENODE5_write_1M_rows.log -node 10.21.21.10</span></span><br><span class="line"></span><br><span class="line">./cassandra-stress mixed ratio\(write=<span class="number">1</span>,<span class="built_in">read</span>=<span class="number">3</span>\) n=<span class="number">100000</span> cl=ONE -pop dist=UNIFORM\(<span class="number">1</span>..<span class="number">1000000</span>\) -schema keyspace=<span class="string">"keyspace1"</span> -mode native cql3 -rate threads\&gt;=<span class="number">16</span> threads\&lt;=<span class="number">256</span> -log file=SINGLENODE5_mixed_write1<span class="built_in">read</span>3_1M.log -node <span class="number">10.21</span>.<span class="number">21.10</span></span><br><span class="line">./cassandra-stress mixed ratio\(write=<span class="number">3</span>,<span class="built_in">read</span>=<span class="number">1</span>\) n=<span class="number">100000</span> cl=ONE -pop dist=UNIFORM\(<span class="number">1</span>..<span class="number">1000000</span>\) -schema keyspace=<span class="string">"keyspace1"</span> -mode native cql3 -rate threads\&gt;=<span class="number">16</span> threads\&lt;=<span class="number">256</span> -log file=SINGLENODE6_mixed_write3<span class="built_in">read</span>1_1M.log -node <span class="number">10.21</span>.<span class="number">21.10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#./cassandra-stress write n=1000000 cl=one -mode native cql3 -schema keyspace="keyspace1" -pop seq=1..1000000 -node 10.21.21.10</span></span><br><span class="line"><span class="comment">#./cassandra-stress read n=1000000 cl=one -mode native cql3 -schema keyspace="keyspace1" -pop seq=1..1000000 -node 10.21.21.10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#自定义表</span></span><br><span class="line"><span class="comment">########</span></span><br><span class="line">./cassandra-stress user profile=./blogpost1.yaml ops\(insert=<span class="number">1</span>\) -node <span class="number">10.21</span>.<span class="number">21.10</span> -log file=SINGLENODE7_blog_insert.log</span><br><span class="line">./cassandra-stress user profile=./blogpost1.yaml ops\(singlepost=<span class="number">2</span>,timeline=<span class="number">1</span>,insert=<span class="number">1</span>\) -node <span class="number">10.21</span>.<span class="number">21.10</span> -log file=SINGLENODE8_blog_mixed.log</span><br><span class="line">./cassandra-stress user profile=./blogpost1.yaml ops\(singlepost=<span class="number">1</span>\) -node <span class="number">10.21</span>.<span class="number">21.10</span> -log file=SINGLENODE9_blog_q1.log</span><br><span class="line">./cassandra-stress user profile=./blogpost1.yaml ops\(timeline=<span class="number">1</span>\) -node <span class="number">10.21</span>.<span class="number">21.10</span> -log file=SINGLENODE10_blog_q2.log</span><br><span class="line"></span><br><span class="line"><span class="comment">#支持图形显示结果（3.2以上支持）</span></span><br><span class="line"><span class="comment">########</span></span><br><span class="line"><span class="comment">#cassandra-stress write n=100000 -rate threads=10 -graph file=example-benchmark.html title=example revision=benchmark-0</span></span><br><span class="line"><span class="comment">#cassandra-stress mixed n=100000 -rate threads=10 -graph file=example-benchmark.html title=example revision=benchmark-0</span></span><br></pre></td></tr></table></figure>
<h4 id="写入测试">写入测试</h4><p>测试100万条数据的写入速度：./cassandra-stress write n=1000000 -node 10.21.21.10 -log file=SINGLENODE1_write_1M.log<br>测试结果：每秒钟写入5.8万条，由于每个row key都是唯一的，所以100万条数据有100万个分区，每秒钟的写入量=每秒钟写入的分区数=每秒钟写入的行数。<br>每条记录的写延迟平均3.4ms，写延迟小于4.1ms的占比95，写延迟小于21ms的占比99%，也就是说99%的记录写延迟在21ms以下。<br>最大一条记录的写延迟为180ms。GC一共发生了5次，GC的大小为7G，GC时间花了1秒，平均GC时间为143ms。  </p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">Results:</span> [write n=<span class="number">1000000</span>], <span class="number">200</span> threads</span><br><span class="line">op <span class="string">rate                   :</span> <span class="number">57901</span> [<span class="string">WRITE:</span><span class="number">57901</span>]</span><br><span class="line">partition <span class="string">rate            :</span> <span class="number">57901</span> [<span class="string">WRITE:</span><span class="number">57901</span>]</span><br><span class="line">row <span class="string">rate                  :</span> <span class="number">57901</span> [<span class="string">WRITE:</span><span class="number">57901</span>]</span><br><span class="line">latency <span class="string">mean              :</span> <span class="number">3.4</span> [<span class="string">WRITE:</span><span class="number">3</span>ps<span class="number">.4</span>]</span><br><span class="line">latency <span class="string">median            :</span> <span class="number">3.2</span> [<span class="string">WRITE:</span><span class="number">3.2</span>]</span><br><span class="line">latency <span class="number">95</span>th <span class="string">percentile   :</span> <span class="number">4.1</span> [<span class="string">WRITE:</span><span class="number">4.1</span>]</span><br><span class="line">latency <span class="number">99</span>th <span class="string">percentile   :</span> <span class="number">5.1</span> [<span class="string">WRITE:</span><span class="number">5.1</span>]</span><br><span class="line">latency <span class="number">99.9</span>th <span class="string">percentile :</span> <span class="number">21.3</span> [<span class="string">WRITE:</span><span class="number">21.3</span>]</span><br><span class="line">latency <span class="string">max               :</span> <span class="number">180.1</span> [<span class="string">WRITE:</span><span class="number">180.1</span>]</span><br><span class="line">Total <span class="string">partitions          :</span> <span class="number">1000000</span> [<span class="string">WRITE:</span><span class="number">1000000</span>]</span><br><span class="line">Total <span class="string">errors              :</span> <span class="number">0</span> [<span class="string">WRITE:</span><span class="number">0</span>]</span><br><span class="line">total gc <span class="string">count            :</span> <span class="number">5</span></span><br><span class="line">total gc <span class="string">mb               :</span> <span class="number">7362</span></span><br><span class="line">total gc time (s)         : <span class="number">1</span></span><br><span class="line">avg gc time(ms)           : <span class="number">143</span></span><br><span class="line">stdev gc time(ms)         : <span class="number">42</span></span><br><span class="line">Total operation <span class="string">time      :</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">17</span></span><br></pre></td></tr></table></figure>
<p>客户端在集群之外测试时，每秒钟的写入量增大到11万。不过GC大小和时间没有多大变化，当然因为每秒钟写入量增多，总共10万条数据，花费的时间也就不同了。  </p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">op <span class="string">rate                   :</span> <span class="number">114509</span> [<span class="string">WRITE:</span><span class="number">114509</span>]</span><br><span class="line">partition <span class="string">rate            :</span> <span class="number">114509</span> [<span class="string">WRITE:</span><span class="number">114509</span>]</span><br><span class="line">row <span class="string">rate                  :</span> <span class="number">114509</span> [<span class="string">WRITE:</span><span class="number">114509</span>]</span><br><span class="line">latency <span class="string">mean              :</span> <span class="number">1.7</span> [<span class="string">WRITE:</span><span class="number">1.7</span>]</span><br><span class="line">latency <span class="string">median            :</span> <span class="number">1.4</span> [<span class="string">WRITE:</span><span class="number">1.4</span>]</span><br><span class="line">latency <span class="number">95</span>th <span class="string">percentile   :</span> <span class="number">2.0</span> [<span class="string">WRITE:</span><span class="number">2.0</span>]</span><br><span class="line">latency <span class="number">99</span>th <span class="string">percentile   :</span> <span class="number">3.0</span> [<span class="string">WRITE:</span><span class="number">3.0</span>]</span><br><span class="line">latency <span class="number">99.9</span>th <span class="string">percentile :</span> <span class="number">110.1</span> [<span class="string">WRITE:</span><span class="number">110.1</span>]</span><br><span class="line">latency <span class="string">max               :</span> <span class="number">191.8</span> [<span class="string">WRITE:</span><span class="number">191.8</span>]</span><br><span class="line">Total <span class="string">partitions          :</span> <span class="number">1000000</span> [<span class="string">WRITE:</span><span class="number">1000000</span>]</span><br><span class="line">Total <span class="string">errors              :</span> <span class="number">0</span> [<span class="string">WRITE:</span><span class="number">0</span>]</span><br><span class="line">total gc <span class="string">count            :</span> <span class="number">5</span></span><br><span class="line">total gc <span class="string">mb               :</span> <span class="number">7351</span></span><br><span class="line">total gc time (s)         : <span class="number">1</span></span><br><span class="line">avg gc time(ms)           : <span class="number">147</span></span><br><span class="line">stdev gc time(ms)         : <span class="number">34</span></span><br><span class="line">Total operation <span class="string">time      :</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">08</span></span><br></pre></td></tr></table></figure>
<p>G1_16G:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">op <span class="string">rate                   :</span> <span class="number">119438</span> [<span class="string">WRITE:</span><span class="number">119438</span>]</span><br><span class="line">partition <span class="string">rate            :</span> <span class="number">119438</span> [<span class="string">WRITE:</span><span class="number">119438</span>]</span><br><span class="line">row <span class="string">rate                  :</span> <span class="number">119438</span> [<span class="string">WRITE:</span><span class="number">119438</span>]</span><br><span class="line">latency <span class="string">mean              :</span> <span class="number">1.7</span> [<span class="string">WRITE:</span><span class="number">1.7</span>]</span><br><span class="line">latency <span class="string">median            :</span> <span class="number">1.4</span> [<span class="string">WRITE:</span><span class="number">1.4</span>]</span><br><span class="line">latency <span class="number">95</span>th <span class="string">percentile   :</span> <span class="number">2.4</span> [<span class="string">WRITE:</span><span class="number">2.4</span>]</span><br><span class="line">latency <span class="number">99</span>th <span class="string">percentile   :</span> <span class="number">3.7</span> [<span class="string">WRITE:</span><span class="number">3.7</span>]</span><br><span class="line">latency <span class="number">99.9</span>th <span class="string">percentile :</span> <span class="number">22.8</span> [<span class="string">WRITE:</span><span class="number">22.8</span>]</span><br><span class="line">latency <span class="string">max               :</span> <span class="number">299.3</span> [<span class="string">WRITE:</span><span class="number">299.3</span>]</span><br><span class="line">Total <span class="string">partitions          :</span> <span class="number">1000000</span> [<span class="string">WRITE:</span><span class="number">1000000</span>]</span><br><span class="line">Total <span class="string">errors              :</span> <span class="number">0</span> [<span class="string">WRITE:</span><span class="number">0</span>]</span><br><span class="line">total gc <span class="string">count            :</span> <span class="number">3</span></span><br><span class="line">total gc <span class="string">mb               :</span> <span class="number">12143</span></span><br><span class="line">total gc time (s)         : <span class="number">1</span></span><br><span class="line">avg gc time(ms)           : <span class="number">195</span></span><br><span class="line">stdev gc time(ms)         : <span class="number">64</span></span><br><span class="line">Total operation <span class="string">time      :</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">08</span></span><br></pre></td></tr></table></figure>
<p>G1_24G</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">op <span class="string">rate                   :</span> <span class="number">125029</span> [<span class="string">WRITE:</span><span class="number">125029</span>]</span><br><span class="line">partition <span class="string">rate            :</span> <span class="number">125029</span> [<span class="string">WRITE:</span><span class="number">125029</span>]</span><br><span class="line">row <span class="string">rate                  :</span> <span class="number">125029</span> [<span class="string">WRITE:</span><span class="number">125029</span>]</span><br><span class="line">latency <span class="string">mean              :</span> <span class="number">1.6</span> [<span class="string">WRITE:</span><span class="number">1.6</span>]</span><br><span class="line">latency <span class="string">median            :</span> <span class="number">1.3</span> [<span class="string">WRITE:</span><span class="number">1.3</span>]</span><br><span class="line">latency <span class="number">95</span>th <span class="string">percentile   :</span> <span class="number">1.8</span> [<span class="string">WRITE:</span><span class="number">1.8</span>]</span><br><span class="line">latency <span class="number">99</span>th <span class="string">percentile   :</span> <span class="number">2.9</span> [<span class="string">WRITE:</span><span class="number">2.9</span>]</span><br><span class="line">latency <span class="number">99.9</span>th <span class="string">percentile :</span> <span class="number">84.8</span> [<span class="string">WRITE:</span><span class="number">84.8</span>]</span><br><span class="line">latency <span class="string">max               :</span> <span class="number">113.5</span> [<span class="string">WRITE:</span><span class="number">113.5</span>]</span><br><span class="line">Total <span class="string">partitions          :</span> <span class="number">1000000</span> [<span class="string">WRITE:</span><span class="number">1000000</span>]</span><br><span class="line">Total <span class="string">errors              :</span> <span class="number">0</span> [<span class="string">WRITE:</span><span class="number">0</span>]</span><br><span class="line">total gc <span class="string">count            :</span> <span class="number">7</span></span><br><span class="line">total gc <span class="string">mb               :</span> <span class="number">6680</span></span><br><span class="line">total gc time (s)         : <span class="number">1</span></span><br><span class="line">avg gc time(ms)           : <span class="number">86</span></span><br><span class="line">stdev gc time(ms)         : <span class="number">14</span></span><br><span class="line">Total operation <span class="string">time      :</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">07</span></span><br></pre></td></tr></table></figure>
<p>G1_32G</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">op <span class="string">rate                   :</span> <span class="number">119296</span> [<span class="string">WRITE:</span><span class="number">119296</span>]</span><br><span class="line">partition <span class="string">rate            :</span> <span class="number">119296</span> [<span class="string">WRITE:</span><span class="number">119296</span>]</span><br><span class="line">row <span class="string">rate                  :</span> <span class="number">119296</span> [<span class="string">WRITE:</span><span class="number">119296</span>]</span><br><span class="line">latency <span class="string">mean              :</span> <span class="number">1.7</span> [<span class="string">WRITE:</span><span class="number">1.7</span>]</span><br><span class="line">latency <span class="string">median            :</span> <span class="number">1.4</span> [<span class="string">WRITE:</span><span class="number">1.4</span>]</span><br><span class="line">latency <span class="number">95</span>th <span class="string">percentile   :</span> <span class="number">2.3</span> [<span class="string">WRITE:</span><span class="number">2.3</span>]</span><br><span class="line">latency <span class="number">99</span>th <span class="string">percentile   :</span> <span class="number">3.6</span> [<span class="string">WRITE:</span><span class="number">3.6</span>]</span><br><span class="line">latency <span class="number">99.9</span>th <span class="string">percentile :</span> <span class="number">38.0</span> [<span class="string">WRITE:</span><span class="number">38.0</span>]</span><br><span class="line">latency <span class="string">max               :</span> <span class="number">168.8</span> [<span class="string">WRITE:</span><span class="number">168.8</span>]</span><br><span class="line">Total <span class="string">partitions          :</span> <span class="number">1000000</span> [<span class="string">WRITE:</span><span class="number">1000000</span>]</span><br><span class="line">Total <span class="string">errors              :</span> <span class="number">0</span> [<span class="string">WRITE:</span><span class="number">0</span>]</span><br><span class="line">total gc <span class="string">count            :</span> <span class="number">7</span></span><br><span class="line">total gc <span class="string">mb               :</span> <span class="number">8904</span></span><br><span class="line">total gc time (s)         : <span class="number">1</span></span><br><span class="line">avg gc time(ms)           : <span class="number">83</span></span><br><span class="line">stdev gc time(ms)         : <span class="number">26</span></span><br><span class="line">Total operation <span class="string">time      :</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">08</span></span><br></pre></td></tr></table></figure>
<h4 id="采用cql3协议写入">采用cql3协议写入</h4><p>./cassandra-stress write n=1000000 cl=one -mode native cql3 -schema keyspace=”keyspace1” -log file=SINGLENODE5_write_1M_rows.log -node 10.21.21.10<br>测试结果：基本上和默认的模式是一样的，那么默认的模式是什么类型的？  </p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">op <span class="string">rate                   :</span> <span class="number">123953</span> [<span class="string">WRITE:</span><span class="number">123953</span>]</span><br><span class="line">partition <span class="string">rate            :</span> <span class="number">123953</span> [<span class="string">WRITE:</span><span class="number">123953</span>]</span><br><span class="line">row <span class="string">rate                  :</span> <span class="number">123953</span> [<span class="string">WRITE:</span><span class="number">123953</span>]</span><br><span class="line">latency <span class="string">mean              :</span> <span class="number">1.6</span> [<span class="string">WRITE:</span><span class="number">1.6</span>]</span><br><span class="line">latency <span class="string">median            :</span> <span class="number">1.4</span> [<span class="string">WRITE:</span><span class="number">1.4</span>]</span><br><span class="line">latency <span class="number">95</span>th <span class="string">percentile   :</span> <span class="number">1.8</span> [<span class="string">WRITE:</span><span class="number">1.8</span>]</span><br><span class="line">latency <span class="number">99</span>th <span class="string">percentile   :</span> <span class="number">2.5</span> [<span class="string">WRITE:</span><span class="number">2.5</span>]</span><br><span class="line">latency <span class="number">99.9</span>th <span class="string">percentile :</span> <span class="number">18.7</span> [<span class="string">WRITE:</span><span class="number">18.7</span>]</span><br><span class="line">latency <span class="string">max               :</span> <span class="number">201.6</span> [<span class="string">WRITE:</span><span class="number">201.6</span>]</span><br><span class="line">Total <span class="string">partitions          :</span> <span class="number">1000000</span> [<span class="string">WRITE:</span><span class="number">1000000</span>]</span><br><span class="line">Total <span class="string">errors              :</span> <span class="number">0</span> [<span class="string">WRITE:</span><span class="number">0</span>]</span><br><span class="line">total gc <span class="string">count            :</span> <span class="number">4</span></span><br><span class="line">total gc <span class="string">mb               :</span> <span class="number">5753</span></span><br><span class="line">total gc time (s)         : <span class="number">1</span></span><br><span class="line">avg gc time(ms)           : <span class="number">165</span></span><br><span class="line">stdev gc time(ms)         : <span class="number">39</span></span><br><span class="line">Total operation <span class="string">time      :</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">08</span></span><br></pre></td></tr></table></figure>
<p>可能是由于数量太小（100万还不小？可以设置为500万，差不多需要7分钟），更改内存，基本上看不出差别。</p>
<h4 id="读取测试">读取测试</h4><p>读取20万条记录：./cassandra-stress read n=200000 -node 10.21.21.10 -log file=SINGLENODE2_read_2.log<br>测试结果：使用121个线程时，每秒最大可以读取8万条数据，平均每条读取时间1.4ms，99.9%的读取时间在2ms内，<br>读取时间最长的那条记录花了21ms，GC发生了一次，花费了14ms。<br>问题：为什么读取也会有GC？ 因为读取时会先把数据放到内存，然后才会返回给客户端。  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line">  <span class="number">4</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">24220</span>,   <span class="number">24220</span>,   <span class="number">24220</span>,     <span class="number">0.2</span>,     <span class="number">0.1</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,    <span class="number">40.3</span>,    <span class="number">8.3</span>,  <span class="number">0.01704</span>,      <span class="number">0</span>,      <span class="number">2</span>,      <span class="number">69</span>,      <span class="number">69</span>,       <span class="number">5</span>,    <span class="number">3380</span></span><br><span class="line">  <span class="number">8</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">44524</span>,   <span class="number">44524</span>,   <span class="number">44524</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,    <span class="number">26.7</span>,    <span class="number">4.5</span>,  <span class="number">0.01377</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">25</span>,      <span class="number">25</span>,       <span class="number">0</span>,    <span class="number">1640</span></span><br><span class="line"> <span class="number">16</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">66583</span>,   <span class="number">66583</span>,   <span class="number">66583</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">1.1</span>,    <span class="number">32.3</span>,    <span class="number">3.0</span>,  <span class="number">0.01140</span>,      <span class="number">0</span>,      <span class="number">2</span>,      <span class="number">16</span>,      <span class="number">29</span>,       <span class="number">2</span>,    <span class="number">1646</span></span><br><span class="line"> <span class="number">24</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">71464</span>,   <span class="number">71464</span>,   <span class="number">71464</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.7</span>,    <span class="number">19.1</span>,    <span class="number">2.8</span>,  <span class="number">0.02220</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">13</span>,      <span class="number">13</span>,       <span class="number">0</span>,    <span class="number">1638</span></span><br><span class="line"> <span class="number">36</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">74215</span>,   <span class="number">74215</span>,   <span class="number">74215</span>,     <span class="number">0.5</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.8</span>,     <span class="number">1.1</span>,    <span class="number">16.2</span>,    <span class="number">2.7</span>,  <span class="number">0.02348</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">15</span>,      <span class="number">15</span>,       <span class="number">0</span>,    <span class="number">1637</span></span><br><span class="line"> <span class="number">54</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">75220</span>,   <span class="number">75220</span>,   <span class="number">75220</span>,     <span class="number">0.7</span>,     <span class="number">0.7</span>,     <span class="number">0.9</span>,     <span class="number">1.0</span>,     <span class="number">1.6</span>,    <span class="number">16.4</span>,    <span class="number">2.7</span>,  <span class="number">0.00871</span>,      <span class="number">0</span>,      <span class="number">2</span>,      <span class="number">28</span>,      <span class="number">28</span>,       <span class="number">0</span>,    <span class="number">3276</span></span><br><span class="line"> <span class="number">81</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">77820</span>,   <span class="number">77820</span>,   <span class="number">77820</span>,     <span class="number">1.0</span>,     <span class="number">1.0</span>,     <span class="number">1.3</span>,     <span class="number">1.6</span>,     <span class="number">7.0</span>,    <span class="number">17.6</span>,    <span class="number">2.6</span>,  <span class="number">0.02741</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">15</span>,      <span class="number">15</span>,       <span class="number">0</span>,    <span class="number">1638</span></span><br><span class="line"><span class="number">121</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">83228</span>,   <span class="number">83228</span>,   <span class="number">83228</span>,     <span class="number">1.4</span>,     <span class="number">1.4</span>,     <span class="number">1.6</span>,     <span class="number">1.7</span>,     <span class="number">2.0</span>,    <span class="number">21.0</span>,    <span class="number">2.4</span>,  <span class="number">0.00911</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">14</span>,      <span class="number">14</span>,       <span class="number">0</span>,    <span class="number">1638</span></span><br><span class="line"><span class="number">181</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">77173</span>,   <span class="number">77173</span>,   <span class="number">77173</span>,     <span class="number">2.3</span>,     <span class="number">2.4</span>,     <span class="number">2.7</span>,     <span class="number">3.2</span>,    <span class="number">16.7</span>,    <span class="number">18.6</span>,    <span class="number">2.6</span>,  <span class="number">0.01297</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">14</span>,      <span class="number">14</span>,       <span class="number">0</span>,    <span class="number">1638</span></span><br><span class="line"><span class="number">271</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">71700</span>,   <span class="number">71700</span>,   <span class="number">71700</span>,     <span class="number">3.8</span>,     <span class="number">3.6</span>,     <span class="number">4.9</span>,     <span class="number">5.7</span>,    <span class="number">18.7</span>,    <span class="number">20.6</span>,    <span class="number">2.8</span>,  <span class="number">0.02096</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">13</span>,      <span class="number">13</span>,       <span class="number">0</span>,    <span class="number">1638</span></span><br></pre></td></tr></table></figure>
<p>上面是stress客户端和Cassandra运行在同一个节点，客户端本身消耗一定的资源，下面是客户端在集群之外的测试：<br>测试结果：线程数量在181时达到最大，因为客户端在集群里面本身开启一些测试线程，把客户端排除在外后，可用的线程数增大。<br>在181个线程下，每秒钟最大可以读取13万条，99.9%的读取时间在2.5ms，GC一次花了14ms。<br>可以看到跟上面的结果是差不多的，只不过因为客户端线程本身占用了一些线程，导致没有达到最大线程。  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line">  <span class="number">4</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">19522</span>,   <span class="number">19522</span>,   <span class="number">19522</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.6</span>,    <span class="number">37.4</span>,   <span class="number">10.2</span>,  <span class="number">0.01172</span>,      <span class="number">0</span>,      <span class="number">2</span>,      <span class="number">67</span>,      <span class="number">67</span>,       <span class="number">3</span>,    <span class="number">3265</span></span><br><span class="line">  <span class="number">8</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">32361</span>,   <span class="number">32361</span>,   <span class="number">32361</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.4</span>,    <span class="number">26.4</span>,    <span class="number">6.2</span>,  <span class="number">0.00157</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">25</span>,      <span class="number">25</span>,       <span class="number">0</span>,    <span class="number">1638</span></span><br><span class="line"> <span class="number">16</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">48620</span>,   <span class="number">48620</span>,   <span class="number">48620</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,    <span class="number">18.9</span>,    <span class="number">4.1</span>,  <span class="number">0.01178</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">17</span>,      <span class="number">17</span>,       <span class="number">0</span>,    <span class="number">1636</span></span><br><span class="line"> <span class="number">24</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">56026</span>,   <span class="number">56026</span>,   <span class="number">56026</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.8</span>,    <span class="number">17.7</span>,    <span class="number">3.6</span>,  <span class="number">0.00253</span>,      <span class="number">0</span>,      <span class="number">2</span>,      <span class="number">32</span>,      <span class="number">32</span>,       <span class="number">1</span>,    <span class="number">3276</span></span><br><span class="line"> <span class="number">36</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">70923</span>,   <span class="number">70923</span>,   <span class="number">70923</span>,     <span class="number">0.5</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,     <span class="number">0.8</span>,    <span class="number">16.9</span>,    <span class="number">2.8</span>,  <span class="number">0.00233</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">15</span>,      <span class="number">15</span>,       <span class="number">0</span>,    <span class="number">1638</span></span><br><span class="line"> <span class="number">54</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">86152</span>,   <span class="number">86152</span>,   <span class="number">86152</span>,     <span class="number">0.6</span>,     <span class="number">0.6</span>,     <span class="number">0.8</span>,     <span class="number">0.8</span>,     <span class="number">0.9</span>,    <span class="number">16.8</span>,    <span class="number">2.3</span>,  <span class="number">0.01160</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">15</span>,      <span class="number">15</span>,       <span class="number">0</span>,    <span class="number">1638</span></span><br><span class="line"> <span class="number">81</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">103282</span>,  <span class="number">103282</span>,  <span class="number">103282</span>,     <span class="number">0.8</span>,     <span class="number">0.7</span>,     <span class="number">1.0</span>,     <span class="number">1.0</span>,     <span class="number">1.2</span>,    <span class="number">21.5</span>,    <span class="number">1.9</span>,  <span class="number">0.00076</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">15</span>,      <span class="number">15</span>,       <span class="number">0</span>,    <span class="number">1638</span></span><br><span class="line"><span class="number">121</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">123607</span>,  <span class="number">123607</span>,  <span class="number">123607</span>,     <span class="number">1.0</span>,     <span class="number">0.9</span>,     <span class="number">1.3</span>,     <span class="number">1.5</span>,    <span class="number">22.9</span>,    <span class="number">31.2</span>,    <span class="number">1.6</span>,  <span class="number">0.01687</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">14</span>,      <span class="number">14</span>,       <span class="number">0</span>,    <span class="number">1638</span></span><br><span class="line"><span class="number">181</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">134298</span>,  <span class="number">134298</span>,  <span class="number">134298</span>,     <span class="number">1.3</span>,     <span class="number">1.2</span>,     <span class="number">1.8</span>,     <span class="number">2.1</span>,     <span class="number">2.5</span>,    <span class="number">27.6</span>,    <span class="number">1.5</span>,  <span class="number">0.00338</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">14</span>,      <span class="number">14</span>,       <span class="number">0</span>,    <span class="number">1638</span></span><br><span class="line"><span class="number">271</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">132761</span>,  <span class="number">132761</span>,  <span class="number">132761</span>,     <span class="number">2.1</span>,     <span class="number">1.8</span>,     <span class="number">2.9</span>,     <span class="number">3.2</span>,    <span class="number">17.7</span>,    <span class="number">25.8</span>,    <span class="number">1.5</span>,  <span class="number">0.01147</span>,      <span class="number">0</span>,      <span class="number">2</span>,      <span class="number">28</span>,      <span class="number">28</span>,       <span class="number">0</span>,    <span class="number">3276</span></span><br><span class="line"><span class="number">406</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">121970</span>,  <span class="number">121970</span>,  <span class="number">121970</span>,     <span class="number">3.3</span>,     <span class="number">3.1</span>,     <span class="number">4.7</span>,     <span class="number">5.6</span>,    <span class="number">37.4</span>,    <span class="number">39.2</span>,    <span class="number">1.6</span>,  <span class="number">0.04408</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">14</span>,      <span class="number">14</span>,       <span class="number">0</span>,    <span class="number">1638</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>问题：这里的线程数是什么含义？跟Cassandra本身的concurrent_reads有没有什么关系，如果更了concurrent_reads，这里的线程数会不会有影响？<br>答：这里的线程指的应该是客户端线程数，就好比多个客户端同时要查询Cassandra，实际中是API分布在多台机器上，每台机器都会查询Cassandra。所以线程数指的是可以允许多少个客户端同时查询。</p>
</blockquote>
<p>又测试一次，看起来很上面差不多，不过不同的是.999的读取时间在81个线程-271个线程不断递增，而上面在181线程却降下来了。<br>实际上即使每次测试，结果也是不同的，不过可以测试多次，观察相同的现象，从而得出最优的线程。  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line">  <span class="number">4</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">20232</span>,   <span class="number">20232</span>,   <span class="number">20232</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,    <span class="number">29.9</span>,    <span class="number">9.9</span>,  <span class="number">0.00875</span>,      <span class="number">0</span>,      <span class="number">2</span>,      <span class="number">56</span>,      <span class="number">56</span>,       <span class="number">1</span>,    <span class="number">3408</span></span><br><span class="line">  <span class="number">8</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">31871</span>,   <span class="number">31871</span>,   <span class="number">31871</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,    <span class="number">24.8</span>,    <span class="number">6.3</span>,  <span class="number">0.00596</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">24</span>,      <span class="number">24</span>,       <span class="number">0</span>,    <span class="number">1640</span></span><br><span class="line"> <span class="number">16</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">48916</span>,   <span class="number">48916</span>,   <span class="number">48916</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.5</span>,    <span class="number">18.4</span>,    <span class="number">4.1</span>,  <span class="number">0.00362</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">16</span>,      <span class="number">16</span>,       <span class="number">0</span>,    <span class="number">1638</span></span><br><span class="line"> <span class="number">24</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">57223</span>,   <span class="number">57223</span>,   <span class="number">57223</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.6</span>,    <span class="number">17.2</span>,    <span class="number">3.5</span>,  <span class="number">0.00869</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">15</span>,      <span class="number">15</span>,       <span class="number">0</span>,    <span class="number">1637</span></span><br><span class="line"> <span class="number">36</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">72069</span>,   <span class="number">72069</span>,   <span class="number">72069</span>,     <span class="number">0.5</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,     <span class="number">0.7</span>,    <span class="number">15.7</span>,    <span class="number">2.8</span>,  <span class="number">0.00479</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">14</span>,      <span class="number">14</span>,       <span class="number">0</span>,    <span class="number">1638</span></span><br><span class="line"> <span class="number">54</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">84576</span>,   <span class="number">84576</span>,   <span class="number">84576</span>,     <span class="number">0.6</span>,     <span class="number">0.6</span>,     <span class="number">0.8</span>,     <span class="number">0.8</span>,     <span class="number">8.8</span>,    <span class="number">16.1</span>,    <span class="number">2.4</span>,  <span class="number">0.01512</span>,      <span class="number">0</span>,      <span class="number">2</span>,      <span class="number">27</span>,      <span class="number">27</span>,       <span class="number">1</span>,    <span class="number">3276</span></span><br><span class="line"> <span class="number">81</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">97560</span>,   <span class="number">97560</span>,   <span class="number">97560</span>,     <span class="number">0.8</span>,     <span class="number">0.8</span>,     <span class="number">1.0</span>,     <span class="number">1.3</span>,    <span class="number">10.5</span>,    <span class="number">19.3</span>,    <span class="number">2.0</span>,  <span class="number">0.00667</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">13</span>,      <span class="number">13</span>,       <span class="number">0</span>,    <span class="number">1638</span></span><br><span class="line"><span class="number">121</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">124550</span>,  <span class="number">124550</span>,  <span class="number">124550</span>,     <span class="number">1.0</span>,     <span class="number">0.9</span>,     <span class="number">1.3</span>,     <span class="number">1.5</span>,    <span class="number">11.3</span>,    <span class="number">15.5</span>,    <span class="number">1.6</span>,  <span class="number">0.01291</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">13</span>,      <span class="number">13</span>,       <span class="number">0</span>,    <span class="number">1638</span></span><br><span class="line"><span class="number">181</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">128233</span>,  <span class="number">128233</span>,  <span class="number">128233</span>,     <span class="number">1.4</span>,     <span class="number">1.3</span>,     <span class="number">1.9</span>,     <span class="number">2.2</span>,    <span class="number">15.2</span>,    <span class="number">26.5</span>,    <span class="number">1.6</span>,  <span class="number">0.02911</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">14</span>,      <span class="number">14</span>,       <span class="number">0</span>,    <span class="number">1638</span></span><br><span class="line"><span class="number">271</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">129338</span>,  <span class="number">129338</span>,  <span class="number">129338</span>,     <span class="number">2.1</span>,     <span class="number">1.8</span>,     <span class="number">3.0</span>,     <span class="number">3.3</span>,    <span class="number">36.4</span>,    <span class="number">37.1</span>,    <span class="number">1.5</span>,  <span class="number">0.00817</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">14</span>,      <span class="number">14</span>,       <span class="number">0</span>,    <span class="number">1638</span></span><br><span class="line"><span class="number">406</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">122300</span>,  <span class="number">122300</span>,  <span class="number">122300</span>,     <span class="number">3.3</span>,     <span class="number">3.1</span>,     <span class="number">4.4</span>,     <span class="number">5.3</span>,    <span class="number">30.9</span>,    <span class="number">33.7</span>,    <span class="number">1.6</span>,  <span class="number">0.02184</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">14</span>,      <span class="number">14</span>,       <span class="number">0</span>,    <span class="number">1638</span></span><br></pre></td></tr></table></figure>
<p>G1_16G</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line">  <span class="number">4</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">20314</span>,   <span class="number">20314</span>,   <span class="number">20314</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,   <span class="number">217.3</span>,    <span class="number">9.8</span>,  <span class="number">0.00695</span>,      <span class="number">0</span>,      <span class="number">1</span>,     <span class="number">205</span>,     <span class="number">205</span>,       <span class="number">0</span>,    <span class="number">4514</span></span><br><span class="line">  <span class="number">8</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">32903</span>,   <span class="number">32903</span>,   <span class="number">32903</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.5</span>,    <span class="number">11.1</span>,    <span class="number">6.1</span>,  <span class="number">0.05020</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">16</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">50563</span>,   <span class="number">50563</span>,   <span class="number">50563</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.5</span>,     <span class="number">8.5</span>,    <span class="number">4.0</span>,  <span class="number">0.00313</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">24</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">57049</span>,   <span class="number">57049</span>,   <span class="number">57049</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.8</span>,   <span class="number">130.7</span>,    <span class="number">3.5</span>,  <span class="number">0.00710</span>,      <span class="number">0</span>,      <span class="number">1</span>,     <span class="number">129</span>,     <span class="number">129</span>,       <span class="number">0</span>,    <span class="number">4876</span></span><br><span class="line"> <span class="number">36</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">70887</span>,   <span class="number">70887</span>,   <span class="number">70887</span>,     <span class="number">0.5</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,     <span class="number">1.2</span>,    <span class="number">11.6</span>,    <span class="number">2.8</span>,  <span class="number">0.00415</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">54</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">86965</span>,   <span class="number">86965</span>,   <span class="number">86965</span>,     <span class="number">0.6</span>,     <span class="number">0.6</span>,     <span class="number">0.8</span>,     <span class="number">0.8</span>,     <span class="number">1.5</span>,    <span class="number">16.1</span>,    <span class="number">2.3</span>,  <span class="number">0.01355</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">81</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">98004</span>,   <span class="number">98004</span>,   <span class="number">98004</span>,     <span class="number">0.8</span>,     <span class="number">0.8</span>,     <span class="number">1.0</span>,     <span class="number">1.1</span>,    <span class="number">12.4</span>,    <span class="number">97.3</span>,    <span class="number">2.0</span>,  <span class="number">0.01691</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">95</span>,      <span class="number">95</span>,       <span class="number">0</span>,    <span class="number">4896</span></span><br><span class="line"><span class="number">121</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">123605</span>,  <span class="number">123605</span>,  <span class="number">123605</span>,     <span class="number">1.0</span>,     <span class="number">0.9</span>,     <span class="number">1.3</span>,     <span class="number">1.5</span>,     <span class="number">1.7</span>,    <span class="number">32.3</span>,    <span class="number">1.6</span>,  <span class="number">0.02667</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">181</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">137328</span>,  <span class="number">137328</span>,  <span class="number">137328</span>,     <span class="number">1.3</span>,     <span class="number">1.2</span>,     <span class="number">1.8</span>,     <span class="number">2.1</span>,     <span class="number">2.6</span>,    <span class="number">13.4</span>,    <span class="number">1.5</span>,  <span class="number">0.00533</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">271</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">116140</span>,  <span class="number">116140</span>,  <span class="number">116140</span>,     <span class="number">2.3</span>,     <span class="number">1.9</span>,     <span class="number">3.1</span>,     <span class="number">3.7</span>,   <span class="number">100.8</span>,   <span class="number">102.4</span>,    <span class="number">1.7</span>,  <span class="number">0.04059</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">98</span>,      <span class="number">98</span>,       <span class="number">0</span>,    <span class="number">4900</span></span><br><span class="line"><span class="number">406</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">117164</span>,  <span class="number">117164</span>,  <span class="number">117164</span>,     <span class="number">3.5</span>,     <span class="number">3.2</span>,     <span class="number">4.6</span>,     <span class="number">5.1</span>,    <span class="number">82.8</span>,    <span class="number">86.3</span>,    <span class="number">1.7</span>,  <span class="number">0.02663</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>G1_24G</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">  <span class="number">4</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">20711</span>,   <span class="number">20711</span>,   <span class="number">20711</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.5</span>,    <span class="number">19.7</span>,    <span class="number">9.7</span>,  <span class="number">0.00445</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line">  <span class="number">8</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">32481</span>,   <span class="number">32481</span>,   <span class="number">32481</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,    <span class="number">58.7</span>,    <span class="number">6.2</span>,  <span class="number">0.00439</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">57</span>,      <span class="number">57</span>,       <span class="number">0</span>,    <span class="number">2040</span></span><br><span class="line"> <span class="number">16</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">50857</span>,   <span class="number">50857</span>,   <span class="number">50857</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,    <span class="number">12.5</span>,    <span class="number">3.9</span>,  <span class="number">0.00302</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">24</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">59620</span>,   <span class="number">59620</span>,   <span class="number">59620</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,    <span class="number">26.0</span>,    <span class="number">3.4</span>,  <span class="number">0.01248</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">36</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">69831</span>,   <span class="number">69831</span>,   <span class="number">69831</span>,     <span class="number">0.5</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,     <span class="number">0.9</span>,    <span class="number">57.5</span>,    <span class="number">2.9</span>,  <span class="number">0.00704</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">56</span>,      <span class="number">56</span>,       <span class="number">0</span>,    <span class="number">4471</span></span><br><span class="line"> <span class="number">54</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">86572</span>,   <span class="number">86572</span>,   <span class="number">86572</span>,     <span class="number">0.6</span>,     <span class="number">0.6</span>,     <span class="number">0.8</span>,     <span class="number">0.8</span>,     <span class="number">1.1</span>,    <span class="number">19.1</span>,    <span class="number">2.3</span>,  <span class="number">0.00671</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">81</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">101654</span>,  <span class="number">101654</span>,  <span class="number">101654</span>,     <span class="number">0.8</span>,     <span class="number">0.8</span>,     <span class="number">1.0</span>,     <span class="number">1.1</span>,     <span class="number">2.8</span>,    <span class="number">21.5</span>,    <span class="number">2.0</span>,  <span class="number">0.00311</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">121</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">126553</span>,  <span class="number">126553</span>,  <span class="number">126553</span>,     <span class="number">0.9</span>,     <span class="number">0.9</span>,     <span class="number">1.4</span>,     <span class="number">1.5</span>,     <span class="number">1.9</span>,     <span class="number">9.4</span>,    <span class="number">1.6</span>,  <span class="number">0.00052</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">181</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">132684</span>,  <span class="number">132684</span>,  <span class="number">132684</span>,     <span class="number">1.4</span>,     <span class="number">1.3</span>,     <span class="number">1.8</span>,     <span class="number">2.1</span>,    <span class="number">21.0</span>,    <span class="number">21.7</span>,    <span class="number">1.5</span>,  <span class="number">0.00036</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">271</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">132321</span>,  <span class="number">132321</span>,  <span class="number">132321</span>,     <span class="number">2.0</span>,     <span class="number">1.8</span>,     <span class="number">3.0</span>,     <span class="number">3.4</span>,    <span class="number">30.7</span>,    <span class="number">31.0</span>,    <span class="number">1.5</span>,  <span class="number">0.00586</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">406</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">122917</span>,  <span class="number">122917</span>,  <span class="number">122917</span>,     <span class="number">3.3</span>,     <span class="number">3.3</span>,     <span class="number">4.5</span>,     <span class="number">5.3</span>,    <span class="number">10.7</span>,    <span class="number">14.0</span>,    <span class="number">1.6</span>,  <span class="number">0.00033</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>G1_32G</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line">  <span class="number">4</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">20056</span>,   <span class="number">20056</span>,   <span class="number">20056</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,    <span class="number">66.8</span>,   <span class="number">10.0</span>,  <span class="number">0.00585</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">65</span>,      <span class="number">65</span>,       <span class="number">0</span>,    <span class="number">2168</span></span><br><span class="line">  <span class="number">8</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">31968</span>,   <span class="number">31968</span>,   <span class="number">31968</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,     <span class="number">9.3</span>,    <span class="number">6.3</span>,  <span class="number">0.00748</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">16</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">48700</span>,   <span class="number">48700</span>,   <span class="number">48700</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.5</span>,    <span class="number">62.4</span>,    <span class="number">4.1</span>,  <span class="number">0.00510</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">59</span>,      <span class="number">59</span>,       <span class="number">0</span>,    <span class="number">3208</span></span><br><span class="line"> <span class="number">24</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">56472</span>,   <span class="number">56472</span>,   <span class="number">56472</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.6</span>,     <span class="number">9.1</span>,    <span class="number">3.5</span>,  <span class="number">0.01747</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">36</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">71375</span>,   <span class="number">71375</span>,   <span class="number">71375</span>,     <span class="number">0.5</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,     <span class="number">0.9</span>,    <span class="number">11.4</span>,    <span class="number">2.8</span>,  <span class="number">0.00540</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">54</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">83859</span>,   <span class="number">83859</span>,   <span class="number">83859</span>,     <span class="number">0.6</span>,     <span class="number">0.6</span>,     <span class="number">0.8</span>,     <span class="number">0.8</span>,     <span class="number">0.9</span>,    <span class="number">12.2</span>,    <span class="number">2.4</span>,  <span class="number">0.00536</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">81</span> threadCount, READ,         <span class="number">199262</span>,   <span class="number">99124</span>,   <span class="number">99124</span>,   <span class="number">99124</span>,     <span class="number">0.8</span>,     <span class="number">0.8</span>,     <span class="number">1.0</span>,     <span class="number">1.1</span>,     <span class="number">5.8</span>,    <span class="number">17.2</span>,    <span class="number">2.0</span>,  <span class="number">0.00078</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">121</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">119172</span>,  <span class="number">119172</span>,  <span class="number">119172</span>,     <span class="number">1.0</span>,     <span class="number">0.9</span>,     <span class="number">1.4</span>,     <span class="number">1.6</span>,    <span class="number">13.5</span>,    <span class="number">31.7</span>,    <span class="number">1.7</span>,  <span class="number">0.03623</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">181</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">133795</span>,  <span class="number">133795</span>,  <span class="number">133795</span>,     <span class="number">1.3</span>,     <span class="number">1.3</span>,     <span class="number">1.8</span>,     <span class="number">2.1</span>,     <span class="number">2.6</span>,    <span class="number">20.4</span>,    <span class="number">1.5</span>,  <span class="number">0.00240</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">271</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">132177</span>,  <span class="number">132177</span>,  <span class="number">132177</span>,     <span class="number">2.0</span>,     <span class="number">1.9</span>,     <span class="number">2.9</span>,     <span class="number">3.2</span>,    <span class="number">24.8</span>,    <span class="number">26.0</span>,    <span class="number">1.5</span>,  <span class="number">0.01529</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">406</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">116899</span>,  <span class="number">116899</span>,  <span class="number">116899</span>,     <span class="number">3.5</span>,     <span class="number">3.3</span>,     <span class="number">4.7</span>,     <span class="number">5.2</span>,    <span class="number">11.5</span>,    <span class="number">35.6</span>,    <span class="number">1.7</span>,  <span class="number">0.00301</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br></pre></td></tr></table></figure>
<h4 id="没有预热读取">没有预热读取</h4><p>没有预热读取20万条数据：./cassandra-stress read n=200000 no-warmup -node 10.21.21.10 -log file=SINGLENODE3_read_2_nowarm.log<br>测试结果：以181个线程为例，每秒的读取数量差不了多少，但是没有预热情况下，99.9%的读取时间在41.5ms，不过仍有99%的读取时间在2.3ms。  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line">  <span class="number">4</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">19246</span>,   <span class="number">19246</span>,   <span class="number">19246</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.8</span>,    <span class="number">22.7</span>,   <span class="number">10.4</span>,  <span class="number">0.03294</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">20</span>,      <span class="number">20</span>,       <span class="number">0</span>,    <span class="number">1634</span></span><br><span class="line">  <span class="number">8</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">31951</span>,   <span class="number">31951</span>,   <span class="number">31951</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,    <span class="number">31.8</span>,    <span class="number">6.3</span>,  <span class="number">0.00502</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">31</span>,      <span class="number">31</span>,       <span class="number">0</span>,    <span class="number">1638</span></span><br><span class="line"> <span class="number">16</span> threadCount, READ,         <span class="number">199935</span>,   <span class="number">49763</span>,   <span class="number">49763</span>,   <span class="number">49763</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.5</span>,    <span class="number">16.4</span>,    <span class="number">4.0</span>,  <span class="number">0.00809</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">15</span>,      <span class="number">15</span>,       <span class="number">0</span>,    <span class="number">1640</span></span><br><span class="line"> <span class="number">24</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">57285</span>,   <span class="number">57285</span>,   <span class="number">57285</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,    <span class="number">16.1</span>,    <span class="number">3.5</span>,  <span class="number">0.01034</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">15</span>,      <span class="number">15</span>,       <span class="number">0</span>,    <span class="number">1639</span></span><br><span class="line"> <span class="number">36</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">71017</span>,   <span class="number">71017</span>,   <span class="number">71017</span>,     <span class="number">0.5</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,     <span class="number">0.8</span>,    <span class="number">15.9</span>,    <span class="number">2.8</span>,  <span class="number">0.00060</span>,      <span class="number">0</span>,      <span class="number">2</span>,      <span class="number">30</span>,      <span class="number">30</span>,       <span class="number">0</span>,    <span class="number">3277</span></span><br><span class="line"> <span class="number">54</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">84927</span>,   <span class="number">84927</span>,   <span class="number">84927</span>,     <span class="number">0.6</span>,     <span class="number">0.6</span>,     <span class="number">0.8</span>,     <span class="number">0.8</span>,     <span class="number">1.0</span>,    <span class="number">16.6</span>,    <span class="number">2.4</span>,  <span class="number">0.01203</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">14</span>,      <span class="number">14</span>,       <span class="number">0</span>,    <span class="number">1638</span></span><br><span class="line"> <span class="number">81</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">102405</span>,  <span class="number">102405</span>,  <span class="number">102405</span>,     <span class="number">0.8</span>,     <span class="number">0.8</span>,     <span class="number">1.0</span>,     <span class="number">1.1</span>,     <span class="number">1.4</span>,    <span class="number">16.6</span>,    <span class="number">2.0</span>,  <span class="number">0.00724</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">14</span>,      <span class="number">14</span>,       <span class="number">0</span>,    <span class="number">1638</span></span><br><span class="line"><span class="number">121</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">113897</span>,  <span class="number">113897</span>,  <span class="number">113897</span>,     <span class="number">1.1</span>,     <span class="number">0.9</span>,     <span class="number">1.3</span>,     <span class="number">1.6</span>,    <span class="number">52.6</span>,    <span class="number">89.4</span>,    <span class="number">1.8</span>,  <span class="number">0.01850</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">14</span>,      <span class="number">14</span>,       <span class="number">0</span>,    <span class="number">1638</span></span><br><span class="line"><span class="number">181</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">121195</span>,  <span class="number">121195</span>,  <span class="number">121195</span>,     <span class="number">1.5</span>,     <span class="number">1.3</span>,     <span class="number">1.9</span>,     <span class="number">2.3</span>,    <span class="number">41.5</span>,    <span class="number">61.9</span>,    <span class="number">1.6</span>,  <span class="number">0.02605</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">15</span>,      <span class="number">15</span>,       <span class="number">0</span>,    <span class="number">1638</span></span><br><span class="line"><span class="number">271</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">131395</span>,  <span class="number">131395</span>,  <span class="number">131395</span>,     <span class="number">2.1</span>,     <span class="number">1.9</span>,     <span class="number">2.9</span>,     <span class="number">3.2</span>,    <span class="number">17.5</span>,    <span class="number">20.2</span>,    <span class="number">1.5</span>,  <span class="number">0.00003</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">14</span>,      <span class="number">14</span>,       <span class="number">0</span>,    <span class="number">1638</span></span><br><span class="line"><span class="number">406</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">120490</span>,  <span class="number">120490</span>,  <span class="number">120490</span>,     <span class="number">3.4</span>,     <span class="number">3.3</span>,     <span class="number">4.4</span>,     <span class="number">7.9</span>,    <span class="number">24.9</span>,    <span class="number">33.7</span>,    <span class="number">1.7</span>,  <span class="number">0.02581</span>,      <span class="number">0</span>,      <span class="number">2</span>,      <span class="number">28</span>,      <span class="number">28</span>,       <span class="number">0</span>,    <span class="number">3277</span></span><br><span class="line"><span class="number">609</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">113461</span>,  <span class="number">113461</span>,  <span class="number">113461</span>,     <span class="number">5.4</span>,     <span class="number">5.5</span>,     <span class="number">6.9</span>,     <span class="number">9.5</span>,    <span class="number">41.3</span>,    <span class="number">43.5</span>,    <span class="number">1.8</span>,  <span class="number">0.02642</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">14</span>,      <span class="number">14</span>,       <span class="number">0</span>,    <span class="number">1638</span></span><br></pre></td></tr></table></figure>
<p>G1_16G</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line">  <span class="number">4</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">19459</span>,   <span class="number">19459</span>,   <span class="number">19459</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.7</span>,    <span class="number">13.6</span>,   <span class="number">10.3</span>,  <span class="number">0.03267</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line">  <span class="number">8</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">31733</span>,   <span class="number">31733</span>,   <span class="number">31733</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,    <span class="number">11.4</span>,    <span class="number">6.3</span>,  <span class="number">0.00728</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">16</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">48927</span>,   <span class="number">48927</span>,   <span class="number">48927</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">9.0</span>,    <span class="number">4.1</span>,  <span class="number">0.00572</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">24</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">57267</span>,   <span class="number">57267</span>,   <span class="number">57267</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,    <span class="number">10.2</span>,    <span class="number">3.5</span>,  <span class="number">0.00991</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">36</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">71712</span>,   <span class="number">71712</span>,   <span class="number">71712</span>,     <span class="number">0.5</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,     <span class="number">0.8</span>,    <span class="number">38.8</span>,    <span class="number">2.8</span>,  <span class="number">0.00863</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">37</span>,      <span class="number">37</span>,       <span class="number">0</span>,    <span class="number">8782</span></span><br><span class="line"> <span class="number">54</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">89064</span>,   <span class="number">89064</span>,   <span class="number">89064</span>,     <span class="number">0.6</span>,     <span class="number">0.6</span>,     <span class="number">0.8</span>,     <span class="number">0.8</span>,     <span class="number">1.2</span>,    <span class="number">13.5</span>,    <span class="number">2.2</span>,  <span class="number">0.00836</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">81</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">101873</span>,  <span class="number">101873</span>,  <span class="number">101873</span>,     <span class="number">0.8</span>,     <span class="number">0.8</span>,     <span class="number">1.0</span>,     <span class="number">1.1</span>,     <span class="number">1.6</span>,    <span class="number">26.6</span>,    <span class="number">2.0</span>,  <span class="number">0.01203</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">121</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">128791</span>,  <span class="number">128791</span>,  <span class="number">128791</span>,     <span class="number">0.9</span>,     <span class="number">0.9</span>,     <span class="number">1.3</span>,     <span class="number">1.4</span>,     <span class="number">4.5</span>,    <span class="number">20.3</span>,    <span class="number">1.6</span>,  <span class="number">0.00524</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">181</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">136667</span>,  <span class="number">136667</span>,  <span class="number">136667</span>,     <span class="number">1.3</span>,     <span class="number">1.2</span>,     <span class="number">1.8</span>,     <span class="number">2.1</span>,     <span class="number">5.3</span>,    <span class="number">31.5</span>,    <span class="number">1.5</span>,  <span class="number">0.01082</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">271</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">121611</span>,  <span class="number">121611</span>,  <span class="number">121611</span>,     <span class="number">2.2</span>,     <span class="number">1.9</span>,     <span class="number">3.1</span>,     <span class="number">3.8</span>,    <span class="number">31.1</span>,    <span class="number">32.0</span>,    <span class="number">1.6</span>,  <span class="number">0.01160</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">21</span>,      <span class="number">21</span>,       <span class="number">0</span>,    <span class="number">8783</span></span><br><span class="line"><span class="number">406</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">118972</span>,  <span class="number">118972</span>,  <span class="number">118972</span>,     <span class="number">3.4</span>,     <span class="number">3.6</span>,     <span class="number">4.5</span>,     <span class="number">5.5</span>,    <span class="number">35.2</span>,    <span class="number">36.3</span>,    <span class="number">1.7</span>,  <span class="number">0.00088</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>G1_24G</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line">  <span class="number">4</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">19715</span>,   <span class="number">19715</span>,   <span class="number">19715</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.7</span>,    <span class="number">14.3</span>,   <span class="number">10.1</span>,  <span class="number">0.02534</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line">  <span class="number">8</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">32683</span>,   <span class="number">32683</span>,   <span class="number">32683</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.4</span>,    <span class="number">10.1</span>,    <span class="number">6.1</span>,  <span class="number">0.00510</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">16</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">49059</span>,   <span class="number">49059</span>,   <span class="number">49059</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.5</span>,     <span class="number">9.0</span>,    <span class="number">4.1</span>,  <span class="number">0.00434</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">24</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">58071</span>,   <span class="number">58071</span>,   <span class="number">58071</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.6</span>,     <span class="number">8.2</span>,    <span class="number">3.4</span>,  <span class="number">0.01215</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">36</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">71800</span>,   <span class="number">71800</span>,   <span class="number">71800</span>,     <span class="number">0.5</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,     <span class="number">5.6</span>,    <span class="number">10.1</span>,    <span class="number">2.8</span>,  <span class="number">0.00305</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">54</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">85405</span>,   <span class="number">85405</span>,   <span class="number">85405</span>,     <span class="number">0.6</span>,     <span class="number">0.6</span>,     <span class="number">0.8</span>,     <span class="number">0.8</span>,     <span class="number">2.5</span>,    <span class="number">15.0</span>,    <span class="number">2.3</span>,  <span class="number">0.01252</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">12</span>,      <span class="number">12</span>,       <span class="number">0</span>,   <span class="number">14734</span></span><br><span class="line"> <span class="number">81</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">102288</span>,  <span class="number">102288</span>,  <span class="number">102288</span>,     <span class="number">0.8</span>,     <span class="number">0.8</span>,     <span class="number">1.0</span>,     <span class="number">1.1</span>,     <span class="number">2.4</span>,    <span class="number">10.3</span>,    <span class="number">2.0</span>,  <span class="number">0.00164</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">121</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">122329</span>,  <span class="number">122329</span>,  <span class="number">122329</span>,     <span class="number">1.0</span>,     <span class="number">0.9</span>,     <span class="number">1.3</span>,     <span class="number">1.5</span>,    <span class="number">15.5</span>,    <span class="number">92.1</span>,    <span class="number">1.6</span>,  <span class="number">0.00384</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">181</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">127409</span>,  <span class="number">127409</span>,  <span class="number">127409</span>,     <span class="number">1.4</span>,     <span class="number">1.2</span>,     <span class="number">1.8</span>,     <span class="number">2.0</span>,    <span class="number">45.2</span>,    <span class="number">83.2</span>,    <span class="number">1.6</span>,  <span class="number">0.02074</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">271</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">129012</span>,  <span class="number">129012</span>,  <span class="number">129012</span>,     <span class="number">2.1</span>,     <span class="number">1.8</span>,     <span class="number">3.0</span>,     <span class="number">3.8</span>,    <span class="number">24.2</span>,    <span class="number">25.1</span>,    <span class="number">1.5</span>,  <span class="number">0.02108</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">406</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">124542</span>,  <span class="number">124542</span>,  <span class="number">124542</span>,     <span class="number">3.3</span>,     <span class="number">3.4</span>,     <span class="number">4.3</span>,     <span class="number">5.1</span>,    <span class="number">21.1</span>,    <span class="number">22.3</span>,    <span class="number">1.6</span>,  <span class="number">0.01146</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">609</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">114549</span>,  <span class="number">114549</span>,  <span class="number">114549</span>,     <span class="number">5.4</span>,     <span class="number">5.5</span>,     <span class="number">6.9</span>,     <span class="number">7.8</span>,    <span class="number">26.4</span>,    <span class="number">28.6</span>,    <span class="number">1.7</span>,  <span class="number">0.00217</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>G1_32G</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line">  <span class="number">4</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">18901</span>,   <span class="number">18901</span>,   <span class="number">18901</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.7</span>,    <span class="number">14.6</span>,   <span class="number">10.6</span>,  <span class="number">0.02816</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line">  <span class="number">8</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">32102</span>,   <span class="number">32102</span>,   <span class="number">32102</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.4</span>,    <span class="number">13.4</span>,    <span class="number">6.2</span>,  <span class="number">0.00663</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">13</span>,      <span class="number">13</span>,       <span class="number">0</span>,   <span class="number">19629</span></span><br><span class="line"> <span class="number">16</span> threadCount, READ,         <span class="number">199859</span>,   <span class="number">49739</span>,   <span class="number">49739</span>,   <span class="number">49739</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,     <span class="number">0.6</span>,     <span class="number">6.3</span>,    <span class="number">4.0</span>,  <span class="number">0.00201</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">24</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">56403</span>,   <span class="number">56403</span>,   <span class="number">56403</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,     <span class="number">0.6</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,     <span class="number">8.5</span>,    <span class="number">3.5</span>,  <span class="number">0.01001</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">36</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">72080</span>,   <span class="number">72080</span>,   <span class="number">72080</span>,     <span class="number">0.5</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.6</span>,     <span class="number">0.9</span>,     <span class="number">9.7</span>,    <span class="number">2.8</span>,  <span class="number">0.00493</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">54</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">85258</span>,   <span class="number">85258</span>,   <span class="number">85258</span>,     <span class="number">0.6</span>,     <span class="number">0.6</span>,     <span class="number">0.8</span>,     <span class="number">0.9</span>,     <span class="number">1.3</span>,    <span class="number">20.8</span>,    <span class="number">2.3</span>,  <span class="number">0.00435</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">81</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">96518</span>,   <span class="number">96518</span>,   <span class="number">96518</span>,     <span class="number">0.8</span>,     <span class="number">0.8</span>,     <span class="number">1.0</span>,     <span class="number">1.1</span>,     <span class="number">1.2</span>,    <span class="number">15.6</span>,    <span class="number">2.1</span>,  <span class="number">0.00669</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">121</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">120044</span>,  <span class="number">120044</span>,  <span class="number">120044</span>,     <span class="number">1.0</span>,     <span class="number">0.9</span>,     <span class="number">1.3</span>,     <span class="number">1.5</span>,    <span class="number">14.7</span>,    <span class="number">36.8</span>,    <span class="number">1.7</span>,  <span class="number">0.01983</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">181</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">129879</span>,  <span class="number">129879</span>,  <span class="number">129879</span>,     <span class="number">1.4</span>,     <span class="number">1.3</span>,     <span class="number">1.7</span>,     <span class="number">2.1</span>,    <span class="number">23.6</span>,    <span class="number">70.6</span>,    <span class="number">1.5</span>,  <span class="number">0.03941</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">271</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">134088</span>,  <span class="number">134088</span>,  <span class="number">134088</span>,     <span class="number">2.0</span>,     <span class="number">1.8</span>,     <span class="number">2.9</span>,     <span class="number">3.3</span>,    <span class="number">15.9</span>,    <span class="number">16.6</span>,    <span class="number">1.5</span>,  <span class="number">0.00226</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">406</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">120807</span>,  <span class="number">120807</span>,  <span class="number">120807</span>,     <span class="number">3.4</span>,     <span class="number">3.0</span>,     <span class="number">4.6</span>,     <span class="number">5.1</span>,    <span class="number">51.4</span>,    <span class="number">53.9</span>,    <span class="number">1.7</span>,  <span class="number">0.00992</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">12</span>,      <span class="number">12</span>,       <span class="number">0</span>,   <span class="number">19630</span></span><br><span class="line"><span class="number">609</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">101774</span>,  <span class="number">101774</span>,  <span class="number">101774</span>,     <span class="number">6.1</span>,     <span class="number">5.7</span>,     <span class="number">7.0</span>,     <span class="number">8.2</span>,   <span class="number">227.4</span>,   <span class="number">229.6</span>,    <span class="number">2.0</span>,  <span class="number">0.00759</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br></pre></td></tr></table></figure>
<h4 id="给定一段时间测试最大可以读取多少条记录">给定一段时间测试最大可以读取多少条记录</h4><p>测试3分钟能读取多少条记录：./cassandra-stress read duration=3m -node 10.21.21.10 -log file=SINGLENODE4_read_3min.log<br>测试结果：还是181个线程时达到最大值，总共读取了2500万，99.9%的读取时间为2.4ms，GC发生了144次，最长的GC时间花了2.6s。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line">  <span class="number">4</span> threadCount, READ,        <span class="number">3685598</span>,   <span class="number">20476</span>,   <span class="number">20476</span>,   <span class="number">20476</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,    <span class="number">57.0</span>,  <span class="number">180.0</span>,  <span class="number">0.00144</span>,      <span class="number">0</span>,     <span class="number">27</span>,     <span class="number">757</span>,     <span class="number">757</span>,      <span class="number">11</span>,   <span class="number">44103</span></span><br><span class="line">  <span class="number">8</span> threadCount, READ,        <span class="number">5828269</span>,   <span class="number">32379</span>,   <span class="number">32379</span>,   <span class="number">32379</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.4</span>,    <span class="number">25.5</span>,  <span class="number">180.0</span>,  <span class="number">0.00112</span>,      <span class="number">0</span>,     <span class="number">36</span>,     <span class="number">706</span>,     <span class="number">706</span>,       <span class="number">1</span>,   <span class="number">58974</span></span><br><span class="line"> <span class="number">16</span> threadCount, READ,        <span class="number">8829104</span>,   <span class="number">49050</span>,   <span class="number">49050</span>,   <span class="number">49050</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,    <span class="number">21.7</span>,  <span class="number">180.0</span>,  <span class="number">0.00163</span>,      <span class="number">0</span>,     <span class="number">52</span>,     <span class="number">979</span>,     <span class="number">979</span>,       <span class="number">1</span>,   <span class="number">85196</span></span><br><span class="line"> <span class="number">24</span> threadCount, READ,       <span class="number">10249086</span>,   <span class="number">56939</span>,   <span class="number">56939</span>,   <span class="number">56939</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,    <span class="number">37.2</span>,  <span class="number">180.0</span>,  <span class="number">0.00170</span>,      <span class="number">0</span>,     <span class="number">61</span>,    <span class="number">1140</span>,    <span class="number">1152</span>,       <span class="number">1</span>,   <span class="number">98314</span></span><br><span class="line"> <span class="number">36</span> threadCount, READ,       <span class="number">12957013</span>,   <span class="number">71983</span>,   <span class="number">71983</span>,   <span class="number">71983</span>,     <span class="number">0.5</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.6</span>,     <span class="number">0.8</span>,    <span class="number">21.1</span>,  <span class="number">180.0</span>,  <span class="number">0.00072</span>,      <span class="number">0</span>,     <span class="number">76</span>,    <span class="number">1414</span>,    <span class="number">1414</span>,       <span class="number">1</span>,  <span class="number">124523</span></span><br><span class="line"> <span class="number">54</span> threadCount, READ,       <span class="number">15659754</span>,   <span class="number">86997</span>,   <span class="number">86997</span>,   <span class="number">86997</span>,     <span class="number">0.6</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,     <span class="number">0.8</span>,     <span class="number">1.0</span>,   <span class="number">101.4</span>,  <span class="number">180.0</span>,  <span class="number">0.00075</span>,      <span class="number">0</span>,     <span class="number">91</span>,    <span class="number">1691</span>,    <span class="number">1691</span>,       <span class="number">1</span>,  <span class="number">149101</span></span><br><span class="line"> <span class="number">81</span> threadCount, READ,       <span class="number">18822803</span>,  <span class="number">104569</span>,  <span class="number">104569</span>,  <span class="number">104569</span>,     <span class="number">0.8</span>,     <span class="number">0.7</span>,     <span class="number">1.0</span>,     <span class="number">1.0</span>,     <span class="number">1.2</span>,    <span class="number">36.3</span>,  <span class="number">180.0</span>,  <span class="number">0.00091</span>,      <span class="number">0</span>,    <span class="number">110</span>,    <span class="number">2051</span>,    <span class="number">2051</span>,       <span class="number">1</span>,  <span class="number">180233</span></span><br><span class="line"><span class="number">121</span> threadCount, READ,       <span class="number">20570170</span>,  <span class="number">114275</span>,  <span class="number">114275</span>,  <span class="number">114275</span>,     <span class="number">1.0</span>,     <span class="number">0.9</span>,     <span class="number">1.2</span>,     <span class="number">1.4</span>,     <span class="number">1.6</span>,   <span class="number">994.0</span>,  <span class="number">180.0</span>,  <span class="number">0.01009</span>,      <span class="number">0</span>,    <span class="number">118</span>,    <span class="number">2185</span>,    <span class="number">2185</span>,       <span class="number">1</span>,  <span class="number">193341</span></span><br><span class="line"><span class="number">181</span> threadCount, READ,       <span class="number">24761012</span>,  <span class="number">137557</span>,  <span class="number">137557</span>,  <span class="number">137557</span>,     <span class="number">1.3</span>,     <span class="number">1.2</span>,     <span class="number">1.7</span>,     <span class="number">1.9</span>,     <span class="number">2.4</span>,   <span class="number">150.7</span>,  <span class="number">180.0</span>,  <span class="number">0.00113</span>,      <span class="number">0</span>,    <span class="number">144</span>,    <span class="number">2683</span>,    <span class="number">2683</span>,       <span class="number">1</span>,  <span class="number">235942</span></span><br><span class="line"><span class="number">271</span> threadCount, READ,       <span class="number">24495851</span>,  <span class="number">136082</span>,  <span class="number">136082</span>,  <span class="number">136082</span>,     <span class="number">2.0</span>,     <span class="number">1.8</span>,     <span class="number">2.8</span>,     <span class="number">3.1</span>,    <span class="number">11.6</span>,    <span class="number">37.0</span>,  <span class="number">180.0</span>,  <span class="number">0.00120</span>,      <span class="number">0</span>,    <span class="number">141</span>,    <span class="number">2642</span>,    <span class="number">2642</span>,       <span class="number">1</span>,  <span class="number">231027</span></span><br><span class="line"><span class="number">406</span> threadCount, READ,       <span class="number">20696670</span>,  <span class="number">115470</span>,  <span class="number">115470</span>,  <span class="number">115470</span>,     <span class="number">3.5</span>,     <span class="number">3.1</span>,     <span class="number">4.0</span>,     <span class="number">4.5</span>,    <span class="number">23.5</span>,   <span class="number">883.7</span>,  <span class="number">179.2</span>,  <span class="number">0.01129</span>,      <span class="number">0</span>,    <span class="number">119</span>,    <span class="number">2226</span>,    <span class="number">2226</span>,       <span class="number">1</span>,  <span class="number">194980</span></span><br><span class="line"><span class="number">609</span> threadCount, READ,       <span class="number">20807103</span>,  <span class="number">115587</span>,  <span class="number">115587</span>,  <span class="number">115587</span>,     <span class="number">5.3</span>,     <span class="number">5.4</span>,     <span class="number">6.4</span>,     <span class="number">6.9</span>,    <span class="number">26.1</span>,    <span class="number">36.5</span>,  <span class="number">180.0</span>,  <span class="number">0.00097</span>,      <span class="number">0</span>,    <span class="number">121</span>,    <span class="number">2266</span>,    <span class="number">2266</span>,       <span class="number">1</span>,  <span class="number">198256</span></span><br></pre></td></tr></table></figure>
<p>G1_16G</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line">  <span class="number">4</span> threadCount, READ,        <span class="number">3584751</span>,   <span class="number">19915</span>,   <span class="number">19915</span>,   <span class="number">19915</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,   <span class="number">237.3</span>,  <span class="number">180.0</span>,  <span class="number">0.00161</span>,      <span class="number">0</span>,     <span class="number">12</span>,    <span class="number">1953</span>,    <span class="number">1953</span>,      <span class="number">34</span>,  <span class="number">103288</span></span><br><span class="line">  <span class="number">8</span> threadCount, READ,        <span class="number">5811977</span>,   <span class="number">32289</span>,   <span class="number">32289</span>,   <span class="number">32289</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.4</span>,   <span class="number">121.8</span>,  <span class="number">180.0</span>,  <span class="number">0.00108</span>,      <span class="number">0</span>,     <span class="number">13</span>,    <span class="number">1103</span>,    <span class="number">1103</span>,      <span class="number">13</span>,  <span class="number">113422</span></span><br><span class="line"> <span class="number">16</span> threadCount, READ,        <span class="number">8852062</span>,   <span class="number">49178</span>,   <span class="number">49178</span>,   <span class="number">49178</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,    <span class="number">63.2</span>,  <span class="number">180.0</span>,  <span class="number">0.00176</span>,      <span class="number">0</span>,     <span class="number">17</span>,     <span class="number">956</span>,     <span class="number">956</span>,       <span class="number">4</span>,  <span class="number">149556</span></span><br><span class="line"> <span class="number">24</span> threadCount, READ,       <span class="number">10255674</span>,   <span class="number">56976</span>,   <span class="number">56976</span>,   <span class="number">56976</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,    <span class="number">58.2</span>,  <span class="number">180.0</span>,  <span class="number">0.00189</span>,      <span class="number">0</span>,     <span class="number">11</span>,     <span class="number">541</span>,     <span class="number">541</span>,       <span class="number">1</span>,   <span class="number">96735</span></span><br><span class="line"> <span class="number">36</span> threadCount, READ,       <span class="number">13003446</span>,   <span class="number">72241</span>,   <span class="number">72241</span>,   <span class="number">72241</span>,     <span class="number">0.5</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,     <span class="number">0.8</span>,    <span class="number">49.9</span>,  <span class="number">180.0</span>,  <span class="number">0.00082</span>,      <span class="number">0</span>,     <span class="number">13</span>,     <span class="number">616</span>,     <span class="number">616</span>,       <span class="number">0</span>,  <span class="number">114296</span></span><br><span class="line"> <span class="number">54</span> threadCount, READ,       <span class="number">15887097</span>,   <span class="number">88261</span>,   <span class="number">88261</span>,   <span class="number">88261</span>,     <span class="number">0.6</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,     <span class="number">0.8</span>,     <span class="number">1.0</span>,   <span class="number">107.7</span>,  <span class="number">180.0</span>,  <span class="number">0.00110</span>,      <span class="number">0</span>,     <span class="number">17</span>,     <span class="number">794</span>,     <span class="number">794</span>,       <span class="number">0</span>,  <span class="number">149463</span></span><br><span class="line"> <span class="number">81</span> threadCount, READ,       <span class="number">17262985</span>,   <span class="number">95904</span>,   <span class="number">95904</span>,   <span class="number">95904</span>,     <span class="number">0.8</span>,     <span class="number">0.7</span>,     <span class="number">1.0</span>,     <span class="number">1.0</span>,     <span class="number">1.2</span>,   <span class="number">923.2</span>,  <span class="number">180.0</span>,  <span class="number">0.00918</span>,      <span class="number">0</span>,     <span class="number">18</span>,     <span class="number">843</span>,     <span class="number">843</span>,       <span class="number">1</span>,  <span class="number">158255</span></span><br><span class="line"><span class="number">121</span> threadCount, READ,       <span class="number">21136848</span>,  <span class="number">117427</span>,  <span class="number">117427</span>,  <span class="number">117427</span>,     <span class="number">1.0</span>,     <span class="number">0.9</span>,     <span class="number">1.2</span>,     <span class="number">1.4</span>,     <span class="number">1.6</span>,   <span class="number">977.7</span>,  <span class="number">180.0</span>,  <span class="number">0.01099</span>,      <span class="number">0</span>,     <span class="number">23</span>,    <span class="number">1070</span>,    <span class="number">1070</span>,       <span class="number">1</span>,  <span class="number">202215</span></span><br><span class="line"><span class="number">181</span> threadCount, READ,       <span class="number">24958916</span>,  <span class="number">138650</span>,  <span class="number">138650</span>,  <span class="number">138650</span>,     <span class="number">1.3</span>,     <span class="number">1.2</span>,     <span class="number">1.6</span>,     <span class="number">2.0</span>,     <span class="number">2.3</span>,   <span class="number">203.5</span>,  <span class="number">180.0</span>,  <span class="number">0.00150</span>,      <span class="number">0</span>,     <span class="number">26</span>,    <span class="number">1198</span>,    <span class="number">1198</span>,       <span class="number">0</span>,  <span class="number">228591</span></span><br><span class="line"><span class="number">271</span> threadCount, READ,       <span class="number">21354485</span>,  <span class="number">118630</span>,  <span class="number">118630</span>,  <span class="number">118630</span>,     <span class="number">2.3</span>,     <span class="number">1.8</span>,     <span class="number">2.9</span>,     <span class="number">3.2</span>,     <span class="number">3.7</span>,   <span class="number">911.6</span>,  <span class="number">180.0</span>,  <span class="number">0.01007</span>,      <span class="number">0</span>,     <span class="number">22</span>,    <span class="number">1016</span>,    <span class="number">1016</span>,       <span class="number">0</span>,  <span class="number">193423</span></span><br><span class="line"><span class="number">406</span> threadCount, READ,       <span class="number">21890345</span>,  <span class="number">121606</span>,  <span class="number">121606</span>,  <span class="number">121606</span>,     <span class="number">3.3</span>,     <span class="number">3.3</span>,     <span class="number">4.5</span>,     <span class="number">4.9</span>,     <span class="number">5.9</span>,   <span class="number">286.9</span>,  <span class="number">180.0</span>,  <span class="number">0.00107</span>,      <span class="number">0</span>,     <span class="number">23</span>,    <span class="number">1060</span>,    <span class="number">1060</span>,       <span class="number">0</span>,  <span class="number">202215</span></span><br><span class="line"><span class="number">609</span> threadCount, READ,       <span class="number">20206343</span>,  <span class="number">112250</span>,  <span class="number">112250</span>,  <span class="number">112250</span>,     <span class="number">5.4</span>,     <span class="number">5.4</span>,     <span class="number">6.9</span>,     <span class="number">7.3</span>,    <span class="number">16.5</span>,    <span class="number">77.0</span>,  <span class="number">180.0</span>,  <span class="number">0.00111</span>,      <span class="number">0</span>,     <span class="number">22</span>,    <span class="number">1020</span>,    <span class="number">1020</span>,       <span class="number">0</span>,  <span class="number">193374</span></span><br></pre></td></tr></table></figure>
<p>G1_24G</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line">  <span class="number">4</span> threadCount, READ,        <span class="number">3776268</span>,   <span class="number">20979</span>,   <span class="number">20979</span>,   <span class="number">20979</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,    <span class="number">62.2</span>,  <span class="number">180.0</span>,  <span class="number">0.00140</span>,      <span class="number">0</span>,      <span class="number">2</span>,     <span class="number">121</span>,     <span class="number">121</span>,       <span class="number">1</span>,   <span class="number">29133</span></span><br><span class="line">  <span class="number">8</span> threadCount, READ,        <span class="number">5840032</span>,   <span class="number">32445</span>,   <span class="number">32445</span>,   <span class="number">32445</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.4</span>,    <span class="number">63.1</span>,  <span class="number">180.0</span>,  <span class="number">0.00112</span>,      <span class="number">0</span>,      <span class="number">3</span>,     <span class="number">182</span>,     <span class="number">182</span>,       <span class="number">1</span>,   <span class="number">43696</span></span><br><span class="line"> <span class="number">16</span> threadCount, READ,        <span class="number">8924201</span>,   <span class="number">49579</span>,   <span class="number">49579</span>,   <span class="number">49579</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.5</span>,    <span class="number">63.3</span>,  <span class="number">180.0</span>,  <span class="number">0.00176</span>,      <span class="number">0</span>,      <span class="number">4</span>,     <span class="number">246</span>,     <span class="number">246</span>,       <span class="number">1</span>,   <span class="number">58256</span></span><br><span class="line"> <span class="number">24</span> threadCount, READ,       <span class="number">10387219</span>,   <span class="number">57707</span>,   <span class="number">57707</span>,   <span class="number">57707</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,    <span class="number">87.3</span>,  <span class="number">180.0</span>,  <span class="number">0.00197</span>,      <span class="number">0</span>,      <span class="number">5</span>,     <span class="number">297</span>,     <span class="number">297</span>,      <span class="number">20</span>,   <span class="number">72872</span></span><br><span class="line"> <span class="number">36</span> threadCount, READ,       <span class="number">12901814</span>,   <span class="number">71676</span>,   <span class="number">71676</span>,   <span class="number">71676</span>,     <span class="number">0.5</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,    <span class="number">19.5</span>,  <span class="number">180.0</span>,  <span class="number">0.00079</span>,      <span class="number">0</span>,      <span class="number">6</span>,      <span class="number">91</span>,      <span class="number">91</span>,       <span class="number">1</span>,   <span class="number">88381</span></span><br><span class="line"> <span class="number">54</span> threadCount, READ,       <span class="number">15457962</span>,   <span class="number">85876</span>,   <span class="number">85876</span>,   <span class="number">85876</span>,     <span class="number">0.6</span>,     <span class="number">0.6</span>,     <span class="number">0.8</span>,     <span class="number">0.8</span>,     <span class="number">0.9</span>,   <span class="number">142.2</span>,  <span class="number">180.0</span>,  <span class="number">0.00079</span>,      <span class="number">0</span>,      <span class="number">7</span>,      <span class="number">82</span>,      <span class="number">82</span>,       <span class="number">1</span>,  <span class="number">103152</span></span><br><span class="line"> <span class="number">81</span> threadCount, READ,       <span class="number">16689834</span>,   <span class="number">92720</span>,   <span class="number">92720</span>,   <span class="number">92720</span>,     <span class="number">0.9</span>,     <span class="number">0.8</span>,     <span class="number">1.0</span>,     <span class="number">1.1</span>,     <span class="number">1.2</span>,  <span class="number">1028.4</span>,  <span class="number">180.0</span>,  <span class="number">0.01156</span>,      <span class="number">0</span>,      <span class="number">8</span>,      <span class="number">87</span>,      <span class="number">87</span>,       <span class="number">0</span>,  <span class="number">117888</span></span><br><span class="line"><span class="number">121</span> threadCount, READ,       <span class="number">23132477</span>,  <span class="number">128511</span>,  <span class="number">128511</span>,  <span class="number">128511</span>,     <span class="number">0.9</span>,     <span class="number">0.9</span>,     <span class="number">1.3</span>,     <span class="number">1.4</span>,     <span class="number">1.7</span>,    <span class="number">20.0</span>,  <span class="number">180.0</span>,  <span class="number">0.00100</span>,      <span class="number">0</span>,     <span class="number">11</span>,     <span class="number">121</span>,     <span class="number">121</span>,       <span class="number">0</span>,  <span class="number">162096</span></span><br><span class="line"><span class="number">181</span> threadCount, READ,       <span class="number">24764144</span>,  <span class="number">137574</span>,  <span class="number">137574</span>,  <span class="number">137574</span>,     <span class="number">1.3</span>,     <span class="number">1.2</span>,     <span class="number">1.7</span>,     <span class="number">2.0</span>,     <span class="number">2.3</span>,    <span class="number">24.9</span>,  <span class="number">180.0</span>,  <span class="number">0.00079</span>,      <span class="number">0</span>,     <span class="number">11</span>,     <span class="number">121</span>,     <span class="number">121</span>,       <span class="number">0</span>,  <span class="number">162096</span></span><br><span class="line"><span class="number">271</span> threadCount, READ,       <span class="number">21903620</span>,  <span class="number">121680</span>,  <span class="number">121680</span>,  <span class="number">121680</span>,     <span class="number">2.2</span>,     <span class="number">1.8</span>,     <span class="number">2.8</span>,     <span class="number">3.1</span>,     <span class="number">3.6</span>,   <span class="number">929.1</span>,  <span class="number">180.0</span>,  <span class="number">0.01170</span>,      <span class="number">0</span>,     <span class="number">10</span>,     <span class="number">111</span>,     <span class="number">111</span>,       <span class="number">0</span>,  <span class="number">147360</span></span><br><span class="line"><span class="number">406</span> threadCount, READ,       <span class="number">20649352</span>,  <span class="number">114685</span>,  <span class="number">114685</span>,  <span class="number">114685</span>,     <span class="number">3.5</span>,     <span class="number">2.9</span>,     <span class="number">4.3</span>,     <span class="number">4.7</span>,     <span class="number">5.5</span>,   <span class="number">923.6</span>,  <span class="number">180.1</span>,  <span class="number">0.01094</span>,      <span class="number">0</span>,     <span class="number">10</span>,     <span class="number">112</span>,     <span class="number">112</span>,       <span class="number">0</span>,  <span class="number">147360</span></span><br></pre></td></tr></table></figure>
<p>G1_32G</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line">  <span class="number">4</span> threadCount, READ,        <span class="number">3612926</span>,   <span class="number">20072</span>,   <span class="number">20072</span>,   <span class="number">20072</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,    <span class="number">67.7</span>,  <span class="number">180.0</span>,  <span class="number">0.00157</span>,      <span class="number">0</span>,      <span class="number">2</span>,     <span class="number">132</span>,     <span class="number">132</span>,       <span class="number">0</span>,   <span class="number">38800</span></span><br><span class="line">  <span class="number">8</span> threadCount, READ,        <span class="number">5744438</span>,   <span class="number">31914</span>,   <span class="number">31914</span>,   <span class="number">31914</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,    <span class="number">67.9</span>,  <span class="number">180.0</span>,  <span class="number">0.00106</span>,      <span class="number">0</span>,      <span class="number">4</span>,     <span class="number">263</span>,     <span class="number">263</span>,       <span class="number">1</span>,   <span class="number">77536</span></span><br><span class="line"> <span class="number">16</span> threadCount, READ,        <span class="number">8824045</span>,   <span class="number">49022</span>,   <span class="number">49022</span>,   <span class="number">49022</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,    <span class="number">69.4</span>,  <span class="number">180.0</span>,  <span class="number">0.00145</span>,      <span class="number">0</span>,      <span class="number">4</span>,     <span class="number">264</span>,     <span class="number">264</span>,       <span class="number">1</span>,   <span class="number">77492</span></span><br><span class="line"> <span class="number">24</span> threadCount, READ,        <span class="number">9937324</span>,   <span class="number">55207</span>,   <span class="number">55207</span>,   <span class="number">55207</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,     <span class="number">0.6</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,    <span class="number">94.4</span>,  <span class="number">180.0</span>,  <span class="number">0.00163</span>,      <span class="number">0</span>,      <span class="number">6</span>,     <span class="number">284</span>,     <span class="number">284</span>,      <span class="number">28</span>,  <span class="number">116877</span></span><br><span class="line"> <span class="number">36</span> threadCount, READ,       <span class="number">13117518</span>,   <span class="number">72873</span>,   <span class="number">72873</span>,   <span class="number">72873</span>,     <span class="number">0.5</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,    <span class="number">20.0</span>,  <span class="number">180.0</span>,  <span class="number">0.00073</span>,      <span class="number">0</span>,      <span class="number">6</span>,      <span class="number">79</span>,      <span class="number">79</span>,       <span class="number">2</span>,  <span class="number">117790</span></span><br><span class="line"> <span class="number">54</span> threadCount, READ,       <span class="number">15457163</span>,   <span class="number">85872</span>,   <span class="number">85872</span>,   <span class="number">85872</span>,     <span class="number">0.6</span>,     <span class="number">0.6</span>,     <span class="number">0.8</span>,     <span class="number">0.8</span>,     <span class="number">0.9</span>,   <span class="number">128.8</span>,  <span class="number">180.0</span>,  <span class="number">0.00117</span>,      <span class="number">0</span>,      <span class="number">8</span>,      <span class="number">85</span>,      <span class="number">85</span>,       <span class="number">1</span>,  <span class="number">157056</span></span><br><span class="line"> <span class="number">81</span> threadCount, READ,       <span class="number">16216625</span>,   <span class="number">90090</span>,   <span class="number">90090</span>,   <span class="number">90090</span>,     <span class="number">0.9</span>,     <span class="number">0.8</span>,     <span class="number">1.0</span>,     <span class="number">1.1</span>,     <span class="number">1.2</span>,  <span class="number">1069.8</span>,  <span class="number">180.0</span>,  <span class="number">0.00725</span>,      <span class="number">0</span>,      <span class="number">9</span>,      <span class="number">94</span>,      <span class="number">94</span>,       <span class="number">0</span>,  <span class="number">176688</span></span><br><span class="line"><span class="number">121</span> threadCount, READ,       <span class="number">22825729</span>,  <span class="number">126807</span>,  <span class="number">126807</span>,  <span class="number">126807</span>,     <span class="number">0.9</span>,     <span class="number">0.9</span>,     <span class="number">1.3</span>,     <span class="number">1.4</span>,     <span class="number">1.6</span>,   <span class="number">959.0</span>,  <span class="number">180.0</span>,  <span class="number">0.00100</span>,      <span class="number">0</span>,     <span class="number">12</span>,     <span class="number">129</span>,     <span class="number">129</span>,       <span class="number">0</span>,  <span class="number">235584</span></span><br><span class="line"><span class="number">181</span> threadCount, READ,       <span class="number">24977336</span>,  <span class="number">138758</span>,  <span class="number">138758</span>,  <span class="number">138758</span>,     <span class="number">1.3</span>,     <span class="number">1.2</span>,     <span class="number">1.6</span>,     <span class="number">1.9</span>,     <span class="number">2.3</span>,    <span class="number">29.0</span>,  <span class="number">180.0</span>,  <span class="number">0.00089</span>,      <span class="number">0</span>,     <span class="number">12</span>,     <span class="number">128</span>,     <span class="number">128</span>,       <span class="number">0</span>,  <span class="number">235584</span></span><br><span class="line"><span class="number">271</span> threadCount, READ,       <span class="number">22096073</span>,  <span class="number">122749</span>,  <span class="number">122749</span>,  <span class="number">122749</span>,     <span class="number">2.2</span>,     <span class="number">1.8</span>,     <span class="number">2.8</span>,     <span class="number">3.2</span>,     <span class="number">3.7</span>,   <span class="number">839.5</span>,  <span class="number">180.0</span>,  <span class="number">0.01227</span>,      <span class="number">0</span>,     <span class="number">12</span>,     <span class="number">129</span>,     <span class="number">129</span>,       <span class="number">0</span>,  <span class="number">235584</span></span><br><span class="line"><span class="number">406</span> threadCount, READ,       <span class="number">22520223</span>,  <span class="number">125103</span>,  <span class="number">125103</span>,  <span class="number">125103</span>,     <span class="number">3.2</span>,     <span class="number">3.1</span>,     <span class="number">4.2</span>,     <span class="number">4.7</span>,     <span class="number">5.3</span>,   <span class="number">136.5</span>,  <span class="number">180.0</span>,  <span class="number">0.00141</span>,      <span class="number">0</span>,     <span class="number">11</span>,     <span class="number">119</span>,     <span class="number">119</span>,       <span class="number">0</span>,  <span class="number">215952</span></span><br></pre></td></tr></table></figure>
<h4 id="混合模式读大于写">混合模式读大于写</h4><p>./cassandra-stress mixed ratio(write=1,read=3) n=100000 cl=ONE -pop dist=UNIFORM(1..1000000) \<br>-schema keyspace=”keyspace1” -mode native cql3 -rate threads>=16 threads\&lt;=256 -log file=SINGLENODE6_mixed_autorate_50r50w_1M.log -node 10.21.21.10</p>
<p>population=10万，其中读和写的比例是3:1，比如读7万条，写2万条，这种是读比较多的场景。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line"> <span class="number">16</span> threadCount, READ,          <span class="number">75251</span>,   <span class="number">34505</span>,   <span class="number">34505</span>,   <span class="number">34505</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.7</span>,    <span class="number">46.8</span>,    <span class="number">2.2</span>,  <span class="number">0.03844</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">45</span>,      <span class="number">45</span>,       <span class="number">0</span>,    <span class="number">1712</span></span><br><span class="line"> <span class="number">16</span> threadCount, WRITE,         <span class="number">24749</span>,   <span class="number">11348</span>,   <span class="number">11348</span>,   <span class="number">11348</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.8</span>,    <span class="number">46.7</span>,    <span class="number">2.2</span>,  <span class="number">0.03844</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">45</span>,      <span class="number">45</span>,       <span class="number">0</span>,    <span class="number">1712</span></span><br><span class="line"> <span class="number">16</span> threadCount, total,        <span class="number">100000</span>,   <span class="number">45853</span>,   <span class="number">45853</span>,   <span class="number">45853</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.8</span>,    <span class="number">46.8</span>,    <span class="number">2.2</span>,  <span class="number">0.03844</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">45</span>,      <span class="number">45</span>,       <span class="number">0</span>,    <span class="number">1712</span></span><br><span class="line"> <span class="number">24</span> threadCount, READ,          <span class="number">74844</span>,   <span class="number">40916</span>,   <span class="number">40916</span>,   <span class="number">40916</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.8</span>,    <span class="number">62.0</span>,    <span class="number">1.8</span>,  <span class="number">0.03023</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">60</span>,      <span class="number">60</span>,       <span class="number">0</span>,    <span class="number">1602</span></span><br><span class="line"> <span class="number">24</span> threadCount, WRITE,         <span class="number">25156</span>,   <span class="number">13754</span>,   <span class="number">13754</span>,   <span class="number">13754</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.9</span>,    <span class="number">62.0</span>,    <span class="number">1.8</span>,  <span class="number">0.03023</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">60</span>,      <span class="number">60</span>,       <span class="number">0</span>,    <span class="number">1602</span></span><br><span class="line"> <span class="number">24</span> threadCount, total,        <span class="number">100000</span>,   <span class="number">54668</span>,   <span class="number">54668</span>,   <span class="number">54668</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,    <span class="number">62.0</span>,    <span class="number">1.8</span>,  <span class="number">0.03023</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">60</span>,      <span class="number">60</span>,       <span class="number">0</span>,    <span class="number">1602</span></span><br><span class="line"> <span class="number">36</span> threadCount, READ,          <span class="number">74519</span>,   <span class="number">54694</span>,   <span class="number">54694</span>,   <span class="number">54694</span>,     <span class="number">0.5</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,     <span class="number">1.6</span>,     <span class="number">3.6</span>,    <span class="number">1.4</span>,  <span class="number">0.00051</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">36</span> threadCount, WRITE,         <span class="number">25481</span>,   <span class="number">18702</span>,   <span class="number">18702</span>,   <span class="number">18702</span>,     <span class="number">0.5</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,     <span class="number">1.7</span>,     <span class="number">3.6</span>,    <span class="number">1.4</span>,  <span class="number">0.00051</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">36</span> threadCount, total,        <span class="number">100000</span>,   <span class="number">73396</span>,   <span class="number">73396</span>,   <span class="number">73396</span>,     <span class="number">0.5</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,     <span class="number">1.5</span>,     <span class="number">3.6</span>,    <span class="number">1.4</span>,  <span class="number">0.00051</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">54</span> threadCount, READ,          <span class="number">75429</span>,   <span class="number">62268</span>,   <span class="number">62268</span>,   <span class="number">62268</span>,     <span class="number">0.6</span>,     <span class="number">0.6</span>,     <span class="number">0.8</span>,     <span class="number">1.0</span>,     <span class="number">3.8</span>,    <span class="number">51.4</span>,    <span class="number">1.2</span>,  <span class="number">0.00555</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">49</span>,      <span class="number">49</span>,       <span class="number">0</span>,    <span class="number">1621</span></span><br><span class="line"> <span class="number">54</span> threadCount, WRITE,         <span class="number">24571</span>,   <span class="number">20284</span>,   <span class="number">20284</span>,   <span class="number">20284</span>,     <span class="number">0.6</span>,     <span class="number">0.6</span>,     <span class="number">0.8</span>,     <span class="number">1.0</span>,    <span class="number">25.6</span>,    <span class="number">51.3</span>,    <span class="number">1.2</span>,  <span class="number">0.00555</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">49</span>,      <span class="number">49</span>,       <span class="number">0</span>,    <span class="number">1621</span></span><br><span class="line"> <span class="number">54</span> threadCount, total,        <span class="number">100000</span>,   <span class="number">82551</span>,   <span class="number">82551</span>,   <span class="number">82551</span>,     <span class="number">0.6</span>,     <span class="number">0.6</span>,     <span class="number">0.8</span>,     <span class="number">1.0</span>,     <span class="number">7.2</span>,    <span class="number">51.4</span>,    <span class="number">1.2</span>,  <span class="number">0.00555</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">49</span>,      <span class="number">49</span>,       <span class="number">0</span>,    <span class="number">1621</span></span><br><span class="line"> <span class="number">81</span> threadCount, READ,          <span class="number">74648</span>,   <span class="number">77082</span>,   <span class="number">77082</span>,   <span class="number">77082</span>,     <span class="number">0.8</span>,     <span class="number">0.7</span>,     <span class="number">1.0</span>,     <span class="number">1.2</span>,     <span class="number">2.5</span>,    <span class="number">51.3</span>,    <span class="number">1.0</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">48</span>,      <span class="number">48</span>,       <span class="number">0</span>,    <span class="number">1606</span></span><br><span class="line"> <span class="number">81</span> threadCount, WRITE,         <span class="number">25352</span>,   <span class="number">26181</span>,   <span class="number">26181</span>,   <span class="number">26181</span>,     <span class="number">0.8</span>,     <span class="number">0.7</span>,     <span class="number">1.0</span>,     <span class="number">1.2</span>,     <span class="number">3.4</span>,    <span class="number">51.2</span>,    <span class="number">1.0</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">48</span>,      <span class="number">48</span>,       <span class="number">0</span>,    <span class="number">1606</span></span><br><span class="line"> <span class="number">81</span> threadCount, total,        <span class="number">100000</span>,  <span class="number">103261</span>,  <span class="number">103261</span>,  <span class="number">103261</span>,     <span class="number">0.8</span>,     <span class="number">0.7</span>,     <span class="number">1.0</span>,     <span class="number">1.2</span>,     <span class="number">2.4</span>,    <span class="number">51.3</span>,    <span class="number">1.0</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">48</span>,      <span class="number">48</span>,       <span class="number">0</span>,    <span class="number">1606</span></span><br><span class="line"><span class="number">121</span> threadCount, READ,          <span class="number">74735</span>,   <span class="number">85846</span>,   <span class="number">85846</span>,   <span class="number">85846</span>,     <span class="number">1.0</span>,     <span class="number">0.9</span>,     <span class="number">1.1</span>,     <span class="number">1.3</span>,     <span class="number">2.5</span>,    <span class="number">54.0</span>,    <span class="number">0.9</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">51</span>,      <span class="number">51</span>,       <span class="number">0</span>,    <span class="number">1609</span></span><br><span class="line"><span class="number">121</span> threadCount, WRITE,         <span class="number">25265</span>,   <span class="number">29358</span>,   <span class="number">29358</span>,   <span class="number">29358</span>,     <span class="number">1.0</span>,     <span class="number">0.8</span>,     <span class="number">1.2</span>,     <span class="number">1.4</span>,    <span class="number">53.6</span>,    <span class="number">53.9</span>,    <span class="number">0.9</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">51</span>,      <span class="number">51</span>,       <span class="number">0</span>,    <span class="number">1609</span></span><br><span class="line"><span class="number">121</span> threadCount, total,        <span class="number">100000</span>,  <span class="number">114867</span>,  <span class="number">114867</span>,  <span class="number">114867</span>,     <span class="number">1.0</span>,     <span class="number">0.9</span>,     <span class="number">1.1</span>,     <span class="number">1.3</span>,     <span class="number">2.4</span>,    <span class="number">54.0</span>,    <span class="number">0.9</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">51</span>,      <span class="number">51</span>,       <span class="number">0</span>,    <span class="number">1609</span></span><br><span class="line"><span class="number">181</span> threadCount, READ,          <span class="number">74534</span>,  <span class="number">104771</span>,  <span class="number">104771</span>,  <span class="number">104771</span>,     <span class="number">1.3</span>,     <span class="number">1.3</span>,     <span class="number">1.7</span>,     <span class="number">1.9</span>,     <span class="number">5.3</span>,     <span class="number">7.7</span>,    <span class="number">0.7</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">181</span> threadCount, WRITE,         <span class="number">25466</span>,   <span class="number">35798</span>,   <span class="number">35798</span>,   <span class="number">35798</span>,     <span class="number">1.3</span>,     <span class="number">1.2</span>,     <span class="number">1.7</span>,     <span class="number">2.0</span>,     <span class="number">4.9</span>,     <span class="number">8.3</span>,    <span class="number">0.7</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">181</span> threadCount, total,        <span class="number">100000</span>,  <span class="number">140568</span>,  <span class="number">140568</span>,  <span class="number">140568</span>,     <span class="number">1.3</span>,     <span class="number">1.2</span>,     <span class="number">1.7</span>,     <span class="number">1.9</span>,     <span class="number">5.1</span>,     <span class="number">8.3</span>,    <span class="number">0.7</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>G1_16G</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line"> <span class="number">16</span> threadCount, READ,          <span class="number">75381</span>,   <span class="number">34242</span>,   <span class="number">34242</span>,   <span class="number">34242</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.7</span>,    <span class="number">18.8</span>,    <span class="number">2.2</span>,  <span class="number">0.00397</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">16</span> threadCount, WRITE,         <span class="number">24619</span>,   <span class="number">11183</span>,   <span class="number">11183</span>,   <span class="number">11183</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.8</span>,    <span class="number">18.8</span>,    <span class="number">2.2</span>,  <span class="number">0.00397</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">16</span> threadCount, total,        <span class="number">100000</span>,   <span class="number">45425</span>,   <span class="number">45425</span>,   <span class="number">45425</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.7</span>,    <span class="number">18.8</span>,    <span class="number">2.2</span>,  <span class="number">0.00397</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">24</span> threadCount, READ,          <span class="number">74898</span>,   <span class="number">42757</span>,   <span class="number">42757</span>,   <span class="number">42757</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.8</span>,    <span class="number">17.6</span>,    <span class="number">1.8</span>,  <span class="number">0.02794</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">24</span> threadCount, WRITE,         <span class="number">25102</span>,   <span class="number">14331</span>,   <span class="number">14331</span>,   <span class="number">14331</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.9</span>,    <span class="number">17.6</span>,    <span class="number">1.8</span>,  <span class="number">0.02794</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">24</span> threadCount, total,        <span class="number">100000</span>,   <span class="number">57087</span>,   <span class="number">57087</span>,   <span class="number">57087</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.8</span>,    <span class="number">17.6</span>,    <span class="number">1.8</span>,  <span class="number">0.02794</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">36</span> threadCount, READ,          <span class="number">75189</span>,   <span class="number">54221</span>,   <span class="number">54221</span>,   <span class="number">54221</span>,     <span class="number">0.5</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,     <span class="number">1.7</span>,     <span class="number">8.3</span>,    <span class="number">1.4</span>,  <span class="number">0.00024</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">36</span> threadCount, WRITE,         <span class="number">24811</span>,   <span class="number">17892</span>,   <span class="number">17892</span>,   <span class="number">17892</span>,     <span class="number">0.5</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,     <span class="number">1.7</span>,     <span class="number">5.2</span>,    <span class="number">1.4</span>,  <span class="number">0.00024</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">36</span> threadCount, total,        <span class="number">100000</span>,   <span class="number">72113</span>,   <span class="number">72113</span>,   <span class="number">72113</span>,     <span class="number">0.5</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,     <span class="number">1.7</span>,     <span class="number">8.3</span>,    <span class="number">1.4</span>,  <span class="number">0.00024</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">54</span> threadCount, READ,          <span class="number">74941</span>,   <span class="number">63319</span>,   <span class="number">63319</span>,   <span class="number">63319</span>,     <span class="number">0.6</span>,     <span class="number">0.6</span>,     <span class="number">0.8</span>,     <span class="number">1.0</span>,     <span class="number">1.5</span>,    <span class="number">24.7</span>,    <span class="number">1.2</span>,  <span class="number">0.02843</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">54</span> threadCount, WRITE,         <span class="number">25059</span>,   <span class="number">21175</span>,   <span class="number">21175</span>,   <span class="number">21175</span>,     <span class="number">0.6</span>,     <span class="number">0.6</span>,     <span class="number">0.8</span>,     <span class="number">1.0</span>,     <span class="number">2.0</span>,    <span class="number">24.5</span>,    <span class="number">1.2</span>,  <span class="number">0.02843</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">54</span> threadCount, total,        <span class="number">100000</span>,   <span class="number">84492</span>,   <span class="number">84492</span>,   <span class="number">84492</span>,     <span class="number">0.6</span>,     <span class="number">0.6</span>,     <span class="number">0.8</span>,     <span class="number">1.0</span>,     <span class="number">1.4</span>,    <span class="number">24.7</span>,    <span class="number">1.2</span>,  <span class="number">0.02843</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">81</span> threadCount, READ,          <span class="number">75009</span>,   <span class="number">80336</span>,   <span class="number">80336</span>,   <span class="number">80336</span>,     <span class="number">0.7</span>,     <span class="number">0.7</span>,     <span class="number">1.0</span>,     <span class="number">1.0</span>,     <span class="number">1.1</span>,     <span class="number">7.2</span>,    <span class="number">0.9</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">81</span> threadCount, WRITE,         <span class="number">24991</span>,   <span class="number">26766</span>,   <span class="number">26766</span>,   <span class="number">26766</span>,     <span class="number">0.7</span>,     <span class="number">0.7</span>,     <span class="number">1.0</span>,     <span class="number">1.1</span>,     <span class="number">1.3</span>,     <span class="number">3.1</span>,    <span class="number">0.9</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">81</span> threadCount, total,        <span class="number">100000</span>,  <span class="number">107102</span>,  <span class="number">107102</span>,  <span class="number">107102</span>,     <span class="number">0.7</span>,     <span class="number">0.7</span>,     <span class="number">1.0</span>,     <span class="number">1.0</span>,     <span class="number">1.1</span>,     <span class="number">7.2</span>,    <span class="number">0.9</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">121</span> threadCount, READ,          <span class="number">75063</span>,   <span class="number">91080</span>,   <span class="number">91080</span>,   <span class="number">91080</span>,     <span class="number">1.0</span>,     <span class="number">0.9</span>,     <span class="number">1.3</span>,     <span class="number">1.5</span>,     <span class="number">3.2</span>,    <span class="number">29.6</span>,    <span class="number">0.8</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">121</span> threadCount, WRITE,         <span class="number">24937</span>,   <span class="number">30259</span>,   <span class="number">30259</span>,   <span class="number">30259</span>,     <span class="number">1.0</span>,     <span class="number">0.9</span>,     <span class="number">1.3</span>,     <span class="number">1.7</span>,    <span class="number">28.2</span>,    <span class="number">29.6</span>,    <span class="number">0.8</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">121</span> threadCount, total,        <span class="number">100000</span>,  <span class="number">121338</span>,  <span class="number">121338</span>,  <span class="number">121338</span>,     <span class="number">1.0</span>,     <span class="number">0.9</span>,     <span class="number">1.3</span>,     <span class="number">1.5</span>,    <span class="number">13.5</span>,    <span class="number">29.6</span>,    <span class="number">0.8</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">181</span> threadCount, READ,          <span class="number">75342</span>,  <span class="number">104114</span>,  <span class="number">104114</span>,  <span class="number">104114</span>,     <span class="number">1.3</span>,     <span class="number">1.3</span>,     <span class="number">1.7</span>,     <span class="number">1.9</span>,     <span class="number">3.9</span>,     <span class="number">7.6</span>,    <span class="number">0.7</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">181</span> threadCount, WRITE,         <span class="number">24658</span>,   <span class="number">34075</span>,   <span class="number">34075</span>,   <span class="number">34075</span>,     <span class="number">1.3</span>,     <span class="number">1.3</span>,     <span class="number">1.7</span>,     <span class="number">2.0</span>,     <span class="number">4.9</span>,     <span class="number">8.0</span>,    <span class="number">0.7</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">181</span> threadCount, total,        <span class="number">100000</span>,  <span class="number">138189</span>,  <span class="number">138189</span>,  <span class="number">138189</span>,     <span class="number">1.3</span>,     <span class="number">1.3</span>,     <span class="number">1.7</span>,     <span class="number">1.9</span>,     <span class="number">3.3</span>,     <span class="number">8.0</span>,    <span class="number">0.7</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>G1_24G</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">16</span> threadCount, READ,          <span class="number">74594</span>,   <span class="number">33655</span>,   <span class="number">33655</span>,   <span class="number">33655</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.5</span>,     <span class="number">0.5</span>,     <span class="number">0.8</span>,    <span class="number">23.1</span>,    <span class="number">2.2</span>,  <span class="number">0.00911</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">16</span> threadCount, WRITE,         <span class="number">25406</span>,   <span class="number">11467</span>,   <span class="number">11467</span>,   <span class="number">11467</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.5</span>,     <span class="number">0.5</span>,     <span class="number">0.8</span>,     <span class="number">9.9</span>,    <span class="number">2.2</span>,  <span class="number">0.00911</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">16</span> threadCount, total,        <span class="number">100000</span>,   <span class="number">45117</span>,   <span class="number">45117</span>,   <span class="number">45117</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.5</span>,     <span class="number">0.5</span>,     <span class="number">0.8</span>,    <span class="number">23.1</span>,    <span class="number">2.2</span>,  <span class="number">0.00911</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">24</span> threadCount, READ,          <span class="number">74649</span>,   <span class="number">40798</span>,   <span class="number">40798</span>,   <span class="number">40798</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,    <span class="number">13.7</span>,    <span class="number">1.8</span>,  <span class="number">0.01581</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">24</span> threadCount, WRITE,         <span class="number">25351</span>,   <span class="number">13861</span>,   <span class="number">13861</span>,   <span class="number">13861</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,    <span class="number">13.7</span>,    <span class="number">1.8</span>,  <span class="number">0.01581</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">24</span> threadCount, total,        <span class="number">100000</span>,   <span class="number">54653</span>,   <span class="number">54653</span>,   <span class="number">54653</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,    <span class="number">13.7</span>,    <span class="number">1.8</span>,  <span class="number">0.01581</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">36</span> threadCount, READ,          <span class="number">75378</span>,   <span class="number">53898</span>,   <span class="number">53898</span>,   <span class="number">53898</span>,     <span class="number">0.5</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,     <span class="number">1.6</span>,     <span class="number">3.2</span>,    <span class="number">1.4</span>,  <span class="number">0.01693</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">36</span> threadCount, WRITE,         <span class="number">24622</span>,   <span class="number">17606</span>,   <span class="number">17606</span>,   <span class="number">17606</span>,     <span class="number">0.5</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,     <span class="number">1.4</span>,     <span class="number">2.9</span>,    <span class="number">1.4</span>,  <span class="number">0.01693</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">36</span> threadCount, total,        <span class="number">100000</span>,   <span class="number">71503</span>,   <span class="number">71503</span>,   <span class="number">71503</span>,     <span class="number">0.5</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,     <span class="number">1.4</span>,     <span class="number">3.2</span>,    <span class="number">1.4</span>,  <span class="number">0.01693</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">54</span> threadCount, READ,          <span class="number">75012</span>,   <span class="number">61606</span>,   <span class="number">61606</span>,   <span class="number">61606</span>,     <span class="number">0.6</span>,     <span class="number">0.6</span>,     <span class="number">0.8</span>,     <span class="number">1.0</span>,     <span class="number">3.1</span>,    <span class="number">30.7</span>,    <span class="number">1.2</span>,  <span class="number">0.02550</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">54</span> threadCount, WRITE,         <span class="number">24988</span>,   <span class="number">20522</span>,   <span class="number">20522</span>,   <span class="number">20522</span>,     <span class="number">0.6</span>,     <span class="number">0.6</span>,     <span class="number">0.8</span>,     <span class="number">1.0</span>,     <span class="number">3.8</span>,    <span class="number">30.5</span>,    <span class="number">1.2</span>,  <span class="number">0.02550</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">54</span> threadCount, total,        <span class="number">100000</span>,   <span class="number">82128</span>,   <span class="number">82128</span>,   <span class="number">82128</span>,     <span class="number">0.6</span>,     <span class="number">0.6</span>,     <span class="number">0.8</span>,     <span class="number">1.0</span>,     <span class="number">3.4</span>,    <span class="number">30.7</span>,    <span class="number">1.2</span>,  <span class="number">0.02550</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">81</span> threadCount, READ,          <span class="number">75469</span>,   <span class="number">76118</span>,   <span class="number">76118</span>,   <span class="number">76118</span>,     <span class="number">0.8</span>,     <span class="number">0.8</span>,     <span class="number">1.0</span>,     <span class="number">1.1</span>,     <span class="number">1.3</span>,     <span class="number">3.0</span>,    <span class="number">1.0</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">81</span> threadCount, WRITE,         <span class="number">24531</span>,   <span class="number">24748</span>,   <span class="number">24748</span>,   <span class="number">24748</span>,     <span class="number">0.8</span>,     <span class="number">0.8</span>,     <span class="number">1.0</span>,     <span class="number">1.1</span>,     <span class="number">1.6</span>,     <span class="number">2.6</span>,    <span class="number">1.0</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">81</span> threadCount, total,        <span class="number">100000</span>,  <span class="number">100860</span>,  <span class="number">100860</span>,  <span class="number">100860</span>,     <span class="number">0.8</span>,     <span class="number">0.8</span>,     <span class="number">1.0</span>,     <span class="number">1.1</span>,     <span class="number">1.3</span>,     <span class="number">3.0</span>,    <span class="number">1.0</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">121</span> threadCount, READ,          <span class="number">75006</span>,   <span class="number">90799</span>,   <span class="number">90799</span>,   <span class="number">90799</span>,     <span class="number">1.0</span>,     <span class="number">0.9</span>,     <span class="number">1.3</span>,     <span class="number">1.5</span>,    <span class="number">31.1</span>,    <span class="number">31.5</span>,    <span class="number">0.8</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">121</span> threadCount, WRITE,         <span class="number">24994</span>,   <span class="number">30257</span>,   <span class="number">30257</span>,   <span class="number">30257</span>,     <span class="number">1.0</span>,     <span class="number">0.9</span>,     <span class="number">1.3</span>,     <span class="number">1.5</span>,    <span class="number">31.3</span>,    <span class="number">31.5</span>,    <span class="number">0.8</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">121</span> threadCount, total,        <span class="number">100000</span>,  <span class="number">121055</span>,  <span class="number">121055</span>,  <span class="number">121055</span>,     <span class="number">1.0</span>,     <span class="number">0.9</span>,     <span class="number">1.3</span>,     <span class="number">1.5</span>,     <span class="number">5.5</span>,    <span class="number">31.5</span>,    <span class="number">0.8</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">181</span> threadCount, READ,          <span class="number">75454</span>,  <span class="number">103545</span>,  <span class="number">103545</span>,  <span class="number">103545</span>,     <span class="number">1.3</span>,     <span class="number">1.3</span>,     <span class="number">1.7</span>,     <span class="number">2.0</span>,     <span class="number">2.2</span>,     <span class="number">4.5</span>,    <span class="number">0.7</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">181</span> threadCount, WRITE,         <span class="number">24546</span>,   <span class="number">33685</span>,   <span class="number">33685</span>,   <span class="number">33685</span>,     <span class="number">1.3</span>,     <span class="number">1.3</span>,     <span class="number">1.8</span>,     <span class="number">2.1</span>,     <span class="number">3.0</span>,     <span class="number">4.5</span>,    <span class="number">0.7</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">181</span> threadCount, total,        <span class="number">100000</span>,  <span class="number">137229</span>,  <span class="number">137229</span>,  <span class="number">137229</span>,     <span class="number">1.3</span>,     <span class="number">1.3</span>,     <span class="number">1.7</span>,     <span class="number">2.0</span>,     <span class="number">2.2</span>,     <span class="number">4.5</span>,    <span class="number">0.7</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br></pre></td></tr></table></figure>
<h4 id="混合模式写大于读">混合模式写大于读</h4><p>./cassandra-stress mixed ratio(write=3,read=1) n=1000000 cl=ONE -pop dist=UNIFORM(1..10000000) -schema keyspace=”keyspace1” -mode native cql3 -rate threads>=16 threads\&lt;=256 -log file=SINGLENODE6_mixed_write3read1_1M.log -node 10.21.21.10</p>
<h3 id="自定义schema">自定义schema</h3><p><a href="http://www.datastax.com/dev/blog/improved-cassandra-2-1-stress-tool-benchmark-any-schema" target="_blank" rel="external">http://www.datastax.com/dev/blog/improved-cassandra-2-1-stress-tool-benchmark-any-schema</a></p>
<p>自定义的YAML配置文件包括四部分：  </p>
<ol>
<li>DDL：表结构</li>
<li>列的分布：定义每个列的大小，和每个Partition有多少列等</li>
<li>写入数据的分布：数据写入</li>
<li>DML：数据查询</li>
</ol>
<blockquote>
<p>模拟数据一般考虑生成多少行（总的数据量和每行的数据量），每一列的数据大小和数据分布。</p>
</blockquote>
<p><strong>列分布</strong>是为了模拟实际的数据：model the size of the data in the column, the number of unique values, and the clustering of them withing a given partition.<br>分别对应了columnspec下每个column的size，population,cluster。当然并不是说每个列都要定义这三个选项，只有排序键cluster key才需要定义cluster（比如下文的publish_date）。  </p>
<ul>
<li>Size distribution – Defines the distribution of sizes for text, blob, set and list types  (default of UNIFORM(4..8))</li>
<li>Population distribution – Defines the distribution of <strong>unique values for the column values</strong> (default of UNIFORM(1..100B))</li>
<li>Cluster distribution – Defines the  distribution for <strong>the number of clustering prefixes within a given partition</strong> (default of FIXED(1))</li>
</ul>
<blockquote>
<p>B是Billion十亿,默认值100B=1000亿，M是Million百万。UNIFORM:均匀分布/平均分布，Gaussion:高斯分布/正太分布，中间高两边低<br>默认的size，population，cluster表示：长度=[4,8]均匀分布，数据量=[1,1000万]均匀分布，排序键=1，表示每一个主键只有一行数据。  </p>
</blockquote>
<p>size表示每一列的长度（比如默认每一列长度在4-8之间），population表示不同列的数量，比如n=10万，population=1000，表示在产生10万条数据，但是不同的数据只有1000条，也就是每条数据实际上有多个列。不过为什么UNIFORM(1..100B)是个范围而不是精确的数字呢？比如n=10万，而UNIFORM(1..100B)，其中最大值100B=1000亿，那么数据是怎么分布的呢？  </p>
<p><strong>插入分布</strong>：插入数据要指定row-key，对应Cassandra的Partition这个概念，每一行row-key都对应了一个Partition。 批量插入数据的方式有LOGGED和UNLOGGED两种类型。</p>
<ul>
<li>Partition distribution：The number of partitions to update per batch (default FIXED(1))</li>
<li>select distribution ratio：The ratio of rows each partition should insert as a proportion of the total possible rows for the partition (as defined by the clustering distribution columns). default FIXED(1)/1</li>
</ul>
<blockquote>
<p>列分布决定数据的分布，插入分布决定插入的方式。可以不需要配置插入分布，插入数据时会自动符合列分布。</p>
</blockquote>
<h4 id="示例">示例</h4><blockquote>
<p>说明：在tools/bin下创建blogpost1.yaml配置文件。如果表结果已经存在，只需要定义keyspace和table就可以，<br>不需要定义keyspace_definition和table_definition。由于目前还是单节点测试，所以副本数=1。  </p>
</blockquote>
<p>表结构说明： blogposts存储博客，主键是domain，排序键是发布时间。在实际中domain是实际的站点，url是博客的链接地址。<br>比如domain=<a href="http://blog.csdn.net" target="_blank" rel="external">http://blog.csdn.net</a>，在同一个站点发布博客的所有作者都放在同一行。这种一般用于现在非常流畅的聚合类应用。  </p>
<blockquote>
<p>目标：define a model for a simple app to hold blog posts for multiple websites 多个站点的帖子</p>
</blockquote>
<p>而如果对于某个博客站点自己做的应用他不需要聚合其他站点的博客，就可以把domain理解成博客作者的主页。<br>比如我在CSDN博客于2015-01-27发表了一篇关于Hello Flink的入门文章：  </p>
<p>domain：<a href="http://blog.csdn.net/zqhxuyuan" target="_blank" rel="external">http://blog.csdn.net/zqhxuyuan</a><br>publish-date：2015-01-27<br>url: <a href="http://blog.csdn.net/zqhxuyuan/article/details/43196423" target="_blank" rel="external">http://blog.csdn.net/zqhxuyuan/article/details/43196423</a>  </p>
<p>又在2016-05-18发表了一篇Apache GraphX的图文详解文章：  </p>
<p>domain：<a href="http://blog.csdn.net/zqhxuyuan" target="_blank" rel="external">http://blog.csdn.net/zqhxuyuan</a><br>publish-date：2016-05-18<br>url：<a href="http://blog.csdn.net/zqhxuyuan/article/details/48730515" target="_blank" rel="external">http://blog.csdn.net/zqhxuyuan/article/details/48730515</a>  </p>
<p>在Cassandra相同key的不同记录以列式存储，实际存储结果类似：  </p>
<table>
<thead>
<tr>
<th>row-key</th>
<th>2015-01-27:url:author:title:body</th>
<th>2016-05-18:url:author:title:body</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="http://blog.csdn.net/zqhxuyuan" target="_blank" rel="external">http://blog.csdn.net/zqhxuyuan</a></td>
<td><a href="http://blog.csdn.net/zqhxuyuan/article/details/43196423" target="_blank" rel="external">http://blog.csdn.net/zqhxuyuan/article/details/43196423</a>:zqhxuyuan:Hello Flink:…</td>
<td><a href="http://blog.csdn.net/zqhxuyuan/article/details/48730515" target="_blank" rel="external">http://blog.csdn.net/zqhxuyuan/article/details/48730515</a>:zqhxuyuan:Apache GraphX 图文详解:…</td>
</tr>
</tbody>
</table>
<blockquote>
<p>集群环境下，可以修改副本数=3，不过可以先测试1个副本，然后再测试3个副本</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">### DDL ###&#10;###########&#10;&#10;# Keyspace Name&#10;keyspace: stresscql&#10;&#10;# The CQL for creating a keyspace (optional if it already exists)&#10;keyspace_definition: |&#10;  CREATE KEYSPACE stresscql WITH replication = &#123;&#39;class&#39;: &#39;SimpleStrategy&#39;, &#39;replication_factor&#39;: 1&#125;;&#10;# Table name&#10;table: blogposts&#10;&#10;# The CQL for creating a table you wish to stress (optional if it already exists)&#10;table_definition: |&#10;  CREATE TABLE blogposts (&#10;        domain text,&#10;        published_date timeuuid,&#10;        url text,&#10;        author text,&#10;        title text,&#10;        body text,&#10;        PRIMARY KEY(domain, published_date)&#10;  ) WITH CLUSTERING ORDER BY (published_date DESC) &#10;    AND compaction = &#123; &#39;class&#39;:&#39;LeveledCompactionStrategy&#39; &#125; &#10;    AND comment=&#39;A table to hold blog posts&#39;&#10;&#10;### Column Distribution Specifications ###&#10;##########################################&#10;&#10;columnspec:&#10;  - name: domain&#10;    size: gaussian(5..100)       #domain names are relatively short&#10;    population: uniform(1..10M)  #10M possible domains to pick from&#10;&#10;  - name: published_date         #&#27599;&#20010;&#31449;&#28857;&#26368;&#22810;&#20801;&#35768;1000&#20010;&#24086;&#23376;&#65292;&#29992;&#25490;&#24207;&#38190;&#20915;&#23450;&#21015;&#30340;&#25968;&#37327;&#10;    cluster: fixed(1000)         #under each domain we will have max 1000 posts&#10;&#10;  - name: url&#10;    size: uniform(30..300)       &#10;&#10;  - name: title                  #titles shouldn&#39;t go beyond 200 chars&#10;    size: gaussian(10..200)&#10;&#10;  - name: author&#10;    size: uniform(5..20)         #author names should be short&#10;&#10;  - name: body&#10;    size: gaussian(100..5000)    #the body of the blog post can be long&#10;   &#10;### Batch Ratio Distribution Specifications ###&#10;###############################################&#10;&#10;insert:                           #&#27599;&#20010;batch&#21482;&#25554;&#20837;&#19968;&#27425;&#65288;&#65311;&#65289;&#65292; &#27604;&#22914;&#21487;&#20197;&#29992;insert=1&#65292;&#25110;&#32773;insert=2&#65292;...&#10;  partitions: fixed(1)            #Our partition key is the domain so only insert one per batch&#10;  select:    fixed(1)/1000        #We have 1000 posts per domain so 1/1000 will allow 1 post per batch&#10;  batchtype: UNLOGGED             #Unlogged batches&#10;&#10;&#10;### A list of queries you wish to run against the schema ###&#10;############################################################&#10;&#10;queries:&#10;   singlepost:&#10;      cql: select * from blogposts where domain = ? LIMIT 1 &#10;      fields: samerow&#10;   timeline: &#10;      cql: select url, title, published_date from blogposts where domain = ? LIMIT 10&#10;      fields: samerow</span><br></pre></td></tr></table></figure>
<p>数据分布测试：</p>
<p>./cassandra-stress user profile=blogpost.yaml ops(insert=1) -rate threads=100 -node 10.21.21.130</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">  domain text,</span><br><span class="line">  published_date timeuuid,</span><br><span class="line"></span><br><span class="line">columspec:</span><br><span class="line">  - name: domain</span><br><span class="line">    size: <span class="function"><span class="title">gaussian</span><span class="params">(<span class="number">5</span>..<span class="number">20</span>)</span></span>       </span><br><span class="line">    population: <span class="function"><span class="title">uniform</span><span class="params">(<span class="number">1</span>..<span class="number">100</span>)</span></span>  </span><br><span class="line"></span><br><span class="line">  - name: published_date         </span><br><span class="line">    cluster: <span class="function"><span class="title">fixed</span><span class="params">(<span class="number">10</span>)</span></span></span><br></pre></td></tr></table></figure>
<p>数据特征：总数=1000条，<strong>相同domain不同published_date有10条</strong>。 <strong>domain一共有100条</strong>，所以总数=100*10=1000<br>字段的长度和类型也有关系，比如published_date是uuid类型，长度是固定的，即使指定size也不起作用。<br>而domain和autor为文本类型，支持size的分布方式，比如domain是高斯分布，5-20中间的部分12左右最多。</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="special">[</span>admin@cass021133 bin<span class="special">]</span><span class="formula">$ cqlsh 10.21.21.130 -e "select domain,published_date,author from stresscql.blogposts1;"</span><br><span class="line">...</span><br><span class="line">               ;"<span class="special">&#123;</span>(<span class="command">\x</span>06<span class="command">\x</span>17<span class="special">&#125;</span>N<span class="command">\x</span>01Y-ic:R | 29124890-da3b-11d9-4eb1-f78328592aad |                |<span class="command">\x</span>15<span class="command">\x</span>0b<span class="command">\x</span>17<span class="command">\x</span>15-<span class="command">\x</span>1cE<span class="command">\x</span>1bYY<span class="command">\x</span>1a</span><br><span class="line">               ;"<span class="special">&#123;</span>(<span class="command">\x</span>06<span class="command">\x</span>17<span class="special">&#125;</span>N<span class="command">\x</span>01Y-ic:R | 70758610-c81c-11d9-4eb1-f78328592aad |                                n4Q<span class="command">\x</span>05<span class="command">\x</span>02P<span class="command">\x</span>1e0</span><br><span class="line">               ;"<span class="special">&#123;</span>(<span class="command">\x</span>06<span class="command">\x</span>17<span class="special">&#125;</span>N<span class="command">\x</span>01Y-ic:R | ce7cac90-9d72-11d9-4eb1-f78328592aad |                                   <span class="command">\x</span>07<span class="command">\x</span>18<span class="command">\x</span>0ew<span class="special">[</span></span><br><span class="line">               ;"<span class="special">&#123;</span>(<span class="command">\x</span>06<span class="command">\x</span>17<span class="special">&#125;</span>N<span class="command">\x</span>01Y-ic:R | 262528f0-ddf2-11d3-4eb1-f78328592aad |                                         .x<span class="special">[</span>ChI+<span class="special">&#125;</span></span><br><span class="line">               ;"<span class="special">&#123;</span>(<span class="command">\x</span>06<span class="command">\x</span>17<span class="special">&#125;</span>N<span class="command">\x</span>01Y-ic:R | c5e60070-55de-11d0-4eb1-f78328592aad |                            p;.<span class="command">\x</span>12<span class="command">\nKn</span><span class="special">[</span>N-<span class="command">\x</span>17^tc</span><br><span class="line">               ;"<span class="special">&#123;</span>(<span class="command">\x</span>06<span class="command">\x</span>17<span class="special">&#125;</span>N<span class="command">\x</span>01Y-ic:R | db0601c0-cb63-11c2-4eb1-f78328592aad |              z$</span>y<span class="command">\x</span>06<span class="formula">$v+DwMqsA<span class="command">\x</span>00=<span class="command">\x</span>08/3<span class="command">\x</span>12<span class="command">\x</span>1b</span><br><span class="line">               ;"<span class="special">&#123;</span>(<span class="command">\x</span>06<span class="command">\x</span>17<span class="special">&#125;</span>N<span class="command">\x</span>01Y-ic:R | 7b715db0-857b-11bc-4eb1-f78328592aad |          <span class="command">\x</span>1138<span class="command">\x</span>15<span class="command">\x</span>1e2<span class="command">\x</span>13`<span class="command">\x</span>19/@9M<span class="command">\x</span>00<span class="command">\x</span>088;</span><br><span class="line">               ;"<span class="special">&#123;</span>(<span class="command">\x</span>06<span class="command">\x</span>17<span class="special">&#125;</span>N<span class="command">\x</span>01Y-ic:R | ac53f6d0-254b-11bc-4eb1-f78328592aad |                   )<span class="command">\x</span>0f<span class="command">\x</span>14MWKc7t<span class="command">\x</span>01qv<span class="special">]</span>JZ<span class="special">[</span><span class="command">\x</span>19<span class="special">~</span></span><br><span class="line">               ;"<span class="special">&#123;</span>(<span class="command">\x</span>06<span class="command">\x</span>17<span class="special">&#125;</span>N<span class="command">\x</span>01Y-ic:R | 468457e0-829e-11b7-4eb1-f78328592aad |                  7<span class="command">\x</span>02%<span class="command">\tn</span>=y<span class="command">\x</span>00<span class="command">\x</span>19/M<span class="command">\x</span>15<span class="command">\x</span>1e"E</span><br><span class="line">               ;"<span class="special">&#123;</span>(<span class="command">\x</span>06<span class="command">\x</span>17<span class="special">&#125;</span>N<span class="command">\x</span>01Y-ic:R | 20466680-2370-11b4-4eb1-f78328592aad |                       &gt;_u<span class="special">&#125;</span>x<span class="command">\x</span>1cSFu<span class="command">\x</span>0e)<span class="command">\x</span>1ey<span class="command">\x</span>10</span><br><span class="line">(1000 rows)</span><br><span class="line"></span><br><span class="line"><span class="special">[</span>admin@cass021133 bin<span class="special">]</span>$</span> cqlsh 10.21.21.130 -e "select distinct domain from stresscql.blogposts1;"</span><br><span class="line">                <span class="command">\x</span>05!GRpp<span class="command">\x</span>1dD<span class="command">\x</span>1fuUpS</span><br><span class="line">                      srP<span class="special">&#125;</span>.6R<span class="command">\x</span>1c"xd)t</span><br><span class="line">                      Mw<span class="special">&#125;</span>o^<span class="command">\x</span>16zFQ -!y</span><br><span class="line">              ;"<span class="special">&#123;</span>(<span class="command">\x</span>06<span class="command">\x</span>17<span class="special">&#125;</span>N<span class="command">\x</span>01Y-ic:R</span><br><span class="line">(100 rows)</span><br></pre></td></tr></table></figure>
<h4 id="只有写入">只有写入</h4><p>./cassandra-stress user profile=./blogpost1.yaml ops(insert=1) -node 10.21.21.10 -log file=SINGLENODE7_blog_insert.log</p>
<p>默认没有其他选项，会从4个线程开始，并逐步增加线程数量，直到达到一个限制。默认的插入模式协议采用native transport，以及使用PreparedStatement。<br>这里跟标准测试不同的是，没有指定n=?，因为在profile YAML配置文件中，insert部分已经可以说明数据将如何被插入。  </p>
<blockquote>
<p>参考文章中作者的笔记本单台机器，可以达到401个线程，每秒8500。下面的测试结果中线程的上限只有81个，不过每秒可以写入2.5万条记录。  </p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">            id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line"> <span class="number">4</span> threadCount, insert,       <span class="number">244201</span>,    <span class="number">8098</span>,    <span class="number">8098</span>,   <span class="number">11068</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,     <span class="number">1.0</span>,   <span class="number">380.9</span>,   <span class="number">30.2</span>,  <span class="number">0.00348</span>,      <span class="number">0</span>,      <span class="number">4</span>,    <span class="number">1207</span>,    <span class="number">1207</span>,      <span class="number">53</span>,    <span class="number">5233</span></span><br><span class="line"> <span class="number">8</span> threadCount, insert,       <span class="number">429876</span>,   <span class="number">14162</span>,   <span class="number">14162</span>,   <span class="number">19369</span>,     <span class="number">0.5</span>,     <span class="number">0.4</span>,     <span class="number">0.7</span>,     <span class="number">0.8</span>,     <span class="number">1.4</span>,   <span class="number">265.7</span>,   <span class="number">30.4</span>,  <span class="number">0.01082</span>,      <span class="number">0</span>,      <span class="number">7</span>,    <span class="number">1606</span>,    <span class="number">1606</span>,      <span class="number">20</span>,    <span class="number">9419</span></span><br><span class="line"><span class="number">16</span> threadCount, insert,       <span class="number">658771</span>,   <span class="number">21750</span>,   <span class="number">21750</span>,   <span class="number">29780</span>,     <span class="number">0.6</span>,     <span class="number">0.5</span>,     <span class="number">0.8</span>,     <span class="number">1.0</span>,     <span class="number">2.2</span>,   <span class="number">279.1</span>,   <span class="number">30.3</span>,  <span class="number">0.00910</span>,      <span class="number">0</span>,     <span class="number">12</span>,    <span class="number">2182</span>,    <span class="number">2266</span>,      <span class="number">59</span>,   <span class="number">16897</span></span><br><span class="line"><span class="number">24</span> threadCount, insert,       <span class="number">754842</span>,   <span class="number">24767</span>,   <span class="number">24767</span>,   <span class="number">33897</span>,     <span class="number">0.8</span>,     <span class="number">0.7</span>,     <span class="number">1.0</span>,     <span class="number">1.5</span>,     <span class="number">4.5</span>,   <span class="number">232.1</span>,   <span class="number">30.5</span>,  <span class="number">0.01926</span>,      <span class="number">0</span>,     <span class="number">13</span>,    <span class="number">2256</span>,    <span class="number">2256</span>,      <span class="number">46</span>,   <span class="number">19254</span></span><br><span class="line"><span class="number">36</span> threadCount, insert,       <span class="number">768148</span>,   <span class="number">25357</span>,   <span class="number">25357</span>,   <span class="number">34689</span>,     <span class="number">1.3</span>,     <span class="number">1.1</span>,     <span class="number">1.5</span>,     <span class="number">2.0</span>,     <span class="number">3.9</span>,   <span class="number">238.5</span>,   <span class="number">30.3</span>,  <span class="number">0.01159</span>,      <span class="number">0</span>,     <span class="number">13</span>,    <span class="number">2095</span>,    <span class="number">2185</span>,      <span class="number">39</span>,   <span class="number">19013</span></span><br><span class="line"><span class="number">54</span> threadCount, insert,       <span class="number">761943</span>,   <span class="number">25102</span>,   <span class="number">25102</span>,   <span class="number">34326</span>,     <span class="number">2.0</span>,     <span class="number">1.7</span>,     <span class="number">2.1</span>,     <span class="number">2.7</span>,    <span class="number">25.4</span>,   <span class="number">263.5</span>,   <span class="number">30.4</span>,  <span class="number">0.01724</span>,      <span class="number">0</span>,     <span class="number">13</span>,    <span class="number">2076</span>,    <span class="number">2152</span>,      <span class="number">38</span>,   <span class="number">19154</span></span><br><span class="line"><span class="number">81</span> threadCount, insert,       <span class="number">755494</span>,   <span class="number">24711</span>,   <span class="number">24711</span>,   <span class="number">33815</span>,     <span class="number">3.2</span>,     <span class="number">2.7</span>,     <span class="number">3.1</span>,     <span class="number">4.1</span>,   <span class="number">148.3</span>,   <span class="number">270.2</span>,   <span class="number">30.6</span>,  <span class="number">0.01210</span>,      <span class="number">0</span>,     <span class="number">13</span>,    <span class="number">2227</span>,    <span class="number">2227</span>,      <span class="number">48</span>,   <span class="number">19182</span></span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line">  <span class="number">4</span> threadCount, insert,       <span class="number">251178</span>,    <span class="number">8245</span>,    <span class="number">8245</span>,   <span class="number">11278</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,     <span class="number">1.0</span>,   <span class="number">274.2</span>,   <span class="number">30.5</span>,  <span class="number">0.00551</span>,      <span class="number">0</span>,      <span class="number">4</span>,     <span class="number">902</span>,     <span class="number">902</span>,      <span class="number">43</span>,    <span class="number">5347</span></span><br><span class="line">  <span class="number">8</span> threadCount, insert,       <span class="number">427090</span>,   <span class="number">13995</span>,   <span class="number">13995</span>,   <span class="number">19119</span>,     <span class="number">0.5</span>,     <span class="number">0.4</span>,     <span class="number">0.7</span>,     <span class="number">0.8</span>,     <span class="number">1.6</span>,   <span class="number">235.4</span>,   <span class="number">30.5</span>,  <span class="number">0.00936</span>,      <span class="number">0</span>,      <span class="number">9</span>,    <span class="number">1557</span>,    <span class="number">1557</span>,      <span class="number">46</span>,   <span class="number">13130</span></span><br><span class="line"> <span class="number">16</span> threadCount, insert,       <span class="number">677353</span>,   <span class="number">22261</span>,   <span class="number">22261</span>,   <span class="number">30444</span>,     <span class="number">0.6</span>,     <span class="number">0.5</span>,     <span class="number">0.8</span>,     <span class="number">1.1</span>,     <span class="number">2.2</span>,   <span class="number">239.3</span>,   <span class="number">30.4</span>,  <span class="number">0.00837</span>,      <span class="number">0</span>,     <span class="number">11</span>,    <span class="number">2080</span>,    <span class="number">2080</span>,      <span class="number">40</span>,   <span class="number">14631</span></span><br><span class="line"> <span class="number">24</span> threadCount, insert,       <span class="number">762573</span>,   <span class="number">24999</span>,   <span class="number">24999</span>,   <span class="number">34192</span>,     <span class="number">0.8</span>,     <span class="number">0.7</span>,     <span class="number">1.0</span>,     <span class="number">1.2</span>,     <span class="number">2.0</span>,   <span class="number">246.0</span>,   <span class="number">30.5</span>,  <span class="number">0.00974</span>,      <span class="number">0</span>,     <span class="number">12</span>,    <span class="number">2131</span>,    <span class="number">2131</span>,      <span class="number">38</span>,   <span class="number">15912</span></span><br><span class="line"> <span class="number">36</span> threadCount, insert,       <span class="number">772075</span>,   <span class="number">25215</span>,   <span class="number">25215</span>,   <span class="number">34509</span>,     <span class="number">1.3</span>,     <span class="number">1.1</span>,     <span class="number">1.5</span>,     <span class="number">2.3</span>,     <span class="number">6.4</span>,   <span class="number">250.1</span>,   <span class="number">30.6</span>,  <span class="number">0.00550</span>,      <span class="number">0</span>,     <span class="number">12</span>,    <span class="number">2149</span>,    <span class="number">2149</span>,      <span class="number">31</span>,   <span class="number">15900</span></span><br><span class="line"> <span class="number">54</span> threadCount, insert,       <span class="number">780249</span>,   <span class="number">25669</span>,   <span class="number">25669</span>,   <span class="number">35082</span>,     <span class="number">2.0</span>,     <span class="number">1.7</span>,     <span class="number">2.1</span>,     <span class="number">2.6</span>,    <span class="number">22.5</span>,   <span class="number">279.1</span>,   <span class="number">30.4</span>,  <span class="number">0.00497</span>,      <span class="number">0</span>,     <span class="number">12</span>,    <span class="number">2358</span>,    <span class="number">2358</span>,      <span class="number">24</span>,   <span class="number">15793</span></span><br><span class="line"> <span class="number">81</span> threadCount, insert,       <span class="number">781505</span>,   <span class="number">25519</span>,   <span class="number">25519</span>,   <span class="number">34884</span>,     <span class="number">3.0</span>,     <span class="number">2.7</span>,     <span class="number">3.1</span>,     <span class="number">4.1</span>,   <span class="number">173.6</span>,   <span class="number">310.7</span>,   <span class="number">30.6</span>,  <span class="number">0.01380</span>,      <span class="number">0</span>,     <span class="number">13</span>,    <span class="number">2137</span>,    <span class="number">2137</span>,      <span class="number">37</span>,   <span class="number">18920</span></span><br><span class="line"><span class="number">121</span> threadCount, insert,       <span class="number">770318</span>,   <span class="number">25009</span>,   <span class="number">25009</span>,   <span class="number">34189</span>,     <span class="number">4.7</span>,     <span class="number">4.0</span>,     <span class="number">4.5</span>,     <span class="number">5.4</span>,   <span class="number">185.7</span>,   <span class="number">277.4</span>,   <span class="number">30.8</span>,  <span class="number">0.01570</span>,      <span class="number">0</span>,     <span class="number">12</span>,    <span class="number">2152</span>,    <span class="number">2152</span>,      <span class="number">36</span>,   <span class="number">15916</span></span><br></pre></td></tr></table></figure>
<p>G1_16G</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line">  <span class="number">4</span> threadCount, insert,       <span class="number">248881</span>,    <span class="number">8178</span>,    <span class="number">8178</span>,   <span class="number">11171</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,     <span class="number">1.1</span>,   <span class="number">373.4</span>,   <span class="number">30.4</span>,  <span class="number">0.01796</span>,      <span class="number">0</span>,      <span class="number">2</span>,     <span class="number">704</span>,     <span class="number">704</span>,      <span class="number">11</span>,    <span class="number">5843</span></span><br><span class="line">  <span class="number">8</span> threadCount, insert,       <span class="number">446173</span>,   <span class="number">14559</span>,   <span class="number">14559</span>,   <span class="number">19911</span>,     <span class="number">0.5</span>,     <span class="number">0.4</span>,     <span class="number">0.7</span>,     <span class="number">0.8</span>,     <span class="number">1.2</span>,   <span class="number">324.8</span>,   <span class="number">30.6</span>,  <span class="number">0.03065</span>,      <span class="number">0</span>,      <span class="number">2</span>,     <span class="number">532</span>,     <span class="number">532</span>,      <span class="number">57</span>,    <span class="number">7486</span></span><br><span class="line"> <span class="number">16</span> threadCount, insert,       <span class="number">690320</span>,   <span class="number">22697</span>,   <span class="number">22697</span>,   <span class="number">31027</span>,     <span class="number">0.6</span>,     <span class="number">0.5</span>,     <span class="number">0.8</span>,     <span class="number">1.0</span>,     <span class="number">2.1</span>,   <span class="number">335.4</span>,   <span class="number">30.4</span>,  <span class="number">0.00967</span>,      <span class="number">0</span>,      <span class="number">4</span>,     <span class="number">937</span>,     <span class="number">937</span>,      <span class="number">74</span>,   <span class="number">14148</span></span><br><span class="line"> <span class="number">24</span> threadCount, insert,       <span class="number">767142</span>,   <span class="number">25009</span>,   <span class="number">25009</span>,   <span class="number">34198</span>,     <span class="number">0.8</span>,     <span class="number">0.7</span>,     <span class="number">1.0</span>,     <span class="number">1.3</span>,     <span class="number">2.9</span>,   <span class="number">450.4</span>,   <span class="number">30.7</span>,  <span class="number">0.01082</span>,      <span class="number">0</span>,      <span class="number">4</span>,    <span class="number">1506</span>,    <span class="number">1506</span>,      <span class="number">68</span>,   <span class="number">18804</span></span><br><span class="line"> <span class="number">36</span> threadCount, insert,       <span class="number">779673</span>,   <span class="number">25765</span>,   <span class="number">25765</span>,   <span class="number">35240</span>,     <span class="number">1.3</span>,     <span class="number">1.1</span>,     <span class="number">1.5</span>,     <span class="number">2.5</span>,    <span class="number">16.4</span>,   <span class="number">284.5</span>,   <span class="number">30.3</span>,  <span class="number">0.01161</span>,      <span class="number">0</span>,      <span class="number">5</span>,    <span class="number">1062</span>,    <span class="number">1062</span>,      <span class="number">43</span>,   <span class="number">14792</span></span><br><span class="line"> <span class="number">54</span> threadCount, insert,       <span class="number">806073</span>,   <span class="number">25927</span>,   <span class="number">25927</span>,   <span class="number">35449</span>,     <span class="number">2.0</span>,     <span class="number">1.7</span>,     <span class="number">2.2</span>,     <span class="number">2.8</span>,     <span class="number">8.2</span>,   <span class="number">466.0</span>,   <span class="number">31.1</span>,  <span class="number">0.00649</span>,      <span class="number">0</span>,      <span class="number">5</span>,    <span class="number">1667</span>,    <span class="number">1667</span>,      <span class="number">87</span>,   <span class="number">18160</span></span><br><span class="line"> <span class="number">81</span> threadCount, insert,       <span class="number">804974</span>,   <span class="number">26236</span>,   <span class="number">26236</span>,   <span class="number">35850</span>,     <span class="number">3.0</span>,     <span class="number">2.7</span>,     <span class="number">3.1</span>,     <span class="number">3.9</span>,    <span class="number">44.3</span>,   <span class="number">539.6</span>,   <span class="number">30.7</span>,  <span class="number">0.00619</span>,      <span class="number">0</span>,      <span class="number">4</span>,    <span class="number">1155</span>,    <span class="number">1155</span>,     <span class="number">155</span>,   <span class="number">15884</span></span><br><span class="line"><span class="number">121</span> threadCount, insert,       <span class="number">767591</span>,   <span class="number">25302</span>,   <span class="number">25302</span>,   <span class="number">34605</span>,     <span class="number">4.7</span>,     <span class="number">4.0</span>,     <span class="number">4.6</span>,     <span class="number">5.4</span>,   <span class="number">111.4</span>,   <span class="number">394.4</span>,   <span class="number">30.3</span>,  <span class="number">0.01340</span>,      <span class="number">0</span>,      <span class="number">6</span>,    <span class="number">1585</span>,    <span class="number">1585</span>,      <span class="number">78</span>,   <span class="number">16745</span></span><br></pre></td></tr></table></figure>
<p>G1_24G</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line">  <span class="number">4</span> threadCount, insert,       <span class="number">257051</span>,    <span class="number">8524</span>,    <span class="number">8524</span>,   <span class="number">11675</span>,     <span class="number">0.4</span>,     <span class="number">0.3</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,     <span class="number">0.9</span>,   <span class="number">224.7</span>,   <span class="number">30.2</span>,  <span class="number">0.00582</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line">  <span class="number">8</span> threadCount, insert,       <span class="number">450270</span>,   <span class="number">14830</span>,   <span class="number">14830</span>,   <span class="number">20289</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,     <span class="number">0.7</span>,     <span class="number">0.8</span>,     <span class="number">1.4</span>,   <span class="number">330.0</span>,   <span class="number">30.4</span>,  <span class="number">0.00674</span>,      <span class="number">0</span>,      <span class="number">1</span>,     <span class="number">327</span>,     <span class="number">327</span>,       <span class="number">0</span>,   <span class="number">13398</span></span><br><span class="line"> <span class="number">16</span> threadCount, insert,       <span class="number">702064</span>,   <span class="number">23078</span>,   <span class="number">23078</span>,   <span class="number">31593</span>,     <span class="number">0.6</span>,     <span class="number">0.5</span>,     <span class="number">0.8</span>,     <span class="number">1.0</span>,     <span class="number">2.0</span>,   <span class="number">401.3</span>,   <span class="number">30.4</span>,  <span class="number">0.00763</span>,      <span class="number">0</span>,      <span class="number">2</span>,     <span class="number">658</span>,     <span class="number">658</span>,      <span class="number">69</span>,   <span class="number">26291</span></span><br><span class="line"> <span class="number">24</span> threadCount, insert,       <span class="number">798352</span>,   <span class="number">26369</span>,   <span class="number">26369</span>,   <span class="number">36088</span>,     <span class="number">0.8</span>,     <span class="number">0.7</span>,     <span class="number">1.0</span>,     <span class="number">1.4</span>,     <span class="number">2.3</span>,   <span class="number">250.0</span>,   <span class="number">30.3</span>,  <span class="number">0.00953</span>,      <span class="number">0</span>,      <span class="number">1</span>,     <span class="number">231</span>,     <span class="number">231</span>,       <span class="number">0</span>,   <span class="number">12944</span></span><br><span class="line"> <span class="number">36</span> threadCount, insert,       <span class="number">824159</span>,   <span class="number">27317</span>,   <span class="number">27317</span>,   <span class="number">37329</span>,     <span class="number">1.2</span>,     <span class="number">1.1</span>,     <span class="number">1.5</span>,     <span class="number">1.9</span>,     <span class="number">3.5</span>,   <span class="number">242.5</span>,   <span class="number">30.2</span>,  <span class="number">0.00507</span>,      <span class="number">0</span>,      <span class="number">2</span>,     <span class="number">248</span>,     <span class="number">248</span>,      <span class="number">44</span>,   <span class="number">27657</span></span><br><span class="line"> <span class="number">54</span> threadCount, insert,       <span class="number">812952</span>,   <span class="number">26948</span>,   <span class="number">26948</span>,   <span class="number">36838</span>,     <span class="number">1.9</span>,     <span class="number">1.7</span>,     <span class="number">2.1</span>,     <span class="number">2.8</span>,     <span class="number">8.7</span>,   <span class="number">235.6</span>,   <span class="number">30.2</span>,  <span class="number">0.00507</span>,      <span class="number">0</span>,      <span class="number">1</span>,     <span class="number">206</span>,     <span class="number">206</span>,       <span class="number">0</span>,   <span class="number">13159</span></span><br><span class="line"> <span class="number">81</span> threadCount, insert,       <span class="number">826216</span>,   <span class="number">27214</span>,   <span class="number">27214</span>,   <span class="number">37200</span>,     <span class="number">2.9</span>,     <span class="number">2.7</span>,     <span class="number">3.1</span>,     <span class="number">4.2</span>,    <span class="number">25.3</span>,   <span class="number">238.6</span>,   <span class="number">30.4</span>,  <span class="number">0.00570</span>,      <span class="number">0</span>,      <span class="number">2</span>,     <span class="number">232</span>,     <span class="number">232</span>,      <span class="number">44</span>,   <span class="number">27827</span></span><br><span class="line"><span class="number">121</span> threadCount, insert,       <span class="number">834614</span>,   <span class="number">27495</span>,   <span class="number">27495</span>,   <span class="number">37594</span>,     <span class="number">4.3</span>,     <span class="number">4.0</span>,     <span class="number">4.5</span>,     <span class="number">5.0</span>,    <span class="number">23.9</span>,   <span class="number">263.9</span>,   <span class="number">30.4</span>,  <span class="number">0.00342</span>,      <span class="number">0</span>,      <span class="number">2</span>,     <span class="number">456</span>,     <span class="number">456</span>,      <span class="number">25</span>,   <span class="number">26020</span></span><br><span class="line"><span class="number">181</span> threadCount, insert,       <span class="number">795024</span>,   <span class="number">25577</span>,   <span class="number">25577</span>,   <span class="number">34996</span>,     <span class="number">6.9</span>,     <span class="number">6.1</span>,     <span class="number">6.7</span>,     <span class="number">7.7</span>,   <span class="number">113.7</span>,   <span class="number">444.3</span>,   <span class="number">31.1</span>,  <span class="number">0.01847</span>,      <span class="number">0</span>,      <span class="number">1</span>,     <span class="number">429</span>,     <span class="number">429</span>,       <span class="number">0</span>,   <span class="number">11326</span></span><br></pre></td></tr></table></figure>
<h4 id="读写混合模式">读写混合模式</h4><p>类似于mixed模式指定读和写的线程数，自定义的ops包括insert和多种查询方式，比如blogpost1.yaml的queries定义了两种查询模式。  </p>
<p>./cassandra-stress user profile=./blogpost1.yaml ops(singlepost=2,timeline=1,insert=1) -node 10.21.21.10 -log file=SINGLENODE8_blog_mixed.log</p>
<p>singlepost的查询是timeline查询和insert写入的两倍，比如查询singlepost次数=71309，写入insert=34965，查询timeline=35761。  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line">  <span class="number">4</span> threadCount, insert,        <span class="number">34965</span>,    <span class="number">1118</span>,    <span class="number">1118</span>,    <span class="number">1528</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,     <span class="number">0.7</span>,     <span class="number">0.8</span>,     <span class="number">1.5</span>,    <span class="number">56.7</span>,   <span class="number">31.3</span>,  <span class="number">0.00905</span>,      <span class="number">0</span>,      <span class="number">8</span>,     <span class="number">413</span>,     <span class="number">413</span>,      <span class="number">32</span>,   <span class="number">12700</span></span><br><span class="line">  <span class="number">4</span> threadCount, singlepost,    <span class="number">71309</span>,    <span class="number">2280</span>,    <span class="number">2166</span>,    <span class="number">2166</span>,     <span class="number">0.9</span>,     <span class="number">1.0</span>,     <span class="number">1.3</span>,     <span class="number">1.4</span>,     <span class="number">2.0</span>,   <span class="number">137.9</span>,   <span class="number">31.3</span>,  <span class="number">0.00905</span>,      <span class="number">0</span>,      <span class="number">8</span>,     <span class="number">413</span>,     <span class="number">413</span>,      <span class="number">32</span>,   <span class="number">12700</span></span><br><span class="line">  <span class="number">4</span> threadCount, timeline,      <span class="number">35761</span>,    <span class="number">1143</span>,    <span class="number">1085</span>,    <span class="number">6727</span>,     <span class="number">1.0</span>,     <span class="number">1.0</span>,     <span class="number">1.4</span>,     <span class="number">1.6</span>,     <span class="number">2.1</span>,   <span class="number">138.0</span>,   <span class="number">31.3</span>,  <span class="number">0.00905</span>,      <span class="number">0</span>,      <span class="number">8</span>,     <span class="number">413</span>,     <span class="number">413</span>,      <span class="number">32</span>,   <span class="number">12700</span></span><br><span class="line">  <span class="number">4</span> threadCount, total,        <span class="number">142035</span>,    <span class="number">4541</span>,    <span class="number">4368</span>,   <span class="number">10420</span>,     <span class="number">0.8</span>,     <span class="number">0.8</span>,     <span class="number">1.3</span>,     <span class="number">1.4</span>,     <span class="number">1.6</span>,   <span class="number">138.0</span>,   <span class="number">31.3</span>,  <span class="number">0.00905</span>,      <span class="number">0</span>,      <span class="number">8</span>,     <span class="number">413</span>,     <span class="number">413</span>,      <span class="number">32</span>,   <span class="number">12700</span></span><br><span class="line">  <span class="number">8</span> threadCount, insert,        <span class="number">67924</span>,    <span class="number">2135</span>,    <span class="number">2135</span>,    <span class="number">2924</span>,     <span class="number">0.5</span>,     <span class="number">0.4</span>,     <span class="number">0.7</span>,     <span class="number">0.9</span>,     <span class="number">3.0</span>,    <span class="number">41.6</span>,   <span class="number">31.8</span>,  <span class="number">0.00592</span>,      <span class="number">0</span>,     <span class="number">13</span>,     <span class="number">477</span>,     <span class="number">477</span>,       <span class="number">2</span>,   <span class="number">20864</span></span><br><span class="line">  <span class="number">8</span> threadCount, singlepost,   <span class="number">137283</span>,    <span class="number">4314</span>,    <span class="number">4098</span>,    <span class="number">4098</span>,     <span class="number">0.9</span>,     <span class="number">1.0</span>,     <span class="number">1.3</span>,     <span class="number">1.5</span>,     <span class="number">1.9</span>,    <span class="number">43.1</span>,   <span class="number">31.8</span>,  <span class="number">0.00592</span>,      <span class="number">0</span>,     <span class="number">13</span>,     <span class="number">477</span>,     <span class="number">477</span>,       <span class="number">2</span>,   <span class="number">20864</span></span><br><span class="line">  <span class="number">8</span> threadCount, timeline,      <span class="number">68781</span>,    <span class="number">2162</span>,    <span class="number">2052</span>,   <span class="number">12863</span>,     <span class="number">1.1</span>,     <span class="number">1.1</span>,     <span class="number">1.5</span>,     <span class="number">1.7</span>,     <span class="number">2.2</span>,    <span class="number">42.2</span>,   <span class="number">31.8</span>,  <span class="number">0.00592</span>,      <span class="number">0</span>,     <span class="number">13</span>,     <span class="number">477</span>,     <span class="number">477</span>,       <span class="number">2</span>,   <span class="number">20864</span></span><br><span class="line">  <span class="number">8</span> threadCount, total,        <span class="number">273988</span>,    <span class="number">8611</span>,    <span class="number">8285</span>,   <span class="number">19885</span>,     <span class="number">0.9</span>,     <span class="number">0.8</span>,     <span class="number">1.4</span>,     <span class="number">1.6</span>,     <span class="number">2.0</span>,    <span class="number">43.1</span>,   <span class="number">31.8</span>,  <span class="number">0.00592</span>,      <span class="number">0</span>,     <span class="number">13</span>,     <span class="number">477</span>,     <span class="number">477</span>,       <span class="number">2</span>,   <span class="number">20864</span></span><br><span class="line"> <span class="number">16</span> threadCount, insert,       <span class="number">120202</span>,    <span class="number">3684</span>,    <span class="number">3684</span>,    <span class="number">5031</span>,     <span class="number">0.6</span>,     <span class="number">0.5</span>,     <span class="number">0.9</span>,     <span class="number">1.1</span>,     <span class="number">1.9</span>,    <span class="number">47.8</span>,   <span class="number">32.6</span>,  <span class="number">0.00506</span>,      <span class="number">0</span>,     <span class="number">22</span>,     <span class="number">872</span>,     <span class="number">872</span>,       <span class="number">3</span>,   <span class="number">35249</span></span><br><span class="line"> <span class="number">16</span> threadCount, singlepost,   <span class="number">238117</span>,    <span class="number">7297</span>,    <span class="number">6947</span>,    <span class="number">6947</span>,     <span class="number">1.1</span>,     <span class="number">1.1</span>,     <span class="number">1.6</span>,     <span class="number">1.9</span>,     <span class="number">4.1</span>,    <span class="number">49.4</span>,   <span class="number">32.6</span>,  <span class="number">0.00506</span>,      <span class="number">0</span>,     <span class="number">22</span>,     <span class="number">872</span>,     <span class="number">872</span>,       <span class="number">3</span>,   <span class="number">35249</span></span><br><span class="line"> <span class="number">16</span> threadCount, timeline,     <span class="number">121167</span>,    <span class="number">3713</span>,    <span class="number">3532</span>,   <span class="number">22654</span>,     <span class="number">1.2</span>,     <span class="number">1.2</span>,     <span class="number">1.8</span>,     <span class="number">2.1</span>,     <span class="number">7.1</span>,    <span class="number">49.0</span>,   <span class="number">32.6</span>,  <span class="number">0.00506</span>,      <span class="number">0</span>,     <span class="number">22</span>,     <span class="number">872</span>,     <span class="number">872</span>,       <span class="number">3</span>,   <span class="number">35249</span></span><br><span class="line"> <span class="number">16</span> threadCount, total,        <span class="number">479486</span>,   <span class="number">14694</span>,   <span class="number">14163</span>,   <span class="number">34631</span>,     <span class="number">1.0</span>,     <span class="number">0.9</span>,     <span class="number">1.6</span>,     <span class="number">1.9</span>,     <span class="number">3.7</span>,    <span class="number">49.4</span>,   <span class="number">32.6</span>,  <span class="number">0.00506</span>,      <span class="number">0</span>,     <span class="number">22</span>,     <span class="number">872</span>,     <span class="number">872</span>,       <span class="number">3</span>,   <span class="number">35249</span></span><br><span class="line"> <span class="number">24</span> threadCount, insert,       <span class="number">155861</span>,    <span class="number">4687</span>,    <span class="number">4687</span>,    <span class="number">6411</span>,     <span class="number">0.7</span>,     <span class="number">0.6</span>,     <span class="number">1.1</span>,     <span class="number">1.8</span>,     <span class="number">7.0</span>,    <span class="number">70.5</span>,   <span class="number">33.3</span>,  <span class="number">0.00541</span>,      <span class="number">0</span>,     <span class="number">29</span>,    <span class="number">1218</span>,    <span class="number">1262</span>,       <span class="number">6</span>,   <span class="number">47967</span></span><br><span class="line"> <span class="number">24</span> threadCount, singlepost,   <span class="number">311426</span>,    <span class="number">9364</span>,    <span class="number">8937</span>,    <span class="number">8937</span>,     <span class="number">1.3</span>,     <span class="number">1.2</span>,     <span class="number">2.0</span>,     <span class="number">2.4</span>,     <span class="number">7.2</span>,    <span class="number">71.7</span>,   <span class="number">33.3</span>,  <span class="number">0.00541</span>,      <span class="number">0</span>,     <span class="number">29</span>,    <span class="number">1218</span>,    <span class="number">1262</span>,       <span class="number">6</span>,   <span class="number">47967</span></span><br><span class="line"> <span class="number">24</span> threadCount, timeline,     <span class="number">156992</span>,    <span class="number">4720</span>,    <span class="number">4502</span>,   <span class="number">29719</span>,     <span class="number">1.5</span>,     <span class="number">1.4</span>,     <span class="number">2.2</span>,     <span class="number">2.6</span>,    <span class="number">42.2</span>,    <span class="number">71.7</span>,   <span class="number">33.3</span>,  <span class="number">0.00541</span>,      <span class="number">0</span>,     <span class="number">29</span>,    <span class="number">1218</span>,    <span class="number">1262</span>,       <span class="number">6</span>,   <span class="number">47967</span></span><br><span class="line"> <span class="number">24</span> threadCount, total,        <span class="number">624279</span>,   <span class="number">18771</span>,   <span class="number">18125</span>,   <span class="number">45066</span>,     <span class="number">1.2</span>,     <span class="number">1.0</span>,     <span class="number">2.0</span>,     <span class="number">2.3</span>,     <span class="number">6.8</span>,    <span class="number">71.7</span>,   <span class="number">33.3</span>,  <span class="number">0.00541</span>,      <span class="number">0</span>,     <span class="number">29</span>,    <span class="number">1218</span>,    <span class="number">1262</span>,       <span class="number">6</span>,   <span class="number">47967</span></span><br><span class="line"> <span class="number">36</span> threadCount, insert,       <span class="number">190266</span>,    <span class="number">5468</span>,    <span class="number">5468</span>,    <span class="number">7489</span>,     <span class="number">1.0</span>,     <span class="number">0.8</span>,     <span class="number">1.9</span>,     <span class="number">2.9</span>,    <span class="number">10.6</span>,   <span class="number">267.7</span>,   <span class="number">34.8</span>,  <span class="number">0.00593</span>,      <span class="number">0</span>,     <span class="number">35</span>,    <span class="number">1226</span>,    <span class="number">1417</span>,       <span class="number">3</span>,   <span class="number">56050</span></span><br><span class="line"> <span class="number">36</span> threadCount, singlepost,   <span class="number">380356</span>,   <span class="number">10930</span>,   <span class="number">10461</span>,   <span class="number">10461</span>,     <span class="number">1.7</span>,     <span class="number">1.5</span>,     <span class="number">2.7</span>,     <span class="number">3.7</span>,    <span class="number">40.5</span>,    <span class="number">57.6</span>,   <span class="number">34.8</span>,  <span class="number">0.00593</span>,      <span class="number">0</span>,     <span class="number">35</span>,    <span class="number">1226</span>,    <span class="number">1417</span>,       <span class="number">3</span>,   <span class="number">56050</span></span><br><span class="line"> <span class="number">36</span> threadCount, timeline,     <span class="number">189548</span>,    <span class="number">5447</span>,    <span class="number">5211</span>,   <span class="number">35642</span>,     <span class="number">1.9</span>,     <span class="number">1.7</span>,     <span class="number">3.0</span>,     <span class="number">4.3</span>,    <span class="number">44.1</span>,    <span class="number">57.1</span>,   <span class="number">34.8</span>,  <span class="number">0.00593</span>,      <span class="number">0</span>,     <span class="number">35</span>,    <span class="number">1226</span>,    <span class="number">1417</span>,       <span class="number">3</span>,   <span class="number">56050</span></span><br><span class="line"> <span class="number">36</span> threadCount, total,        <span class="number">760170</span>,   <span class="number">21844</span>,   <span class="number">21140</span>,   <span class="number">53592</span>,     <span class="number">1.6</span>,     <span class="number">1.3</span>,     <span class="number">2.7</span>,     <span class="number">3.5</span>,     <span class="number">9.4</span>,   <span class="number">267.7</span>,   <span class="number">34.8</span>,  <span class="number">0.00593</span>,      <span class="number">0</span>,     <span class="number">35</span>,    <span class="number">1226</span>,    <span class="number">1417</span>,       <span class="number">3</span>,   <span class="number">56050</span></span><br><span class="line"> <span class="number">54</span> threadCount, insert,       <span class="number">207273</span>,    <span class="number">5642</span>,    <span class="number">5642</span>,    <span class="number">7719</span>,     <span class="number">1.7</span>,     <span class="number">1.2</span>,     <span class="number">3.9</span>,     <span class="number">7.3</span>,    <span class="number">37.8</span>,    <span class="number">56.4</span>,   <span class="number">36.7</span>,  <span class="number">0.00588</span>,      <span class="number">0</span>,     <span class="number">38</span>,    <span class="number">1192</span>,    <span class="number">1503</span>,       <span class="number">2</span>,   <span class="number">60870</span></span><br><span class="line"> <span class="number">54</span> threadCount, singlepost,   <span class="number">416789</span>,   <span class="number">11344</span>,   <span class="number">10897</span>,   <span class="number">10897</span>,     <span class="number">2.4</span>,     <span class="number">2.0</span>,     <span class="number">4.1</span>,     <span class="number">6.7</span>,    <span class="number">42.7</span>,    <span class="number">56.1</span>,   <span class="number">36.7</span>,  <span class="number">0.00588</span>,      <span class="number">0</span>,     <span class="number">38</span>,    <span class="number">1192</span>,    <span class="number">1503</span>,       <span class="number">2</span>,   <span class="number">60870</span></span><br><span class="line"> <span class="number">54</span> threadCount, timeline,     <span class="number">206615</span>,    <span class="number">5624</span>,    <span class="number">5403</span>,   <span class="number">38239</span>,     <span class="number">2.6</span>,     <span class="number">2.3</span>,     <span class="number">4.5</span>,     <span class="number">8.0</span>,    <span class="number">43.6</span>,    <span class="number">55.0</span>,   <span class="number">36.7</span>,  <span class="number">0.00588</span>,      <span class="number">0</span>,     <span class="number">38</span>,    <span class="number">1192</span>,    <span class="number">1503</span>,       <span class="number">2</span>,   <span class="number">60870</span></span><br><span class="line"> <span class="number">54</span> threadCount, total,        <span class="number">830677</span>,   <span class="number">22610</span>,   <span class="number">21942</span>,   <span class="number">56855</span>,     <span class="number">2.3</span>,     <span class="number">1.9</span>,     <span class="number">4.1</span>,     <span class="number">7.1</span>,    <span class="number">42.4</span>,    <span class="number">56.4</span>,   <span class="number">36.7</span>,  <span class="number">0.00588</span>,      <span class="number">0</span>,     <span class="number">38</span>,    <span class="number">1192</span>,    <span class="number">1503</span>,       <span class="number">2</span>,   <span class="number">60870</span></span><br><span class="line"> <span class="number">81</span> threadCount, insert,       <span class="number">224064</span>,    <span class="number">5377</span>,    <span class="number">5377</span>,    <span class="number">7341</span>,     <span class="number">3.2</span>,     <span class="number">2.3</span>,     <span class="number">6.7</span>,    <span class="number">12.7</span>,    <span class="number">50.5</span>,   <span class="number">350.3</span>,   <span class="number">41.7</span>,  <span class="number">0.00879</span>,      <span class="number">0</span>,     <span class="number">44</span>,    <span class="number">1354</span>,    <span class="number">1883</span>,       <span class="number">5</span>,   <span class="number">72225</span></span><br><span class="line"> <span class="number">81</span> threadCount, singlepost,   <span class="number">447717</span>,   <span class="number">10745</span>,   <span class="number">10347</span>,   <span class="number">10347</span>,     <span class="number">3.7</span>,     <span class="number">3.1</span>,     <span class="number">6.4</span>,    <span class="number">11.4</span>,    <span class="number">50.4</span>,   <span class="number">291.2</span>,   <span class="number">41.7</span>,  <span class="number">0.00879</span>,      <span class="number">0</span>,     <span class="number">44</span>,    <span class="number">1354</span>,    <span class="number">1883</span>,       <span class="number">5</span>,   <span class="number">72225</span></span><br><span class="line"> <span class="number">81</span> threadCount, timeline,     <span class="number">224468</span>,    <span class="number">5387</span>,    <span class="number">5188</span>,   <span class="number">37984</span>,     <span class="number">4.0</span>,     <span class="number">3.4</span>,     <span class="number">6.6</span>,    <span class="number">11.3</span>,    <span class="number">50.5</span>,   <span class="number">288.1</span>,   <span class="number">41.7</span>,  <span class="number">0.00879</span>,      <span class="number">0</span>,     <span class="number">44</span>,    <span class="number">1354</span>,    <span class="number">1883</span>,       <span class="number">5</span>,   <span class="number">72225</span></span><br><span class="line"> <span class="number">81</span> threadCount, total,        <span class="number">896249</span>,   <span class="number">21509</span>,   <span class="number">20913</span>,   <span class="number">55672</span>,     <span class="number">3.7</span>,     <span class="number">3.0</span>,     <span class="number">6.4</span>,    <span class="number">10.6</span>,    <span class="number">49.3</span>,   <span class="number">350.3</span>,   <span class="number">41.7</span>,  <span class="number">0.00879</span>,      <span class="number">0</span>,     <span class="number">44</span>,    <span class="number">1354</span>,    <span class="number">1883</span>,       <span class="number">5</span>,   <span class="number">72225</span></span><br><span class="line"><span class="number">121</span> threadCount, insert,       <span class="number">260078</span>,    <span class="number">5322</span>,    <span class="number">5322</span>,    <span class="number">7286</span>,     <span class="number">4.9</span>,     <span class="number">3.8</span>,    <span class="number">11.1</span>,    <span class="number">21.4</span>,    <span class="number">54.6</span>,   <span class="number">166.5</span>,   <span class="number">48.9</span>,  <span class="number">0.00509</span>,      <span class="number">0</span>,     <span class="number">51</span>,    <span class="number">1255</span>,    <span class="number">2034</span>,       <span class="number">2</span>,   <span class="number">81759</span></span><br><span class="line"><span class="number">121</span> threadCount, singlepost,   <span class="number">525682</span>,   <span class="number">10758</span>,   <span class="number">10398</span>,   <span class="number">10398</span>,     <span class="number">5.6</span>,     <span class="number">4.9</span>,     <span class="number">9.5</span>,    <span class="number">15.4</span>,    <span class="number">50.4</span>,   <span class="number">151.7</span>,   <span class="number">48.9</span>,  <span class="number">0.00509</span>,      <span class="number">0</span>,     <span class="number">51</span>,    <span class="number">1255</span>,    <span class="number">2034</span>,       <span class="number">2</span>,   <span class="number">81759</span></span><br><span class="line"><span class="number">121</span> threadCount, timeline,     <span class="number">260886</span>,    <span class="number">5339</span>,    <span class="number">5157</span>,   <span class="number">39078</span>,     <span class="number">5.9</span>,     <span class="number">5.2</span>,     <span class="number">9.9</span>,    <span class="number">17.1</span>,    <span class="number">51.6</span>,   <span class="number">151.7</span>,   <span class="number">48.9</span>,  <span class="number">0.00509</span>,      <span class="number">0</span>,     <span class="number">51</span>,    <span class="number">1255</span>,    <span class="number">2034</span>,       <span class="number">2</span>,   <span class="number">81759</span></span><br><span class="line"><span class="number">121</span> threadCount, total,       <span class="number">1046646</span>,   <span class="number">21419</span>,   <span class="number">20877</span>,   <span class="number">56762</span>,     <span class="number">5.5</span>,     <span class="number">4.8</span>,     <span class="number">9.7</span>,    <span class="number">16.0</span>,    <span class="number">50.6</span>,   <span class="number">166.5</span>,   <span class="number">48.9</span>,  <span class="number">0.00509</span>,      <span class="number">0</span>,     <span class="number">51</span>,    <span class="number">1255</span>,    <span class="number">2034</span>,       <span class="number">2</span>,   <span class="number">81759</span></span><br></pre></td></tr></table></figure>
<p>G1_16G</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line">  <span class="number">4</span> threadCount, insert,        <span class="number">33438</span>,    <span class="number">1048</span>,    <span class="number">1048</span>,    <span class="number">1436</span>,     <span class="number">0.5</span>,     <span class="number">0.4</span>,     <span class="number">0.7</span>,     <span class="number">0.9</span>,    <span class="number">11.6</span>,   <span class="number">276.4</span>,   <span class="number">31.9</span>,  <span class="number">0.00995</span>,      <span class="number">0</span>,      <span class="number">1</span>,     <span class="number">274</span>,     <span class="number">274</span>,       <span class="number">0</span>,    <span class="number">8124</span></span><br><span class="line">  <span class="number">4</span> threadCount, singlepost,    <span class="number">66170</span>,    <span class="number">2074</span>,    <span class="number">2007</span>,    <span class="number">2007</span>,     <span class="number">1.0</span>,     <span class="number">1.0</span>,     <span class="number">1.3</span>,     <span class="number">1.4</span>,     <span class="number">1.8</span>,   <span class="number">277.3</span>,   <span class="number">31.9</span>,  <span class="number">0.00995</span>,      <span class="number">0</span>,      <span class="number">1</span>,     <span class="number">274</span>,     <span class="number">274</span>,       <span class="number">0</span>,    <span class="number">8124</span></span><br><span class="line">  <span class="number">4</span> threadCount, timeline,      <span class="number">33241</span>,    <span class="number">1042</span>,    <span class="number">1008</span>,    <span class="number">7133</span>,     <span class="number">1.1</span>,     <span class="number">1.1</span>,     <span class="number">1.5</span>,     <span class="number">1.6</span>,     <span class="number">2.1</span>,    <span class="number">11.0</span>,   <span class="number">31.9</span>,  <span class="number">0.00995</span>,      <span class="number">0</span>,      <span class="number">1</span>,     <span class="number">274</span>,     <span class="number">274</span>,       <span class="number">0</span>,    <span class="number">8124</span></span><br><span class="line">  <span class="number">4</span> threadCount, total,        <span class="number">132849</span>,    <span class="number">4164</span>,    <span class="number">4063</span>,   <span class="number">10576</span>,     <span class="number">0.9</span>,     <span class="number">0.9</span>,     <span class="number">1.3</span>,     <span class="number">1.5</span>,     <span class="number">1.9</span>,   <span class="number">277.3</span>,   <span class="number">31.9</span>,  <span class="number">0.00995</span>,      <span class="number">0</span>,      <span class="number">1</span>,     <span class="number">274</span>,     <span class="number">274</span>,       <span class="number">0</span>,    <span class="number">8124</span></span><br><span class="line">  <span class="number">8</span> threadCount, insert,        <span class="number">61953</span>,    <span class="number">1927</span>,    <span class="number">1927</span>,    <span class="number">2635</span>,     <span class="number">0.5</span>,     <span class="number">0.4</span>,     <span class="number">0.8</span>,     <span class="number">0.9</span>,    <span class="number">11.2</span>,   <span class="number">235.4</span>,   <span class="number">32.1</span>,  <span class="number">0.02825</span>,      <span class="number">0</span>,      <span class="number">3</span>,     <span class="number">700</span>,     <span class="number">700</span>,       <span class="number">0</span>,   <span class="number">24313</span></span><br><span class="line">  <span class="number">8</span> threadCount, singlepost,   <span class="number">124181</span>,    <span class="number">3863</span>,    <span class="number">3742</span>,    <span class="number">3742</span>,     <span class="number">1.1</span>,     <span class="number">1.1</span>,     <span class="number">1.4</span>,     <span class="number">1.5</span>,     <span class="number">2.1</span>,   <span class="number">236.5</span>,   <span class="number">32.1</span>,  <span class="number">0.02825</span>,      <span class="number">0</span>,      <span class="number">3</span>,     <span class="number">700</span>,     <span class="number">700</span>,       <span class="number">0</span>,   <span class="number">24313</span></span><br><span class="line">  <span class="number">8</span> threadCount, timeline,      <span class="number">61760</span>,    <span class="number">1921</span>,    <span class="number">1859</span>,   <span class="number">13300</span>,     <span class="number">1.2</span>,     <span class="number">1.2</span>,     <span class="number">1.6</span>,     <span class="number">1.8</span>,     <span class="number">2.3</span>,   <span class="number">236.6</span>,   <span class="number">32.1</span>,  <span class="number">0.02825</span>,      <span class="number">0</span>,      <span class="number">3</span>,     <span class="number">700</span>,     <span class="number">700</span>,       <span class="number">0</span>,   <span class="number">24313</span></span><br><span class="line">  <span class="number">8</span> threadCount, total,        <span class="number">247894</span>,    <span class="number">7712</span>,    <span class="number">7529</span>,   <span class="number">19677</span>,     <span class="number">1.0</span>,     <span class="number">1.0</span>,     <span class="number">1.4</span>,     <span class="number">1.6</span>,     <span class="number">2.3</span>,   <span class="number">236.6</span>,   <span class="number">32.1</span>,  <span class="number">0.02825</span>,      <span class="number">0</span>,      <span class="number">3</span>,     <span class="number">700</span>,     <span class="number">700</span>,       <span class="number">0</span>,   <span class="number">24313</span></span><br><span class="line"> <span class="number">16</span> threadCount, insert,       <span class="number">106968</span>,    <span class="number">3253</span>,    <span class="number">3253</span>,    <span class="number">4444</span>,     <span class="number">0.6</span>,     <span class="number">0.5</span>,     <span class="number">0.9</span>,     <span class="number">1.3</span>,     <span class="number">2.2</span>,   <span class="number">243.6</span>,   <span class="number">32.9</span>,  <span class="number">0.01511</span>,      <span class="number">0</span>,      <span class="number">4</span>,     <span class="number">936</span>,     <span class="number">936</span>,       <span class="number">8</span>,   <span class="number">30098</span></span><br><span class="line"> <span class="number">16</span> threadCount, singlepost,   <span class="number">215904</span>,    <span class="number">6566</span>,    <span class="number">6368</span>,    <span class="number">6368</span>,     <span class="number">1.3</span>,     <span class="number">1.2</span>,     <span class="number">1.7</span>,     <span class="number">2.0</span>,     <span class="number">2.9</span>,   <span class="number">252.0</span>,   <span class="number">32.9</span>,  <span class="number">0.01511</span>,      <span class="number">0</span>,      <span class="number">4</span>,     <span class="number">936</span>,     <span class="number">936</span>,       <span class="number">8</span>,   <span class="number">30098</span></span><br><span class="line"> <span class="number">16</span> threadCount, timeline,     <span class="number">106719</span>,    <span class="number">3246</span>,    <span class="number">3149</span>,   <span class="number">22826</span>,     <span class="number">1.4</span>,     <span class="number">1.4</span>,     <span class="number">1.9</span>,     <span class="number">2.2</span>,     <span class="number">3.4</span>,   <span class="number">245.1</span>,   <span class="number">32.9</span>,  <span class="number">0.01511</span>,      <span class="number">0</span>,      <span class="number">4</span>,     <span class="number">936</span>,     <span class="number">936</span>,       <span class="number">8</span>,   <span class="number">30098</span></span><br><span class="line"> <span class="number">16</span> threadCount, total,        <span class="number">429591</span>,   <span class="number">13065</span>,   <span class="number">12770</span>,   <span class="number">33638</span>,     <span class="number">1.1</span>,     <span class="number">1.1</span>,     <span class="number">1.7</span>,     <span class="number">2.0</span>,     <span class="number">2.6</span>,   <span class="number">252.0</span>,   <span class="number">32.9</span>,  <span class="number">0.01511</span>,      <span class="number">0</span>,      <span class="number">4</span>,     <span class="number">936</span>,     <span class="number">936</span>,       <span class="number">8</span>,   <span class="number">30098</span></span><br><span class="line"> <span class="number">24</span> threadCount, insert,       <span class="number">140739</span>,    <span class="number">4170</span>,    <span class="number">4170</span>,    <span class="number">5704</span>,     <span class="number">0.7</span>,     <span class="number">0.6</span>,     <span class="number">1.3</span>,     <span class="number">1.9</span>,    <span class="number">12.9</span>,   <span class="number">220.6</span>,   <span class="number">33.7</span>,  <span class="number">0.01478</span>,      <span class="number">0</span>,      <span class="number">7</span>,    <span class="number">1334</span>,    <span class="number">1334</span>,      <span class="number">13</span>,   <span class="number">47280</span></span><br><span class="line"> <span class="number">24</span> threadCount, singlepost,   <span class="number">281951</span>,    <span class="number">8355</span>,    <span class="number">8115</span>,    <span class="number">8115</span>,     <span class="number">1.5</span>,     <span class="number">1.4</span>,     <span class="number">2.0</span>,     <span class="number">2.5</span>,     <span class="number">4.8</span>,   <span class="number">220.0</span>,   <span class="number">33.7</span>,  <span class="number">0.01478</span>,      <span class="number">0</span>,      <span class="number">7</span>,    <span class="number">1334</span>,    <span class="number">1334</span>,      <span class="number">13</span>,   <span class="number">47280</span></span><br><span class="line"> <span class="number">24</span> threadCount, timeline,     <span class="number">140441</span>,    <span class="number">4162</span>,    <span class="number">4038</span>,   <span class="number">29866</span>,     <span class="number">1.7</span>,     <span class="number">1.6</span>,     <span class="number">2.3</span>,     <span class="number">2.8</span>,     <span class="number">6.7</span>,   <span class="number">219.8</span>,   <span class="number">33.7</span>,  <span class="number">0.01478</span>,      <span class="number">0</span>,      <span class="number">7</span>,    <span class="number">1334</span>,    <span class="number">1334</span>,      <span class="number">13</span>,   <span class="number">47280</span></span><br><span class="line"> <span class="number">24</span> threadCount, total,        <span class="number">563131</span>,   <span class="number">16686</span>,   <span class="number">16323</span>,   <span class="number">43684</span>,     <span class="number">1.3</span>,     <span class="number">1.3</span>,     <span class="number">2.0</span>,     <span class="number">2.4</span>,     <span class="number">4.5</span>,   <span class="number">220.6</span>,   <span class="number">33.7</span>,  <span class="number">0.01478</span>,      <span class="number">0</span>,      <span class="number">7</span>,    <span class="number">1334</span>,    <span class="number">1334</span>,      <span class="number">13</span>,   <span class="number">47280</span></span><br><span class="line"> <span class="number">36</span> threadCount, insert,       <span class="number">159910</span>,    <span class="number">4489</span>,    <span class="number">4489</span>,    <span class="number">6153</span>,     <span class="number">1.2</span>,     <span class="number">0.8</span>,     <span class="number">2.4</span>,     <span class="number">4.0</span>,     <span class="number">9.1</span>,   <span class="number">257.0</span>,   <span class="number">35.6</span>,  <span class="number">0.01898</span>,      <span class="number">0</span>,      <span class="number">9</span>,    <span class="number">1717</span>,    <span class="number">1717</span>,       <span class="number">8</span>,   <span class="number">50212</span></span><br><span class="line"> <span class="number">36</span> threadCount, singlepost,   <span class="number">320744</span>,    <span class="number">9005</span>,    <span class="number">8751</span>,    <span class="number">8751</span>,     <span class="number">2.0</span>,     <span class="number">1.8</span>,     <span class="number">3.1</span>,     <span class="number">4.6</span>,    <span class="number">11.0</span>,   <span class="number">226.2</span>,   <span class="number">35.6</span>,  <span class="number">0.01898</span>,      <span class="number">0</span>,      <span class="number">9</span>,    <span class="number">1717</span>,    <span class="number">1717</span>,       <span class="number">8</span>,   <span class="number">50212</span></span><br><span class="line"> <span class="number">36</span> threadCount, timeline,     <span class="number">160623</span>,    <span class="number">4509</span>,    <span class="number">4382</span>,   <span class="number">33117</span>,     <span class="number">2.3</span>,     <span class="number">2.0</span>,     <span class="number">3.4</span>,     <span class="number">5.3</span>,    <span class="number">10.1</span>,   <span class="number">211.6</span>,   <span class="number">35.6</span>,  <span class="number">0.01898</span>,      <span class="number">0</span>,      <span class="number">9</span>,    <span class="number">1717</span>,    <span class="number">1717</span>,       <span class="number">8</span>,   <span class="number">50212</span></span><br><span class="line"> <span class="number">36</span> threadCount, total,        <span class="number">641277</span>,   <span class="number">18003</span>,   <span class="number">17622</span>,   <span class="number">48021</span>,     <span class="number">1.9</span>,     <span class="number">1.7</span>,     <span class="number">3.1</span>,     <span class="number">4.7</span>,    <span class="number">10.8</span>,   <span class="number">257.0</span>,   <span class="number">35.6</span>,  <span class="number">0.01898</span>,      <span class="number">0</span>,      <span class="number">9</span>,    <span class="number">1717</span>,    <span class="number">1717</span>,       <span class="number">8</span>,   <span class="number">50212</span></span><br><span class="line"> <span class="number">54</span> threadCount, insert,       <span class="number">184306</span>,    <span class="number">4527</span>,    <span class="number">4527</span>,    <span class="number">6189</span>,     <span class="number">2.2</span>,     <span class="number">1.6</span>,     <span class="number">4.6</span>,     <span class="number">8.4</span>,    <span class="number">22.7</span>,   <span class="number">234.8</span>,   <span class="number">40.7</span>,  <span class="number">0.01920</span>,      <span class="number">0</span>,     <span class="number">13</span>,    <span class="number">2092</span>,    <span class="number">2212</span>,      <span class="number">39</span>,   <span class="number">58141</span></span><br><span class="line"> <span class="number">54</span> threadCount, singlepost,   <span class="number">365911</span>,    <span class="number">8988</span>,    <span class="number">8744</span>,    <span class="number">8744</span>,     <span class="number">3.1</span>,     <span class="number">2.5</span>,     <span class="number">5.0</span>,     <span class="number">8.2</span>,    <span class="number">17.6</span>,   <span class="number">237.7</span>,   <span class="number">40.7</span>,  <span class="number">0.01920</span>,      <span class="number">0</span>,     <span class="number">13</span>,    <span class="number">2092</span>,    <span class="number">2212</span>,      <span class="number">39</span>,   <span class="number">58141</span></span><br><span class="line"> <span class="number">54</span> threadCount, timeline,     <span class="number">182207</span>,    <span class="number">4476</span>,    <span class="number">4356</span>,   <span class="number">33754</span>,     <span class="number">3.3</span>,     <span class="number">2.8</span>,     <span class="number">5.3</span>,     <span class="number">8.4</span>,    <span class="number">18.1</span>,   <span class="number">237.4</span>,   <span class="number">40.7</span>,  <span class="number">0.01920</span>,      <span class="number">0</span>,     <span class="number">13</span>,    <span class="number">2092</span>,    <span class="number">2212</span>,      <span class="number">39</span>,   <span class="number">58141</span></span><br><span class="line"> <span class="number">54</span> threadCount, total,        <span class="number">732424</span>,   <span class="number">17991</span>,   <span class="number">17627</span>,   <span class="number">48687</span>,     <span class="number">2.9</span>,     <span class="number">2.4</span>,     <span class="number">5.0</span>,     <span class="number">8.3</span>,    <span class="number">20.4</span>,   <span class="number">237.7</span>,   <span class="number">40.7</span>,  <span class="number">0.01920</span>,      <span class="number">0</span>,     <span class="number">13</span>,    <span class="number">2092</span>,    <span class="number">2212</span>,      <span class="number">39</span>,   <span class="number">58141</span></span><br><span class="line"> <span class="number">81</span> threadCount, insert,       <span class="number">198077</span>,    <span class="number">4603</span>,    <span class="number">4603</span>,    <span class="number">6296</span>,     <span class="number">3.6</span>,     <span class="number">2.8</span>,     <span class="number">7.0</span>,    <span class="number">11.9</span>,    <span class="number">25.0</span>,   <span class="number">282.6</span>,   <span class="number">43.0</span>,  <span class="number">0.01447</span>,      <span class="number">0</span>,      <span class="number">7</span>,    <span class="number">1702</span>,    <span class="number">1702</span>,      <span class="number">17</span>,   <span class="number">61791</span></span><br><span class="line"> <span class="number">81</span> threadCount, singlepost,   <span class="number">392856</span>,    <span class="number">9129</span>,    <span class="number">8895</span>,    <span class="number">8895</span>,     <span class="number">4.5</span>,     <span class="number">3.9</span>,     <span class="number">7.5</span>,    <span class="number">11.9</span>,    <span class="number">25.4</span>,   <span class="number">282.4</span>,   <span class="number">43.0</span>,  <span class="number">0.01447</span>,      <span class="number">0</span>,      <span class="number">7</span>,    <span class="number">1702</span>,    <span class="number">1702</span>,      <span class="number">17</span>,   <span class="number">61791</span></span><br><span class="line"> <span class="number">81</span> threadCount, timeline,     <span class="number">197187</span>,    <span class="number">4582</span>,    <span class="number">4466</span>,   <span class="number">35435</span>,     <span class="number">4.8</span>,     <span class="number">4.2</span>,     <span class="number">7.7</span>,    <span class="number">12.2</span>,    <span class="number">27.2</span>,   <span class="number">282.0</span>,   <span class="number">43.0</span>,  <span class="number">0.01447</span>,      <span class="number">0</span>,      <span class="number">7</span>,    <span class="number">1702</span>,    <span class="number">1702</span>,      <span class="number">17</span>,   <span class="number">61791</span></span><br><span class="line"> <span class="number">81</span> threadCount, total,        <span class="number">788120</span>,   <span class="number">18315</span>,   <span class="number">17964</span>,   <span class="number">50626</span>,     <span class="number">4.3</span>,     <span class="number">3.8</span>,     <span class="number">7.5</span>,    <span class="number">12.0</span>,    <span class="number">26.4</span>,   <span class="number">282.6</span>,   <span class="number">43.0</span>,  <span class="number">0.01447</span>,      <span class="number">0</span>,      <span class="number">7</span>,    <span class="number">1702</span>,    <span class="number">1702</span>,      <span class="number">17</span>,   <span class="number">61791</span></span><br><span class="line"><span class="number">121</span> threadCount, insert,       <span class="number">233633</span>,    <span class="number">4512</span>,    <span class="number">4512</span>,    <span class="number">6159</span>,     <span class="number">5.5</span>,     <span class="number">4.3</span>,    <span class="number">11.0</span>,    <span class="number">18.8</span>,    <span class="number">42.2</span>,   <span class="number">352.3</span>,   <span class="number">51.8</span>,  <span class="number">0.01403</span>,      <span class="number">0</span>,     <span class="number">10</span>,    <span class="number">2035</span>,    <span class="number">2035</span>,      <span class="number">13</span>,   <span class="number">83812</span></span><br><span class="line"><span class="number">121</span> threadCount, singlepost,   <span class="number">473282</span>,    <span class="number">9140</span>,    <span class="number">8922</span>,    <span class="number">8922</span>,     <span class="number">6.8</span>,     <span class="number">6.0</span>,    <span class="number">10.7</span>,    <span class="number">16.3</span>,   <span class="number">171.5</span>,   <span class="number">253.0</span>,   <span class="number">51.8</span>,  <span class="number">0.01403</span>,      <span class="number">0</span>,     <span class="number">10</span>,    <span class="number">2035</span>,    <span class="number">2035</span>,      <span class="number">13</span>,   <span class="number">83812</span></span><br><span class="line"><span class="number">121</span> threadCount, timeline,     <span class="number">236412</span>,    <span class="number">4566</span>,    <span class="number">4455</span>,   <span class="number">36174</span>,     <span class="number">7.1</span>,     <span class="number">6.4</span>,    <span class="number">11.5</span>,    <span class="number">17.6</span>,   <span class="number">197.3</span>,   <span class="number">256.9</span>,   <span class="number">51.8</span>,  <span class="number">0.01403</span>,      <span class="number">0</span>,     <span class="number">10</span>,    <span class="number">2035</span>,    <span class="number">2035</span>,      <span class="number">13</span>,   <span class="number">83812</span></span><br><span class="line"><span class="number">121</span> threadCount, total,        <span class="number">943327</span>,   <span class="number">18218</span>,   <span class="number">17889</span>,   <span class="number">51255</span>,     <span class="number">6.5</span>,     <span class="number">5.8</span>,    <span class="number">10.9</span>,    <span class="number">17.2</span>,   <span class="number">186.2</span>,   <span class="number">352.3</span>,   <span class="number">51.8</span>,  <span class="number">0.01403</span>,      <span class="number">0</span>,     <span class="number">10</span>,    <span class="number">2035</span>,    <span class="number">2035</span>,      <span class="number">13</span>,   <span class="number">83812</span></span><br><span class="line"><span class="number">181</span> threadCount, insert,       <span class="number">283444</span>,    <span class="number">4539</span>,    <span class="number">4539</span>,    <span class="number">6209</span>,     <span class="number">6.8</span>,     <span class="number">4.2</span>,    <span class="number">14.1</span>,    <span class="number">20.9</span>,   <span class="number">140.7</span>,   <span class="number">237.1</span>,   <span class="number">62.4</span>,  <span class="number">0.01059</span>,      <span class="number">0</span>,     <span class="number">14</span>,    <span class="number">2545</span>,    <span class="number">2545</span>,      <span class="number">13</span>,   <span class="number">92851</span></span><br><span class="line"><span class="number">181</span> threadCount, singlepost,   <span class="number">567229</span>,    <span class="number">9083</span>,    <span class="number">8880</span>,    <span class="number">8880</span>,    <span class="number">10.7</span>,    <span class="number">10.0</span>,    <span class="number">16.5</span>,    <span class="number">24.0</span>,   <span class="number">194.7</span>,   <span class="number">235.9</span>,   <span class="number">62.4</span>,  <span class="number">0.01059</span>,      <span class="number">0</span>,     <span class="number">14</span>,    <span class="number">2545</span>,    <span class="number">2545</span>,      <span class="number">13</span>,   <span class="number">92851</span></span><br><span class="line"><span class="number">181</span> threadCount, timeline,     <span class="number">283462</span>,    <span class="number">4539</span>,    <span class="number">4437</span>,   <span class="number">36966</span>,    <span class="number">11.1</span>,    <span class="number">10.3</span>,    <span class="number">16.7</span>,    <span class="number">23.2</span>,   <span class="number">181.4</span>,   <span class="number">235.7</span>,   <span class="number">62.4</span>,  <span class="number">0.01059</span>,      <span class="number">0</span>,     <span class="number">14</span>,    <span class="number">2545</span>,    <span class="number">2545</span>,      <span class="number">13</span>,   <span class="number">92851</span></span><br><span class="line"><span class="number">181</span> threadCount, total,       <span class="number">1134135</span>,   <span class="number">18162</span>,   <span class="number">17856</span>,   <span class="number">52054</span>,     <span class="number">9.8</span>,     <span class="number">9.7</span>,    <span class="number">16.0</span>,    <span class="number">23.3</span>,   <span class="number">187.3</span>,   <span class="number">237.1</span>,   <span class="number">62.4</span>,  <span class="number">0.01059</span>,      <span class="number">0</span>,     <span class="number">14</span>,    <span class="number">2545</span>,    <span class="number">2545</span>,      <span class="number">13</span>,   <span class="number">92851</span></span><br></pre></td></tr></table></figure>
<p>G1_24G</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line">  <span class="number">4</span> threadCount, insert,        <span class="number">29865</span>,     <span class="number">941</span>,     <span class="number">941</span>,    <span class="number">1288</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,     <span class="number">0.7</span>,     <span class="number">0.9</span>,     <span class="number">1.3</span>,    <span class="number">24.0</span>,   <span class="number">31.7</span>,  <span class="number">0.01344</span>,      <span class="number">0</span>,      <span class="number">1</span>,     <span class="number">189</span>,     <span class="number">189</span>,       <span class="number">0</span>,   <span class="number">13616</span></span><br><span class="line">  <span class="number">4</span> threadCount, singlepost,    <span class="number">58981</span>,    <span class="number">1858</span>,    <span class="number">1817</span>,    <span class="number">1817</span>,     <span class="number">1.1</span>,     <span class="number">1.1</span>,     <span class="number">1.4</span>,     <span class="number">1.6</span>,     <span class="number">1.9</span>,   <span class="number">192.1</span>,   <span class="number">31.7</span>,  <span class="number">0.01344</span>,      <span class="number">0</span>,      <span class="number">1</span>,     <span class="number">189</span>,     <span class="number">189</span>,       <span class="number">0</span>,   <span class="number">13616</span></span><br><span class="line">  <span class="number">4</span> threadCount, timeline,      <span class="number">29198</span>,     <span class="number">920</span>,     <span class="number">902</span>,    <span class="number">7072</span>,     <span class="number">1.3</span>,     <span class="number">1.3</span>,     <span class="number">1.6</span>,     <span class="number">1.8</span>,     <span class="number">2.2</span>,   <span class="number">192.1</span>,   <span class="number">31.7</span>,  <span class="number">0.01344</span>,      <span class="number">0</span>,      <span class="number">1</span>,     <span class="number">189</span>,     <span class="number">189</span>,       <span class="number">0</span>,   <span class="number">13616</span></span><br><span class="line">  <span class="number">4</span> threadCount, total,        <span class="number">118044</span>,    <span class="number">3718</span>,    <span class="number">3660</span>,   <span class="number">10177</span>,     <span class="number">1.0</span>,     <span class="number">1.1</span>,     <span class="number">1.5</span>,     <span class="number">1.7</span>,     <span class="number">1.9</span>,   <span class="number">192.1</span>,   <span class="number">31.7</span>,  <span class="number">0.01344</span>,      <span class="number">0</span>,      <span class="number">1</span>,     <span class="number">189</span>,     <span class="number">189</span>,       <span class="number">0</span>,   <span class="number">13616</span></span><br><span class="line">  <span class="number">8</span> threadCount, insert,        <span class="number">54546</span>,    <span class="number">1708</span>,    <span class="number">1708</span>,    <span class="number">2333</span>,     <span class="number">0.5</span>,     <span class="number">0.4</span>,     <span class="number">0.8</span>,     <span class="number">1.0</span>,     <span class="number">2.3</span>,   <span class="number">239.1</span>,   <span class="number">31.9</span>,  <span class="number">0.01014</span>,      <span class="number">0</span>,      <span class="number">2</span>,     <span class="number">396</span>,     <span class="number">396</span>,      <span class="number">33</span>,   <span class="number">27244</span></span><br><span class="line">  <span class="number">8</span> threadCount, singlepost,   <span class="number">108726</span>,    <span class="number">3404</span>,    <span class="number">3333</span>,    <span class="number">3333</span>,     <span class="number">1.2</span>,     <span class="number">1.2</span>,     <span class="number">1.5</span>,     <span class="number">1.7</span>,     <span class="number">2.2</span>,   <span class="number">243.7</span>,   <span class="number">31.9</span>,  <span class="number">0.01014</span>,      <span class="number">0</span>,      <span class="number">2</span>,     <span class="number">396</span>,     <span class="number">396</span>,      <span class="number">33</span>,   <span class="number">27244</span></span><br><span class="line">  <span class="number">8</span> threadCount, timeline,      <span class="number">55449</span>,    <span class="number">1736</span>,    <span class="number">1698</span>,   <span class="number">13427</span>,     <span class="number">1.4</span>,     <span class="number">1.4</span>,     <span class="number">1.8</span>,     <span class="number">2.0</span>,     <span class="number">2.4</span>,   <span class="number">240.1</span>,   <span class="number">31.9</span>,  <span class="number">0.01014</span>,      <span class="number">0</span>,      <span class="number">2</span>,     <span class="number">396</span>,     <span class="number">396</span>,      <span class="number">33</span>,   <span class="number">27244</span></span><br><span class="line">  <span class="number">8</span> threadCount, total,        <span class="number">218721</span>,    <span class="number">6847</span>,    <span class="number">6738</span>,   <span class="number">19092</span>,     <span class="number">1.1</span>,     <span class="number">1.2</span>,     <span class="number">1.6</span>,     <span class="number">1.8</span>,     <span class="number">2.4</span>,   <span class="number">243.7</span>,   <span class="number">31.9</span>,  <span class="number">0.01014</span>,      <span class="number">0</span>,      <span class="number">2</span>,     <span class="number">396</span>,     <span class="number">396</span>,      <span class="number">33</span>,   <span class="number">27244</span></span><br><span class="line"> <span class="number">16</span> threadCount, insert,        <span class="number">95384</span>,    <span class="number">2838</span>,    <span class="number">2838</span>,    <span class="number">3885</span>,     <span class="number">0.6</span>,     <span class="number">0.5</span>,     <span class="number">1.0</span>,     <span class="number">1.6</span>,     <span class="number">8.5</span>,   <span class="number">294.3</span>,   <span class="number">33.6</span>,  <span class="number">0.01193</span>,      <span class="number">0</span>,      <span class="number">3</span>,     <span class="number">721</span>,     <span class="number">721</span>,      <span class="number">37</span>,   <span class="number">40601</span></span><br><span class="line"> <span class="number">16</span> threadCount, singlepost,   <span class="number">192030</span>,    <span class="number">5714</span>,    <span class="number">5599</span>,    <span class="number">5599</span>,     <span class="number">1.5</span>,     <span class="number">1.4</span>,     <span class="number">1.9</span>,     <span class="number">2.3</span>,     <span class="number">3.1</span>,   <span class="number">296.1</span>,   <span class="number">33.6</span>,  <span class="number">0.01193</span>,      <span class="number">0</span>,      <span class="number">3</span>,     <span class="number">721</span>,     <span class="number">721</span>,      <span class="number">37</span>,   <span class="number">40601</span></span><br><span class="line"> <span class="number">16</span> threadCount, timeline,      <span class="number">96518</span>,    <span class="number">2872</span>,    <span class="number">2813</span>,   <span class="number">22426</span>,     <span class="number">1.7</span>,     <span class="number">1.6</span>,     <span class="number">2.1</span>,     <span class="number">2.5</span>,     <span class="number">3.6</span>,   <span class="number">295.6</span>,   <span class="number">33.6</span>,  <span class="number">0.01193</span>,      <span class="number">0</span>,      <span class="number">3</span>,     <span class="number">721</span>,     <span class="number">721</span>,      <span class="number">37</span>,   <span class="number">40601</span></span><br><span class="line"> <span class="number">16</span> threadCount, total,        <span class="number">383932</span>,   <span class="number">11424</span>,   <span class="number">11249</span>,   <span class="number">31909</span>,     <span class="number">1.3</span>,     <span class="number">1.4</span>,     <span class="number">1.9</span>,     <span class="number">2.2</span>,     <span class="number">3.0</span>,   <span class="number">296.1</span>,   <span class="number">33.6</span>,  <span class="number">0.01193</span>,      <span class="number">0</span>,      <span class="number">3</span>,     <span class="number">721</span>,     <span class="number">721</span>,      <span class="number">37</span>,   <span class="number">40601</span></span><br><span class="line"> <span class="number">24</span> threadCount, insert,       <span class="number">123912</span>,    <span class="number">3595</span>,    <span class="number">3595</span>,    <span class="number">4927</span>,     <span class="number">0.8</span>,     <span class="number">0.6</span>,     <span class="number">1.5</span>,     <span class="number">2.1</span>,     <span class="number">4.4</span>,   <span class="number">286.7</span>,   <span class="number">34.5</span>,  <span class="number">0.01224</span>,      <span class="number">0</span>,      <span class="number">4</span>,     <span class="number">990</span>,     <span class="number">990</span>,      <span class="number">20</span>,   <span class="number">53495</span></span><br><span class="line"> <span class="number">24</span> threadCount, singlepost,   <span class="number">244685</span>,    <span class="number">7099</span>,    <span class="number">6955</span>,    <span class="number">6955</span>,     <span class="number">1.8</span>,     <span class="number">1.7</span>,     <span class="number">2.4</span>,     <span class="number">3.0</span>,     <span class="number">4.8</span>,   <span class="number">285.4</span>,   <span class="number">34.5</span>,  <span class="number">0.01224</span>,      <span class="number">0</span>,      <span class="number">4</span>,     <span class="number">990</span>,     <span class="number">990</span>,      <span class="number">20</span>,   <span class="number">53495</span></span><br><span class="line"> <span class="number">24</span> threadCount, timeline,     <span class="number">122475</span>,    <span class="number">3553</span>,    <span class="number">3485</span>,   <span class="number">28206</span>,     <span class="number">2.0</span>,     <span class="number">1.9</span>,     <span class="number">2.7</span>,     <span class="number">3.3</span>,     <span class="number">7.0</span>,   <span class="number">284.8</span>,   <span class="number">34.5</span>,  <span class="number">0.01224</span>,      <span class="number">0</span>,      <span class="number">4</span>,     <span class="number">990</span>,     <span class="number">990</span>,      <span class="number">20</span>,   <span class="number">53495</span></span><br><span class="line"> <span class="number">24</span> threadCount, total,        <span class="number">491072</span>,   <span class="number">14248</span>,   <span class="number">14035</span>,   <span class="number">40087</span>,     <span class="number">1.6</span>,     <span class="number">1.6</span>,     <span class="number">2.4</span>,     <span class="number">3.0</span>,     <span class="number">5.4</span>,   <span class="number">286.7</span>,   <span class="number">34.5</span>,  <span class="number">0.01224</span>,      <span class="number">0</span>,      <span class="number">4</span>,     <span class="number">990</span>,     <span class="number">990</span>,      <span class="number">20</span>,   <span class="number">53495</span></span><br><span class="line"> <span class="number">36</span> threadCount, insert,       <span class="number">141317</span>,    <span class="number">3850</span>,    <span class="number">3850</span>,    <span class="number">5277</span>,     <span class="number">1.3</span>,     <span class="number">1.0</span>,     <span class="number">2.8</span>,     <span class="number">4.8</span>,    <span class="number">16.1</span>,   <span class="number">240.0</span>,   <span class="number">36.7</span>,  <span class="number">0.01231</span>,      <span class="number">0</span>,      <span class="number">4</span>,     <span class="number">913</span>,     <span class="number">913</span>,       <span class="number">7</span>,   <span class="number">52596</span></span><br><span class="line"> <span class="number">36</span> threadCount, singlepost,   <span class="number">284198</span>,    <span class="number">7743</span>,    <span class="number">7596</span>,    <span class="number">7596</span>,     <span class="number">2.4</span>,     <span class="number">2.2</span>,     <span class="number">3.7</span>,     <span class="number">5.4</span>,    <span class="number">10.0</span>,   <span class="number">243.2</span>,   <span class="number">36.7</span>,  <span class="number">0.01231</span>,      <span class="number">0</span>,      <span class="number">4</span>,     <span class="number">913</span>,     <span class="number">913</span>,       <span class="number">7</span>,   <span class="number">52596</span></span><br><span class="line"> <span class="number">36</span> threadCount, timeline,     <span class="number">142241</span>,    <span class="number">3876</span>,    <span class="number">3800</span>,   <span class="number">31128</span>,     <span class="number">2.7</span>,     <span class="number">2.4</span>,     <span class="number">3.9</span>,     <span class="number">5.6</span>,    <span class="number">10.1</span>,   <span class="number">244.6</span>,   <span class="number">36.7</span>,  <span class="number">0.01231</span>,      <span class="number">0</span>,      <span class="number">4</span>,     <span class="number">913</span>,     <span class="number">913</span>,       <span class="number">7</span>,   <span class="number">52596</span></span><br><span class="line"> <span class="number">36</span> threadCount, total,        <span class="number">567756</span>,   <span class="number">15470</span>,   <span class="number">15247</span>,   <span class="number">44000</span>,     <span class="number">2.2</span>,     <span class="number">2.1</span>,     <span class="number">3.7</span>,     <span class="number">5.3</span>,    <span class="number">10.3</span>,   <span class="number">244.6</span>,   <span class="number">36.7</span>,  <span class="number">0.01231</span>,      <span class="number">0</span>,      <span class="number">4</span>,     <span class="number">913</span>,     <span class="number">913</span>,       <span class="number">7</span>,   <span class="number">52596</span></span><br><span class="line"> <span class="number">54</span> threadCount, insert,       <span class="number">147609</span>,    <span class="number">3469</span>,    <span class="number">3469</span>,    <span class="number">4745</span>,     <span class="number">2.8</span>,     <span class="number">2.2</span>,     <span class="number">5.6</span>,     <span class="number">9.2</span>,    <span class="number">18.7</span>,   <span class="number">287.0</span>,   <span class="number">42.6</span>,  <span class="number">0.02038</span>,      <span class="number">0</span>,      <span class="number">5</span>,    <span class="number">1273</span>,    <span class="number">1273</span>,      <span class="number">19</span>,   <span class="number">61300</span></span><br><span class="line"> <span class="number">54</span> threadCount, singlepost,   <span class="number">296313</span>,    <span class="number">6963</span>,    <span class="number">6832</span>,    <span class="number">6832</span>,     <span class="number">4.0</span>,     <span class="number">3.5</span>,     <span class="number">6.4</span>,    <span class="number">10.1</span>,    <span class="number">17.9</span>,   <span class="number">289.4</span>,   <span class="number">42.6</span>,  <span class="number">0.02038</span>,      <span class="number">0</span>,      <span class="number">5</span>,    <span class="number">1273</span>,    <span class="number">1273</span>,      <span class="number">19</span>,   <span class="number">61300</span></span><br><span class="line"> <span class="number">54</span> threadCount, timeline,     <span class="number">148281</span>,    <span class="number">3484</span>,    <span class="number">3420</span>,   <span class="number">28464</span>,     <span class="number">4.3</span>,     <span class="number">3.8</span>,     <span class="number">6.9</span>,    <span class="number">11.0</span>,    <span class="number">19.9</span>,   <span class="number">287.3</span>,   <span class="number">42.6</span>,  <span class="number">0.02038</span>,      <span class="number">0</span>,      <span class="number">5</span>,    <span class="number">1273</span>,    <span class="number">1273</span>,      <span class="number">19</span>,   <span class="number">61300</span></span><br><span class="line"> <span class="number">54</span> threadCount, total,        <span class="number">592203</span>,   <span class="number">13916</span>,   <span class="number">13721</span>,   <span class="number">40040</span>,     <span class="number">3.8</span>,     <span class="number">3.4</span>,     <span class="number">6.4</span>,    <span class="number">10.1</span>,    <span class="number">18.3</span>,   <span class="number">289.4</span>,   <span class="number">42.6</span>,  <span class="number">0.02038</span>,      <span class="number">0</span>,      <span class="number">5</span>,    <span class="number">1273</span>,    <span class="number">1273</span>,      <span class="number">19</span>,   <span class="number">61300</span></span><br><span class="line"> <span class="number">81</span> threadCount, insert,       <span class="number">174282</span>,    <span class="number">3778</span>,    <span class="number">3778</span>,    <span class="number">5162</span>,     <span class="number">4.3</span>,     <span class="number">3.5</span>,     <span class="number">8.1</span>,    <span class="number">13.6</span>,    <span class="number">35.7</span>,   <span class="number">338.4</span>,   <span class="number">46.1</span>,  <span class="number">0.01278</span>,      <span class="number">0</span>,      <span class="number">7</span>,    <span class="number">1466</span>,    <span class="number">1466</span>,      <span class="number">10</span>,   <span class="number">77864</span></span><br><span class="line"> <span class="number">81</span> threadCount, singlepost,   <span class="number">350655</span>,    <span class="number">7600</span>,    <span class="number">7462</span>,    <span class="number">7462</span>,     <span class="number">5.4</span>,     <span class="number">4.9</span>,     <span class="number">8.7</span>,    <span class="number">13.2</span>,    <span class="number">40.4</span>,   <span class="number">248.2</span>,   <span class="number">46.1</span>,  <span class="number">0.01278</span>,      <span class="number">0</span>,      <span class="number">7</span>,    <span class="number">1466</span>,    <span class="number">1466</span>,      <span class="number">10</span>,   <span class="number">77864</span></span><br><span class="line"> <span class="number">81</span> threadCount, timeline,     <span class="number">176191</span>,    <span class="number">3819</span>,    <span class="number">3750</span>,   <span class="number">31705</span>,     <span class="number">5.8</span>,     <span class="number">5.2</span>,     <span class="number">9.1</span>,    <span class="number">14.1</span>,    <span class="number">25.5</span>,   <span class="number">241.2</span>,   <span class="number">46.1</span>,  <span class="number">0.01278</span>,      <span class="number">0</span>,      <span class="number">7</span>,    <span class="number">1466</span>,    <span class="number">1466</span>,      <span class="number">10</span>,   <span class="number">77864</span></span><br><span class="line"> <span class="number">81</span> threadCount, total,        <span class="number">701128</span>,   <span class="number">15197</span>,   <span class="number">14990</span>,   <span class="number">44329</span>,     <span class="number">5.2</span>,     <span class="number">4.7</span>,     <span class="number">8.6</span>,    <span class="number">12.2</span>,    <span class="number">24.5</span>,   <span class="number">338.4</span>,   <span class="number">46.1</span>,  <span class="number">0.01278</span>,      <span class="number">0</span>,      <span class="number">7</span>,    <span class="number">1466</span>,    <span class="number">1466</span>,      <span class="number">10</span>,   <span class="number">77864</span></span><br><span class="line"><span class="number">121</span> threadCount, insert,       <span class="number">214800</span>,    <span class="number">3841</span>,    <span class="number">3841</span>,    <span class="number">5256</span>,     <span class="number">6.0</span>,     <span class="number">5.1</span>,    <span class="number">12.3</span>,    <span class="number">19.4</span>,    <span class="number">41.9</span>,   <span class="number">230.0</span>,   <span class="number">55.9</span>,  <span class="number">0.01080</span>,      <span class="number">0</span>,      <span class="number">9</span>,    <span class="number">1730</span>,    <span class="number">1730</span>,       <span class="number">8</span>,   <span class="number">87696</span></span><br><span class="line"><span class="number">121</span> threadCount, singlepost,   <span class="number">423920</span>,    <span class="number">7580</span>,    <span class="number">7446</span>,    <span class="number">7446</span>,     <span class="number">8.3</span>,     <span class="number">7.8</span>,    <span class="number">13.5</span>,    <span class="number">20.2</span>,   <span class="number">145.0</span>,   <span class="number">248.7</span>,   <span class="number">55.9</span>,  <span class="number">0.01080</span>,      <span class="number">0</span>,      <span class="number">9</span>,    <span class="number">1730</span>,    <span class="number">1730</span>,       <span class="number">8</span>,   <span class="number">87696</span></span><br><span class="line"><span class="number">121</span> threadCount, timeline,     <span class="number">211840</span>,    <span class="number">3788</span>,    <span class="number">3721</span>,   <span class="number">31998</span>,     <span class="number">8.7</span>,     <span class="number">8.1</span>,    <span class="number">13.8</span>,    <span class="number">19.8</span>,    <span class="number">47.7</span>,   <span class="number">250.8</span>,   <span class="number">55.9</span>,  <span class="number">0.01080</span>,      <span class="number">0</span>,      <span class="number">9</span>,    <span class="number">1730</span>,    <span class="number">1730</span>,       <span class="number">8</span>,   <span class="number">87696</span></span><br><span class="line"><span class="number">121</span> threadCount, total,        <span class="number">850560</span>,   <span class="number">15208</span>,   <span class="number">15008</span>,   <span class="number">44700</span>,     <span class="number">7.8</span>,     <span class="number">7.4</span>,    <span class="number">13.4</span>,    <span class="number">20.0</span>,    <span class="number">47.6</span>,   <span class="number">250.8</span>,   <span class="number">55.9</span>,  <span class="number">0.01080</span>,      <span class="number">0</span>,      <span class="number">9</span>,    <span class="number">1730</span>,    <span class="number">1730</span>,       <span class="number">8</span>,   <span class="number">87696</span></span><br></pre></td></tr></table></figure>
<p>G1_32G</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line">  <span class="number">4</span> threadCount, insert,        <span class="number">30936</span>,     <span class="number">973</span>,     <span class="number">973</span>,    <span class="number">1340</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,     <span class="number">0.7</span>,     <span class="number">0.9</span>,     <span class="number">1.4</span>,    <span class="number">17.8</span>,   <span class="number">31.8</span>,  <span class="number">0.00898</span>,      <span class="number">0</span>,      <span class="number">1</span>,     <span class="number">214</span>,     <span class="number">214</span>,       <span class="number">0</span>,   <span class="number">13344</span></span><br><span class="line">  <span class="number">4</span> threadCount, singlepost,    <span class="number">63324</span>,    <span class="number">1992</span>,    <span class="number">1992</span>,    <span class="number">1992</span>,     <span class="number">1.1</span>,     <span class="number">1.1</span>,     <span class="number">1.3</span>,     <span class="number">1.5</span>,     <span class="number">1.9</span>,   <span class="number">215.8</span>,   <span class="number">31.8</span>,  <span class="number">0.00898</span>,      <span class="number">0</span>,      <span class="number">1</span>,     <span class="number">214</span>,     <span class="number">214</span>,       <span class="number">0</span>,   <span class="number">13344</span></span><br><span class="line">  <span class="number">4</span> threadCount, timeline,      <span class="number">31379</span>,     <span class="number">987</span>,     <span class="number">987</span>,    <span class="number">6929</span>,     <span class="number">1.2</span>,     <span class="number">1.2</span>,     <span class="number">1.5</span>,     <span class="number">1.7</span>,     <span class="number">2.2</span>,   <span class="number">215.9</span>,   <span class="number">31.8</span>,  <span class="number">0.00898</span>,      <span class="number">0</span>,      <span class="number">1</span>,     <span class="number">214</span>,     <span class="number">214</span>,       <span class="number">0</span>,   <span class="number">13344</span></span><br><span class="line">  <span class="number">4</span> threadCount, total,        <span class="number">125639</span>,    <span class="number">3952</span>,    <span class="number">3952</span>,   <span class="number">10261</span>,     <span class="number">0.9</span>,     <span class="number">1.0</span>,     <span class="number">1.4</span>,     <span class="number">1.6</span>,     <span class="number">1.9</span>,   <span class="number">215.9</span>,   <span class="number">31.8</span>,  <span class="number">0.00898</span>,      <span class="number">0</span>,      <span class="number">1</span>,     <span class="number">214</span>,     <span class="number">214</span>,       <span class="number">0</span>,   <span class="number">13344</span></span><br><span class="line">  <span class="number">8</span> threadCount, insert,        <span class="number">59491</span>,    <span class="number">1843</span>,    <span class="number">1843</span>,    <span class="number">2526</span>,     <span class="number">0.5</span>,     <span class="number">0.4</span>,     <span class="number">0.8</span>,     <span class="number">0.9</span>,     <span class="number">1.8</span>,   <span class="number">260.4</span>,   <span class="number">32.3</span>,  <span class="number">0.01028</span>,      <span class="number">0</span>,      <span class="number">2</span>,     <span class="number">446</span>,     <span class="number">446</span>,      <span class="number">36</span>,   <span class="number">27262</span></span><br><span class="line">  <span class="number">8</span> threadCount, singlepost,   <span class="number">119048</span>,    <span class="number">3688</span>,    <span class="number">3688</span>,    <span class="number">3688</span>,     <span class="number">1.1</span>,     <span class="number">1.1</span>,     <span class="number">1.4</span>,     <span class="number">1.6</span>,     <span class="number">2.0</span>,   <span class="number">261.8</span>,   <span class="number">32.3</span>,  <span class="number">0.01028</span>,      <span class="number">0</span>,      <span class="number">2</span>,     <span class="number">446</span>,     <span class="number">446</span>,      <span class="number">36</span>,   <span class="number">27262</span></span><br><span class="line">  <span class="number">8</span> threadCount, timeline,      <span class="number">59223</span>,    <span class="number">1835</span>,    <span class="number">1834</span>,   <span class="number">12942</span>,     <span class="number">1.3</span>,     <span class="number">1.3</span>,     <span class="number">1.6</span>,     <span class="number">1.8</span>,     <span class="number">2.1</span>,   <span class="number">261.4</span>,   <span class="number">32.3</span>,  <span class="number">0.01028</span>,      <span class="number">0</span>,      <span class="number">2</span>,     <span class="number">446</span>,     <span class="number">446</span>,      <span class="number">36</span>,   <span class="number">27262</span></span><br><span class="line">  <span class="number">8</span> threadCount, total,        <span class="number">237762</span>,    <span class="number">7365</span>,    <span class="number">7365</span>,   <span class="number">19155</span>,     <span class="number">1.0</span>,     <span class="number">1.1</span>,     <span class="number">1.5</span>,     <span class="number">1.7</span>,     <span class="number">1.9</span>,   <span class="number">261.8</span>,   <span class="number">32.3</span>,  <span class="number">0.01028</span>,      <span class="number">0</span>,      <span class="number">2</span>,     <span class="number">446</span>,     <span class="number">446</span>,      <span class="number">36</span>,   <span class="number">27262</span></span><br><span class="line"> <span class="number">16</span> threadCount, insert,       <span class="number">130937</span>,    <span class="number">2899</span>,    <span class="number">2899</span>,    <span class="number">3964</span>,     <span class="number">0.7</span>,     <span class="number">0.5</span>,     <span class="number">1.0</span>,     <span class="number">1.6</span>,    <span class="number">11.6</span>,   <span class="number">282.7</span>,   <span class="number">45.2</span>,  <span class="number">0.01953</span>,      <span class="number">0</span>,      <span class="number">4</span>,     <span class="number">935</span>,     <span class="number">935</span>,      <span class="number">10</span>,   <span class="number">53938</span></span><br><span class="line"> <span class="number">16</span> threadCount, singlepost,   <span class="number">260371</span>,    <span class="number">5765</span>,    <span class="number">5765</span>,    <span class="number">5765</span>,     <span class="number">1.4</span>,     <span class="number">1.4</span>,     <span class="number">2.0</span>,     <span class="number">2.5</span>,    <span class="number">18.3</span>,   <span class="number">248.8</span>,   <span class="number">45.2</span>,  <span class="number">0.01953</span>,      <span class="number">0</span>,      <span class="number">4</span>,     <span class="number">935</span>,     <span class="number">935</span>,      <span class="number">10</span>,   <span class="number">53938</span></span><br><span class="line"> <span class="number">16</span> threadCount, timeline,     <span class="number">131599</span>,    <span class="number">2914</span>,    <span class="number">2913</span>,   <span class="number">20924</span>,     <span class="number">1.6</span>,     <span class="number">1.5</span>,     <span class="number">2.2</span>,     <span class="number">2.8</span>,    <span class="number">16.2</span>,   <span class="number">248.8</span>,   <span class="number">45.2</span>,  <span class="number">0.01953</span>,      <span class="number">0</span>,      <span class="number">4</span>,     <span class="number">935</span>,     <span class="number">935</span>,      <span class="number">10</span>,   <span class="number">53938</span></span><br><span class="line"> <span class="number">16</span> threadCount, total,        <span class="number">522907</span>,   <span class="number">11578</span>,   <span class="number">11577</span>,   <span class="number">30652</span>,     <span class="number">1.3</span>,     <span class="number">1.3</span>,     <span class="number">2.0</span>,     <span class="number">2.5</span>,    <span class="number">15.4</span>,   <span class="number">282.7</span>,   <span class="number">45.2</span>,  <span class="number">0.01953</span>,      <span class="number">0</span>,      <span class="number">4</span>,     <span class="number">935</span>,     <span class="number">935</span>,      <span class="number">10</span>,   <span class="number">53938</span></span><br><span class="line"> <span class="number">24</span> threadCount, insert,       <span class="number">130883</span>,    <span class="number">3804</span>,    <span class="number">3804</span>,    <span class="number">5202</span>,     <span class="number">0.8</span>,     <span class="number">0.6</span>,     <span class="number">1.4</span>,     <span class="number">2.3</span>,     <span class="number">9.2</span>,   <span class="number">281.2</span>,   <span class="number">34.4</span>,  <span class="number">0.01905</span>,      <span class="number">0</span>,      <span class="number">4</span>,     <span class="number">960</span>,     <span class="number">960</span>,      <span class="number">24</span>,   <span class="number">50744</span></span><br><span class="line"> <span class="number">24</span> threadCount, singlepost,   <span class="number">260226</span>,    <span class="number">7563</span>,    <span class="number">7563</span>,    <span class="number">7563</span>,     <span class="number">1.6</span>,     <span class="number">1.6</span>,     <span class="number">2.4</span>,     <span class="number">3.2</span>,     <span class="number">7.9</span>,   <span class="number">281.7</span>,   <span class="number">34.4</span>,  <span class="number">0.01905</span>,      <span class="number">0</span>,      <span class="number">4</span>,     <span class="number">960</span>,     <span class="number">960</span>,      <span class="number">24</span>,   <span class="number">50744</span></span><br><span class="line"> <span class="number">24</span> threadCount, timeline,     <span class="number">131484</span>,    <span class="number">3821</span>,    <span class="number">3821</span>,   <span class="number">28081</span>,     <span class="number">1.9</span>,     <span class="number">1.7</span>,     <span class="number">2.7</span>,     <span class="number">3.5</span>,     <span class="number">8.1</span>,   <span class="number">281.9</span>,   <span class="number">34.4</span>,  <span class="number">0.01905</span>,      <span class="number">0</span>,      <span class="number">4</span>,     <span class="number">960</span>,     <span class="number">960</span>,      <span class="number">24</span>,   <span class="number">50744</span></span><br><span class="line"> <span class="number">24</span> threadCount, total,        <span class="number">522593</span>,   <span class="number">15189</span>,   <span class="number">15188</span>,   <span class="number">40845</span>,     <span class="number">1.5</span>,     <span class="number">1.4</span>,     <span class="number">2.4</span>,     <span class="number">3.0</span>,     <span class="number">7.9</span>,   <span class="number">281.9</span>,   <span class="number">34.4</span>,  <span class="number">0.01905</span>,      <span class="number">0</span>,      <span class="number">4</span>,     <span class="number">960</span>,     <span class="number">960</span>,      <span class="number">24</span>,   <span class="number">50744</span></span><br><span class="line"> <span class="number">36</span> threadCount, insert,       <span class="number">188834</span>,    <span class="number">4247</span>,    <span class="number">4247</span>,    <span class="number">5813</span>,     <span class="number">1.3</span>,     <span class="number">0.9</span>,     <span class="number">2.5</span>,     <span class="number">4.1</span>,    <span class="number">10.8</span>,   <span class="number">251.4</span>,   <span class="number">44.5</span>,  <span class="number">0.01940</span>,      <span class="number">0</span>,      <span class="number">7</span>,    <span class="number">1505</span>,    <span class="number">1505</span>,      <span class="number">17</span>,   <span class="number">80632</span></span><br><span class="line"> <span class="number">36</span> threadCount, singlepost,   <span class="number">376070</span>,    <span class="number">8459</span>,    <span class="number">8458</span>,    <span class="number">8458</span>,     <span class="number">2.2</span>,     <span class="number">1.9</span>,     <span class="number">3.4</span>,     <span class="number">5.1</span>,    <span class="number">14.3</span>,   <span class="number">253.9</span>,   <span class="number">44.5</span>,  <span class="number">0.01940</span>,      <span class="number">0</span>,      <span class="number">7</span>,    <span class="number">1505</span>,    <span class="number">1505</span>,      <span class="number">17</span>,   <span class="number">80632</span></span><br><span class="line"> <span class="number">36</span> threadCount, timeline,     <span class="number">187315</span>,    <span class="number">4213</span>,    <span class="number">4213</span>,   <span class="number">31700</span>,     <span class="number">2.5</span>,     <span class="number">2.2</span>,     <span class="number">3.7</span>,     <span class="number">5.4</span>,    <span class="number">11.0</span>,   <span class="number">250.7</span>,   <span class="number">44.5</span>,  <span class="number">0.01940</span>,      <span class="number">0</span>,      <span class="number">7</span>,    <span class="number">1505</span>,    <span class="number">1505</span>,      <span class="number">17</span>,   <span class="number">80632</span></span><br><span class="line"> <span class="number">36</span> threadCount, total,        <span class="number">752219</span>,   <span class="number">16920</span>,   <span class="number">16918</span>,   <span class="number">45970</span>,     <span class="number">2.0</span>,     <span class="number">1.8</span>,     <span class="number">3.4</span>,     <span class="number">5.1</span>,    <span class="number">11.7</span>,   <span class="number">253.9</span>,   <span class="number">44.5</span>,  <span class="number">0.01940</span>,      <span class="number">0</span>,      <span class="number">7</span>,    <span class="number">1505</span>,    <span class="number">1505</span>,      <span class="number">17</span>,   <span class="number">80632</span></span><br><span class="line"> <span class="number">54</span> threadCount, insert,       <span class="number">171633</span>,    <span class="number">4481</span>,    <span class="number">4481</span>,    <span class="number">6135</span>,     <span class="number">2.2</span>,     <span class="number">1.6</span>,     <span class="number">4.7</span>,     <span class="number">8.2</span>,    <span class="number">13.7</span>,   <span class="number">291.3</span>,   <span class="number">38.3</span>,  <span class="number">0.01210</span>,      <span class="number">0</span>,      <span class="number">6</span>,    <span class="number">1124</span>,    <span class="number">1124</span>,       <span class="number">7</span>,   <span class="number">60444</span></span><br><span class="line"> <span class="number">54</span> threadCount, singlepost,   <span class="number">345440</span>,    <span class="number">9018</span>,    <span class="number">9017</span>,    <span class="number">9017</span>,     <span class="number">3.1</span>,     <span class="number">2.6</span>,     <span class="number">5.0</span>,     <span class="number">8.2</span>,    <span class="number">13.6</span>,   <span class="number">211.1</span>,   <span class="number">38.3</span>,  <span class="number">0.01210</span>,      <span class="number">0</span>,      <span class="number">6</span>,    <span class="number">1124</span>,    <span class="number">1124</span>,       <span class="number">7</span>,   <span class="number">60444</span></span><br><span class="line"> <span class="number">54</span> threadCount, timeline,     <span class="number">170465</span>,    <span class="number">4450</span>,    <span class="number">4450</span>,   <span class="number">34329</span>,     <span class="number">3.3</span>,     <span class="number">2.9</span>,     <span class="number">5.5</span>,     <span class="number">9.1</span>,    <span class="number">20.3</span>,   <span class="number">209.1</span>,   <span class="number">38.3</span>,  <span class="number">0.01210</span>,      <span class="number">0</span>,      <span class="number">6</span>,    <span class="number">1124</span>,    <span class="number">1124</span>,       <span class="number">7</span>,   <span class="number">60444</span></span><br><span class="line"> <span class="number">54</span> threadCount, total,        <span class="number">687538</span>,   <span class="number">17950</span>,   <span class="number">17948</span>,   <span class="number">49481</span>,     <span class="number">2.9</span>,     <span class="number">2.5</span>,     <span class="number">5.1</span>,     <span class="number">8.1</span>,    <span class="number">12.3</span>,   <span class="number">291.3</span>,   <span class="number">38.3</span>,  <span class="number">0.01210</span>,      <span class="number">0</span>,      <span class="number">6</span>,    <span class="number">1124</span>,    <span class="number">1124</span>,       <span class="number">7</span>,   <span class="number">60444</span></span><br><span class="line"> <span class="number">81</span> threadCount, insert,       <span class="number">332670</span>,    <span class="number">4041</span>,    <span class="number">4041</span>,    <span class="number">5526</span>,     <span class="number">4.1</span>,     <span class="number">3.2</span>,     <span class="number">8.0</span>,    <span class="number">14.0</span>,    <span class="number">59.9</span>,   <span class="number">283.7</span>,   <span class="number">82.3</span>,  <span class="number">0.01953</span>,      <span class="number">0</span>,     <span class="number">14</span>,    <span class="number">2598</span>,    <span class="number">2713</span>,      <span class="number">44</span>,  <span class="number">141155</span></span><br><span class="line"> <span class="number">81</span> threadCount, singlepost,   <span class="number">669779</span>,    <span class="number">8136</span>,    <span class="number">8135</span>,    <span class="number">8135</span>,     <span class="number">5.0</span>,     <span class="number">4.3</span>,     <span class="number">8.4</span>,    <span class="number">13.5</span>,    <span class="number">41.3</span>,   <span class="number">290.7</span>,   <span class="number">82.3</span>,  <span class="number">0.01953</span>,      <span class="number">0</span>,     <span class="number">14</span>,    <span class="number">2598</span>,    <span class="number">2713</span>,      <span class="number">44</span>,  <span class="number">141155</span></span><br><span class="line"> <span class="number">81</span> threadCount, timeline,     <span class="number">336680</span>,    <span class="number">4090</span>,    <span class="number">4089</span>,   <span class="number">32559</span>,     <span class="number">5.4</span>,     <span class="number">4.6</span>,     <span class="number">8.8</span>,    <span class="number">14.7</span>,    <span class="number">73.9</span>,   <span class="number">290.4</span>,   <span class="number">82.3</span>,  <span class="number">0.01953</span>,      <span class="number">0</span>,     <span class="number">14</span>,    <span class="number">2598</span>,    <span class="number">2713</span>,      <span class="number">44</span>,  <span class="number">141155</span></span><br><span class="line"> <span class="number">81</span> threadCount, total,       <span class="number">1339129</span>,   <span class="number">16267</span>,   <span class="number">16266</span>,   <span class="number">46221</span>,     <span class="number">4.9</span>,     <span class="number">4.2</span>,     <span class="number">8.4</span>,    <span class="number">13.6</span>,    <span class="number">47.7</span>,   <span class="number">290.7</span>,   <span class="number">82.3</span>,  <span class="number">0.01953</span>,      <span class="number">0</span>,     <span class="number">14</span>,    <span class="number">2598</span>,    <span class="number">2713</span>,      <span class="number">44</span>,  <span class="number">141155</span></span><br><span class="line"><span class="number">121</span> threadCount, insert,       <span class="number">213975</span>,    <span class="number">3926</span>,    <span class="number">3926</span>,    <span class="number">5368</span>,     <span class="number">6.3</span>,     <span class="number">5.1</span>,    <span class="number">12.4</span>,    <span class="number">19.8</span>,   <span class="number">182.6</span>,   <span class="number">419.9</span>,   <span class="number">54.5</span>,  <span class="number">0.01905</span>,      <span class="number">0</span>,      <span class="number">5</span>,    <span class="number">1791</span>,    <span class="number">1791</span>,      <span class="number">38</span>,   <span class="number">89659</span></span><br><span class="line"><span class="number">121</span> threadCount, singlepost,   <span class="number">427658</span>,    <span class="number">7846</span>,    <span class="number">7845</span>,    <span class="number">7845</span>,     <span class="number">7.9</span>,     <span class="number">7.2</span>,    <span class="number">12.9</span>,    <span class="number">18.1</span>,    <span class="number">42.6</span>,   <span class="number">413.9</span>,   <span class="number">54.5</span>,  <span class="number">0.01905</span>,      <span class="number">0</span>,      <span class="number">5</span>,    <span class="number">1791</span>,    <span class="number">1791</span>,      <span class="number">38</span>,   <span class="number">89659</span></span><br><span class="line"><span class="number">121</span> threadCount, timeline,     <span class="number">212777</span>,    <span class="number">3904</span>,    <span class="number">3903</span>,   <span class="number">32054</span>,     <span class="number">8.3</span>,     <span class="number">7.5</span>,    <span class="number">13.7</span>,    <span class="number">19.2</span>,    <span class="number">43.7</span>,   <span class="number">413.3</span>,   <span class="number">54.5</span>,  <span class="number">0.01905</span>,      <span class="number">0</span>,      <span class="number">5</span>,    <span class="number">1791</span>,    <span class="number">1791</span>,      <span class="number">38</span>,   <span class="number">89659</span></span><br><span class="line"><span class="number">121</span> threadCount, total,        <span class="number">854410</span>,   <span class="number">15675</span>,   <span class="number">15674</span>,   <span class="number">45268</span>,     <span class="number">7.6</span>,     <span class="number">6.9</span>,    <span class="number">13.0</span>,    <span class="number">18.3</span>,    <span class="number">37.3</span>,   <span class="number">419.9</span>,   <span class="number">54.5</span>,  <span class="number">0.01905</span>,      <span class="number">0</span>,      <span class="number">5</span>,    <span class="number">1791</span>,    <span class="number">1791</span>,      <span class="number">38</span>,   <span class="number">89659</span></span><br></pre></td></tr></table></figure>
<h4 id="只有读取">只有读取</h4><p>./cassandra-stress user profile=./blogpost1.yaml ops(singlepost=1) -node 10.21.21.10 -log file=SINGLENODE9_blog_q1.log</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line">  <span class="number">4</span> threadCount, singlepost,    <span class="number">122443</span>,    <span class="number">4069</span>,    <span class="number">3943</span>,    <span class="number">3943</span>,     <span class="number">0.9</span>,     <span class="number">0.8</span>,     <span class="number">1.5</span>,     <span class="number">1.7</span>,     <span class="number">2.1</span>,    <span class="number">41.4</span>,   <span class="number">30.1</span>,  <span class="number">0.01114</span>,      <span class="number">0</span>,      <span class="number">7</span>,     <span class="number">246</span>,     <span class="number">246</span>,       <span class="number">1</span>,   <span class="number">11380</span></span><br><span class="line">  <span class="number">8</span> threadCount, singlepost,    <span class="number">235489</span>,    <span class="number">7815</span>,    <span class="number">7565</span>,    <span class="number">7565</span>,     <span class="number">0.9</span>,     <span class="number">0.8</span>,     <span class="number">1.6</span>,     <span class="number">1.8</span>,     <span class="number">2.2</span>,    <span class="number">60.2</span>,   <span class="number">30.1</span>,  <span class="number">0.00628</span>,      <span class="number">0</span>,     <span class="number">12</span>,     <span class="number">426</span>,     <span class="number">426</span>,       <span class="number">2</span>,   <span class="number">19508</span></span><br><span class="line"> <span class="number">16</span> threadCount, singlepost,    <span class="number">414028</span>,   <span class="number">13749</span>,   <span class="number">13311</span>,   <span class="number">13311</span>,     <span class="number">1.1</span>,     <span class="number">0.9</span>,     <span class="number">1.8</span>,     <span class="number">2.2</span>,     <span class="number">2.8</span>,    <span class="number">49.8</span>,   <span class="number">30.1</span>,  <span class="number">0.00339</span>,      <span class="number">0</span>,     <span class="number">18</span>,     <span class="number">653</span>,     <span class="number">653</span>,       <span class="number">2</span>,   <span class="number">29268</span></span><br><span class="line"> <span class="number">24</span> threadCount, singlepost,    <span class="number">544879</span>,   <span class="number">18049</span>,   <span class="number">17474</span>,   <span class="number">17474</span>,     <span class="number">1.2</span>,     <span class="number">1.0</span>,     <span class="number">2.2</span>,     <span class="number">2.6</span>,     <span class="number">4.6</span>,    <span class="number">97.9</span>,   <span class="number">30.2</span>,  <span class="number">0.00540</span>,      <span class="number">0</span>,     <span class="number">22</span>,     <span class="number">865</span>,     <span class="number">865</span>,       <span class="number">3</span>,   <span class="number">35767</span></span><br><span class="line"> <span class="number">36</span> threadCount, singlepost,    <span class="number">656440</span>,   <span class="number">21729</span>,   <span class="number">21036</span>,   <span class="number">21036</span>,     <span class="number">1.6</span>,     <span class="number">1.3</span>,     <span class="number">2.7</span>,     <span class="number">4.0</span>,    <span class="number">10.2</span>,    <span class="number">74.8</span>,   <span class="number">30.2</span>,  <span class="number">0.00489</span>,      <span class="number">0</span>,     <span class="number">26</span>,     <span class="number">959</span>,     <span class="number">959</span>,       <span class="number">1</span>,   <span class="number">42267</span></span><br><span class="line"> <span class="number">54</span> threadCount, singlepost,    <span class="number">719453</span>,   <span class="number">23782</span>,   <span class="number">23027</span>,   <span class="number">23027</span>,     <span class="number">2.2</span>,     <span class="number">1.7</span>,     <span class="number">3.9</span>,     <span class="number">6.9</span>,    <span class="number">21.9</span>,    <span class="number">87.5</span>,   <span class="number">30.3</span>,  <span class="number">0.01074</span>,      <span class="number">0</span>,     <span class="number">26</span>,     <span class="number">949</span>,     <span class="number">949</span>,      <span class="number">10</span>,   <span class="number">44004</span></span><br><span class="line"> <span class="number">81</span> threadCount, singlepost,    <span class="number">822082</span>,   <span class="number">26965</span>,   <span class="number">26101</span>,   <span class="number">26101</span>,     <span class="number">2.9</span>,     <span class="number">2.3</span>,     <span class="number">5.5</span>,    <span class="number">11.4</span>,    <span class="number">39.6</span>,    <span class="number">59.5</span>,   <span class="number">30.5</span>,  <span class="number">0.00400</span>,      <span class="number">0</span>,     <span class="number">26</span>,     <span class="number">899</span>,     <span class="number">899</span>,       <span class="number">2</span>,   <span class="number">42271</span></span><br><span class="line"><span class="number">121</span> threadCount, singlepost,    <span class="number">881038</span>,   <span class="number">28869</span>,   <span class="number">27948</span>,   <span class="number">27948</span>,     <span class="number">4.1</span>,     <span class="number">3.3</span>,     <span class="number">7.1</span>,    <span class="number">12.4</span>,    <span class="number">41.9</span>,    <span class="number">75.2</span>,   <span class="number">30.5</span>,  <span class="number">0.00428</span>,      <span class="number">0</span>,     <span class="number">26</span>,     <span class="number">912</span>,     <span class="number">912</span>,       <span class="number">1</span>,   <span class="number">42277</span></span><br><span class="line"><span class="number">181</span> threadCount, singlepost,    <span class="number">955638</span>,   <span class="number">31123</span>,   <span class="number">30123</span>,   <span class="number">30123</span>,     <span class="number">5.7</span>,     <span class="number">4.8</span>,     <span class="number">9.5</span>,    <span class="number">15.6</span>,    <span class="number">49.8</span>,   <span class="number">108.2</span>,   <span class="number">30.7</span>,  <span class="number">0.00680</span>,      <span class="number">0</span>,     <span class="number">26</span>,     <span class="number">924</span>,     <span class="number">924</span>,       <span class="number">1</span>,   <span class="number">42275</span></span><br><span class="line"><span class="number">271</span> threadCount, singlepost,   <span class="number">1010814</span>,   <span class="number">32952</span>,   <span class="number">31906</span>,   <span class="number">31906</span>,     <span class="number">8.1</span>,     <span class="number">7.1</span>,    <span class="number">12.4</span>,    <span class="number">21.1</span>,    <span class="number">51.6</span>,   <span class="number">168.2</span>,   <span class="number">30.7</span>,  <span class="number">0.01138</span>,      <span class="number">0</span>,     <span class="number">25</span>,     <span class="number">907</span>,     <span class="number">907</span>,       <span class="number">2</span>,   <span class="number">40659</span></span><br><span class="line"><span class="number">406</span> threadCount, singlepost,   <span class="number">1034735</span>,   <span class="number">33619</span>,   <span class="number">32562</span>,   <span class="number">32562</span>,    <span class="number">12.0</span>,    <span class="number">10.1</span>,    <span class="number">16.9</span>,    <span class="number">36.3</span>,    <span class="number">58.2</span>,   <span class="number">145.2</span>,   <span class="number">30.8</span>,  <span class="number">0.02330</span>,      <span class="number">0</span>,     <span class="number">22</span>,     <span class="number">822</span>,     <span class="number">822</span>,       <span class="number">1</span>,   <span class="number">35778</span></span><br><span class="line"><span class="number">609</span> threadCount, singlepost,   <span class="number">1059253</span>,   <span class="number">34225</span>,   <span class="number">33141</span>,   <span class="number">33141</span>,    <span class="number">17.7</span>,    <span class="number">16.2</span>,    <span class="number">23.2</span>,    <span class="number">57.2</span>,    <span class="number">79.0</span>,   <span class="number">219.8</span>,   <span class="number">30.9</span>,  <span class="number">0.01185</span>,      <span class="number">0</span>,     <span class="number">22</span>,     <span class="number">825</span>,     <span class="number">825</span>,       <span class="number">1</span>,   <span class="number">35796</span></span><br><span class="line"><span class="number">913</span> threadCount, singlepost,   <span class="number">1029097</span>,   <span class="number">32958</span>,   <span class="number">31916</span>,   <span class="number">31916</span>,    <span class="number">27.6</span>,    <span class="number">25.9</span>,    <span class="number">31.3</span>,    <span class="number">66.4</span>,   <span class="number">163.6</span>,   <span class="number">309.2</span>,   <span class="number">31.2</span>,  <span class="number">0.01027</span>,      <span class="number">0</span>,     <span class="number">21</span>,     <span class="number">777</span>,     <span class="number">777</span>,       <span class="number">2</span>,   <span class="number">34169</span></span><br></pre></td></tr></table></figure>
<p>G1_16G</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line">  <span class="number">4</span> threadCount, singlepost,    <span class="number">109941</span>,    <span class="number">3639</span>,    <span class="number">3560</span>,    <span class="number">3560</span>,     <span class="number">1.0</span>,     <span class="number">1.0</span>,     <span class="number">1.4</span>,     <span class="number">1.6</span>,     <span class="number">1.8</span>,   <span class="number">178.4</span>,   <span class="number">30.2</span>,  <span class="number">0.00904</span>,      <span class="number">0</span>,      <span class="number">2</span>,     <span class="number">320</span>,     <span class="number">320</span>,      <span class="number">16</span>,   <span class="number">11256</span></span><br><span class="line">  <span class="number">8</span> threadCount, singlepost,    <span class="number">207401</span>,    <span class="number">6893</span>,    <span class="number">6743</span>,    <span class="number">6743</span>,     <span class="number">1.1</span>,     <span class="number">1.1</span>,     <span class="number">1.4</span>,     <span class="number">1.6</span>,     <span class="number">1.9</span>,   <span class="number">145.8</span>,   <span class="number">30.1</span>,  <span class="number">0.00604</span>,      <span class="number">0</span>,      <span class="number">3</span>,     <span class="number">422</span>,     <span class="number">422</span>,       <span class="number">3</span>,   <span class="number">16829</span></span><br><span class="line"> <span class="number">16</span> threadCount, singlepost,    <span class="number">354764</span>,   <span class="number">11775</span>,   <span class="number">11517</span>,   <span class="number">11517</span>,     <span class="number">1.3</span>,     <span class="number">1.2</span>,     <span class="number">1.7</span>,     <span class="number">2.0</span>,     <span class="number">2.6</span>,   <span class="number">139.1</span>,   <span class="number">30.1</span>,  <span class="number">0.00768</span>,      <span class="number">0</span>,      <span class="number">6</span>,     <span class="number">800</span>,     <span class="number">800</span>,       <span class="number">3</span>,   <span class="number">33620</span></span><br><span class="line"> <span class="number">24</span> threadCount, singlepost,    <span class="number">448907</span>,   <span class="number">14829</span>,   <span class="number">14506</span>,   <span class="number">14506</span>,     <span class="number">1.5</span>,     <span class="number">1.4</span>,     <span class="number">2.2</span>,     <span class="number">2.7</span>,     <span class="number">4.6</span>,   <span class="number">143.3</span>,   <span class="number">30.3</span>,  <span class="number">0.01183</span>,      <span class="number">0</span>,      <span class="number">7</span>,     <span class="number">880</span>,     <span class="number">880</span>,      <span class="number">16</span>,   <span class="number">39657</span></span><br><span class="line"> <span class="number">36</span> threadCount, singlepost,    <span class="number">492859</span>,   <span class="number">16296</span>,   <span class="number">15946</span>,   <span class="number">15946</span>,     <span class="number">2.1</span>,     <span class="number">1.9</span>,     <span class="number">3.4</span>,     <span class="number">5.6</span>,    <span class="number">10.4</span>,   <span class="number">104.4</span>,   <span class="number">30.2</span>,  <span class="number">0.00672</span>,      <span class="number">0</span>,      <span class="number">7</span>,     <span class="number">589</span>,     <span class="number">589</span>,       <span class="number">6</span>,   <span class="number">40129</span></span><br><span class="line"> <span class="number">54</span> threadCount, singlepost,    <span class="number">503342</span>,   <span class="number">16622</span>,   <span class="number">16262</span>,   <span class="number">16262</span>,     <span class="number">3.2</span>,     <span class="number">2.8</span>,     <span class="number">5.2</span>,     <span class="number">8.5</span>,    <span class="number">15.2</span>,   <span class="number">103.2</span>,   <span class="number">30.3</span>,  <span class="number">0.00200</span>,      <span class="number">0</span>,      <span class="number">8</span>,     <span class="number">597</span>,     <span class="number">597</span>,       <span class="number">3</span>,   <span class="number">45974</span></span><br><span class="line"> <span class="number">81</span> threadCount, singlepost,    <span class="number">516925</span>,   <span class="number">17020</span>,   <span class="number">16647</span>,   <span class="number">16647</span>,     <span class="number">4.7</span>,     <span class="number">4.2</span>,     <span class="number">7.7</span>,    <span class="number">12.4</span>,    <span class="number">78.0</span>,    <span class="number">99.8</span>,   <span class="number">30.4</span>,  <span class="number">0.00587</span>,      <span class="number">0</span>,      <span class="number">7</span>,     <span class="number">518</span>,     <span class="number">518</span>,       <span class="number">2</span>,   <span class="number">40218</span></span><br><span class="line"><span class="number">121</span> threadCount, singlepost,    <span class="number">525550</span>,   <span class="number">17186</span>,   <span class="number">16816</span>,   <span class="number">16816</span>,     <span class="number">6.9</span>,     <span class="number">6.2</span>,    <span class="number">11.5</span>,    <span class="number">16.5</span>,    <span class="number">82.1</span>,   <span class="number">111.6</span>,   <span class="number">30.6</span>,  <span class="number">0.00364</span>,      <span class="number">0</span>,      <span class="number">8</span>,     <span class="number">588</span>,     <span class="number">588</span>,       <span class="number">2</span>,   <span class="number">45943</span></span><br><span class="line"><span class="number">181</span> threadCount, singlepost,    <span class="number">544759</span>,   <span class="number">17741</span>,   <span class="number">17353</span>,   <span class="number">17353</span>,    <span class="number">10.1</span>,     <span class="number">9.2</span>,    <span class="number">15.7</span>,    <span class="number">20.7</span>,    <span class="number">87.8</span>,   <span class="number">120.6</span>,   <span class="number">30.7</span>,  <span class="number">0.00363</span>,      <span class="number">0</span>,      <span class="number">8</span>,     <span class="number">596</span>,     <span class="number">596</span>,       <span class="number">2</span>,   <span class="number">45887</span></span><br><span class="line"><span class="number">271</span> threadCount, singlepost,    <span class="number">551750</span>,   <span class="number">17863</span>,   <span class="number">17477</span>,   <span class="number">17477</span>,    <span class="number">15.1</span>,    <span class="number">14.0</span>,    <span class="number">22.4</span>,    <span class="number">27.7</span>,    <span class="number">96.8</span>,   <span class="number">144.2</span>,   <span class="number">30.9</span>,  <span class="number">0.00352</span>,      <span class="number">0</span>,      <span class="number">8</span>,     <span class="number">587</span>,     <span class="number">587</span>,       <span class="number">3</span>,   <span class="number">45895</span></span><br></pre></td></tr></table></figure>
<p>G1_24G</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line">  <span class="number">4</span> threadCount, singlepost,     <span class="number">92111</span>,    <span class="number">3061</span>,    <span class="number">3008</span>,    <span class="number">3008</span>,     <span class="number">1.2</span>,     <span class="number">1.2</span>,     <span class="number">1.5</span>,     <span class="number">1.6</span>,     <span class="number">1.9</span>,   <span class="number">166.0</span>,   <span class="number">30.1</span>,  <span class="number">0.00286</span>,      <span class="number">0</span>,      <span class="number">1</span>,     <span class="number">163</span>,     <span class="number">163</span>,       <span class="number">0</span>,    <span class="number">8953</span></span><br><span class="line">  <span class="number">8</span> threadCount, singlepost,    <span class="number">173858</span>,    <span class="number">5753</span>,    <span class="number">5654</span>,    <span class="number">5654</span>,     <span class="number">1.3</span>,     <span class="number">1.3</span>,     <span class="number">1.6</span>,     <span class="number">1.8</span>,     <span class="number">2.0</span>,   <span class="number">137.5</span>,   <span class="number">30.2</span>,  <span class="number">0.00164</span>,      <span class="number">0</span>,      <span class="number">2</span>,     <span class="number">268</span>,     <span class="number">268</span>,       <span class="number">0</span>,   <span class="number">18140</span></span><br><span class="line"> <span class="number">16</span> threadCount, singlepost,    <span class="number">285754</span>,    <span class="number">9470</span>,    <span class="number">9312</span>,    <span class="number">9312</span>,     <span class="number">1.6</span>,     <span class="number">1.5</span>,     <span class="number">2.1</span>,     <span class="number">2.5</span>,     <span class="number">3.3</span>,   <span class="number">141.4</span>,   <span class="number">30.2</span>,  <span class="number">0.00497</span>,      <span class="number">0</span>,      <span class="number">4</span>,     <span class="number">545</span>,     <span class="number">545</span>,       <span class="number">2</span>,   <span class="number">36332</span></span><br><span class="line"> <span class="number">24</span> threadCount, singlepost,    <span class="number">339980</span>,   <span class="number">11279</span>,   <span class="number">11079</span>,   <span class="number">11079</span>,     <span class="number">2.0</span>,     <span class="number">1.9</span>,     <span class="number">2.9</span>,     <span class="number">3.6</span>,     <span class="number">6.2</span>,   <span class="number">154.3</span>,   <span class="number">30.1</span>,  <span class="number">0.00245</span>,      <span class="number">0</span>,      <span class="number">5</span>,     <span class="number">701</span>,     <span class="number">701</span>,       <span class="number">5</span>,   <span class="number">45509</span></span><br><span class="line"> <span class="number">36</span> threadCount, singlepost,    <span class="number">364567</span>,   <span class="number">12065</span>,   <span class="number">11862</span>,   <span class="number">11862</span>,     <span class="number">2.9</span>,     <span class="number">2.6</span>,     <span class="number">4.4</span>,     <span class="number">6.7</span>,    <span class="number">11.8</span>,   <span class="number">125.5</span>,   <span class="number">30.2</span>,  <span class="number">0.00387</span>,      <span class="number">0</span>,      <span class="number">5</span>,     <span class="number">469</span>,     <span class="number">469</span>,      <span class="number">16</span>,   <span class="number">46767</span></span><br><span class="line"> <span class="number">54</span> threadCount, singlepost,    <span class="number">374115</span>,   <span class="number">12349</span>,   <span class="number">12135</span>,   <span class="number">12135</span>,     <span class="number">4.3</span>,     <span class="number">4.0</span>,     <span class="number">6.9</span>,    <span class="number">10.4</span>,    <span class="number">16.1</span>,    <span class="number">96.2</span>,   <span class="number">30.3</span>,  <span class="number">0.00199</span>,      <span class="number">0</span>,      <span class="number">5</span>,     <span class="number">382</span>,     <span class="number">382</span>,       <span class="number">2</span>,   <span class="number">46894</span></span><br><span class="line"> <span class="number">81</span> threadCount, singlepost,    <span class="number">390179</span>,   <span class="number">12834</span>,   <span class="number">12610</span>,   <span class="number">12610</span>,     <span class="number">6.2</span>,     <span class="number">5.9</span>,    <span class="number">10.3</span>,    <span class="number">15.3</span>,    <span class="number">26.7</span>,   <span class="number">112.0</span>,   <span class="number">30.4</span>,  <span class="number">0.00922</span>,      <span class="number">0</span>,      <span class="number">5</span>,     <span class="number">395</span>,     <span class="number">395</span>,       <span class="number">3</span>,   <span class="number">46911</span></span><br><span class="line"><span class="number">121</span> threadCount, singlepost,    <span class="number">412920</span>,   <span class="number">13492</span>,   <span class="number">13259</span>,   <span class="number">13259</span>,     <span class="number">8.9</span>,     <span class="number">8.1</span>,    <span class="number">14.5</span>,    <span class="number">19.9</span>,    <span class="number">33.7</span>,   <span class="number">123.5</span>,   <span class="number">30.6</span>,  <span class="number">0.00379</span>,      <span class="number">0</span>,      <span class="number">5</span>,     <span class="number">391</span>,     <span class="number">391</span>,       <span class="number">2</span>,   <span class="number">46859</span></span><br><span class="line"><span class="number">181</span> threadCount, singlepost,    <span class="number">439554</span>,   <span class="number">14237</span>,   <span class="number">13989</span>,   <span class="number">13989</span>,    <span class="number">12.6</span>,    <span class="number">11.7</span>,    <span class="number">19.8</span>,    <span class="number">25.0</span>,    <span class="number">94.3</span>,   <span class="number">139.9</span>,   <span class="number">30.9</span>,  <span class="number">0.00353</span>,      <span class="number">0</span>,      <span class="number">6</span>,     <span class="number">465</span>,     <span class="number">465</span>,       <span class="number">2</span>,   <span class="number">56229</span></span><br><span class="line"><span class="number">271</span> threadCount, singlepost,    <span class="number">459036</span>,   <span class="number">14783</span>,   <span class="number">14527</span>,   <span class="number">14527</span>,    <span class="number">18.2</span>,    <span class="number">17.3</span>,    <span class="number">26.3</span>,    <span class="number">31.4</span>,   <span class="number">107.9</span>,   <span class="number">150.9</span>,   <span class="number">31.1</span>,  <span class="number">0.00419</span>,      <span class="number">0</span>,      <span class="number">5</span>,     <span class="number">386</span>,     <span class="number">386</span>,       <span class="number">2</span>,   <span class="number">46835</span></span><br><span class="line"><span class="number">406</span> threadCount, singlepost,    <span class="number">472232</span>,   <span class="number">15120</span>,   <span class="number">14857</span>,   <span class="number">14857</span>,    <span class="number">26.7</span>,    <span class="number">25.4</span>,    <span class="number">34.9</span>,    <span class="number">47.8</span>,   <span class="number">110.0</span>,   <span class="number">147.2</span>,   <span class="number">31.2</span>,  <span class="number">0.00490</span>,      <span class="number">0</span>,      <span class="number">6</span>,     <span class="number">473</span>,     <span class="number">473</span>,       <span class="number">2</span>,   <span class="number">56115</span></span><br><span class="line"><span class="number">609</span> threadCount, singlepost,    <span class="number">495949</span>,   <span class="number">15634</span>,   <span class="number">15357</span>,   <span class="number">15357</span>,    <span class="number">38.9</span>,    <span class="number">37.7</span>,    <span class="number">48.3</span>,    <span class="number">57.1</span>,   <span class="number">213.9</span>,   <span class="number">238.0</span>,   <span class="number">31.7</span>,  <span class="number">0.00602</span>,      <span class="number">0</span>,      <span class="number">5</span>,     <span class="number">400</span>,     <span class="number">400</span>,       <span class="number">3</span>,   <span class="number">46782</span></span><br><span class="line"><span class="number">913</span> threadCount, singlepost,    <span class="number">509520</span>,   <span class="number">15849</span>,   <span class="number">15572</span>,   <span class="number">15572</span>,    <span class="number">57.6</span>,    <span class="number">53.7</span>,    <span class="number">72.2</span>,   <span class="number">138.2</span>,   <span class="number">210.9</span>,   <span class="number">245.9</span>,   <span class="number">32.1</span>,  <span class="number">0.00958</span>,      <span class="number">0</span>,      <span class="number">6</span>,     <span class="number">480</span>,     <span class="number">480</span>,       <span class="number">3</span>,   <span class="number">56182</span></span><br></pre></td></tr></table></figure>
<p>G1_32G</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line">  <span class="number">4</span> threadCount, singlepost,     <span class="number">99639</span>,    <span class="number">3285</span>,    <span class="number">3285</span>,    <span class="number">3285</span>,     <span class="number">1.1</span>,     <span class="number">1.1</span>,     <span class="number">1.6</span>,     <span class="number">2.0</span>,     <span class="number">2.6</span>,   <span class="number">285.7</span>,   <span class="number">30.3</span>,  <span class="number">0.00463</span>,      <span class="number">0</span>,      <span class="number">1</span>,     <span class="number">283</span>,     <span class="number">283</span>,       <span class="number">0</span>,   <span class="number">17966</span></span><br><span class="line">  <span class="number">8</span> threadCount, singlepost,    <span class="number">190521</span>,    <span class="number">6331</span>,    <span class="number">6331</span>,    <span class="number">6331</span>,     <span class="number">1.2</span>,     <span class="number">1.1</span>,     <span class="number">1.7</span>,     <span class="number">2.0</span>,     <span class="number">2.6</span>,   <span class="number">238.7</span>,   <span class="number">30.1</span>,  <span class="number">0.00805</span>,      <span class="number">0</span>,      <span class="number">1</span>,     <span class="number">235</span>,     <span class="number">235</span>,       <span class="number">0</span>,   <span class="number">18336</span></span><br><span class="line"> <span class="number">16</span> threadCount, singlepost,    <span class="number">330162</span>,   <span class="number">10888</span>,   <span class="number">10888</span>,   <span class="number">10888</span>,     <span class="number">1.4</span>,     <span class="number">1.3</span>,     <span class="number">2.0</span>,     <span class="number">2.3</span>,     <span class="number">3.0</span>,   <span class="number">234.4</span>,   <span class="number">30.3</span>,  <span class="number">0.00838</span>,      <span class="number">0</span>,      <span class="number">2</span>,     <span class="number">436</span>,     <span class="number">436</span>,      <span class="number">13</span>,   <span class="number">36640</span></span><br><span class="line"> <span class="number">24</span> threadCount, singlepost,    <span class="number">422433</span>,   <span class="number">13919</span>,   <span class="number">13918</span>,   <span class="number">13918</span>,     <span class="number">1.6</span>,     <span class="number">1.5</span>,     <span class="number">2.5</span>,     <span class="number">3.1</span>,     <span class="number">4.7</span>,   <span class="number">229.7</span>,   <span class="number">30.3</span>,  <span class="number">0.00868</span>,      <span class="number">0</span>,      <span class="number">2</span>,     <span class="number">444</span>,     <span class="number">444</span>,       <span class="number">3</span>,   <span class="number">36672</span></span><br><span class="line"> <span class="number">36</span> threadCount, singlepost,    <span class="number">495485</span>,   <span class="number">16338</span>,   <span class="number">16337</span>,   <span class="number">16337</span>,     <span class="number">2.1</span>,     <span class="number">1.9</span>,     <span class="number">3.4</span>,     <span class="number">5.1</span>,     <span class="number">8.5</span>,   <span class="number">219.4</span>,   <span class="number">30.3</span>,  <span class="number">0.00704</span>,      <span class="number">0</span>,      <span class="number">3</span>,     <span class="number">629</span>,     <span class="number">629</span>,       <span class="number">4</span>,   <span class="number">54968</span></span><br><span class="line"> <span class="number">54</span> threadCount, singlepost,    <span class="number">540856</span>,   <span class="number">17748</span>,   <span class="number">17746</span>,   <span class="number">17746</span>,     <span class="number">3.0</span>,     <span class="number">2.5</span>,     <span class="number">5.0</span>,     <span class="number">8.2</span>,    <span class="number">13.3</span>,   <span class="number">235.9</span>,   <span class="number">30.5</span>,  <span class="number">0.00533</span>,      <span class="number">0</span>,      <span class="number">3</span>,     <span class="number">655</span>,     <span class="number">655</span>,       <span class="number">7</span>,   <span class="number">54933</span></span><br><span class="line"> <span class="number">81</span> threadCount, singlepost,    <span class="number">542694</span>,   <span class="number">17868</span>,   <span class="number">17866</span>,   <span class="number">17866</span>,     <span class="number">4.4</span>,     <span class="number">3.9</span>,     <span class="number">7.6</span>,    <span class="number">12.3</span>,    <span class="number">20.1</span>,   <span class="number">225.0</span>,   <span class="number">30.4</span>,  <span class="number">0.00681</span>,      <span class="number">0</span>,      <span class="number">2</span>,     <span class="number">381</span>,     <span class="number">381</span>,      <span class="number">17</span>,   <span class="number">37201</span></span><br><span class="line"><span class="number">121</span> threadCount, singlepost,    <span class="number">572196</span>,   <span class="number">18786</span>,   <span class="number">18785</span>,   <span class="number">18785</span>,     <span class="number">6.3</span>,     <span class="number">5.4</span>,    <span class="number">11.5</span>,    <span class="number">17.8</span>,    <span class="number">31.0</span>,   <span class="number">155.7</span>,   <span class="number">30.5</span>,  <span class="number">0.01925</span>,      <span class="number">0</span>,      <span class="number">3</span>,     <span class="number">349</span>,     <span class="number">349</span>,      <span class="number">21</span>,   <span class="number">57439</span></span><br><span class="line"><span class="number">181</span> threadCount, singlepost,    <span class="number">642455</span>,   <span class="number">20933</span>,   <span class="number">20931</span>,   <span class="number">20931</span>,     <span class="number">8.5</span>,     <span class="number">7.7</span>,    <span class="number">13.5</span>,    <span class="number">18.2</span>,    <span class="number">36.2</span>,   <span class="number">119.7</span>,   <span class="number">30.7</span>,  <span class="number">0.00638</span>,      <span class="number">0</span>,      <span class="number">3</span>,     <span class="number">228</span>,     <span class="number">228</span>,       <span class="number">2</span>,   <span class="number">58005</span></span><br><span class="line"><span class="number">271</span> threadCount, singlepost,    <span class="number">653435</span>,   <span class="number">21239</span>,   <span class="number">21237</span>,   <span class="number">21237</span>,    <span class="number">12.7</span>,    <span class="number">11.7</span>,    <span class="number">18.8</span>,    <span class="number">23.3</span>,    <span class="number">86.6</span>,   <span class="number">162.8</span>,   <span class="number">30.8</span>,  <span class="number">0.01504</span>,      <span class="number">0</span>,      <span class="number">3</span>,     <span class="number">226</span>,     <span class="number">226</span>,       <span class="number">2</span>,   <span class="number">58039</span></span><br><span class="line"><span class="number">406</span> threadCount, singlepost,    <span class="number">651626</span>,   <span class="number">20891</span>,   <span class="number">20889</span>,   <span class="number">20889</span>,    <span class="number">19.3</span>,    <span class="number">18.1</span>,    <span class="number">26.6</span>,    <span class="number">31.8</span>,   <span class="number">135.3</span>,   <span class="number">157.1</span>,   <span class="number">31.2</span>,  <span class="number">0.00646</span>,      <span class="number">0</span>,      <span class="number">3</span>,     <span class="number">224</span>,     <span class="number">224</span>,       <span class="number">1</span>,   <span class="number">58031</span></span><br><span class="line"><span class="number">609</span> threadCount, singlepost,    <span class="number">649846</span>,   <span class="number">20818</span>,   <span class="number">20816</span>,   <span class="number">20816</span>,    <span class="number">29.2</span>,    <span class="number">28.4</span>,    <span class="number">39.0</span>,    <span class="number">49.2</span>,   <span class="number">140.8</span>,   <span class="number">168.4</span>,   <span class="number">31.2</span>,  <span class="number">0.00658</span>,      <span class="number">0</span>,      <span class="number">3</span>,     <span class="number">220</span>,     <span class="number">220</span>,       <span class="number">1</span>,   <span class="number">58031</span></span><br></pre></td></tr></table></figure>
<p>./cassandra-stress user profile=./blogpost1.yaml ops(timeline=1) -node 10.21.21.10 -log file=SINGLENODE10_blog_q2.log</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line">  <span class="number">4</span> threadCount, timeline,     <span class="number">141365</span>,    <span class="number">4698</span>,    <span class="number">4551</span>,   <span class="number">35081</span>,     <span class="number">0.8</span>,     <span class="number">0.8</span>,     <span class="number">1.0</span>,     <span class="number">1.2</span>,     <span class="number">1.3</span>,    <span class="number">29.3</span>,   <span class="number">30.1</span>,  <span class="number">0.00663</span>,      <span class="number">0</span>,      <span class="number">7</span>,     <span class="number">180</span>,     <span class="number">180</span>,       <span class="number">1</span>,   <span class="number">11430</span></span><br><span class="line">  <span class="number">8</span> threadCount, timeline,     <span class="number">265718</span>,    <span class="number">8824</span>,    <span class="number">8538</span>,   <span class="number">65799</span>,     <span class="number">0.8</span>,     <span class="number">0.8</span>,     <span class="number">1.1</span>,     <span class="number">1.2</span>,     <span class="number">1.6</span>,    <span class="number">46.5</span>,   <span class="number">30.1</span>,  <span class="number">0.00213</span>,      <span class="number">0</span>,     <span class="number">12</span>,     <span class="number">322</span>,     <span class="number">322</span>,       <span class="number">2</span>,   <span class="number">19593</span></span><br><span class="line"> <span class="number">16</span> threadCount, timeline,     <span class="number">474596</span>,   <span class="number">15761</span>,   <span class="number">15255</span>,  <span class="number">117608</span>,     <span class="number">0.9</span>,     <span class="number">0.9</span>,     <span class="number">1.2</span>,     <span class="number">1.4</span>,     <span class="number">2.2</span>,    <span class="number">30.6</span>,   <span class="number">30.1</span>,  <span class="number">0.00551</span>,      <span class="number">0</span>,     <span class="number">20</span>,     <span class="number">526</span>,     <span class="number">526</span>,       <span class="number">1</span>,   <span class="number">32658</span></span><br><span class="line"> <span class="number">24</span> threadCount, timeline,     <span class="number">636296</span>,   <span class="number">21118</span>,   <span class="number">20452</span>,  <span class="number">157511</span>,     <span class="number">1.0</span>,     <span class="number">1.0</span>,     <span class="number">1.4</span>,     <span class="number">1.7</span>,     <span class="number">3.5</span>,    <span class="number">38.3</span>,   <span class="number">30.1</span>,  <span class="number">0.00725</span>,      <span class="number">0</span>,     <span class="number">26</span>,     <span class="number">698</span>,     <span class="number">698</span>,       <span class="number">2</span>,   <span class="number">42462</span></span><br><span class="line"> <span class="number">36</span> threadCount, timeline,     <span class="number">783994</span>,   <span class="number">25984</span>,   <span class="number">25153</span>,  <span class="number">193866</span>,     <span class="number">1.3</span>,     <span class="number">1.2</span>,     <span class="number">2.0</span>,     <span class="number">2.9</span>,    <span class="number">10.2</span>,    <span class="number">32.2</span>,   <span class="number">30.2</span>,  <span class="number">0.00573</span>,      <span class="number">0</span>,     <span class="number">32</span>,     <span class="number">804</span>,     <span class="number">858</span>,       <span class="number">1</span>,   <span class="number">52263</span></span><br><span class="line"> <span class="number">54</span> threadCount, timeline,     <span class="number">829706</span>,   <span class="number">27400</span>,   <span class="number">26524</span>,  <span class="number">204420</span>,     <span class="number">1.9</span>,     <span class="number">1.5</span>,     <span class="number">3.3</span>,     <span class="number">6.3</span>,    <span class="number">14.7</span>,    <span class="number">43.7</span>,   <span class="number">30.3</span>,  <span class="number">0.00411</span>,      <span class="number">0</span>,     <span class="number">33</span>,     <span class="number">805</span>,     <span class="number">884</span>,       <span class="number">1</span>,   <span class="number">53898</span></span><br><span class="line"> <span class="number">81</span> threadCount, timeline,     <span class="number">845373</span>,   <span class="number">27903</span>,   <span class="number">27028</span>,  <span class="number">208271</span>,     <span class="number">2.8</span>,     <span class="number">2.2</span>,     <span class="number">5.1</span>,     <span class="number">9.8</span>,    <span class="number">31.3</span>,    <span class="number">59.9</span>,   <span class="number">30.3</span>,  <span class="number">0.00598</span>,      <span class="number">0</span>,     <span class="number">33</span>,     <span class="number">815</span>,     <span class="number">897</span>,       <span class="number">1</span>,   <span class="number">53902</span></span><br><span class="line"><span class="number">121</span> threadCount, timeline,     <span class="number">867840</span>,   <span class="number">28402</span>,   <span class="number">27500</span>,  <span class="number">211936</span>,     <span class="number">4.2</span>,     <span class="number">3.3</span>,     <span class="number">7.4</span>,    <span class="number">13.9</span>,    <span class="number">35.8</span>,    <span class="number">74.6</span>,   <span class="number">30.6</span>,  <span class="number">0.00515</span>,      <span class="number">0</span>,     <span class="number">34</span>,     <span class="number">814</span>,     <span class="number">920</span>,       <span class="number">2</span>,   <span class="number">55536</span></span><br><span class="line"><span class="number">181</span> threadCount, timeline,     <span class="number">864168</span>,   <span class="number">28392</span>,   <span class="number">27486</span>,  <span class="number">211904</span>,     <span class="number">6.3</span>,     <span class="number">5.6</span>,    <span class="number">10.1</span>,    <span class="number">15.0</span>,    <span class="number">36.1</span>,   <span class="number">109.1</span>,   <span class="number">30.4</span>,  <span class="number">0.00668</span>,      <span class="number">0</span>,     <span class="number">33</span>,     <span class="number">792</span>,     <span class="number">868</span>,       <span class="number">1</span>,   <span class="number">53909</span></span><br><span class="line"><span class="number">271</span> threadCount, timeline,     <span class="number">850865</span>,   <span class="number">27816</span>,   <span class="number">26934</span>,  <span class="number">207565</span>,     <span class="number">9.6</span>,     <span class="number">8.9</span>,    <span class="number">14.4</span>,    <span class="number">20.4</span>,    <span class="number">45.8</span>,   <span class="number">168.7</span>,   <span class="number">30.6</span>,  <span class="number">0.00722</span>,      <span class="number">0</span>,     <span class="number">31</span>,     <span class="number">796</span>,     <span class="number">822</span>,       <span class="number">1</span>,   <span class="number">50649</span></span><br></pre></td></tr></table></figure>
<p>G1_16G</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line">  <span class="number">4</span> threadCount, timeline,      <span class="number">94817</span>,    <span class="number">3150</span>,    <span class="number">3081</span>,   <span class="number">26009</span>,     <span class="number">1.2</span>,     <span class="number">1.2</span>,     <span class="number">1.5</span>,     <span class="number">1.7</span>,     <span class="number">1.9</span>,    <span class="number">79.5</span>,   <span class="number">30.1</span>,  <span class="number">0.01005</span>,      <span class="number">0</span>,      <span class="number">3</span>,     <span class="number">226</span>,     <span class="number">226</span>,       <span class="number">2</span>,   <span class="number">17204</span></span><br><span class="line">  <span class="number">8</span> threadCount, timeline,     <span class="number">180270</span>,    <span class="number">5989</span>,    <span class="number">5857</span>,   <span class="number">49467</span>,     <span class="number">1.3</span>,     <span class="number">1.3</span>,     <span class="number">1.6</span>,     <span class="number">1.8</span>,     <span class="number">2.1</span>,    <span class="number">77.2</span>,   <span class="number">30.1</span>,  <span class="number">0.00188</span>,      <span class="number">0</span>,      <span class="number">4</span>,     <span class="number">285</span>,     <span class="number">285</span>,       <span class="number">2</span>,   <span class="number">22916</span></span><br><span class="line"> <span class="number">16</span> threadCount, timeline,     <span class="number">309748</span>,   <span class="number">10283</span>,   <span class="number">10060</span>,   <span class="number">84849</span>,     <span class="number">1.5</span>,     <span class="number">1.4</span>,     <span class="number">1.9</span>,     <span class="number">2.2</span>,     <span class="number">2.8</span>,    <span class="number">78.7</span>,   <span class="number">30.1</span>,  <span class="number">0.00332</span>,      <span class="number">0</span>,      <span class="number">7</span>,     <span class="number">485</span>,     <span class="number">485</span>,       <span class="number">3</span>,   <span class="number">40163</span></span><br><span class="line"> <span class="number">24</span> threadCount, timeline,     <span class="number">390132</span>,   <span class="number">12948</span>,   <span class="number">12665</span>,  <span class="number">106703</span>,     <span class="number">1.8</span>,     <span class="number">1.7</span>,     <span class="number">2.5</span>,     <span class="number">3.1</span>,     <span class="number">5.9</span>,    <span class="number">74.7</span>,   <span class="number">30.1</span>,  <span class="number">0.00768</span>,      <span class="number">0</span>,      <span class="number">8</span>,     <span class="number">525</span>,     <span class="number">525</span>,       <span class="number">3</span>,   <span class="number">45882</span></span><br><span class="line"> <span class="number">36</span> threadCount, timeline,     <span class="number">409718</span>,   <span class="number">13539</span>,   <span class="number">13247</span>,  <span class="number">111801</span>,     <span class="number">2.6</span>,     <span class="number">2.3</span>,     <span class="number">4.0</span>,     <span class="number">6.0</span>,    <span class="number">10.0</span>,    <span class="number">80.8</span>,   <span class="number">30.3</span>,  <span class="number">0.00283</span>,      <span class="number">0</span>,      <span class="number">9</span>,     <span class="number">597</span>,     <span class="number">597</span>,       <span class="number">2</span>,   <span class="number">51530</span></span><br><span class="line"> <span class="number">54</span> threadCount, timeline,     <span class="number">419480</span>,   <span class="number">13781</span>,   <span class="number">13479</span>,  <span class="number">113650</span>,     <span class="number">3.8</span>,     <span class="number">3.5</span>,     <span class="number">6.1</span>,     <span class="number">9.2</span>,    <span class="number">69.8</span>,    <span class="number">81.4</span>,   <span class="number">30.4</span>,  <span class="number">0.00249</span>,      <span class="number">0</span>,      <span class="number">9</span>,     <span class="number">597</span>,     <span class="number">597</span>,       <span class="number">1</span>,   <span class="number">51606</span></span><br><span class="line"> <span class="number">81</span> threadCount, timeline,     <span class="number">424742</span>,   <span class="number">13963</span>,   <span class="number">13663</span>,  <span class="number">115244</span>,     <span class="number">5.7</span>,     <span class="number">5.4</span>,     <span class="number">9.1</span>,    <span class="number">13.3</span>,    <span class="number">72.4</span>,    <span class="number">98.2</span>,   <span class="number">30.4</span>,  <span class="number">0.00410</span>,      <span class="number">0</span>,     <span class="number">10</span>,     <span class="number">666</span>,     <span class="number">666</span>,       <span class="number">2</span>,   <span class="number">57182</span></span><br><span class="line"><span class="number">121</span> threadCount, timeline,     <span class="number">453080</span>,   <span class="number">14847</span>,   <span class="number">14527</span>,  <span class="number">122499</span>,     <span class="number">8.0</span>,     <span class="number">7.4</span>,    <span class="number">12.9</span>,    <span class="number">17.5</span>,    <span class="number">48.8</span>,    <span class="number">98.5</span>,   <span class="number">30.5</span>,  <span class="number">0.00354</span>,      <span class="number">0</span>,      <span class="number">9</span>,     <span class="number">601</span>,     <span class="number">601</span>,       <span class="number">2</span>,   <span class="number">51426</span></span><br><span class="line"><span class="number">181</span> threadCount, timeline,     <span class="number">484441</span>,   <span class="number">15578</span>,   <span class="number">15240</span>,  <span class="number">128493</span>,    <span class="number">11.5</span>,    <span class="number">10.4</span>,    <span class="number">18.1</span>,    <span class="number">24.0</span>,    <span class="number">84.9</span>,   <span class="number">121.2</span>,   <span class="number">31.1</span>,  <span class="number">0.00916</span>,      <span class="number">0</span>,     <span class="number">10</span>,     <span class="number">658</span>,     <span class="number">658</span>,       <span class="number">2</span>,   <span class="number">57159</span></span><br><span class="line"><span class="number">271</span> threadCount, timeline,     <span class="number">497398</span>,   <span class="number">16078</span>,   <span class="number">15732</span>,  <span class="number">132660</span>,    <span class="number">16.7</span>,    <span class="number">15.4</span>,    <span class="number">25.0</span>,    <span class="number">32.6</span>,    <span class="number">88.4</span>,   <span class="number">157.2</span>,   <span class="number">30.9</span>,  <span class="number">0.00627</span>,      <span class="number">0</span>,     <span class="number">10</span>,     <span class="number">648</span>,     <span class="number">648</span>,       <span class="number">2</span>,   <span class="number">57157</span></span><br><span class="line"><span class="number">406</span> threadCount, timeline,     <span class="number">495006</span>,   <span class="number">15889</span>,   <span class="number">15550</span>,  <span class="number">131065</span>,    <span class="number">25.4</span>,    <span class="number">24.3</span>,    <span class="number">36.4</span>,    <span class="number">65.2</span>,   <span class="number">107.0</span>,   <span class="number">139.0</span>,   <span class="number">31.2</span>,  <span class="number">0.00792</span>,      <span class="number">0</span>,     <span class="number">10</span>,     <span class="number">662</span>,     <span class="number">662</span>,       <span class="number">2</span>,   <span class="number">57141</span></span><br><span class="line"><span class="number">609</span> threadCount, timeline,     <span class="number">494388</span>,   <span class="number">15750</span>,   <span class="number">15409</span>,  <span class="number">129898</span>,    <span class="number">38.6</span>,    <span class="number">39.5</span>,    <span class="number">51.2</span>,    <span class="number">65.6</span>,   <span class="number">316.1</span>,   <span class="number">328.2</span>,   <span class="number">31.4</span>,  <span class="number">0.01020</span>,      <span class="number">0</span>,      <span class="number">9</span>,     <span class="number">602</span>,     <span class="number">602</span>,       <span class="number">3</span>,   <span class="number">51304</span></span><br><span class="line"><span class="number">913</span> threadCount, timeline,     <span class="number">513498</span>,   <span class="number">16183</span>,   <span class="number">15834</span>,  <span class="number">133546</span>,    <span class="number">56.3</span>,    <span class="number">54.7</span>,    <span class="number">74.1</span>,   <span class="number">123.2</span>,   <span class="number">181.0</span>,   <span class="number">234.1</span>,   <span class="number">31.7</span>,  <span class="number">0.01149</span>,      <span class="number">0</span>,      <span class="number">9</span>,     <span class="number">595</span>,     <span class="number">595</span>,       <span class="number">5</span>,   <span class="number">51276</span></span><br></pre></td></tr></table></figure>
<p>G1_24G</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line">  <span class="number">4</span> threadCount, timeline,      <span class="number">92842</span>,    <span class="number">3085</span>,    <span class="number">3033</span>,   <span class="number">26250</span>,     <span class="number">1.2</span>,     <span class="number">1.3</span>,     <span class="number">1.7</span>,     <span class="number">1.8</span>,     <span class="number">2.1</span>,    <span class="number">80.6</span>,   <span class="number">30.1</span>,  <span class="number">0.00626</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">78</span>,      <span class="number">78</span>,       <span class="number">0</span>,    <span class="number">9368</span></span><br><span class="line">  <span class="number">8</span> threadCount, timeline,     <span class="number">178117</span>,    <span class="number">5917</span>,    <span class="number">5817</span>,   <span class="number">50390</span>,     <span class="number">1.3</span>,     <span class="number">1.4</span>,     <span class="number">1.8</span>,     <span class="number">2.0</span>,     <span class="number">2.3</span>,    <span class="number">80.6</span>,   <span class="number">30.1</span>,  <span class="number">0.00197</span>,      <span class="number">0</span>,      <span class="number">3</span>,     <span class="number">229</span>,     <span class="number">229</span>,       <span class="number">2</span>,   <span class="number">28092</span></span><br><span class="line"> <span class="number">16</span> threadCount, timeline,     <span class="number">312579</span>,   <span class="number">10362</span>,   <span class="number">10186</span>,   <span class="number">88208</span>,     <span class="number">1.5</span>,     <span class="number">1.5</span>,     <span class="number">2.1</span>,     <span class="number">2.4</span>,     <span class="number">3.2</span>,    <span class="number">82.0</span>,   <span class="number">30.2</span>,  <span class="number">0.00372</span>,      <span class="number">0</span>,      <span class="number">4</span>,     <span class="number">301</span>,     <span class="number">301</span>,       <span class="number">2</span>,   <span class="number">37464</span></span><br><span class="line"> <span class="number">24</span> threadCount, timeline,     <span class="number">399572</span>,   <span class="number">13245</span>,   <span class="number">13017</span>,  <span class="number">112750</span>,     <span class="number">1.7</span>,     <span class="number">1.8</span>,     <span class="number">2.6</span>,     <span class="number">3.3</span>,     <span class="number">5.4</span>,    <span class="number">83.3</span>,   <span class="number">30.2</span>,  <span class="number">0.00266</span>,      <span class="number">0</span>,      <span class="number">6</span>,     <span class="number">447</span>,     <span class="number">447</span>,       <span class="number">2</span>,   <span class="number">56207</span></span><br><span class="line"> <span class="number">36</span> threadCount, timeline,     <span class="number">439440</span>,   <span class="number">14540</span>,   <span class="number">14291</span>,  <span class="number">123743</span>,     <span class="number">2.4</span>,     <span class="number">2.2</span>,     <span class="number">4.0</span>,     <span class="number">6.0</span>,    <span class="number">10.2</span>,    <span class="number">90.0</span>,   <span class="number">30.2</span>,  <span class="number">0.00303</span>,      <span class="number">0</span>,      <span class="number">5</span>,     <span class="number">374</span>,     <span class="number">374</span>,       <span class="number">2</span>,   <span class="number">46855</span></span><br><span class="line"> <span class="number">54</span> threadCount, timeline,     <span class="number">486527</span>,   <span class="number">13926</span>,   <span class="number">13693</span>,  <span class="number">118602</span>,     <span class="number">3.8</span>,     <span class="number">3.4</span>,     <span class="number">6.6</span>,     <span class="number">9.7</span>,    <span class="number">17.6</span>,   <span class="number">916.4</span>,   <span class="number">34.9</span>,  <span class="number">0.01927</span>,      <span class="number">0</span>,      <span class="number">6</span>,     <span class="number">444</span>,     <span class="number">444</span>,       <span class="number">5</span>,   <span class="number">56223</span></span><br><span class="line"> <span class="number">81</span> threadCount, timeline,     <span class="number">454010</span>,   <span class="number">14970</span>,   <span class="number">14714</span>,  <span class="number">127580</span>,     <span class="number">5.3</span>,     <span class="number">4.8</span>,     <span class="number">9.2</span>,    <span class="number">14.0</span>,    <span class="number">39.8</span>,   <span class="number">175.2</span>,   <span class="number">30.3</span>,  <span class="number">0.01782</span>,      <span class="number">0</span>,      <span class="number">6</span>,     <span class="number">485</span>,     <span class="number">485</span>,       <span class="number">7</span>,   <span class="number">56195</span></span><br><span class="line"><span class="number">121</span> threadCount, timeline,     <span class="number">503869</span>,   <span class="number">16544</span>,   <span class="number">16259</span>,  <span class="number">140877</span>,     <span class="number">7.2</span>,     <span class="number">6.6</span>,    <span class="number">12.3</span>,    <span class="number">17.0</span>,    <span class="number">81.2</span>,   <span class="number">106.9</span>,   <span class="number">30.5</span>,  <span class="number">0.00660</span>,      <span class="number">0</span>,      <span class="number">6</span>,     <span class="number">440</span>,     <span class="number">440</span>,       <span class="number">2</span>,   <span class="number">56155</span></span><br><span class="line"><span class="number">181</span> threadCount, timeline,     <span class="number">544709</span>,   <span class="number">17747</span>,   <span class="number">17446</span>,  <span class="number">151122</span>,    <span class="number">10.1</span>,     <span class="number">9.3</span>,    <span class="number">15.8</span>,    <span class="number">21.1</span>,    <span class="number">87.0</span>,   <span class="number">131.8</span>,   <span class="number">30.7</span>,  <span class="number">0.00631</span>,      <span class="number">0</span>,      <span class="number">6</span>,     <span class="number">426</span>,     <span class="number">426</span>,       <span class="number">2</span>,   <span class="number">56127</span></span><br><span class="line"><span class="number">271</span> threadCount, timeline,     <span class="number">569370</span>,   <span class="number">18463</span>,   <span class="number">18148</span>,  <span class="number">157275</span>,    <span class="number">14.6</span>,    <span class="number">13.5</span>,    <span class="number">22.3</span>,    <span class="number">26.8</span>,    <span class="number">89.7</span>,   <span class="number">149.3</span>,   <span class="number">30.8</span>,  <span class="number">0.00454</span>,      <span class="number">0</span>,      <span class="number">6</span>,     <span class="number">463</span>,     <span class="number">463</span>,      <span class="number">15</span>,   <span class="number">56122</span></span><br><span class="line"><span class="number">406</span> threadCount, timeline,     <span class="number">560757</span>,   <span class="number">17992</span>,   <span class="number">17679</span>,  <span class="number">153140</span>,    <span class="number">22.4</span>,    <span class="number">21.9</span>,    <span class="number">32.9</span>,    <span class="number">42.1</span>,   <span class="number">133.9</span>,   <span class="number">198.9</span>,   <span class="number">31.2</span>,  <span class="number">0.01142</span>,      <span class="number">0</span>,      <span class="number">6</span>,     <span class="number">414</span>,     <span class="number">414</span>,       <span class="number">3</span>,   <span class="number">56115</span></span><br><span class="line"><span class="number">609</span> threadCount, timeline,     <span class="number">579726</span>,   <span class="number">18491</span>,   <span class="number">18181</span>,  <span class="number">157507</span>,    <span class="number">32.8</span>,    <span class="number">32.1</span>,    <span class="number">44.9</span>,    <span class="number">59.0</span>,   <span class="number">141.0</span>,   <span class="number">177.7</span>,   <span class="number">31.4</span>,  <span class="number">0.00779</span>,      <span class="number">0</span>,      <span class="number">6</span>,     <span class="number">421</span>,     <span class="number">421</span>,       <span class="number">6</span>,   <span class="number">56091</span></span><br><span class="line"><span class="number">913</span> threadCount, timeline,     <span class="number">609238</span>,   <span class="number">19220</span>,   <span class="number">18888</span>,  <span class="number">163580</span>,    <span class="number">47.4</span>,    <span class="number">45.8</span>,    <span class="number">58.4</span>,   <span class="number">111.9</span>,   <span class="number">283.9</span>,   <span class="number">306.1</span>,   <span class="number">31.7</span>,  <span class="number">0.01073</span>,      <span class="number">0</span>,      <span class="number">6</span>,     <span class="number">414</span>,     <span class="number">414</span>,       <span class="number">2</span>,   <span class="number">56103</span></span><br></pre></td></tr></table></figure>
<p>G1_32G</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line">  <span class="number">4</span> threadCount, timeline,     <span class="number">106287</span>,    <span class="number">3532</span>,    <span class="number">3532</span>,   <span class="number">29277</span>,     <span class="number">1.1</span>,     <span class="number">1.1</span>,     <span class="number">1.4</span>,     <span class="number">1.5</span>,     <span class="number">1.7</span>,    <span class="number">77.9</span>,   <span class="number">30.1</span>,  <span class="number">0.00395</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">76</span>,      <span class="number">76</span>,       <span class="number">0</span>,   <span class="number">19328</span></span><br><span class="line">  <span class="number">8</span> threadCount, timeline,     <span class="number">200907</span>,    <span class="number">6677</span>,    <span class="number">6676</span>,   <span class="number">55365</span>,     <span class="number">1.1</span>,     <span class="number">1.1</span>,     <span class="number">1.4</span>,     <span class="number">1.6</span>,     <span class="number">1.8</span>,    <span class="number">79.5</span>,   <span class="number">30.1</span>,  <span class="number">0.00313</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">76</span>,      <span class="number">76</span>,       <span class="number">0</span>,   <span class="number">19335</span></span><br><span class="line"> <span class="number">16</span> threadCount, timeline,     <span class="number">350519</span>,   <span class="number">11640</span>,   <span class="number">11639</span>,   <span class="number">96518</span>,     <span class="number">1.3</span>,     <span class="number">1.3</span>,     <span class="number">1.7</span>,     <span class="number">1.9</span>,     <span class="number">2.6</span>,    <span class="number">82.9</span>,   <span class="number">30.1</span>,  <span class="number">0.01155</span>,      <span class="number">0</span>,      <span class="number">3</span>,     <span class="number">224</span>,     <span class="number">224</span>,       <span class="number">3</span>,   <span class="number">58033</span></span><br><span class="line"> <span class="number">24</span> threadCount, timeline,     <span class="number">454119</span>,   <span class="number">15074</span>,   <span class="number">15073</span>,  <span class="number">124972</span>,     <span class="number">1.5</span>,     <span class="number">1.4</span>,     <span class="number">2.1</span>,     <span class="number">2.6</span>,     <span class="number">4.1</span>,    <span class="number">83.0</span>,   <span class="number">30.1</span>,  <span class="number">0.00830</span>,      <span class="number">0</span>,      <span class="number">3</span>,     <span class="number">225</span>,     <span class="number">225</span>,       <span class="number">4</span>,   <span class="number">58022</span></span><br><span class="line"> <span class="number">36</span> threadCount, timeline,     <span class="number">485724</span>,   <span class="number">16081</span>,   <span class="number">16080</span>,  <span class="number">133276</span>,     <span class="number">2.1</span>,     <span class="number">1.9</span>,     <span class="number">3.4</span>,     <span class="number">5.2</span>,     <span class="number">8.3</span>,    <span class="number">80.1</span>,   <span class="number">30.2</span>,  <span class="number">0.00793</span>,      <span class="number">0</span>,      <span class="number">3</span>,     <span class="number">216</span>,     <span class="number">216</span>,       <span class="number">0</span>,   <span class="number">58039</span></span><br><span class="line"> <span class="number">54</span> threadCount, timeline,     <span class="number">493962</span>,   <span class="number">16307</span>,   <span class="number">16306</span>,  <span class="number">135098</span>,     <span class="number">3.2</span>,     <span class="number">2.9</span>,     <span class="number">5.3</span>,     <span class="number">8.8</span>,    <span class="number">14.4</span>,    <span class="number">90.9</span>,   <span class="number">30.3</span>,  <span class="number">0.00459</span>,      <span class="number">0</span>,      <span class="number">3</span>,     <span class="number">223</span>,     <span class="number">223</span>,       <span class="number">1</span>,   <span class="number">58007</span></span><br><span class="line"> <span class="number">81</span> threadCount, timeline,     <span class="number">496295</span>,   <span class="number">16383</span>,   <span class="number">16382</span>,  <span class="number">135850</span>,     <span class="number">4.8</span>,     <span class="number">4.4</span>,     <span class="number">7.9</span>,    <span class="number">11.7</span>,    <span class="number">22.5</span>,   <span class="number">114.7</span>,   <span class="number">30.3</span>,  <span class="number">0.00669</span>,      <span class="number">0</span>,      <span class="number">4</span>,     <span class="number">293</span>,     <span class="number">293</span>,       <span class="number">1</span>,   <span class="number">77393</span></span><br><span class="line"><span class="number">121</span> threadCount, timeline,     <span class="number">509577</span>,   <span class="number">16710</span>,   <span class="number">16708</span>,  <span class="number">138473</span>,     <span class="number">7.1</span>,     <span class="number">6.4</span>,    <span class="number">11.6</span>,    <span class="number">15.8</span>,    <span class="number">34.3</span>,    <span class="number">92.5</span>,   <span class="number">30.5</span>,  <span class="number">0.00294</span>,      <span class="number">0</span>,      <span class="number">3</span>,     <span class="number">215</span>,     <span class="number">215</span>,       <span class="number">1</span>,   <span class="number">58039</span></span><br><span class="line"><span class="number">181</span> threadCount, timeline,     <span class="number">526174</span>,   <span class="number">17130</span>,   <span class="number">17129</span>,  <span class="number">142058</span>,    <span class="number">10.5</span>,     <span class="number">9.6</span>,    <span class="number">16.1</span>,    <span class="number">20.2</span>,    <span class="number">33.4</span>,   <span class="number">114.9</span>,   <span class="number">30.7</span>,  <span class="number">0.00473</span>,      <span class="number">0</span>,      <span class="number">4</span>,     <span class="number">295</span>,     <span class="number">295</span>,       <span class="number">2</span>,   <span class="number">77407</span></span><br><span class="line"><span class="number">271</span> threadCount, timeline,     <span class="number">530603</span>,   <span class="number">17213</span>,   <span class="number">17212</span>,  <span class="number">142632</span>,    <span class="number">15.6</span>,    <span class="number">14.6</span>,    <span class="number">23.7</span>,    <span class="number">29.1</span>,    <span class="number">97.5</span>,   <span class="number">154.6</span>,   <span class="number">30.8</span>,  <span class="number">0.00926</span>,      <span class="number">0</span>,      <span class="number">3</span>,     <span class="number">220</span>,     <span class="number">220</span>,       <span class="number">3</span>,   <span class="number">58047</span></span><br></pre></td></tr></table></figure>
<h3 id="G1测试">G1测试</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/home/admin/apache-cassandra-2.2.6/tools/bin/cassandra-stress write n=50000000 truncate=always -node 10.21.21.10 </span></span><br><span class="line">/home/admin/apache-cassandra-<span class="number">2.2</span>.<span class="number">6</span>/tools/bin/cassandra-stress write n=<span class="number">50000000</span> cl=ONE truncate=always -mode native cql3 -node <span class="number">10.21</span>.<span class="number">21.10</span> </span><br><span class="line">/home/admin/apache-cassandra-<span class="number">2.2</span>.<span class="number">6</span>/tools/bin/cassandra-stress <span class="built_in">read</span> n=<span class="number">200000</span> no-warmup -rate threads\&gt;=<span class="number">16</span> -node <span class="number">10.21</span>.<span class="number">21.10</span></span><br><span class="line">/home/admin/apache-cassandra-<span class="number">2.2</span>.<span class="number">6</span>/tools/bin/cassandra-stress mixed ratio\(write=<span class="number">1</span>,<span class="built_in">read</span>=<span class="number">3</span>\) n=<span class="number">100000</span> cl=ONE -pop dist=UNIFORM\(<span class="number">1</span>..<span class="number">1000000</span>\) -schema keyspace=<span class="string">"keyspace1"</span> -mode native cql3 -rate threads\&gt;=<span class="number">16</span> -node <span class="number">10.21</span>.<span class="number">21.10</span></span><br><span class="line">/home/admin/apache-cassandra-<span class="number">2.2</span>.<span class="number">6</span>/tools/bin/cassandra-stress mixed ratio\(write=<span class="number">3</span>,<span class="built_in">read</span>=<span class="number">1</span>\) n=<span class="number">100000</span> cl=ONE -pop dist=UNIFORM\(<span class="number">1</span>..<span class="number">1000000</span>\) -schema keyspace=<span class="string">"keyspace1"</span> -mode native cql3 -rate threads\&gt;=<span class="number">16</span> -node <span class="number">10.21</span>.<span class="number">21.10</span></span><br></pre></td></tr></table></figure>
<p>CMS Heap/New=8G/2G</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">Results:</span></span><br><span class="line">op <span class="string">rate                   :</span> <span class="number">126219</span> [<span class="string">WRITE:</span><span class="number">126219</span>]</span><br><span class="line">partition <span class="string">rate            :</span> <span class="number">126219</span> [<span class="string">WRITE:</span><span class="number">126219</span>]</span><br><span class="line">row <span class="string">rate                  :</span> <span class="number">126219</span> [<span class="string">WRITE:</span><span class="number">126219</span>]</span><br><span class="line">latency <span class="string">mean              :</span> <span class="number">1.6</span> [<span class="string">WRITE:</span><span class="number">1.6</span>]</span><br><span class="line">latency <span class="string">median            :</span> <span class="number">1.3</span> [<span class="string">WRITE:</span><span class="number">1.3</span>]</span><br><span class="line">latency <span class="number">95</span>th <span class="string">percentile   :</span> <span class="number">1.9</span> [<span class="string">WRITE:</span><span class="number">1.9</span>]</span><br><span class="line">latency <span class="number">99</span>th <span class="string">percentile   :</span> <span class="number">3.0</span> [<span class="string">WRITE:</span><span class="number">3.0</span>]</span><br><span class="line">latency <span class="number">99.9</span>th <span class="string">percentile :</span> <span class="number">19.2</span> [<span class="string">WRITE:</span><span class="number">19.2</span>]</span><br><span class="line">latency <span class="string">max               :</span> <span class="number">5649.4</span> [<span class="string">WRITE:</span><span class="number">5649.4</span>]</span><br><span class="line">Total <span class="string">partitions          :</span> <span class="number">50000000</span> [<span class="string">WRITE:</span><span class="number">50000000</span>]</span><br><span class="line">Total <span class="string">errors              :</span> <span class="number">0</span> [<span class="string">WRITE:</span><span class="number">0</span>]</span><br><span class="line">total gc <span class="string">count            :</span> <span class="number">335</span></span><br><span class="line">total gc <span class="string">mb               :</span> <span class="number">486236</span></span><br><span class="line">total gc time (s)         : <span class="number">41</span></span><br><span class="line">avg gc time(ms)           : <span class="number">121</span></span><br><span class="line">stdev gc time(ms)         : <span class="number">223</span></span><br><span class="line">Total operation <span class="string">time      :</span> <span class="number">00</span>:<span class="number">06</span>:<span class="number">36</span></span><br></pre></td></tr></table></figure>
<p>G1 Heap=16G(16384M)，或者微调G1的选项，设置目标GC时间为1s，设置当堆内存占用60%时触发执行GC。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#JVM_OPTS="$JVM_OPTS -XX:MaxGCPauseMillis=500"</span></span><br><span class="line">JVM_OPTS=<span class="string">"<span class="variable">$JVM_OPTS</span> -XX:MaxGCPauseMillis=1000"</span></span><br><span class="line">JVM_OPTS=<span class="string">"<span class="variable">$JVM_OPTS</span> -XX:InitiatingHeapOccupancyPercent=60"</span></span><br></pre></td></tr></table></figure>
<p>测试结果：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">op <span class="string">rate                   :</span> <span class="number">117340</span> [<span class="string">WRITE:</span><span class="number">117340</span>]</span><br><span class="line">partition <span class="string">rate            :</span> <span class="number">117340</span> [<span class="string">WRITE:</span><span class="number">117340</span>]</span><br><span class="line">row <span class="string">rate                  :</span> <span class="number">117340</span> [<span class="string">WRITE:</span><span class="number">117340</span>]</span><br><span class="line">latency <span class="string">mean              :</span> <span class="number">1.7</span> [<span class="string">WRITE:</span><span class="number">1.7</span>]</span><br><span class="line">latency <span class="string">median            :</span> <span class="number">1.3</span> [<span class="string">WRITE:</span><span class="number">1.3</span>]</span><br><span class="line">latency <span class="number">95</span>th <span class="string">percentile   :</span> <span class="number">2.7</span> [<span class="string">WRITE:</span><span class="number">2.7</span>]</span><br><span class="line">latency <span class="number">99</span>th <span class="string">percentile   :</span> <span class="number">4.1</span> [<span class="string">WRITE:</span><span class="number">4.1</span>]</span><br><span class="line">latency <span class="number">99.9</span>th <span class="string">percentile :</span> <span class="number">13.2</span> [<span class="string">WRITE:</span><span class="number">13.2</span>]</span><br><span class="line">latency <span class="string">max               :</span> <span class="number">654.6</span> [<span class="string">WRITE:</span><span class="number">654.6</span>]</span><br><span class="line">Total <span class="string">partitions          :</span> <span class="number">50000000</span> [<span class="string">WRITE:</span><span class="number">50000000</span>]</span><br><span class="line">Total <span class="string">errors              :</span> <span class="number">0</span> [<span class="string">WRITE:</span><span class="number">0</span>]</span><br><span class="line">total gc <span class="string">count            :</span> <span class="number">102</span></span><br><span class="line">total gc <span class="string">mb               :</span> <span class="number">508991</span></span><br><span class="line">total gc time (s)         : <span class="number">23</span></span><br><span class="line">avg gc time(ms)           : <span class="number">226</span></span><br><span class="line">stdev gc time(ms)         : <span class="number">80</span></span><br><span class="line">Total operation <span class="string">time      :</span> <span class="number">00</span>:<span class="number">07</span>:<span class="number">06</span></span><br></pre></td></tr></table></figure>
<p>G1 Heap=24G(24576M)</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">op <span class="string">rate                   :</span> <span class="number">134586</span> [<span class="string">WRITE:</span><span class="number">134586</span>]</span><br><span class="line">partition <span class="string">rate            :</span> <span class="number">134586</span> [<span class="string">WRITE:</span><span class="number">134586</span>]</span><br><span class="line">row <span class="string">rate                  :</span> <span class="number">134586</span> [<span class="string">WRITE:</span><span class="number">134586</span>]</span><br><span class="line">latency <span class="string">mean              :</span> <span class="number">1.5</span> [<span class="string">WRITE:</span><span class="number">1.5</span>]</span><br><span class="line">latency <span class="string">median            :</span> <span class="number">1.3</span> [<span class="string">WRITE:</span><span class="number">1.3</span>]</span><br><span class="line">latency <span class="number">95</span>th <span class="string">percentile   :</span> <span class="number">1.6</span> [<span class="string">WRITE:</span><span class="number">1.6</span>]</span><br><span class="line">latency <span class="number">99</span>th <span class="string">percentile   :</span> <span class="number">2.5</span> [<span class="string">WRITE:</span><span class="number">2.5</span>]</span><br><span class="line">latency <span class="number">99.9</span>th <span class="string">percentile :</span> <span class="number">6.4</span> [<span class="string">WRITE:</span><span class="number">6.4</span>]</span><br><span class="line">latency <span class="string">max               :</span> <span class="number">637.7</span> [<span class="string">WRITE:</span><span class="number">637.7</span>]</span><br><span class="line">Total <span class="string">partitions          :</span> <span class="number">50000000</span> [<span class="string">WRITE:</span><span class="number">50000000</span>]</span><br><span class="line">Total <span class="string">errors              :</span> <span class="number">0</span> [<span class="string">WRITE:</span><span class="number">0</span>]</span><br><span class="line">total gc <span class="string">count            :</span> <span class="number">60</span></span><br><span class="line">total gc <span class="string">mb               :</span> <span class="number">438681</span></span><br><span class="line">total gc time (s)         : <span class="number">21</span></span><br><span class="line">avg gc time(ms)           : <span class="number">346</span></span><br><span class="line">stdev gc time(ms)         : <span class="number">102</span></span><br><span class="line">Total operation <span class="string">time      :</span> <span class="number">00</span>:<span class="number">06</span>:<span class="number">11</span></span><br></pre></td></tr></table></figure>
<p>JDK: zulu8.15.0.1-jdk8.0.92-linux_x64<br>测试结果显示，zulu在24G下并没有性能提升，相反每秒钟的吞吐量下降了2万多，GC也好不到哪里去。  </p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">op <span class="string">rate                   :</span> <span class="number">111652</span> [<span class="string">WRITE:</span><span class="number">111652</span>]</span><br><span class="line">partition <span class="string">rate            :</span> <span class="number">111652</span> [<span class="string">WRITE:</span><span class="number">111652</span>]</span><br><span class="line">row <span class="string">rate                  :</span> <span class="number">111652</span> [<span class="string">WRITE:</span><span class="number">111652</span>]</span><br><span class="line">latency <span class="string">mean              :</span> <span class="number">1.8</span> [<span class="string">WRITE:</span><span class="number">1.8</span>]</span><br><span class="line">latency <span class="string">median            :</span> <span class="number">1.4</span> [<span class="string">WRITE:</span><span class="number">1.4</span>]</span><br><span class="line">latency <span class="number">95</span>th <span class="string">percentile   :</span> <span class="number">2.9</span> [<span class="string">WRITE:</span><span class="number">2.9</span>]</span><br><span class="line">latency <span class="number">99</span>th <span class="string">percentile   :</span> <span class="number">4.5</span> [<span class="string">WRITE:</span><span class="number">4.5</span>]</span><br><span class="line">latency <span class="number">99.9</span>th <span class="string">percentile :</span> <span class="number">11.8</span> [<span class="string">WRITE:</span><span class="number">11.8</span>]</span><br><span class="line">latency <span class="string">max               :</span> <span class="number">1820.3</span> [<span class="string">WRITE:</span><span class="number">1820.3</span>]</span><br><span class="line">Total <span class="string">partitions          :</span> <span class="number">50000000</span> [<span class="string">WRITE:</span><span class="number">50000000</span>]</span><br><span class="line">Total <span class="string">errors              :</span> <span class="number">0</span> [<span class="string">WRITE:</span><span class="number">0</span>]</span><br><span class="line">total gc <span class="string">count            :</span> <span class="number">67</span></span><br><span class="line">total gc <span class="string">mb               :</span> <span class="number">435180</span></span><br><span class="line">total gc time (s)         : <span class="number">23</span></span><br><span class="line">avg gc time(ms)           : <span class="number">344</span></span><br><span class="line">stdev gc time(ms)         : <span class="number">146</span></span><br><span class="line">Total operation <span class="string">time      :</span> <span class="number">00</span>:<span class="number">07</span>:<span class="number">27</span></span><br></pre></td></tr></table></figure>
<p>G1 Heap=32G(32768M)</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">op <span class="string">rate                   :</span> <span class="number">120814</span> [<span class="string">WRITE:</span><span class="number">120814</span>]</span><br><span class="line">partition <span class="string">rate            :</span> <span class="number">120814</span> [<span class="string">WRITE:</span><span class="number">120814</span>]</span><br><span class="line">row <span class="string">rate                  :</span> <span class="number">120814</span> [<span class="string">WRITE:</span><span class="number">120814</span>]</span><br><span class="line">latency <span class="string">mean              :</span> <span class="number">1.6</span> [<span class="string">WRITE:</span><span class="number">1.6</span>]</span><br><span class="line">latency <span class="string">median            :</span> <span class="number">1.3</span> [<span class="string">WRITE:</span><span class="number">1.3</span>]</span><br><span class="line">latency <span class="number">95</span>th <span class="string">percentile   :</span> <span class="number">2.4</span> [<span class="string">WRITE:</span><span class="number">2.4</span>]</span><br><span class="line">latency <span class="number">99</span>th <span class="string">percentile   :</span> <span class="number">3.9</span> [<span class="string">WRITE:</span><span class="number">3.9</span>]</span><br><span class="line">latency <span class="number">99.9</span>th <span class="string">percentile :</span> <span class="number">11.1</span> [<span class="string">WRITE:</span><span class="number">11.1</span>]</span><br><span class="line">latency <span class="string">max               :</span> <span class="number">1622.8</span> [<span class="string">WRITE:</span><span class="number">1622.8</span>]</span><br><span class="line">Total <span class="string">partitions          :</span> <span class="number">50000000</span> [<span class="string">WRITE:</span><span class="number">50000000</span>]</span><br><span class="line">Total <span class="string">errors              :</span> <span class="number">0</span> [<span class="string">WRITE:</span><span class="number">0</span>]</span><br><span class="line">total gc <span class="string">count            :</span> <span class="number">51</span></span><br><span class="line">total gc <span class="string">mb               :</span> <span class="number">567608</span></span><br><span class="line">total gc time (s)         : <span class="number">22</span></span><br><span class="line">avg gc time(ms)           : <span class="number">429</span></span><br><span class="line">stdev gc time(ms)         : <span class="number">144</span></span><br><span class="line">Total operation <span class="string">time      :</span> <span class="number">00</span>:<span class="number">06</span>:<span class="number">53</span></span><br></pre></td></tr></table></figure>
<p>9个节点的集群: /home/admin/apache-cassandra-2.2.6/tools/bin/cassandra-stress write n=50000000 cl=ONE truncate=always -mode native cql3 -node 10.21.21.19,10.21.21.20,10.21.21.21,10.21.21.22,10.21.21.23,10.21.21.24,10.21.21.25,10.21.21.26,10.21.21.130</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">op <span class="string">rate                   :</span> <span class="number">308252</span> [<span class="string">WRITE:</span><span class="number">308252</span>]</span><br><span class="line">partition <span class="string">rate            :</span> <span class="number">308252</span> [<span class="string">WRITE:</span><span class="number">308252</span>]</span><br><span class="line">row <span class="string">rate                  :</span> <span class="number">308252</span> [<span class="string">WRITE:</span><span class="number">308252</span>]</span><br><span class="line">latency <span class="string">mean              :</span> <span class="number">0.6</span> [<span class="string">WRITE:</span><span class="number">0.6</span>]</span><br><span class="line">latency <span class="string">median            :</span> <span class="number">0.3</span> [<span class="string">WRITE:</span><span class="number">0.3</span>]</span><br><span class="line">latency <span class="number">95</span>th <span class="string">percentile   :</span> <span class="number">2.1</span> [<span class="string">WRITE:</span><span class="number">2.1</span>]</span><br><span class="line">latency <span class="number">99</span>th <span class="string">percentile   :</span> <span class="number">3.2</span> [<span class="string">WRITE:</span><span class="number">3.2</span>]</span><br><span class="line">latency <span class="number">99.9</span>th <span class="string">percentile :</span> <span class="number">6.2</span> [<span class="string">WRITE:</span><span class="number">6.2</span>]</span><br><span class="line">latency <span class="string">max               :</span> <span class="number">495.6</span> [<span class="string">WRITE:</span><span class="number">495.6</span>]</span><br><span class="line">Total <span class="string">partitions          :</span> <span class="number">50000000</span> [<span class="string">WRITE:</span><span class="number">50000000</span>]</span><br><span class="line">Total <span class="string">errors              :</span> <span class="number">0</span> [<span class="string">WRITE:</span><span class="number">0</span>]</span><br><span class="line">total gc <span class="string">count            :</span> <span class="number">83</span></span><br><span class="line">total gc <span class="string">mb               :</span> <span class="number">633231</span></span><br><span class="line">total gc time (s)         : <span class="number">14</span></span><br><span class="line">avg gc time(ms)           : <span class="number">165</span></span><br><span class="line">stdev gc time(ms)         : <span class="number">101</span></span><br><span class="line">Total operation <span class="string">time      :</span> <span class="number">00</span>:<span class="number">02</span>:<span class="number">42</span></span><br></pre></td></tr></table></figure>
<h3 id="集群测试">集群测试</h3><p>10.21.21.10,10.21.21.11,10.21.21.12,10.21.21.13,10.21.21.14,10.21.21.15,10.21.21.16,10.21.21.17,10.21.21.18<br>10.21.21.19,10.21.21.20,10.21.21.21,10.21.21.22,10.21.21.23,10.21.21.24,10.21.21.25,10.21.21.26,10.21.21.130</p>
<p>nohup sh stress1.sh &gt; stress1.log 2&gt;&amp;1 &amp;</p>
<p>100万写，20万读，10万混合读写；5000万写，100万混合读写；自定义表结构</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/home/admin/apache-cassandra-<span class="number">2.2</span>.<span class="number">6</span>/tools/bin/cassandra-stress write n=<span class="number">1000000</span> -node <span class="number">10.21</span>.<span class="number">21.19</span>,<span class="number">10.21</span>.<span class="number">21.20</span>,<span class="number">10.21</span>.<span class="number">21.21</span>,<span class="number">10.21</span>.<span class="number">21.22</span>,<span class="number">10.21</span>.<span class="number">21.23</span>,<span class="number">10.21</span>.<span class="number">21.24</span>,<span class="number">10.21</span>.<span class="number">21.25</span>,<span class="number">10.21</span>.<span class="number">21.26</span>,<span class="number">10.21</span>.<span class="number">21.130</span> -log file=CLUSTER401_write_10M.log</span><br><span class="line">/home/admin/apache-cassandra-<span class="number">2.2</span>.<span class="number">6</span>/tools/bin/cassandra-stress <span class="built_in">read</span> n=<span class="number">200000</span> -node <span class="number">10.21</span>.<span class="number">21.19</span>,<span class="number">10.21</span>.<span class="number">21.20</span>,<span class="number">10.21</span>.<span class="number">21.21</span>,<span class="number">10.21</span>.<span class="number">21.22</span>,<span class="number">10.21</span>.<span class="number">21.23</span>,<span class="number">10.21</span>.<span class="number">21.24</span>,<span class="number">10.21</span>.<span class="number">21.25</span>,<span class="number">10.21</span>.<span class="number">21.26</span>,<span class="number">10.21</span>.<span class="number">21.130</span> -log file=CLUSTER402_<span class="built_in">read</span>_2.log</span><br><span class="line">/home/admin/apache-cassandra-<span class="number">2.2</span>.<span class="number">6</span>/tools/bin/cassandra-stress <span class="built_in">read</span> n=<span class="number">200000</span> no-warmup -node <span class="number">10.21</span>.<span class="number">21.19</span>,<span class="number">10.21</span>.<span class="number">21.20</span>,<span class="number">10.21</span>.<span class="number">21.21</span>,<span class="number">10.21</span>.<span class="number">21.22</span>,<span class="number">10.21</span>.<span class="number">21.23</span>,<span class="number">10.21</span>.<span class="number">21.24</span>,<span class="number">10.21</span>.<span class="number">21.25</span>,<span class="number">10.21</span>.<span class="number">21.26</span>,<span class="number">10.21</span>.<span class="number">21.130</span> -log file=CLUSTER403_<span class="built_in">read</span>_2_nowarm.log</span><br><span class="line">/home/admin/apache-cassandra-<span class="number">2.2</span>.<span class="number">6</span>/tools/bin/cassandra-stress <span class="built_in">read</span> duration=<span class="number">3</span>m -rate threads\&gt;=<span class="number">16</span> -node <span class="number">10.21</span>.<span class="number">21.19</span>,<span class="number">10.21</span>.<span class="number">21.20</span>,<span class="number">10.21</span>.<span class="number">21.21</span>,<span class="number">10.21</span>.<span class="number">21.22</span>,<span class="number">10.21</span>.<span class="number">21.23</span>,<span class="number">10.21</span>.<span class="number">21.24</span>,<span class="number">10.21</span>.<span class="number">21.25</span>,<span class="number">10.21</span>.<span class="number">21.26</span>,<span class="number">10.21</span>.<span class="number">21.130</span> -log file=CLUSTER404_<span class="built_in">read</span>_3min.log</span><br><span class="line">/home/admin/apache-cassandra-<span class="number">2.2</span>.<span class="number">6</span>/tools/bin/cassandra-stress mixed ratio\(write=<span class="number">1</span>,<span class="built_in">read</span>=<span class="number">3</span>\) n=<span class="number">100000</span> cl=ONE -pop dist=UNIFORM\(<span class="number">1</span>..<span class="number">10000000</span>\) -schema keyspace=<span class="string">"keyspace1"</span> -mode native cql3 -rate threads\&gt;=<span class="number">16</span> -log file=CLUSTER405_mixed_<span class="built_in">read</span>3_10M.log -node <span class="number">10.21</span>.<span class="number">21.19</span>,<span class="number">10.21</span>.<span class="number">21.20</span>,<span class="number">10.21</span>.<span class="number">21.21</span>,<span class="number">10.21</span>.<span class="number">21.22</span>,<span class="number">10.21</span>.<span class="number">21.23</span>,<span class="number">10.21</span>.<span class="number">21.24</span>,<span class="number">10.21</span>.<span class="number">21.25</span>,<span class="number">10.21</span>.<span class="number">21.26</span>,<span class="number">10.21</span>.<span class="number">21.130</span></span><br><span class="line">/home/admin/apache-cassandra-<span class="number">2.2</span>.<span class="number">6</span>/tools/bin/cassandra-stress mixed ratio\(write=<span class="number">3</span>,<span class="built_in">read</span>=<span class="number">1</span>\) n=<span class="number">100000</span> cl=ONE -pop dist=UNIFORM\(<span class="number">1</span>..<span class="number">10000000</span>\) -schema keyspace=<span class="string">"keyspace1"</span> -mode native cql3 -rate threads\&gt;=<span class="number">16</span> -log file=CLUSTER406_mixed_write3_10M.log -node <span class="number">10.21</span>.<span class="number">21.19</span>,<span class="number">10.21</span>.<span class="number">21.20</span>,<span class="number">10.21</span>.<span class="number">21.21</span>,<span class="number">10.21</span>.<span class="number">21.22</span>,<span class="number">10.21</span>.<span class="number">21.23</span>,<span class="number">10.21</span>.<span class="number">21.24</span>,<span class="number">10.21</span>.<span class="number">21.25</span>,<span class="number">10.21</span>.<span class="number">21.26</span>,<span class="number">10.21</span>.<span class="number">21.130</span></span><br><span class="line">/home/admin/apache-cassandra-<span class="number">2.2</span>.<span class="number">6</span>/tools/bin/cassandra-stress write n=<span class="number">50000000</span> cl=ONE -mode native cql3 -node <span class="number">10.21</span>.<span class="number">21.19</span>,<span class="number">10.21</span>.<span class="number">21.20</span>,<span class="number">10.21</span>.<span class="number">21.21</span>,<span class="number">10.21</span>.<span class="number">21.22</span>,<span class="number">10.21</span>.<span class="number">21.23</span>,<span class="number">10.21</span>.<span class="number">21.24</span>,<span class="number">10.21</span>.<span class="number">21.25</span>,<span class="number">10.21</span>.<span class="number">21.26</span>,<span class="number">10.21</span>.<span class="number">21.130</span> -log file=CLUSTER407_write_50M.log</span><br><span class="line">/home/admin/apache-cassandra-<span class="number">2.2</span>.<span class="number">6</span>/tools/bin/cassandra-stress mixed ratio\(write=<span class="number">1</span>,<span class="built_in">read</span>=<span class="number">3</span>\) n=<span class="number">1000000</span> cl=ONE -pop dist=UNIFORM\(<span class="number">1</span>..<span class="number">10000000</span>\) -schema keyspace=<span class="string">"keyspace1"</span> -mode native cql3 -rate threads\&gt;=<span class="number">16</span> -log file=CLUSTER408_mixed_<span class="built_in">read</span>3_100M.log -node <span class="number">10.21</span>.<span class="number">21.19</span>,<span class="number">10.21</span>.<span class="number">21.20</span>,<span class="number">10.21</span>.<span class="number">21.21</span>,<span class="number">10.21</span>.<span class="number">21.22</span>,<span class="number">10.21</span>.<span class="number">21.23</span>,<span class="number">10.21</span>.<span class="number">21.24</span>,<span class="number">10.21</span>.<span class="number">21.25</span>,<span class="number">10.21</span>.<span class="number">21.26</span>,<span class="number">10.21</span>.<span class="number">21.130</span></span><br><span class="line">/home/admin/apache-cassandra-<span class="number">2.2</span>.<span class="number">6</span>/tools/bin/cassandra-stress mixed ratio\(write=<span class="number">3</span>,<span class="built_in">read</span>=<span class="number">1</span>\) n=<span class="number">1000000</span> cl=ONE -pop dist=UNIFORM\(<span class="number">1</span>..<span class="number">10000000</span>\) -schema keyspace=<span class="string">"keyspace1"</span> -mode native cql3 -rate threads\&gt;=<span class="number">16</span> -log file=CLUSTER409_mixed_write3_100M.log -node <span class="number">10.21</span>.<span class="number">21.19</span>,<span class="number">10.21</span>.<span class="number">21.20</span>,<span class="number">10.21</span>.<span class="number">21.21</span>,<span class="number">10.21</span>.<span class="number">21.22</span>,<span class="number">10.21</span>.<span class="number">21.23</span>,<span class="number">10.21</span>.<span class="number">21.24</span>,<span class="number">10.21</span>.<span class="number">21.25</span>,<span class="number">10.21</span>.<span class="number">21.26</span>,<span class="number">10.21</span>.<span class="number">21.130</span></span><br><span class="line"></span><br><span class="line">/home/admin/apache-cassandra-<span class="number">2.2</span>.<span class="number">6</span>/tools/bin/cassandra-stress user profile=blogpost3.yaml ops\(insert=<span class="number">1</span>\) -node <span class="number">10.21</span>.<span class="number">21.19</span>,<span class="number">10.21</span>.<span class="number">21.20</span>,<span class="number">10.21</span>.<span class="number">21.21</span>,<span class="number">10.21</span>.<span class="number">21.22</span>,<span class="number">10.21</span>.<span class="number">21.23</span>,<span class="number">10.21</span>.<span class="number">21.24</span>,<span class="number">10.21</span>.<span class="number">21.25</span>,<span class="number">10.21</span>.<span class="number">21.26</span>,<span class="number">10.21</span>.<span class="number">21.130</span> -log file=CLUSTER410_blog_insert.log</span><br><span class="line">/home/admin/apache-cassandra-<span class="number">2.2</span>.<span class="number">6</span>/tools/bin/cassandra-stress user profile=blogpost3.yaml ops\(singlepost=<span class="number">2</span>,timeline=<span class="number">1</span>,insert=<span class="number">1</span>\) -node <span class="number">10.21</span>.<span class="number">21.19</span>,<span class="number">10.21</span>.<span class="number">21.20</span>,<span class="number">10.21</span>.<span class="number">21.21</span>,<span class="number">10.21</span>.<span class="number">21.22</span>,<span class="number">10.21</span>.<span class="number">21.23</span>,<span class="number">10.21</span>.<span class="number">21.24</span>,<span class="number">10.21</span>.<span class="number">21.25</span>,<span class="number">10.21</span>.<span class="number">21.26</span>,<span class="number">10.21</span>.<span class="number">21.130</span> -log file=CLUSTER411_blog_mixed.log</span><br><span class="line">/home/admin/apache-cassandra-<span class="number">2.2</span>.<span class="number">6</span>/tools/bin/cassandra-stress user profile=blogpost3.yaml ops\(singlepost=<span class="number">1</span>\) -node <span class="number">10.21</span>.<span class="number">21.19</span>,<span class="number">10.21</span>.<span class="number">21.20</span>,<span class="number">10.21</span>.<span class="number">21.21</span>,<span class="number">10.21</span>.<span class="number">21.22</span>,<span class="number">10.21</span>.<span class="number">21.23</span>,<span class="number">10.21</span>.<span class="number">21.24</span>,<span class="number">10.21</span>.<span class="number">21.25</span>,<span class="number">10.21</span>.<span class="number">21.26</span>,<span class="number">10.21</span>.<span class="number">21.130</span> -log file=CLUSTER412_blog_q1.log</span><br><span class="line">/home/admin/apache-cassandra-<span class="number">2.2</span>.<span class="number">6</span>/tools/bin/cassandra-stress user profile=blogpost3.yaml ops\(timeline=<span class="number">1</span>\) -node <span class="number">10.21</span>.<span class="number">21.19</span>,<span class="number">10.21</span>.<span class="number">21.20</span>,<span class="number">10.21</span>.<span class="number">21.21</span>,<span class="number">10.21</span>.<span class="number">21.22</span>,<span class="number">10.21</span>.<span class="number">21.23</span>,<span class="number">10.21</span>.<span class="number">21.24</span>,<span class="number">10.21</span>.<span class="number">21.25</span>,<span class="number">10.21</span>.<span class="number">21.26</span>,<span class="number">10.21</span>.<span class="number">21.130</span> -log file=CLUSTER413_blog_q2.log</span><br></pre></td></tr></table></figure>
<p>CLUSTER41_write_1M.log</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">Results:</span></span><br><span class="line">op <span class="string">rate                   :</span> <span class="number">259897</span> [<span class="string">WRITE:</span><span class="number">259897</span>]</span><br><span class="line">partition <span class="string">rate            :</span> <span class="number">259897</span> [<span class="string">WRITE:</span><span class="number">259897</span>]</span><br><span class="line">row <span class="string">rate                  :</span> <span class="number">259897</span> [<span class="string">WRITE:</span><span class="number">259897</span>]</span><br><span class="line">latency <span class="string">mean              :</span> <span class="number">0.8</span> [<span class="string">WRITE:</span><span class="number">0.8</span>]</span><br><span class="line">latency <span class="string">median            :</span> <span class="number">0.5</span> [<span class="string">WRITE:</span><span class="number">0.5</span>]</span><br><span class="line">latency <span class="number">95</span>th <span class="string">percentile   :</span> <span class="number">1.4</span> [<span class="string">WRITE:</span><span class="number">1.4</span>]</span><br><span class="line">latency <span class="number">99</span>th <span class="string">percentile   :</span> <span class="number">2.0</span> [<span class="string">WRITE:</span><span class="number">2.0</span>]</span><br><span class="line">latency <span class="number">99.9</span>th <span class="string">percentile :</span> <span class="number">30.7</span> [<span class="string">WRITE:</span><span class="number">30.7</span>]</span><br><span class="line">latency <span class="string">max               :</span> <span class="number">95.2</span> [<span class="string">WRITE:</span><span class="number">95.2</span>]</span><br><span class="line">Total <span class="string">partitions          :</span> <span class="number">1000000</span> [<span class="string">WRITE:</span><span class="number">1000000</span>]</span><br><span class="line">Total <span class="string">errors              :</span> <span class="number">0</span> [<span class="string">WRITE:</span><span class="number">0</span>]</span><br><span class="line">total gc <span class="string">count            :</span> <span class="number">4</span></span><br><span class="line">total gc <span class="string">mb               :</span> <span class="number">6166</span></span><br><span class="line">total gc time (s)         : <span class="number">0</span></span><br><span class="line">avg gc time(ms)           : <span class="number">79</span></span><br><span class="line">stdev gc time(ms)         : <span class="number">9</span></span><br><span class="line">Total operation <span class="string">time      :</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">03</span></span><br></pre></td></tr></table></figure>
<p>CLUSTER42_read_2.log</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line">  <span class="number">4</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">21460</span>,   <span class="number">21460</span>,   <span class="number">21460</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.5</span>,    <span class="number">10.6</span>,    <span class="number">9.3</span>,  <span class="number">0.00255</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line">  <span class="number">8</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">38502</span>,   <span class="number">38502</span>,   <span class="number">38502</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.6</span>,   <span class="number">140.3</span>,    <span class="number">5.2</span>,  <span class="number">0.00191</span>,      <span class="number">0</span>,      <span class="number">1</span>,     <span class="number">139</span>,     <span class="number">139</span>,       <span class="number">0</span>,    <span class="number">1547</span></span><br><span class="line"> <span class="number">16</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">71834</span>,   <span class="number">71834</span>,   <span class="number">71834</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.4</span>,     <span class="number">0.6</span>,    <span class="number">16.0</span>,    <span class="number">2.8</span>,  <span class="number">0.00155</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">24</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">83062</span>,   <span class="number">83062</span>,   <span class="number">83062</span>,     <span class="number">0.3</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.6</span>,     <span class="number">1.3</span>,   <span class="number">121.3</span>,    <span class="number">2.4</span>,  <span class="number">0.04126</span>,      <span class="number">0</span>,      <span class="number">3</span>,     <span class="number">349</span>,     <span class="number">349</span>,       <span class="number">3</span>,    <span class="number">4624</span></span><br><span class="line"> <span class="number">36</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">134469</span>,  <span class="number">134469</span>,  <span class="number">134469</span>,     <span class="number">0.3</span>,     <span class="number">0.2</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.7</span>,     <span class="number">3.7</span>,    <span class="number">1.5</span>,  <span class="number">0.00428</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">54</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">162900</span>,  <span class="number">162900</span>,  <span class="number">162900</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">0.8</span>,    <span class="number">40.7</span>,    <span class="number">1.2</span>,  <span class="number">0.01089</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">39</span>,      <span class="number">39</span>,       <span class="number">0</span>,    <span class="number">1678</span></span><br><span class="line"> <span class="number">81</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">216457</span>,  <span class="number">216457</span>,  <span class="number">216457</span>,     <span class="number">0.4</span>,     <span class="number">0.3</span>,     <span class="number">0.6</span>,     <span class="number">0.8</span>,     <span class="number">1.5</span>,     <span class="number">5.8</span>,    <span class="number">0.9</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">121</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">236040</span>,  <span class="number">236040</span>,  <span class="number">236040</span>,     <span class="number">0.5</span>,     <span class="number">0.4</span>,     <span class="number">0.9</span>,     <span class="number">1.2</span>,    <span class="number">14.8</span>,    <span class="number">40.8</span>,    <span class="number">0.8</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">2</span>,      <span class="number">26</span>,      <span class="number">26</span>,       <span class="number">0</span>,    <span class="number">3428</span></span><br><span class="line"><span class="number">181</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">286542</span>,  <span class="number">286542</span>,  <span class="number">286542</span>,     <span class="number">0.6</span>,     <span class="number">0.5</span>,     <span class="number">1.2</span>,     <span class="number">1.6</span>,     <span class="number">1.8</span>,    <span class="number">16.6</span>,    <span class="number">0.7</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">12</span>,      <span class="number">12</span>,       <span class="number">0</span>,    <span class="number">1713</span></span><br><span class="line"><span class="number">271</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">299832</span>,  <span class="number">299832</span>,  <span class="number">299832</span>,     <span class="number">0.9</span>,     <span class="number">0.7</span>,     <span class="number">2.0</span>,     <span class="number">2.4</span>,     <span class="number">3.5</span>,    <span class="number">45.7</span>,    <span class="number">0.7</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">406</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">321774</span>,  <span class="number">321774</span>,  <span class="number">321774</span>,     <span class="number">1.3</span>,     <span class="number">1.0</span>,     <span class="number">3.2</span>,     <span class="number">4.2</span>,     <span class="number">6.9</span>,    <span class="number">20.1</span>,    <span class="number">0.6</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">12</span>,      <span class="number">12</span>,       <span class="number">0</span>,    <span class="number">1662</span></span><br><span class="line"><span class="number">609</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">266682</span>,  <span class="number">266682</span>,  <span class="number">266682</span>,     <span class="number">2.4</span>,     <span class="number">1.2</span>,     <span class="number">6.3</span>,    <span class="number">14.6</span>,    <span class="number">84.6</span>,    <span class="number">88.3</span>,    <span class="number">0.7</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">12</span>,      <span class="number">12</span>,       <span class="number">0</span>,    <span class="number">1659</span></span><br></pre></td></tr></table></figure>
<p>CLUSTER43_read_2_nowarm.log</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line">  <span class="number">4</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">20221</span>,   <span class="number">20221</span>,   <span class="number">20221</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.8</span>,    <span class="number">14.0</span>,    <span class="number">9.9</span>,  <span class="number">0.02496</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">12</span>,      <span class="number">12</span>,       <span class="number">0</span>,    <span class="number">1658</span></span><br><span class="line">  <span class="number">8</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">39354</span>,   <span class="number">39354</span>,   <span class="number">39354</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.5</span>,    <span class="number">15.9</span>,    <span class="number">5.1</span>,  <span class="number">0.00334</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">13</span>,      <span class="number">13</span>,       <span class="number">0</span>,    <span class="number">1657</span></span><br><span class="line"> <span class="number">16</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">69779</span>,   <span class="number">69779</span>,   <span class="number">69779</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.4</span>,     <span class="number">0.8</span>,    <span class="number">14.0</span>,    <span class="number">2.9</span>,  <span class="number">0.00565</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">13</span>,      <span class="number">13</span>,       <span class="number">0</span>,    <span class="number">1643</span></span><br><span class="line"> <span class="number">24</span> threadCount, READ,         <span class="number">200000</span>,   <span class="number">95817</span>,   <span class="number">95817</span>,   <span class="number">95817</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.5</span>,     <span class="number">0.9</span>,    <span class="number">14.0</span>,    <span class="number">2.1</span>,  <span class="number">0.00720</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">12</span>,      <span class="number">12</span>,       <span class="number">0</span>,    <span class="number">1643</span></span><br><span class="line"> <span class="number">36</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">130448</span>,  <span class="number">130448</span>,  <span class="number">130448</span>,     <span class="number">0.3</span>,     <span class="number">0.2</span>,     <span class="number">0.4</span>,     <span class="number">0.6</span>,     <span class="number">1.9</span>,    <span class="number">19.1</span>,    <span class="number">1.5</span>,  <span class="number">0.00538</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">13</span>,      <span class="number">13</span>,       <span class="number">0</span>,    <span class="number">1642</span></span><br><span class="line"> <span class="number">54</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">161641</span>,  <span class="number">161641</span>,  <span class="number">161641</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.5</span>,     <span class="number">0.6</span>,     <span class="number">1.0</span>,    <span class="number">41.0</span>,    <span class="number">1.2</span>,  <span class="number">0.00939</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">13</span>,      <span class="number">13</span>,       <span class="number">0</span>,    <span class="number">1640</span></span><br><span class="line"> <span class="number">81</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">207644</span>,  <span class="number">207644</span>,  <span class="number">207644</span>,     <span class="number">0.4</span>,     <span class="number">0.3</span>,     <span class="number">0.6</span>,     <span class="number">0.8</span>,     <span class="number">1.2</span>,    <span class="number">14.4</span>,    <span class="number">1.0</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">13</span>,      <span class="number">13</span>,       <span class="number">0</span>,    <span class="number">1637</span></span><br><span class="line"><span class="number">121</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">225275</span>,  <span class="number">225275</span>,  <span class="number">225275</span>,     <span class="number">0.5</span>,     <span class="number">0.4</span>,     <span class="number">0.9</span>,     <span class="number">1.2</span>,    <span class="number">32.9</span>,    <span class="number">65.8</span>,    <span class="number">0.9</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">13</span>,      <span class="number">13</span>,       <span class="number">0</span>,    <span class="number">1638</span></span><br><span class="line"><span class="number">181</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">252569</span>,  <span class="number">252569</span>,  <span class="number">252569</span>,     <span class="number">0.7</span>,     <span class="number">0.5</span>,     <span class="number">1.4</span>,     <span class="number">1.7</span>,     <span class="number">2.3</span>,    <span class="number">80.4</span>,    <span class="number">0.8</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">271</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">263521</span>,  <span class="number">263521</span>,  <span class="number">263521</span>,     <span class="number">1.0</span>,     <span class="number">0.7</span>,     <span class="number">1.9</span>,     <span class="number">2.8</span>,    <span class="number">14.5</span>,    <span class="number">71.3</span>,    <span class="number">0.8</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">12</span>,      <span class="number">12</span>,       <span class="number">0</span>,    <span class="number">1640</span></span><br><span class="line"><span class="number">406</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">301401</span>,  <span class="number">301401</span>,  <span class="number">301401</span>,     <span class="number">1.4</span>,     <span class="number">1.0</span>,     <span class="number">3.2</span>,     <span class="number">5.1</span>,    <span class="number">52.4</span>,    <span class="number">53.6</span>,    <span class="number">0.7</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">12</span>,      <span class="number">12</span>,       <span class="number">0</span>,    <span class="number">1640</span></span><br><span class="line"><span class="number">609</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">298018</span>,  <span class="number">298018</span>,  <span class="number">298018</span>,     <span class="number">2.1</span>,     <span class="number">1.2</span>,     <span class="number">5.9</span>,     <span class="number">9.9</span>,    <span class="number">15.4</span>,    <span class="number">35.7</span>,    <span class="number">0.7</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">2</span>,      <span class="number">26</span>,      <span class="number">26</span>,       <span class="number">0</span>,    <span class="number">3280</span></span><br><span class="line"><span class="number">913</span> threadCount, READ,         <span class="number">200000</span>,  <span class="number">285031</span>,  <span class="number">285031</span>,  <span class="number">285031</span>,     <span class="number">3.4</span>,     <span class="number">1.2</span>,    <span class="number">11.4</span>,    <span class="number">14.0</span>,    <span class="number">36.6</span>,    <span class="number">50.0</span>,    <span class="number">0.7</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>CLUSTER44_read_3min.log</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line">  <span class="number">4</span> threadCount, READ,        <span class="number">3899838</span>,   <span class="number">21666</span>,   <span class="number">21666</span>,   <span class="number">21666</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,    <span class="number">17.5</span>,  <span class="number">180.0</span>,  <span class="number">0.00060</span>,      <span class="number">0</span>,     <span class="number">20</span>,     <span class="number">264</span>,     <span class="number">264</span>,       <span class="number">1</span>,   <span class="number">32759</span></span><br><span class="line">  <span class="number">8</span> threadCount, READ,        <span class="number">7168561</span>,   <span class="number">39825</span>,   <span class="number">39825</span>,   <span class="number">39825</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.4</span>,    <span class="number">22.0</span>,  <span class="number">180.0</span>,  <span class="number">0.00043</span>,      <span class="number">0</span>,     <span class="number">36</span>,     <span class="number">477</span>,     <span class="number">477</span>,       <span class="number">2</span>,   <span class="number">58983</span></span><br><span class="line"> <span class="number">16</span> threadCount, READ,       <span class="number">12822843</span>,   <span class="number">71238</span>,   <span class="number">71238</span>,   <span class="number">71238</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.4</span>,     <span class="number">0.6</span>,    <span class="number">21.8</span>,  <span class="number">180.0</span>,  <span class="number">0.00075</span>,      <span class="number">0</span>,     <span class="number">59</span>,     <span class="number">760</span>,     <span class="number">760</span>,       <span class="number">2</span>,   <span class="number">96665</span></span><br><span class="line"> <span class="number">24</span> threadCount, READ,       <span class="number">17709667</span>,   <span class="number">98387</span>,   <span class="number">98387</span>,   <span class="number">98387</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.4</span>,     <span class="number">0.8</span>,    <span class="number">21.2</span>,  <span class="number">180.0</span>,  <span class="number">0.00096</span>,      <span class="number">0</span>,     <span class="number">79</span>,     <span class="number">980</span>,     <span class="number">980</span>,       <span class="number">1</span>,  <span class="number">129439</span></span><br><span class="line"> <span class="number">36</span> threadCount, READ,       <span class="number">23887360</span>,  <span class="number">132707</span>,  <span class="number">132707</span>,  <span class="number">132707</span>,     <span class="number">0.3</span>,     <span class="number">0.2</span>,     <span class="number">0.4</span>,     <span class="number">0.5</span>,     <span class="number">0.9</span>,    <span class="number">21.3</span>,  <span class="number">180.0</span>,  <span class="number">0.00101</span>,      <span class="number">0</span>,    <span class="number">105</span>,    <span class="number">1314</span>,    <span class="number">1314</span>,       <span class="number">1</span>,  <span class="number">172032</span></span><br><span class="line"> <span class="number">54</span> threadCount, READ,       <span class="number">31144699</span>,  <span class="number">173025</span>,  <span class="number">173025</span>,  <span class="number">173025</span>,     <span class="number">0.3</span>,     <span class="number">0.3</span>,     <span class="number">0.4</span>,     <span class="number">0.6</span>,     <span class="number">1.2</span>,    <span class="number">27.8</span>,  <span class="number">180.0</span>,  <span class="number">0.00124</span>,      <span class="number">0</span>,    <span class="number">135</span>,    <span class="number">1654</span>,    <span class="number">1654</span>,       <span class="number">1</span>,  <span class="number">221187</span></span><br><span class="line"> <span class="number">81</span> threadCount, READ,       <span class="number">38692768</span>,  <span class="number">214959</span>,  <span class="number">214959</span>,  <span class="number">214959</span>,     <span class="number">0.4</span>,     <span class="number">0.3</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,     <span class="number">1.5</span>,    <span class="number">40.2</span>,  <span class="number">180.0</span>,  <span class="number">0.00126</span>,      <span class="number">0</span>,    <span class="number">166</span>,    <span class="number">2010</span>,    <span class="number">2010</span>,       <span class="number">1</span>,  <span class="number">271986</span></span><br><span class="line"><span class="number">121</span> threadCount, READ,       <span class="number">46099747</span>,  <span class="number">256109</span>,  <span class="number">256109</span>,  <span class="number">256109</span>,     <span class="number">0.5</span>,     <span class="number">0.4</span>,     <span class="number">0.8</span>,     <span class="number">1.0</span>,     <span class="number">1.7</span>,    <span class="number">42.0</span>,  <span class="number">180.0</span>,  <span class="number">0.00132</span>,      <span class="number">0</span>,    <span class="number">195</span>,    <span class="number">2352</span>,    <span class="number">2352</span>,       <span class="number">1</span>,  <span class="number">319494</span></span><br><span class="line"><span class="number">181</span> threadCount, READ,       <span class="number">51810325</span>,  <span class="number">287834</span>,  <span class="number">287834</span>,  <span class="number">287834</span>,     <span class="number">0.6</span>,     <span class="number">0.5</span>,     <span class="number">1.2</span>,     <span class="number">1.5</span>,     <span class="number">2.4</span>,    <span class="number">51.7</span>,  <span class="number">180.0</span>,  <span class="number">0.00156</span>,      <span class="number">0</span>,    <span class="number">218</span>,    <span class="number">2583</span>,    <span class="number">2583</span>,       <span class="number">1</span>,  <span class="number">357188</span></span><br><span class="line"><span class="number">271</span> threadCount, READ,       <span class="number">56578917</span>,  <span class="number">314325</span>,  <span class="number">314325</span>,  <span class="number">314325</span>,     <span class="number">0.8</span>,     <span class="number">0.7</span>,     <span class="number">1.7</span>,     <span class="number">2.3</span>,     <span class="number">3.9</span>,    <span class="number">44.5</span>,  <span class="number">180.0</span>,  <span class="number">0.00163</span>,      <span class="number">0</span>,    <span class="number">238</span>,    <span class="number">2818</span>,    <span class="number">2830</span>,       <span class="number">1</span>,  <span class="number">388317</span></span><br><span class="line"><span class="number">406</span> threadCount, READ,       <span class="number">59909240</span>,  <span class="number">332826</span>,  <span class="number">332826</span>,  <span class="number">332826</span>,     <span class="number">1.2</span>,     <span class="number">0.9</span>,     <span class="number">2.7</span>,     <span class="number">4.0</span>,    <span class="number">13.9</span>,   <span class="number">208.3</span>,  <span class="number">180.0</span>,  <span class="number">0.00223</span>,      <span class="number">0</span>,    <span class="number">252</span>,    <span class="number">2976</span>,    <span class="number">3000</span>,       <span class="number">1</span>,  <span class="number">409622</span></span><br><span class="line"><span class="number">609</span> threadCount, READ,       <span class="number">56825414</span>,  <span class="number">315692</span>,  <span class="number">315692</span>,  <span class="number">315692</span>,     <span class="number">1.9</span>,     <span class="number">1.0</span>,     <span class="number">5.4</span>,     <span class="number">7.1</span>,    <span class="number">15.6</span>,    <span class="number">47.6</span>,  <span class="number">180.0</span>,  <span class="number">0.00207</span>,      <span class="number">0</span>,    <span class="number">238</span>,    <span class="number">2826</span>,    <span class="number">2826</span>,       <span class="number">1</span>,  <span class="number">389955</span></span><br><span class="line"><span class="number">913</span> threadCount, READ,       <span class="number">53999369</span>,  <span class="number">299986</span>,  <span class="number">299986</span>,  <span class="number">299986</span>,     <span class="number">3.0</span>,     <span class="number">1.3</span>,     <span class="number">8.9</span>,    <span class="number">11.0</span>,    <span class="number">15.6</span>,   <span class="number">302.9</span>,  <span class="number">180.0</span>,  <span class="number">0.00160</span>,      <span class="number">0</span>,    <span class="number">225</span>,    <span class="number">2755</span>,    <span class="number">2755</span>,       <span class="number">1</span>,  <span class="number">368647</span></span><br></pre></td></tr></table></figure>
<p>CLUSTER45_write_1M_rows.log</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">Results:</span></span><br><span class="line">op <span class="string">rate                   :</span> <span class="number">267419</span> [<span class="string">WRITE:</span><span class="number">267419</span>]</span><br><span class="line">partition <span class="string">rate            :</span> <span class="number">267419</span> [<span class="string">WRITE:</span><span class="number">267419</span>]</span><br><span class="line">row <span class="string">rate                  :</span> <span class="number">267419</span> [<span class="string">WRITE:</span><span class="number">267419</span>]</span><br><span class="line">latency <span class="string">mean              :</span> <span class="number">0.7</span> [<span class="string">WRITE:</span><span class="number">0.7</span>]</span><br><span class="line">latency <span class="string">median            :</span> <span class="number">0.5</span> [<span class="string">WRITE:</span><span class="number">0.5</span>]</span><br><span class="line">latency <span class="number">95</span>th <span class="string">percentile   :</span> <span class="number">1.2</span> [<span class="string">WRITE:</span><span class="number">1.2</span>]</span><br><span class="line">latency <span class="number">99</span>th <span class="string">percentile   :</span> <span class="number">1.8</span> [<span class="string">WRITE:</span><span class="number">1.8</span>]</span><br><span class="line">latency <span class="number">99.9</span>th <span class="string">percentile :</span> <span class="number">31.9</span> [<span class="string">WRITE:</span><span class="number">31.9</span>]</span><br><span class="line">latency <span class="string">max               :</span> <span class="number">218.2</span> [<span class="string">WRITE:</span><span class="number">218.2</span>]</span><br><span class="line">Total <span class="string">partitions          :</span> <span class="number">1000000</span> [<span class="string">WRITE:</span><span class="number">1000000</span>]</span><br><span class="line">Total <span class="string">errors              :</span> <span class="number">0</span> [<span class="string">WRITE:</span><span class="number">0</span>]</span><br><span class="line">total gc <span class="string">count            :</span> <span class="number">4</span></span><br><span class="line">total gc <span class="string">mb               :</span> <span class="number">6248</span></span><br><span class="line">total gc time (s)         : <span class="number">0</span></span><br><span class="line">avg gc time(ms)           : <span class="number">31</span></span><br><span class="line">stdev gc time(ms)         : <span class="number">11</span></span><br><span class="line">Total operation <span class="string">time      :</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">03</span></span><br></pre></td></tr></table></figure>
<p>CLUSTER46_mixed_autorate_50r50w_1M.log</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line"> <span class="number">16</span> threadCount, READ,          <span class="number">74852</span>,   <span class="number">41220</span>,   <span class="number">41220</span>,   <span class="number">41220</span>,     <span class="number">0.3</span>,     <span class="number">0.2</span>,     <span class="number">0.4</span>,     <span class="number">0.8</span>,     <span class="number">2.7</span>,    <span class="number">93.6</span>,    <span class="number">1.8</span>,  <span class="number">0.06069</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">92</span>,      <span class="number">92</span>,       <span class="number">0</span>,    <span class="number">1521</span></span><br><span class="line"> <span class="number">16</span> threadCount, WRITE,         <span class="number">25148</span>,   <span class="number">13849</span>,   <span class="number">13849</span>,   <span class="number">13849</span>,     <span class="number">0.3</span>,     <span class="number">0.2</span>,     <span class="number">0.4</span>,     <span class="number">0.8</span>,     <span class="number">3.3</span>,    <span class="number">93.7</span>,    <span class="number">1.8</span>,  <span class="number">0.06069</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">92</span>,      <span class="number">92</span>,       <span class="number">0</span>,    <span class="number">1521</span></span><br><span class="line"> <span class="number">16</span> threadCount, total,        <span class="number">100000</span>,   <span class="number">55069</span>,   <span class="number">55069</span>,   <span class="number">55069</span>,     <span class="number">0.3</span>,     <span class="number">0.2</span>,     <span class="number">0.4</span>,     <span class="number">0.8</span>,     <span class="number">1.9</span>,    <span class="number">93.7</span>,    <span class="number">1.8</span>,  <span class="number">0.06069</span>,      <span class="number">0</span>,      <span class="number">1</span>,      <span class="number">92</span>,      <span class="number">92</span>,       <span class="number">0</span>,    <span class="number">1521</span></span><br><span class="line"> <span class="number">24</span> threadCount, READ,          <span class="number">75161</span>,   <span class="number">67239</span>,   <span class="number">67239</span>,   <span class="number">67239</span>,     <span class="number">0.3</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.6</span>,     <span class="number">1.6</span>,    <span class="number">50.3</span>,    <span class="number">1.1</span>,  <span class="number">0.12330</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">24</span> threadCount, WRITE,         <span class="number">24839</span>,   <span class="number">22221</span>,   <span class="number">22221</span>,   <span class="number">22221</span>,     <span class="number">0.2</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.5</span>,     <span class="number">1.9</span>,    <span class="number">25.5</span>,    <span class="number">1.1</span>,  <span class="number">0.12330</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">24</span> threadCount, total,        <span class="number">100000</span>,   <span class="number">89460</span>,   <span class="number">89460</span>,   <span class="number">89460</span>,     <span class="number">0.3</span>,     <span class="number">0.2</span>,     <span class="number">0.3</span>,     <span class="number">0.6</span>,     <span class="number">1.8</span>,    <span class="number">50.3</span>,    <span class="number">1.1</span>,  <span class="number">0.12330</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">36</span> threadCount, READ,          <span class="number">74515</span>,   <span class="number">76617</span>,   <span class="number">76617</span>,   <span class="number">76617</span>,     <span class="number">0.3</span>,     <span class="number">0.2</span>,     <span class="number">0.4</span>,     <span class="number">0.6</span>,     <span class="number">1.1</span>,   <span class="number">174.0</span>,    <span class="number">1.0</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">1</span>,     <span class="number">173</span>,     <span class="number">173</span>,       <span class="number">0</span>,    <span class="number">1538</span></span><br><span class="line"> <span class="number">36</span> threadCount, WRITE,         <span class="number">25485</span>,   <span class="number">26204</span>,   <span class="number">26204</span>,   <span class="number">26204</span>,     <span class="number">0.3</span>,     <span class="number">0.2</span>,     <span class="number">0.4</span>,     <span class="number">0.7</span>,    <span class="number">11.9</span>,   <span class="number">174.0</span>,    <span class="number">1.0</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">1</span>,     <span class="number">173</span>,     <span class="number">173</span>,       <span class="number">0</span>,    <span class="number">1538</span></span><br><span class="line"> <span class="number">36</span> threadCount, total,        <span class="number">100000</span>,  <span class="number">102821</span>,  <span class="number">102821</span>,  <span class="number">102821</span>,     <span class="number">0.3</span>,     <span class="number">0.2</span>,     <span class="number">0.4</span>,     <span class="number">0.6</span>,     <span class="number">1.0</span>,   <span class="number">174.0</span>,    <span class="number">1.0</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">1</span>,     <span class="number">173</span>,     <span class="number">173</span>,       <span class="number">0</span>,    <span class="number">1538</span></span><br><span class="line"> <span class="number">54</span> threadCount, READ,          <span class="number">75025</span>,   <span class="number">92227</span>,   <span class="number">92227</span>,   <span class="number">92227</span>,     <span class="number">0.4</span>,     <span class="number">0.3</span>,     <span class="number">0.5</span>,     <span class="number">0.7</span>,    <span class="number">25.2</span>,   <span class="number">211.2</span>,    <span class="number">0.8</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">1</span>,     <span class="number">209</span>,     <span class="number">209</span>,       <span class="number">0</span>,    <span class="number">1553</span></span><br><span class="line"> <span class="number">54</span> threadCount, WRITE,         <span class="number">24975</span>,   <span class="number">30711</span>,   <span class="number">30711</span>,   <span class="number">30711</span>,     <span class="number">0.4</span>,     <span class="number">0.3</span>,     <span class="number">0.5</span>,     <span class="number">0.7</span>,    <span class="number">25.4</span>,   <span class="number">211.3</span>,    <span class="number">0.8</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">1</span>,     <span class="number">209</span>,     <span class="number">209</span>,       <span class="number">0</span>,    <span class="number">1553</span></span><br><span class="line"> <span class="number">54</span> threadCount, total,        <span class="number">100000</span>,  <span class="number">122928</span>,  <span class="number">122928</span>,  <span class="number">122928</span>,     <span class="number">0.4</span>,     <span class="number">0.3</span>,     <span class="number">0.5</span>,     <span class="number">0.7</span>,     <span class="number">2.3</span>,   <span class="number">211.3</span>,    <span class="number">0.8</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">1</span>,     <span class="number">209</span>,     <span class="number">209</span>,       <span class="number">0</span>,    <span class="number">1553</span></span><br><span class="line"> <span class="number">81</span> threadCount, READ,          <span class="number">74565</span>,  <span class="number">150728</span>,  <span class="number">150728</span>,  <span class="number">150728</span>,     <span class="number">0.4</span>,     <span class="number">0.3</span>,     <span class="number">0.6</span>,     <span class="number">0.9</span>,     <span class="number">1.3</span>,    <span class="number">25.7</span>,    <span class="number">0.5</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">81</span> threadCount, WRITE,         <span class="number">25435</span>,   <span class="number">50799</span>,   <span class="number">50799</span>,   <span class="number">50799</span>,     <span class="number">0.4</span>,     <span class="number">0.3</span>,     <span class="number">0.6</span>,     <span class="number">0.9</span>,     <span class="number">2.0</span>,    <span class="number">31.7</span>,    <span class="number">0.5</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"> <span class="number">81</span> threadCount, total,        <span class="number">100000</span>,  <span class="number">199721</span>,  <span class="number">199721</span>,  <span class="number">199721</span>,     <span class="number">0.4</span>,     <span class="number">0.3</span>,     <span class="number">0.6</span>,     <span class="number">0.9</span>,     <span class="number">1.3</span>,    <span class="number">31.7</span>,    <span class="number">0.5</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">121</span> threadCount, READ,          <span class="number">74804</span>,  <span class="number">162638</span>,  <span class="number">162638</span>,  <span class="number">162638</span>,     <span class="number">0.5</span>,     <span class="number">0.4</span>,     <span class="number">0.8</span>,     <span class="number">1.0</span>,     <span class="number">1.2</span>,    <span class="number">63.8</span>,    <span class="number">0.5</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">121</span> threadCount, WRITE,         <span class="number">25196</span>,   <span class="number">54783</span>,   <span class="number">54783</span>,   <span class="number">54783</span>,     <span class="number">0.6</span>,     <span class="number">0.4</span>,     <span class="number">0.8</span>,     <span class="number">1.3</span>,    <span class="number">63.2</span>,    <span class="number">63.8</span>,    <span class="number">0.5</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">121</span> threadCount, total,        <span class="number">100000</span>,  <span class="number">217418</span>,  <span class="number">217418</span>,  <span class="number">217418</span>,     <span class="number">0.6</span>,     <span class="number">0.4</span>,     <span class="number">0.8</span>,     <span class="number">1.0</span>,     <span class="number">1.5</span>,    <span class="number">63.8</span>,    <span class="number">0.5</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">181</span> threadCount, READ,          <span class="number">74519</span>,  <span class="number">206697</span>,  <span class="number">206697</span>,  <span class="number">206697</span>,     <span class="number">0.6</span>,     <span class="number">0.5</span>,     <span class="number">1.1</span>,     <span class="number">1.4</span>,    <span class="number">23.4</span>,    <span class="number">24.3</span>,    <span class="number">0.4</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">181</span> threadCount, WRITE,         <span class="number">25481</span>,   <span class="number">70677</span>,   <span class="number">70677</span>,   <span class="number">70677</span>,     <span class="number">0.7</span>,     <span class="number">0.5</span>,     <span class="number">1.1</span>,     <span class="number">1.4</span>,    <span class="number">23.3</span>,    <span class="number">24.1</span>,    <span class="number">0.4</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br><span class="line"><span class="number">181</span> threadCount, total,        <span class="number">100000</span>,  <span class="number">277373</span>,  <span class="number">277373</span>,  <span class="number">277373</span>,     <span class="number">0.7</span>,     <span class="number">0.5</span>,     <span class="number">1.1</span>,     <span class="number">1.4</span>,    <span class="number">23.3</span>,    <span class="number">24.3</span>,    <span class="number">0.4</span>,  <span class="number">0.00000</span>,      <span class="number">0</span>,      <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span>,       <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>CLUSTER47_blog_insert.log</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line">  <span class="number">4</span> threadCount, insert,       <span class="number">232963</span>,    <span class="number">7740</span>,    <span class="number">7740</span>,   <span class="number">10588</span>,     <span class="number">0.4</span>,     <span class="number">0.4</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,     <span class="number">0.9</span>,   <span class="number">241.4</span>,   <span class="number">30.1</span>,  <span class="number">0.01115</span>,      <span class="number">0</span>,      <span class="number">3</span>,     <span class="number">634</span>,     <span class="number">634</span>,      <span class="number">22</span>,    <span class="number">4127</span></span><br><span class="line">  <span class="number">8</span> threadCount, insert,       <span class="number">436194</span>,   <span class="number">14420</span>,   <span class="number">14420</span>,   <span class="number">19680</span>,     <span class="number">0.5</span>,     <span class="number">0.4</span>,     <span class="number">0.6</span>,     <span class="number">0.7</span>,     <span class="number">1.0</span>,   <span class="number">290.6</span>,   <span class="number">30.2</span>,  <span class="number">0.00780</span>,      <span class="number">0</span>,      <span class="number">7</span>,    <span class="number">1677</span>,    <span class="number">1677</span>,      <span class="number">42</span>,    <span class="number">9298</span></span><br><span class="line"> <span class="number">16</span> threadCount, insert,       <span class="number">720362</span>,   <span class="number">23471</span>,   <span class="number">23471</span>,   <span class="number">32086</span>,     <span class="number">0.6</span>,     <span class="number">0.5</span>,     <span class="number">0.8</span>,     <span class="number">0.9</span>,     <span class="number">1.9</span>,   <span class="number">222.3</span>,   <span class="number">30.7</span>,  <span class="number">0.01669</span>,      <span class="number">0</span>,     <span class="number">14</span>,    <span class="number">2259</span>,    <span class="number">2259</span>,      <span class="number">36</span>,   <span class="number">19650</span></span><br><span class="line"> <span class="number">24</span> threadCount, insert,       <span class="number">762309</span>,   <span class="number">24963</span>,   <span class="number">24963</span>,   <span class="number">34151</span>,     <span class="number">0.8</span>,     <span class="number">0.7</span>,     <span class="number">1.1</span>,     <span class="number">1.4</span>,     <span class="number">6.3</span>,   <span class="number">239.9</span>,   <span class="number">30.5</span>,  <span class="number">0.01428</span>,      <span class="number">0</span>,     <span class="number">16</span>,    <span class="number">2494</span>,    <span class="number">2494</span>,      <span class="number">43</span>,   <span class="number">22431</span></span><br><span class="line"> <span class="number">36</span> threadCount, insert,       <span class="number">782500</span>,   <span class="number">25769</span>,   <span class="number">25769</span>,   <span class="number">35273</span>,     <span class="number">1.3</span>,     <span class="number">1.1</span>,     <span class="number">2.0</span>,     <span class="number">2.4</span>,    <span class="number">13.0</span>,   <span class="number">230.8</span>,   <span class="number">30.4</span>,  <span class="number">0.00666</span>,      <span class="number">0</span>,     <span class="number">15</span>,    <span class="number">2454</span>,    <span class="number">2454</span>,      <span class="number">40</span>,   <span class="number">20885</span></span><br><span class="line"> <span class="number">54</span> threadCount, insert,       <span class="number">779071</span>,   <span class="number">25684</span>,   <span class="number">25684</span>,   <span class="number">35130</span>,     <span class="number">2.0</span>,     <span class="number">1.5</span>,     <span class="number">3.6</span>,     <span class="number">4.1</span>,    <span class="number">13.7</span>,   <span class="number">260.4</span>,   <span class="number">30.3</span>,  <span class="number">0.00705</span>,      <span class="number">0</span>,     <span class="number">18</span>,    <span class="number">2607</span>,    <span class="number">2607</span>,      <span class="number">44</span>,   <span class="number">30028</span></span><br><span class="line"> <span class="number">81</span> threadCount, insert,       <span class="number">799458</span>,   <span class="number">25948</span>,   <span class="number">25948</span>,   <span class="number">35478</span>,     <span class="number">3.0</span>,     <span class="number">2.5</span>,     <span class="number">5.4</span>,     <span class="number">6.6</span>,   <span class="number">144.4</span>,   <span class="number">266.1</span>,   <span class="number">30.8</span>,  <span class="number">0.00924</span>,      <span class="number">0</span>,     <span class="number">15</span>,    <span class="number">2181</span>,    <span class="number">2181</span>,      <span class="number">36</span>,   <span class="number">20905</span></span><br><span class="line"><span class="number">121</span> threadCount, insert,       <span class="number">806416</span>,   <span class="number">26515</span>,   <span class="number">26515</span>,   <span class="number">36222</span>,     <span class="number">4.4</span>,     <span class="number">3.8</span>,     <span class="number">8.5</span>,    <span class="number">10.4</span>,   <span class="number">100.2</span>,   <span class="number">262.6</span>,   <span class="number">30.4</span>,  <span class="number">0.00663</span>,      <span class="number">0</span>,     <span class="number">15</span>,    <span class="number">1936</span>,    <span class="number">1936</span>,      <span class="number">42</span>,   <span class="number">20970</span></span><br><span class="line"><span class="number">181</span> threadCount, insert,       <span class="number">813139</span>,   <span class="number">26389</span>,   <span class="number">26389</span>,   <span class="number">36115</span>,     <span class="number">6.7</span>,     <span class="number">4.4</span>,    <span class="number">15.7</span>,    <span class="number">18.4</span>,   <span class="number">166.1</span>,   <span class="number">269.2</span>,   <span class="number">30.8</span>,  <span class="number">0.01099</span>,      <span class="number">0</span>,     <span class="number">15</span>,    <span class="number">2067</span>,    <span class="number">2067</span>,      <span class="number">39</span>,   <span class="number">20847</span></span><br></pre></td></tr></table></figure>
<p>CLUSTER48_blog_mixed.log</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line">  <span class="number">4</span> threadCount, insert,        <span class="number">37302</span>,    <span class="number">1185</span>,    <span class="number">1185</span>,    <span class="number">1618</span>,     <span class="number">0.5</span>,     <span class="number">0.4</span>,     <span class="number">0.7</span>,     <span class="number">0.8</span>,     <span class="number">1.4</span>,   <span class="number">232.6</span>,   <span class="number">31.5</span>,  <span class="number">0.00958</span>,      <span class="number">0</span>,      <span class="number">9</span>,     <span class="number">535</span>,     <span class="number">535</span>,      <span class="number">13</span>,   <span class="number">16094</span></span><br><span class="line">  <span class="number">4</span> threadCount, singlepost,     <span class="number">73938</span>,    <span class="number">2350</span>,    <span class="number">2287</span>,    <span class="number">2287</span>,     <span class="number">0.8</span>,     <span class="number">0.8</span>,     <span class="number">1.1</span>,     <span class="number">1.2</span>,     <span class="number">1.4</span>,    <span class="number">93.2</span>,   <span class="number">31.5</span>,  <span class="number">0.00958</span>,      <span class="number">0</span>,      <span class="number">9</span>,     <span class="number">535</span>,     <span class="number">535</span>,      <span class="number">13</span>,   <span class="number">16094</span></span><br><span class="line">  <span class="number">4</span> threadCount, timeline,      <span class="number">37531</span>,    <span class="number">1193</span>,    <span class="number">1161</span>,    <span class="number">9236</span>,     <span class="number">1.0</span>,     <span class="number">0.9</span>,     <span class="number">1.3</span>,     <span class="number">1.4</span>,     <span class="number">1.7</span>,    <span class="number">93.3</span>,   <span class="number">31.5</span>,  <span class="number">0.00958</span>,      <span class="number">0</span>,      <span class="number">9</span>,     <span class="number">535</span>,     <span class="number">535</span>,      <span class="number">13</span>,   <span class="number">16094</span></span><br><span class="line">  <span class="number">4</span> threadCount, total,        <span class="number">148771</span>,    <span class="number">4728</span>,    <span class="number">4633</span>,   <span class="number">13140</span>,     <span class="number">0.8</span>,     <span class="number">0.8</span>,     <span class="number">1.1</span>,     <span class="number">1.3</span>,     <span class="number">1.4</span>,   <span class="number">232.6</span>,   <span class="number">31.5</span>,  <span class="number">0.00958</span>,      <span class="number">0</span>,      <span class="number">9</span>,     <span class="number">535</span>,     <span class="number">535</span>,      <span class="number">13</span>,   <span class="number">16094</span></span><br><span class="line">  <span class="number">8</span> threadCount, insert,        <span class="number">74933</span>,    <span class="number">2379</span>,    <span class="number">2379</span>,    <span class="number">3256</span>,     <span class="number">0.5</span>,     <span class="number">0.4</span>,     <span class="number">0.7</span>,     <span class="number">0.8</span>,     <span class="number">7.1</span>,    <span class="number">54.7</span>,   <span class="number">31.5</span>,  <span class="number">0.00967</span>,      <span class="number">0</span>,     <span class="number">13</span>,     <span class="number">473</span>,     <span class="number">473</span>,      <span class="number">10</span>,   <span class="number">20848</span></span><br><span class="line">  <span class="number">8</span> threadCount, singlepost,    <span class="number">151072</span>,    <span class="number">4797</span>,    <span class="number">4667</span>,    <span class="number">4667</span>,     <span class="number">0.8</span>,     <span class="number">0.8</span>,     <span class="number">1.0</span>,     <span class="number">1.1</span>,     <span class="number">7.6</span>,    <span class="number">55.8</span>,   <span class="number">31.5</span>,  <span class="number">0.00967</span>,      <span class="number">0</span>,     <span class="number">13</span>,     <span class="number">473</span>,     <span class="number">473</span>,      <span class="number">10</span>,   <span class="number">20848</span></span><br><span class="line">  <span class="number">8</span> threadCount, timeline,      <span class="number">75451</span>,    <span class="number">2396</span>,    <span class="number">2331</span>,   <span class="number">18748</span>,     <span class="number">1.0</span>,     <span class="number">0.9</span>,     <span class="number">1.2</span>,     <span class="number">1.4</span>,    <span class="number">10.3</span>,    <span class="number">55.8</span>,   <span class="number">31.5</span>,  <span class="number">0.00967</span>,      <span class="number">0</span>,     <span class="number">13</span>,     <span class="number">473</span>,     <span class="number">473</span>,      <span class="number">10</span>,   <span class="number">20848</span></span><br><span class="line">  <span class="number">8</span> threadCount, total,        <span class="number">301456</span>,    <span class="number">9571</span>,    <span class="number">9377</span>,   <span class="number">26671</span>,     <span class="number">0.8</span>,     <span class="number">0.8</span>,     <span class="number">1.1</span>,     <span class="number">1.2</span>,     <span class="number">6.1</span>,    <span class="number">55.8</span>,   <span class="number">31.5</span>,  <span class="number">0.00967</span>,      <span class="number">0</span>,     <span class="number">13</span>,     <span class="number">473</span>,     <span class="number">473</span>,      <span class="number">10</span>,   <span class="number">20848</span></span><br><span class="line"> <span class="number">16</span> threadCount, insert,       <span class="number">145800</span>,    <span class="number">4531</span>,    <span class="number">4531</span>,    <span class="number">6208</span>,     <span class="number">0.5</span>,     <span class="number">0.4</span>,     <span class="number">0.7</span>,     <span class="number">0.8</span>,     <span class="number">1.2</span>,    <span class="number">71.5</span>,   <span class="number">32.2</span>,  <span class="number">0.00600</span>,      <span class="number">0</span>,     <span class="number">21</span>,     <span class="number">832</span>,     <span class="number">832</span>,      <span class="number">11</span>,   <span class="number">34730</span></span><br><span class="line"> <span class="number">16</span> threadCount, singlepost,    <span class="number">294522</span>,    <span class="number">9152</span>,    <span class="number">8910</span>,    <span class="number">8910</span>,     <span class="number">0.8</span>,     <span class="number">0.8</span>,     <span class="number">1.1</span>,     <span class="number">1.2</span>,     <span class="number">6.7</span>,    <span class="number">72.1</span>,   <span class="number">32.2</span>,  <span class="number">0.00600</span>,      <span class="number">0</span>,     <span class="number">21</span>,     <span class="number">832</span>,     <span class="number">832</span>,      <span class="number">11</span>,   <span class="number">34730</span></span><br><span class="line"> <span class="number">16</span> threadCount, timeline,     <span class="number">145130</span>,    <span class="number">4510</span>,    <span class="number">4390</span>,   <span class="number">35766</span>,     <span class="number">1.0</span>,     <span class="number">1.0</span>,     <span class="number">1.3</span>,     <span class="number">1.4</span>,     <span class="number">3.2</span>,    <span class="number">72.4</span>,   <span class="number">32.2</span>,  <span class="number">0.00600</span>,      <span class="number">0</span>,     <span class="number">21</span>,     <span class="number">832</span>,     <span class="number">832</span>,      <span class="number">11</span>,   <span class="number">34730</span></span><br><span class="line"> <span class="number">16</span> threadCount, total,        <span class="number">585452</span>,   <span class="number">18193</span>,   <span class="number">17831</span>,   <span class="number">50885</span>,     <span class="number">0.8</span>,     <span class="number">0.8</span>,     <span class="number">1.1</span>,     <span class="number">1.3</span>,     <span class="number">6.2</span>,    <span class="number">72.4</span>,   <span class="number">32.2</span>,  <span class="number">0.00600</span>,      <span class="number">0</span>,     <span class="number">21</span>,     <span class="number">832</span>,     <span class="number">832</span>,      <span class="number">11</span>,   <span class="number">34730</span></span><br><span class="line"> <span class="number">24</span> threadCount, insert,       <span class="number">205026</span>,    <span class="number">6333</span>,    <span class="number">6333</span>,    <span class="number">8666</span>,     <span class="number">0.5</span>,     <span class="number">0.5</span>,     <span class="number">0.8</span>,     <span class="number">0.9</span>,     <span class="number">2.5</span>,   <span class="number">240.6</span>,   <span class="number">32.4</span>,  <span class="number">0.01018</span>,      <span class="number">0</span>,     <span class="number">23</span>,     <span class="number">900</span>,     <span class="number">900</span>,       <span class="number">8</span>,   <span class="number">37887</span></span><br><span class="line"> <span class="number">24</span> threadCount, singlepost,    <span class="number">407459</span>,   <span class="number">12585</span>,   <span class="number">12271</span>,   <span class="number">12271</span>,     <span class="number">0.9</span>,     <span class="number">0.9</span>,     <span class="number">1.1</span>,     <span class="number">1.3</span>,     <span class="number">2.5</span>,    <span class="number">69.3</span>,   <span class="number">32.4</span>,  <span class="number">0.01018</span>,      <span class="number">0</span>,     <span class="number">23</span>,     <span class="number">900</span>,     <span class="number">900</span>,       <span class="number">8</span>,   <span class="number">37887</span></span><br><span class="line"> <span class="number">24</span> threadCount, timeline,     <span class="number">205264</span>,    <span class="number">6340</span>,    <span class="number">6182</span>,   <span class="number">51336</span>,     <span class="number">1.1</span>,     <span class="number">1.0</span>,     <span class="number">1.3</span>,     <span class="number">1.5</span>,     <span class="number">7.0</span>,    <span class="number">69.7</span>,   <span class="number">32.4</span>,  <span class="number">0.01018</span>,      <span class="number">0</span>,     <span class="number">23</span>,     <span class="number">900</span>,     <span class="number">900</span>,       <span class="number">8</span>,   <span class="number">37887</span></span><br><span class="line"> <span class="number">24</span> threadCount, total,        <span class="number">817749</span>,   <span class="number">25257</span>,   <span class="number">24786</span>,   <span class="number">72273</span>,     <span class="number">0.9</span>,     <span class="number">0.9</span>,     <span class="number">1.2</span>,     <span class="number">1.4</span>,     <span class="number">5.4</span>,   <span class="number">240.6</span>,   <span class="number">32.4</span>,  <span class="number">0.01018</span>,      <span class="number">0</span>,     <span class="number">23</span>,     <span class="number">900</span>,     <span class="number">900</span>,       <span class="number">8</span>,   <span class="number">37887</span></span><br><span class="line"> <span class="number">36</span> threadCount, insert,       <span class="number">288985</span>,    <span class="number">8787</span>,    <span class="number">8787</span>,   <span class="number">12010</span>,     <span class="number">0.6</span>,     <span class="number">0.5</span>,     <span class="number">0.9</span>,     <span class="number">1.1</span>,     <span class="number">7.9</span>,   <span class="number">223.1</span>,   <span class="number">32.9</span>,  <span class="number">0.00892</span>,      <span class="number">0</span>,     <span class="number">32</span>,    <span class="number">1210</span>,    <span class="number">1210</span>,       <span class="number">2</span>,   <span class="number">50873</span></span><br><span class="line"> <span class="number">36</span> threadCount, singlepost,    <span class="number">575082</span>,   <span class="number">17486</span>,   <span class="number">17068</span>,   <span class="number">17068</span>,     <span class="number">1.0</span>,     <span class="number">0.9</span>,     <span class="number">1.2</span>,     <span class="number">1.4</span>,     <span class="number">9.0</span>,   <span class="number">225.5</span>,   <span class="number">32.9</span>,  <span class="number">0.00892</span>,      <span class="number">0</span>,     <span class="number">32</span>,    <span class="number">1210</span>,    <span class="number">1210</span>,       <span class="number">2</span>,   <span class="number">50873</span></span><br><span class="line"> <span class="number">36</span> threadCount, timeline,     <span class="number">287981</span>,    <span class="number">8756</span>,    <span class="number">8548</span>,   <span class="number">72597</span>,     <span class="number">1.2</span>,     <span class="number">1.1</span>,     <span class="number">1.5</span>,     <span class="number">1.7</span>,     <span class="number">8.1</span>,   <span class="number">226.4</span>,   <span class="number">32.9</span>,  <span class="number">0.00892</span>,      <span class="number">0</span>,     <span class="number">32</span>,    <span class="number">1210</span>,    <span class="number">1210</span>,       <span class="number">2</span>,   <span class="number">50873</span></span><br><span class="line"> <span class="number">36</span> threadCount, total,       <span class="number">1152048</span>,   <span class="number">35029</span>,   <span class="number">34403</span>,  <span class="number">101674</span>,     <span class="number">0.9</span>,     <span class="number">0.9</span>,     <span class="number">1.3</span>,     <span class="number">1.5</span>,     <span class="number">2.2</span>,   <span class="number">226.4</span>,   <span class="number">32.9</span>,  <span class="number">0.00892</span>,      <span class="number">0</span>,     <span class="number">32</span>,    <span class="number">1210</span>,    <span class="number">1210</span>,       <span class="number">2</span>,   <span class="number">50873</span></span><br><span class="line"> <span class="number">54</span> threadCount, insert,       <span class="number">386007</span>,   <span class="number">11602</span>,   <span class="number">11602</span>,   <span class="number">15868</span>,     <span class="number">0.7</span>,     <span class="number">0.6</span>,     <span class="number">1.0</span>,     <span class="number">1.3</span>,     <span class="number">4.4</span>,    <span class="number">50.5</span>,   <span class="number">33.3</span>,  <span class="number">0.00845</span>,      <span class="number">0</span>,     <span class="number">40</span>,    <span class="number">1557</span>,    <span class="number">1557</span>,       <span class="number">2</span>,   <span class="number">63491</span></span><br><span class="line"> <span class="number">54</span> threadCount, singlepost,    <span class="number">773934</span>,   <span class="number">23262</span>,   <span class="number">22762</span>,   <span class="number">22762</span>,     <span class="number">1.1</span>,     <span class="number">1.0</span>,     <span class="number">1.5</span>,     <span class="number">1.8</span>,    <span class="number">15.0</span>,    <span class="number">51.3</span>,   <span class="number">33.3</span>,  <span class="number">0.00845</span>,      <span class="number">0</span>,     <span class="number">40</span>,    <span class="number">1557</span>,    <span class="number">1557</span>,       <span class="number">2</span>,   <span class="number">63491</span></span><br><span class="line"> <span class="number">54</span> threadCount, timeline,     <span class="number">387013</span>,   <span class="number">11633</span>,   <span class="number">11381</span>,   <span class="number">99175</span>,     <span class="number">1.3</span>,     <span class="number">1.2</span>,     <span class="number">1.7</span>,     <span class="number">2.1</span>,    <span class="number">18.7</span>,    <span class="number">50.6</span>,   <span class="number">33.3</span>,  <span class="number">0.00845</span>,      <span class="number">0</span>,     <span class="number">40</span>,    <span class="number">1557</span>,    <span class="number">1557</span>,       <span class="number">2</span>,   <span class="number">63491</span></span><br><span class="line"> <span class="number">54</span> threadCount, total,       <span class="number">1546954</span>,   <span class="number">46497</span>,   <span class="number">45746</span>,  <span class="number">137805</span>,     <span class="number">1.1</span>,     <span class="number">1.0</span>,     <span class="number">1.5</span>,     <span class="number">1.9</span>,    <span class="number">13.0</span>,    <span class="number">51.3</span>,   <span class="number">33.3</span>,  <span class="number">0.00845</span>,      <span class="number">0</span>,     <span class="number">40</span>,    <span class="number">1557</span>,    <span class="number">1557</span>,       <span class="number">2</span>,   <span class="number">63491</span></span><br><span class="line"> <span class="number">81</span> threadCount, insert,       <span class="number">440395</span>,   <span class="number">12498</span>,   <span class="number">12498</span>,   <span class="number">17085</span>,     <span class="number">1.2</span>,     <span class="number">1.0</span>,     <span class="number">1.5</span>,     <span class="number">1.8</span>,    <span class="number">15.2</span>,   <span class="number">275.6</span>,   <span class="number">35.2</span>,  <span class="number">0.00697</span>,      <span class="number">0</span>,     <span class="number">43</span>,    <span class="number">1707</span>,    <span class="number">1707</span>,       <span class="number">2</span>,   <span class="number">68157</span></span><br><span class="line"> <span class="number">81</span> threadCount, singlepost,    <span class="number">881687</span>,   <span class="number">25021</span>,   <span class="number">24544</span>,   <span class="number">24544</span>,     <span class="number">1.6</span>,     <span class="number">1.4</span>,     <span class="number">2.0</span>,     <span class="number">2.3</span>,    <span class="number">37.1</span>,    <span class="number">92.8</span>,   <span class="number">35.2</span>,  <span class="number">0.00697</span>,      <span class="number">0</span>,     <span class="number">43</span>,    <span class="number">1707</span>,    <span class="number">1707</span>,       <span class="number">2</span>,   <span class="number">68157</span></span><br><span class="line"> <span class="number">81</span> threadCount, timeline,     <span class="number">441963</span>,   <span class="number">12542</span>,   <span class="number">12299</span>,  <span class="number">109925</span>,     <span class="number">1.8</span>,     <span class="number">1.6</span>,     <span class="number">2.2</span>,     <span class="number">2.6</span>,    <span class="number">39.0</span>,    <span class="number">92.8</span>,   <span class="number">35.2</span>,  <span class="number">0.00697</span>,      <span class="number">0</span>,     <span class="number">43</span>,    <span class="number">1707</span>,    <span class="number">1707</span>,       <span class="number">2</span>,   <span class="number">68157</span></span><br><span class="line"> <span class="number">81</span> threadCount, total,       <span class="number">1764045</span>,   <span class="number">50060</span>,   <span class="number">49340</span>,  <span class="number">151554</span>,     <span class="number">1.5</span>,     <span class="number">1.4</span>,     <span class="number">2.0</span>,     <span class="number">2.4</span>,    <span class="number">35.6</span>,   <span class="number">275.6</span>,   <span class="number">35.2</span>,  <span class="number">0.00697</span>,      <span class="number">0</span>,     <span class="number">43</span>,    <span class="number">1707</span>,    <span class="number">1707</span>,       <span class="number">2</span>,   <span class="number">68157</span></span><br><span class="line"><span class="number">121</span> threadCount, insert,       <span class="number">479643</span>,   <span class="number">12574</span>,   <span class="number">12574</span>,   <span class="number">17174</span>,     <span class="number">2.0</span>,     <span class="number">1.8</span>,     <span class="number">2.3</span>,     <span class="number">2.8</span>,    <span class="number">41.4</span>,   <span class="number">277.5</span>,   <span class="number">38.1</span>,  <span class="number">0.00771</span>,      <span class="number">0</span>,     <span class="number">45</span>,    <span class="number">1788</span>,    <span class="number">1788</span>,       <span class="number">1</span>,   <span class="number">71366</span></span><br><span class="line"><span class="number">121</span> threadCount, singlepost,    <span class="number">949679</span>,   <span class="number">24896</span>,   <span class="number">24466</span>,   <span class="number">24466</span>,     <span class="number">2.4</span>,     <span class="number">2.2</span>,     <span class="number">2.8</span>,     <span class="number">3.3</span>,    <span class="number">41.6</span>,   <span class="number">239.1</span>,   <span class="number">38.1</span>,  <span class="number">0.00771</span>,      <span class="number">0</span>,     <span class="number">45</span>,    <span class="number">1788</span>,    <span class="number">1788</span>,       <span class="number">1</span>,   <span class="number">71366</span></span><br><span class="line"><span class="number">121</span> threadCount, timeline,     <span class="number">476907</span>,   <span class="number">12502</span>,   <span class="number">12289</span>,  <span class="number">112297</span>,     <span class="number">2.6</span>,     <span class="number">2.4</span>,     <span class="number">3.0</span>,     <span class="number">3.5</span>,    <span class="number">42.9</span>,   <span class="number">239.3</span>,   <span class="number">38.1</span>,  <span class="number">0.00771</span>,      <span class="number">0</span>,     <span class="number">45</span>,    <span class="number">1788</span>,    <span class="number">1788</span>,       <span class="number">1</span>,   <span class="number">71366</span></span><br><span class="line"><span class="number">121</span> threadCount, total,       <span class="number">1906229</span>,   <span class="number">49971</span>,   <span class="number">49328</span>,  <span class="number">153936</span>,     <span class="number">2.3</span>,     <span class="number">2.1</span>,     <span class="number">2.8</span>,     <span class="number">3.3</span>,    <span class="number">41.8</span>,   <span class="number">277.5</span>,   <span class="number">38.1</span>,  <span class="number">0.00771</span>,      <span class="number">0</span>,     <span class="number">45</span>,    <span class="number">1788</span>,    <span class="number">1788</span>,       <span class="number">1</span>,   <span class="number">71366</span></span><br><span class="line"><span class="number">181</span> threadCount, insert,       <span class="number">534496</span>,   <span class="number">12376</span>,   <span class="number">12376</span>,   <span class="number">16912</span>,     <span class="number">3.2</span>,     <span class="number">2.9</span>,     <span class="number">3.5</span>,     <span class="number">4.4</span>,    <span class="number">45.5</span>,   <span class="number">351.2</span>,   <span class="number">43.2</span>,  <span class="number">0.00806</span>,      <span class="number">0</span>,     <span class="number">54</span>,    <span class="number">2139</span>,    <span class="number">2164</span>,       <span class="number">8</span>,   <span class="number">84061</span></span><br><span class="line"><span class="number">181</span> threadCount, singlepost,   <span class="number">1070775</span>,   <span class="number">24793</span>,   <span class="number">24419</span>,   <span class="number">24419</span>,     <span class="number">3.6</span>,     <span class="number">3.3</span>,     <span class="number">4.1</span>,     <span class="number">5.4</span>,    <span class="number">45.1</span>,   <span class="number">112.1</span>,   <span class="number">43.2</span>,  <span class="number">0.00806</span>,      <span class="number">0</span>,     <span class="number">54</span>,    <span class="number">2139</span>,    <span class="number">2164</span>,       <span class="number">8</span>,   <span class="number">84061</span></span><br><span class="line"><span class="number">181</span> threadCount, timeline,     <span class="number">535592</span>,   <span class="number">12401</span>,   <span class="number">12212</span>,  <span class="number">113584</span>,     <span class="number">3.8</span>,     <span class="number">3.6</span>,     <span class="number">4.3</span>,     <span class="number">5.4</span>,    <span class="number">42.7</span>,   <span class="number">119.9</span>,   <span class="number">43.2</span>,  <span class="number">0.00806</span>,      <span class="number">0</span>,     <span class="number">54</span>,    <span class="number">2139</span>,    <span class="number">2164</span>,       <span class="number">8</span>,   <span class="number">84061</span></span><br><span class="line"><span class="number">181</span> threadCount, total,       <span class="number">2140863</span>,   <span class="number">49569</span>,   <span class="number">49007</span>,  <span class="number">154916</span>,     <span class="number">3.5</span>,     <span class="number">3.3</span>,     <span class="number">4.1</span>,     <span class="number">5.2</span>,    <span class="number">44.2</span>,   <span class="number">351.2</span>,   <span class="number">43.2</span>,  <span class="number">0.00806</span>,      <span class="number">0</span>,     <span class="number">54</span>,    <span class="number">2139</span>,    <span class="number">2164</span>,       <span class="number">8</span>,   <span class="number">84061</span></span><br><span class="line"><span class="number">271</span> threadCount, insert,       <span class="number">621662</span>,   <span class="number">12450</span>,   <span class="number">12450</span>,   <span class="number">17020</span>,     <span class="number">4.9</span>,     <span class="number">4.5</span>,     <span class="number">5.3</span>,     <span class="number">6.6</span>,    <span class="number">49.1</span>,   <span class="number">352.5</span>,   <span class="number">49.9</span>,  <span class="number">0.00709</span>,      <span class="number">0</span>,     <span class="number">65</span>,    <span class="number">2670</span>,    <span class="number">2670</span>,       <span class="number">8</span>,  <span class="number">105265</span></span><br><span class="line"><span class="number">271</span> threadCount, singlepost,   <span class="number">1236932</span>,   <span class="number">24773</span>,   <span class="number">24448</span>,   <span class="number">24448</span>,     <span class="number">5.4</span>,     <span class="number">5.0</span>,     <span class="number">5.9</span>,     <span class="number">7.4</span>,    <span class="number">50.8</span>,   <span class="number">200.2</span>,   <span class="number">49.9</span>,  <span class="number">0.00709</span>,      <span class="number">0</span>,     <span class="number">65</span>,    <span class="number">2670</span>,    <span class="number">2670</span>,       <span class="number">8</span>,  <span class="number">105265</span></span><br><span class="line"><span class="number">271</span> threadCount, timeline,     <span class="number">615702</span>,   <span class="number">12331</span>,   <span class="number">12169</span>,  <span class="number">114805</span>,     <span class="number">5.7</span>,     <span class="number">5.3</span>,     <span class="number">6.2</span>,     <span class="number">9.9</span>,    <span class="number">57.4</span>,   <span class="number">200.9</span>,   <span class="number">49.9</span>,  <span class="number">0.00709</span>,      <span class="number">0</span>,     <span class="number">65</span>,    <span class="number">2670</span>,    <span class="number">2670</span>,       <span class="number">8</span>,  <span class="number">105265</span></span><br><span class="line"><span class="number">271</span> threadCount, total,       <span class="number">2474296</span>,   <span class="number">49554</span>,   <span class="number">49066</span>,  <span class="number">156273</span>,     <span class="number">5.4</span>,     <span class="number">5.0</span>,     <span class="number">5.9</span>,     <span class="number">7.5</span>,    <span class="number">52.9</span>,   <span class="number">352.5</span>,   <span class="number">49.9</span>,  <span class="number">0.00709</span>,      <span class="number">0</span>,     <span class="number">65</span>,    <span class="number">2670</span>,    <span class="number">2670</span>,       <span class="number">8</span>,  <span class="number">105265</span></span><br></pre></td></tr></table></figure>
<p>CLUSTER49_blog_q1.log</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line">  <span class="number">4</span> threadCount, singlepost,    <span class="number">124438</span>,    <span class="number">4137</span>,    <span class="number">4088</span>,    <span class="number">4088</span>,     <span class="number">0.9</span>,     <span class="number">0.9</span>,     <span class="number">1.2</span>,     <span class="number">1.3</span>,     <span class="number">1.5</span>,    <span class="number">36.0</span>,   <span class="number">30.1</span>,  <span class="number">0.00523</span>,      <span class="number">0</span>,      <span class="number">7</span>,     <span class="number">235</span>,     <span class="number">235</span>,      <span class="number">18</span>,   <span class="number">12655</span></span><br><span class="line">  <span class="number">8</span> threadCount, singlepost,    <span class="number">260639</span>,    <span class="number">8663</span>,    <span class="number">8560</span>,    <span class="number">8560</span>,     <span class="number">0.8</span>,     <span class="number">0.9</span>,     <span class="number">1.2</span>,     <span class="number">1.3</span>,     <span class="number">1.5</span>,    <span class="number">31.4</span>,   <span class="number">30.1</span>,  <span class="number">0.00397</span>,      <span class="number">0</span>,      <span class="number">7</span>,     <span class="number">173</span>,     <span class="number">173</span>,       <span class="number">2</span>,   <span class="number">11432</span></span><br><span class="line"> <span class="number">16</span> threadCount, singlepost,    <span class="number">529703</span>,   <span class="number">17591</span>,   <span class="number">17380</span>,   <span class="number">17380</span>,     <span class="number">0.8</span>,     <span class="number">0.8</span>,     <span class="number">1.2</span>,     <span class="number">1.3</span>,     <span class="number">1.7</span>,    <span class="number">27.4</span>,   <span class="number">30.1</span>,  <span class="number">0.00446</span>,      <span class="number">0</span>,     <span class="number">11</span>,     <span class="number">251</span>,     <span class="number">251</span>,       <span class="number">1</span>,   <span class="number">17981</span></span><br><span class="line"> <span class="number">24</span> threadCount, singlepost,    <span class="number">811028</span>,   <span class="number">26917</span>,   <span class="number">26599</span>,   <span class="number">26599</span>,     <span class="number">0.8</span>,     <span class="number">0.7</span>,     <span class="number">1.2</span>,     <span class="number">1.4</span>,     <span class="number">4.0</span>,    <span class="number">27.0</span>,   <span class="number">30.1</span>,  <span class="number">0.00268</span>,      <span class="number">0</span>,     <span class="number">13</span>,     <span class="number">280</span>,     <span class="number">280</span>,       <span class="number">2</span>,   <span class="number">21261</span></span><br><span class="line"> <span class="number">36</span> threadCount, singlepost,   <span class="number">1140114</span>,   <span class="number">37749</span>,   <span class="number">37294</span>,   <span class="number">37294</span>,     <span class="number">0.9</span>,     <span class="number">0.8</span>,     <span class="number">1.3</span>,     <span class="number">1.5</span>,     <span class="number">3.9</span>,    <span class="number">28.3</span>,   <span class="number">30.2</span>,  <span class="number">0.00807</span>,      <span class="number">0</span>,     <span class="number">16</span>,     <span class="number">331</span>,     <span class="number">331</span>,       <span class="number">2</span>,   <span class="number">26171</span></span><br><span class="line"> <span class="number">54</span> threadCount, singlepost,   <span class="number">1169908</span>,   <span class="number">38732</span>,   <span class="number">38262</span>,   <span class="number">38262</span>,     <span class="number">1.3</span>,     <span class="number">1.2</span>,     <span class="number">1.7</span>,     <span class="number">1.9</span>,     <span class="number">7.8</span>,    <span class="number">25.9</span>,   <span class="number">30.2</span>,  <span class="number">0.00498</span>,      <span class="number">0</span>,     <span class="number">15</span>,     <span class="number">300</span>,     <span class="number">300</span>,       <span class="number">2</span>,   <span class="number">24535</span></span><br><span class="line"> <span class="number">81</span> threadCount, singlepost,   <span class="number">1180577</span>,   <span class="number">39018</span>,   <span class="number">38557</span>,   <span class="number">38557</span>,     <span class="number">2.0</span>,     <span class="number">1.9</span>,     <span class="number">2.3</span>,     <span class="number">2.5</span>,    <span class="number">18.2</span>,    <span class="number">70.3</span>,   <span class="number">30.3</span>,  <span class="number">0.00604</span>,      <span class="number">0</span>,     <span class="number">16</span>,     <span class="number">314</span>,     <span class="number">314</span>,       <span class="number">3</span>,   <span class="number">26168</span></span><br><span class="line"><span class="number">121</span> threadCount, singlepost,   <span class="number">1186818</span>,   <span class="number">39141</span>,   <span class="number">38676</span>,   <span class="number">38676</span>,     <span class="number">3.0</span>,     <span class="number">3.0</span>,     <span class="number">3.2</span>,     <span class="number">3.4</span>,    <span class="number">14.2</span>,    <span class="number">32.9</span>,   <span class="number">30.3</span>,  <span class="number">0.00262</span>,      <span class="number">0</span>,     <span class="number">12</span>,     <span class="number">223</span>,     <span class="number">223</span>,       <span class="number">4</span>,   <span class="number">19624</span></span><br><span class="line"><span class="number">181</span> threadCount, singlepost,   <span class="number">1196971</span>,   <span class="number">39363</span>,   <span class="number">38887</span>,   <span class="number">38887</span>,     <span class="number">4.5</span>,     <span class="number">4.5</span>,     <span class="number">4.7</span>,     <span class="number">4.9</span>,    <span class="number">17.0</span>,    <span class="number">30.4</span>,   <span class="number">30.4</span>,  <span class="number">0.00113</span>,      <span class="number">0</span>,     <span class="number">13</span>,     <span class="number">216</span>,     <span class="number">216</span>,       <span class="number">1</span>,   <span class="number">21263</span></span><br><span class="line"><span class="number">271</span> threadCount, singlepost,   <span class="number">1200807</span>,   <span class="number">39256</span>,   <span class="number">38777</span>,   <span class="number">38777</span>,     <span class="number">6.8</span>,     <span class="number">6.7</span>,     <span class="number">7.0</span>,     <span class="number">7.3</span>,    <span class="number">20.3</span>,   <span class="number">169.8</span>,   <span class="number">30.6</span>,  <span class="number">0.00650</span>,      <span class="number">0</span>,     <span class="number">12</span>,     <span class="number">200</span>,     <span class="number">200</span>,       <span class="number">1</span>,   <span class="number">19628</span></span><br></pre></td></tr></table></figure>
<p>CLUSTER410_blog_q2.log</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">             id, type,      total ops,    op/s,    pk/s,   row/s,    mean,     med,     <span class="number">.95</span>,     <span class="number">.99</span>,    <span class="number">.999</span>,     max,   time,   <span class="built_in">stderr</span>, errors,  gc: <span class="preprocessor">#,  max ms,  sum ms,  sdv ms,      mb</span></span><br><span class="line">  <span class="number">4</span> threadCount, timeline,     <span class="number">150606</span>,    <span class="number">5005</span>,    <span class="number">4945</span>,   <span class="number">46957</span>,     <span class="number">0.7</span>,     <span class="number">0.7</span>,     <span class="number">0.9</span>,     <span class="number">1.0</span>,     <span class="number">1.2</span>,    <span class="number">18.1</span>,   <span class="number">30.1</span>,  <span class="number">0.00308</span>,      <span class="number">0</span>,      <span class="number">9</span>,     <span class="number">134</span>,     <span class="number">134</span>,       <span class="number">1</span>,   <span class="number">14732</span></span><br><span class="line">  <span class="number">8</span> threadCount, timeline,     <span class="number">303760</span>,   <span class="number">10097</span>,    <span class="number">9976</span>,   <span class="number">94717</span>,     <span class="number">0.7</span>,     <span class="number">0.7</span>,     <span class="number">0.9</span>,     <span class="number">1.0</span>,     <span class="number">1.2</span>,    <span class="number">19.8</span>,   <span class="number">30.1</span>,  <span class="number">0.00180</span>,      <span class="number">0</span>,     <span class="number">12</span>,     <span class="number">180</span>,     <span class="number">180</span>,       <span class="number">2</span>,   <span class="number">19640</span></span><br><span class="line"> <span class="number">16</span> threadCount, timeline,     <span class="number">586886</span>,   <span class="number">19491</span>,   <span class="number">19260</span>,  <span class="number">182833</span>,     <span class="number">0.7</span>,     <span class="number">0.7</span>,     <span class="number">0.9</span>,     <span class="number">1.0</span>,     <span class="number">1.2</span>,    <span class="number">23.1</span>,   <span class="number">30.1</span>,  <span class="number">0.00684</span>,      <span class="number">0</span>,     <span class="number">22</span>,     <span class="number">292</span>,     <span class="number">292</span>,       <span class="number">2</span>,   <span class="number">36025</span></span><br><span class="line"> <span class="number">24</span> threadCount, timeline,     <span class="number">842276</span>,   <span class="number">27952</span>,   <span class="number">27615</span>,  <span class="number">262067</span>,     <span class="number">0.8</span>,     <span class="number">0.7</span>,     <span class="number">1.0</span>,     <span class="number">1.1</span>,     <span class="number">3.5</span>,    <span class="number">22.5</span>,   <span class="number">30.1</span>,  <span class="number">0.00723</span>,      <span class="number">0</span>,     <span class="number">32</span>,     <span class="number">400</span>,     <span class="number">400</span>,       <span class="number">2</span>,   <span class="number">52404</span></span><br><span class="line"> <span class="number">36</span> threadCount, timeline,    <span class="number">1159174</span>,   <span class="number">38409</span>,   <span class="number">37950</span>,  <span class="number">360174</span>,     <span class="number">0.8</span>,     <span class="number">0.8</span>,     <span class="number">1.1</span>,     <span class="number">1.2</span>,     <span class="number">5.6</span>,    <span class="number">18.6</span>,   <span class="number">30.2</span>,  <span class="number">0.01793</span>,      <span class="number">0</span>,     <span class="number">41</span>,     <span class="number">477</span>,     <span class="number">477</span>,       <span class="number">1</span>,   <span class="number">67158</span></span><br><span class="line"> <span class="number">54</span> threadCount, timeline,    <span class="number">1212693</span>,   <span class="number">40154</span>,   <span class="number">39673</span>,  <span class="number">376526</span>,     <span class="number">1.3</span>,     <span class="number">1.2</span>,     <span class="number">1.5</span>,     <span class="number">1.6</span>,     <span class="number">8.3</span>,    <span class="number">25.2</span>,   <span class="number">30.2</span>,  <span class="number">0.00919</span>,      <span class="number">0</span>,     <span class="number">42</span>,     <span class="number">467</span>,     <span class="number">475</span>,       <span class="number">2</span>,   <span class="number">67169</span></span><br><span class="line"> <span class="number">81</span> threadCount, timeline,    <span class="number">1216916</span>,   <span class="number">40230</span>,   <span class="number">39744</span>,  <span class="number">377269</span>,     <span class="number">1.9</span>,     <span class="number">1.9</span>,     <span class="number">2.1</span>,     <span class="number">2.4</span>,    <span class="number">11.4</span>,    <span class="number">74.0</span>,   <span class="number">30.2</span>,  <span class="number">0.00547</span>,      <span class="number">0</span>,     <span class="number">42</span>,     <span class="number">454</span>,     <span class="number">454</span>,       <span class="number">1</span>,   <span class="number">68812</span></span><br><span class="line"><span class="number">121</span> threadCount, timeline,    <span class="number">1228813</span>,   <span class="number">40520</span>,   <span class="number">40037</span>,  <span class="number">379868</span>,     <span class="number">2.9</span>,     <span class="number">2.9</span>,     <span class="number">3.1</span>,     <span class="number">3.4</span>,    <span class="number">10.5</span>,    <span class="number">23.5</span>,   <span class="number">30.3</span>,  <span class="number">0.00332</span>,      <span class="number">0</span>,     <span class="number">42</span>,     <span class="number">461</span>,     <span class="number">461</span>,       <span class="number">1</span>,   <span class="number">68813</span></span><br><span class="line"><span class="number">181</span> threadCount, timeline,    <span class="number">1236969</span>,   <span class="number">40658</span>,   <span class="number">40170</span>,  <span class="number">381272</span>,     <span class="number">4.4</span>,     <span class="number">4.3</span>,     <span class="number">4.6</span>,     <span class="number">5.1</span>,    <span class="number">13.7</span>,    <span class="number">27.8</span>,   <span class="number">30.4</span>,  <span class="number">0.00334</span>,      <span class="number">0</span>,     <span class="number">42</span>,     <span class="number">457</span>,     <span class="number">457</span>,       <span class="number">1</span>,   <span class="number">68814</span></span><br><span class="line"><span class="number">271</span> threadCount, timeline,    <span class="number">1231892</span>,   <span class="number">40351</span>,   <span class="number">39865</span>,  <span class="number">378388</span>,     <span class="number">6.6</span>,     <span class="number">6.5</span>,     <span class="number">6.8</span>,     <span class="number">7.5</span>,    <span class="number">29.2</span>,   <span class="number">221.9</span>,   <span class="number">30.5</span>,  <span class="number">0.00637</span>,      <span class="number">0</span>,     <span class="number">42</span>,     <span class="number">453</span>,     <span class="number">453</span>,       <span class="number">0</span>,   <span class="number">68813</span></span><br></pre></td></tr></table></figure>
<h2 id="YCSB">YCSB</h2><p><a href="https://github.com/cloudius-systems/osv/wiki/Benchmarking-Cassandra-and-other-NoSQL-databases-with-YCSB">https://github.com/cloudius-systems/osv/wiki/Benchmarking-Cassandra-and-other-NoSQL-databases-with-YCSB</a></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">./bin/ycsb <span class="operator"><span class="keyword">load</span> cassandra-<span class="number">10</span> -<span class="keyword">p</span> <span class="keyword">hosts</span>=<span class="string">"192.168.122.89"</span> -<span class="keyword">P</span> workloads/workloada -s &gt; workloada_load_res.txt</span><br><span class="line">./<span class="keyword">bin</span>/ycsb run  cassandra-<span class="number">10</span> -threads <span class="number">10</span> -<span class="keyword">p</span> <span class="keyword">hosts</span>=<span class="string">"192.168.122.89"</span> -<span class="keyword">P</span> workloads/workloada -s  &gt; workloada_run_res.txt</span><br><span class="line"></span><br><span class="line">./<span class="keyword">bin</span>/ycsb <span class="keyword">load</span> cassandra-<span class="number">10</span> -<span class="keyword">P</span> workloads/workloada -<span class="keyword">p</span> <span class="keyword">hosts</span>=localhost -<span class="keyword">p</span> columnfamily=<span class="keyword">data</span> &gt; ./my-results/<span class="keyword">load</span>-cassandra-a </span><br><span class="line">./<span class="keyword">bin</span>/ycsb run  cassandra-<span class="number">10</span> -<span class="keyword">P</span> workloads/workloada -<span class="keyword">p</span> <span class="keyword">hosts</span>=localhost -<span class="keyword">p</span> columnfamily=<span class="keyword">data</span> &gt; ./my-results/run-cassandra-a</span></span><br></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/work/">work</a>
	</div>


      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cassandra/">cassandra</a></li></ul>
	</div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
</article>











    
        <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
        <script>
        var yiliaConfig = {
        fancybox: true,
        mathjax: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        open_in_new: false
        }
        </script>
        

  
    <article id="post-Cassandra-Operation" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/10/15/Cassandra-Operation/" class="article-date">
  	<time datetime="2015-10-14T16:00:00.000Z" itemprop="datePublished">2015-10-15</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/15/Cassandra-Operation/">Cassandra操作</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        
        <a id="more"></a>
<!-- MarkdownTOC -->
<ul>
<li>优雅关闭节点</li>
<li>不同集群数据同步<ul>
<li>增量备份</li>
<li>准备工作：新集群搭建和建表</li>
<li>开始：先测试一张表的迁移</li>
<li>整个集群做一次完整的快照迁移</li>
<li>增量备份（需要多次执行）</li>
<li>机房迁移<ul>
<li>直接从当前集群同步到上海集群</li>
<li>新集群安装</li>
<li><ol>
<li>表结构</li>
</ol>
</li>
<li><ol>
<li>数据迁移</li>
</ol>
</li>
<li><ol>
<li>增量数据迁移</li>
</ol>
</li>
<li><ol>
<li>数据验证</li>
</ol>
</li>
</ul>
</li>
</ul>
</li>
<li>nodetool工具<ul>
<li>集群状态: nodetool decribecluster</li>
<li>删除节点: removenode</li>
<li>替换节点: replace_address</li>
<li>重新加入</li>
<li>网络状态netstats: 显示一个节点的Active Stream</li>
<li>节点信息: nodetool info</li>
<li>Gossip信息: nodetool gossipinfo</li>
<li>表相关的信息:nodetool cfstats forseti.velocity</li>
<li>compactionhistory</li>
<li>节点sstable数量异常</li>
</ul>
</li>
<li>tpstats</li>
<li>sstable writer<ul>
<li>文件数过多</li>
<li>导入数据后，用refresh</li>
<li>通过增大内存来增大sstable大小（内存不足）</li>
<li>分表？</li>
</ul>
</li>
<li>sstableloader</li>
<li>jHiccup</li>
</ul>
<!-- /MarkdownTOC -->
<h2 id="优雅关闭节点">优雅关闭节点</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[admin@cass048169 ~]$ /usr/<span class="operator"><span class="keyword">install</span>/cassandra/<span class="keyword">bin</span>/nodetool stopdaemon</span><br><span class="line">Cassandra has <span class="keyword">shutdown</span>.</span><br><span class="line"><span class="keyword">error</span>: 拒绝连接</span><br><span class="line"><span class="comment">-- StackTrace --</span></span><br><span class="line"><span class="keyword">java</span>.net.ConnectException: 拒绝连接</span><br><span class="line">  <span class="keyword">at</span> <span class="keyword">java</span>.net.PlainSocketImpl.socketConnect(<span class="keyword">Native</span> Method)</span><br><span class="line">  <span class="keyword">at</span> <span class="keyword">java</span>.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.<span class="keyword">java</span>:<span class="number">339</span>)</span><br><span class="line">  <span class="keyword">at</span> <span class="keyword">java</span>.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.<span class="keyword">java</span>:<span class="number">200</span>)</span><br><span class="line">  <span class="keyword">at</span> <span class="keyword">java</span>.net.AbstractPlainSocketImpl.<span class="keyword">connect</span>(AbstractPlainSocketImpl.<span class="keyword">java</span>:<span class="number">182</span>)</span><br><span class="line">  <span class="keyword">at</span> <span class="keyword">java</span>.net.SocksSocketImpl.<span class="keyword">connect</span>(SocksSocketImpl.<span class="keyword">java</span>:<span class="number">392</span>)</span><br><span class="line">  <span class="keyword">at</span> <span class="keyword">java</span>.net.Socket.<span class="keyword">connect</span>(Socket.<span class="keyword">java</span>:<span class="number">579</span>)</span><br><span class="line">  <span class="keyword">at</span> <span class="keyword">java</span>.net.Socket.<span class="keyword">connect</span>(Socket.<span class="keyword">java</span>:<span class="number">528</span>)</span><br><span class="line">  <span class="keyword">at</span> <span class="keyword">java</span>.net.Socket.&lt;init&gt;(Socket.<span class="keyword">java</span>:<span class="number">425</span>)</span><br><span class="line">  <span class="keyword">at</span> <span class="keyword">java</span>.net.Socket.&lt;init&gt;(Socket.<span class="keyword">java</span>:<span class="number">208</span>)</span><br><span class="line">  <span class="keyword">at</span> sun.rmi.transport.proxy.RMIDirectSocketFactory.createSocket(RMIDirectSocketFactory.<span class="keyword">java</span>:<span class="number">40</span>)</span><br><span class="line">  <span class="keyword">at</span> sun.rmi.transport.proxy.RMIMasterSocketFactory.createSocket(RMIMasterSocketFactory.<span class="keyword">java</span>:<span class="number">147</span>)</span><br><span class="line">  <span class="keyword">at</span> sun.rmi.transport.tcp.TCPEndpoint.newSocket(TCPEndpoint.<span class="keyword">java</span>:<span class="number">613</span>)</span><br><span class="line">  <span class="keyword">at</span> sun.rmi.transport.tcp.TCPChannel.createConnection(TCPChannel.<span class="keyword">java</span>:<span class="number">216</span>)</span><br><span class="line">  <span class="keyword">at</span> sun.rmi.transport.tcp.TCPChannel.newConnection(TCPChannel.<span class="keyword">java</span>:<span class="number">202</span>)</span><br><span class="line">  <span class="keyword">at</span> sun.rmi.<span class="keyword">server</span>.UnicastRef.invoke(UnicastRef.<span class="keyword">java</span>:<span class="number">129</span>)</span><br><span class="line">  <span class="keyword">at</span> com.sun.jmx.remote.internal.PRef.invoke(<span class="keyword">Unknown</span> <span class="keyword">Source</span>)</span><br><span class="line">  <span class="keyword">at</span> javax.<span class="keyword">management</span>.remote.rmi.RMIConnectionImpl_Stub.<span class="keyword">close</span>(<span class="keyword">Unknown</span> <span class="keyword">Source</span>)</span><br><span class="line">  <span class="keyword">at</span> javax.<span class="keyword">management</span>.remote.rmi.RMIConnector.<span class="keyword">close</span>(RMIConnector.<span class="keyword">java</span>:<span class="number">512</span>)</span><br><span class="line">  <span class="keyword">at</span> javax.<span class="keyword">management</span>.remote.rmi.RMIConnector.<span class="keyword">close</span>(RMIConnector.<span class="keyword">java</span>:<span class="number">452</span>)</span><br><span class="line">  <span class="keyword">at</span> org.apache.cassandra.tools.NodeProbe.<span class="keyword">close</span>(NodeProbe.<span class="keyword">java</span>:<span class="number">237</span>)</span><br><span class="line">  <span class="keyword">at</span> org.apache.cassandra.tools.NodeTool$NodeToolCmd.run(NodeTool.<span class="keyword">java</span>:<span class="number">295</span>)</span><br><span class="line">  <span class="keyword">at</span> org.apache.cassandra.tools.NodeTool.<span class="keyword">main</span>(NodeTool.<span class="keyword">java</span>:<span class="number">206</span>)</span><br><span class="line"></span><br><span class="line">[<span class="keyword">admin</span>@cass048169 ~]$</span><br><span class="line">[<span class="keyword">admin</span>@cass048169 ~]$</span><br><span class="line">[<span class="keyword">admin</span>@cass048169 ~]$ ps -ef|grep cassandra</span><br><span class="line"><span class="keyword">admin</span>    <span class="number">40084</span> <span class="number">37927</span>  <span class="number">0</span> <span class="number">09</span>:<span class="number">46</span> pts/<span class="number">0</span>    <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> grep cassandra</span></span><br></pre></td></tr></table></figure>
<h2 id="不同集群数据同步">不同集群数据同步</h2><p>1.sstableloader的文件夹必须是keyspace/table格式,否则空指针异常:  </p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[qihuang.zheng@dp0652 ~]$ /usr/install/cassandra/bin/sstableloader -d localhost <span class="number">1445938244634</span></span><br><span class="line">Exception <span class="keyword">in</span> thread <span class="string">"main"</span> java<span class="class">.lang</span><span class="class">.NullPointerException</span></span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.io</span><span class="class">.sstable</span><span class="class">.SSTableLoader</span>.&lt;init&gt;(SSTableLoader<span class="class">.java</span>:<span class="number">59</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.tools</span><span class="class">.BulkLoader</span><span class="class">.main</span>(BulkLoader<span class="class">.java</span>:<span class="number">80</span>)</span><br><span class="line"></span><br><span class="line">$ cd /home/admin/data/cassandra/data/forseti/velocity/snapshots</span><br><span class="line">$ /usr/install/cassandra/bin/sstableloader -d <span class="number">192.168</span>.<span class="number">6.52</span> <span class="number">1445938244634</span></span><br><span class="line">Exception <span class="keyword">in</span> thread <span class="string">"main"</span> java<span class="class">.lang</span><span class="class">.NullPointerException</span></span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.io</span><span class="class">.sstable</span><span class="class">.SSTableLoader</span>.&lt;init&gt;(SSTableLoader<span class="class">.java</span>:<span class="number">59</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.tools</span><span class="class">.BulkLoader</span><span class="class">.main</span>(BulkLoader<span class="class">.java</span>:<span class="number">80</span>)</span><br></pre></td></tr></table></figure>
<p>2.做快照后会在表目录生成snapshots文件夹, 不能直接在表目录上使用sstableloader:  </p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ /usr/install/cassandra/bin/sstableloader -d <span class="number">192.168</span>.<span class="number">6.52</span> /home/admin/data/cassandra/data/forseti/velocity/snapshots/<span class="number">1445938244634</span></span><br><span class="line">Could not retrieve endpoint ranges:</span><br><span class="line"><span class="function"><span class="title">InvalidRequestException</span><span class="params">(why:No such keyspace: snapshots)</span></span></span><br><span class="line">Run with --debug to get full stack trace or --help to get help.</span><br><span class="line"></span><br><span class="line">[qihuang.zheng@mysql006070 ~]$ /usr/install/cassandra/bin/sstableloader -d <span class="number">192.168</span>.<span class="number">6.52</span> /home/admin/data/cassandra/data/forseti/velocity</span><br><span class="line">Established connection to <span class="attribute">initial</span> hosts</span><br><span class="line">Opening sstables and calculating sections to stream</span><br><span class="line">Exception <span class="keyword">in</span> thread <span class="string">"main"</span> FSWriteError <span class="keyword">in</span> /home/admin/data/cassandra/data/forseti/velocity/forseti-velocity-jb-<span class="number">414</span>-Summary<span class="class">.db</span></span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.io</span><span class="class">.util</span><span class="class">.FileUtils</span><span class="class">.deleteWithConfirm</span>(FileUtils<span class="class">.java</span>:<span class="number">122</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.io</span><span class="class">.sstable</span><span class="class">.SSTableReader</span><span class="class">.loadSummary</span>(SSTableReader<span class="class">.java</span>:<span class="number">546</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.io</span><span class="class">.sstable</span><span class="class">.SSTableReader</span><span class="class">.openForBatch</span>(SSTableReader<span class="class">.java</span>:<span class="number">173</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.io</span><span class="class">.sstable</span><span class="class">.SSTableLoader</span>$<span class="number">1</span>.<span class="function"><span class="title">accept</span><span class="params">(SSTableLoader.java:<span class="number">107</span>)</span></span></span><br><span class="line">  at java<span class="class">.io</span><span class="class">.File</span><span class="class">.list</span>(File<span class="class">.java</span>:<span class="number">1155</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.io</span><span class="class">.sstable</span><span class="class">.SSTableLoader</span><span class="class">.openSSTables</span>(SSTableLoader<span class="class">.java</span>:<span class="number">68</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.io</span><span class="class">.sstable</span><span class="class">.SSTableLoader</span><span class="class">.stream</span>(SSTableLoader<span class="class">.java</span>:<span class="number">150</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.tools</span><span class="class">.BulkLoader</span><span class="class">.main</span>(BulkLoader<span class="class">.java</span>:<span class="number">95</span>)</span><br><span class="line">Caused by: java<span class="class">.nio</span><span class="class">.file</span><span class="class">.AccessDeniedException</span>: /home/admin/data/cassandra/data/forseti/velocity/forseti-velocity-jb-<span class="number">414</span>-Summary<span class="class">.db</span></span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.io</span><span class="class">.util</span><span class="class">.FileUtils</span><span class="class">.deleteWithConfirm</span>(FileUtils<span class="class">.java</span>:<span class="number">118</span>)</span><br><span class="line">  ... <span class="number">7</span> more</span><br><span class="line">[qihuang.zheng@mysql006070 ~]$ sudo -u admin /usr/install/cassandra/bin/sstableloader -d <span class="number">192.168</span>.<span class="number">6.52</span> /home/admin/data/cassandra/data/forseti/velocity</span><br><span class="line">Caused by: java<span class="class">.net</span><span class="class">.UnknownHostException</span>: mysql006070: 未知的名称或服务</span><br><span class="line">  at java<span class="class">.net</span><span class="class">.Inet6AddressImpl</span><span class="class">.lookupAllHostAddr</span>(Native Method)</span><br><span class="line">  at java<span class="class">.net</span><span class="class">.InetAddress</span>$<span class="number">1</span>.<span class="function"><span class="title">lookupAllHostAddr</span><span class="params">(InetAddress.java:<span class="number">901</span>)</span></span></span><br><span class="line">  at java<span class="class">.net</span><span class="class">.InetAddress</span><span class="class">.getAddressesFromNameService</span>(InetAddress<span class="class">.java</span>:<span class="number">1293</span>)</span><br><span class="line">  at java<span class="class">.net</span><span class="class">.InetAddress</span><span class="class">.getLocalHost</span>(InetAddress<span class="class">.java</span>:<span class="number">1469</span>)</span><br><span class="line">  ... <span class="number">11</span> more</span><br></pre></td></tr></table></figure>
<p>3.使用sstableloader时, 在表目录下不能存在snapshots目录.  <a href="http://tonywutao.github.io/2013/10/17/SSS-Table-Loader-in-Cassandra/" target="_blank" rel="external">http://tonywutao.github.io/2013/10/17/SSS-Table-Loader-in-Cassandra/</a><br>但是做快照时, snapshots目录又是生成在表目录下, 所以不能直接用sstableloader, 解决办法是将快照文件夹拷贝到别的地方,并按照keyspace/table格式.<br>如果运行sstableloader的机器的内存不足, 会报OOM, 可以加大内存, 但是如果机器本身内存不足, 最好的办法只能是scp到一台比较大内存的机器.  </p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Exception <span class="keyword">in</span> thread <span class="string">"main"</span> java<span class="class">.lang</span><span class="class">.OutOfMemoryError</span>: Java heap space</span><br><span class="line">  at java<span class="class">.util</span><span class="class">.TreeMap</span><span class="class">.put</span>(TreeMap<span class="class">.java</span>:<span class="number">569</span>)</span><br><span class="line">  at java<span class="class">.util</span><span class="class">.TreeSet</span><span class="class">.add</span>(TreeSet<span class="class">.java</span>:<span class="number">255</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.io</span><span class="class">.compress</span><span class="class">.CompressionMetadata</span><span class="class">.getChunksForSections</span>(CompressionMetadata<span class="class">.java</span>:<span class="number">226</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.streaming</span><span class="class">.messages</span><span class="class">.OutgoingFileMessage</span>.&lt;init&gt;(OutgoingFileMessage<span class="class">.java</span>:<span class="number">76</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.streaming</span><span class="class">.StreamTransferTask</span><span class="class">.addTransferFile</span>(StreamTransferTask<span class="class">.java</span>:<span class="number">56</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.streaming</span><span class="class">.StreamSession</span><span class="class">.addTransferFiles</span>(StreamSession<span class="class">.java</span>:<span class="number">340</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.streaming</span><span class="class">.StreamPlan</span><span class="class">.transferFiles</span>(StreamPlan<span class="class">.java</span>:<span class="number">138</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.io</span><span class="class">.sstable</span><span class="class">.SSTableLoader</span><span class="class">.stream</span>(SSTableLoader<span class="class">.java</span>:<span class="number">178</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.tools</span><span class="class">.BulkLoader</span><span class="class">.main</span>(BulkLoader<span class="class">.java</span>:<span class="number">95</span>)</span><br><span class="line">ERROR <span class="number">13</span>:<span class="number">32</span>:<span class="number">10</span>,<span class="number">104</span> Error <span class="keyword">in</span> ThreadPoolExecutor</span><br><span class="line">java<span class="class">.lang</span><span class="class">.OutOfMemoryError</span>: Java heap space</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.utils</span><span class="class">.BackgroundActivityMonitor</span><span class="class">.readAndCompute</span>(BackgroundActivityMonitor<span class="class">.java</span>:<span class="number">84</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.utils</span><span class="class">.BackgroundActivityMonitor</span><span class="class">.getIOWait</span>(BackgroundActivityMonitor<span class="class">.java</span>:<span class="number">125</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.utils</span><span class="class">.BackgroundActivityMonitor</span><span class="variable">$BackgroundActivityReporter</span>.<span class="function"><span class="title">run</span><span class="params">(BackgroundActivityMonitor.java:<span class="number">153</span>)</span></span></span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.concurrent</span><span class="class">.DebuggableScheduledThreadPoolExecutor</span><span class="variable">$UncomplainingRunnable</span>.<span class="function"><span class="title">run</span><span class="params">(DebuggableScheduledThreadPoolExecutor.java:<span class="number">80</span>)</span></span></span><br><span class="line">  at java<span class="class">.util</span><span class="class">.concurrent</span><span class="class">.Executors</span><span class="variable">$RunnableAdapter</span>.<span class="function"><span class="title">call</span><span class="params">(Executors.java:<span class="number">471</span>)</span></span></span><br><span class="line">  at java<span class="class">.util</span><span class="class">.concurrent</span><span class="class">.FutureTask</span><span class="class">.runAndReset</span>(FutureTask<span class="class">.java</span>:<span class="number">304</span>)</span><br><span class="line">  at java<span class="class">.util</span><span class="class">.concurrent</span><span class="class">.ScheduledThreadPoolExecutor</span><span class="variable">$ScheduledFutureTask</span>.access$<span class="number">301</span>(ScheduledThreadPoolExecutor<span class="class">.java</span>:<span class="number">178</span>)</span><br><span class="line">  at java<span class="class">.util</span><span class="class">.concurrent</span><span class="class">.ScheduledThreadPoolExecutor</span><span class="variable">$ScheduledFutureTask</span>.<span class="function"><span class="title">run</span><span class="params">(ScheduledThreadPoolExecutor.java:<span class="number">293</span>)</span></span></span><br><span class="line">  at java<span class="class">.util</span><span class="class">.concurrent</span><span class="class">.ThreadPoolExecutor</span><span class="class">.runWorker</span>(ThreadPoolExecutor<span class="class">.java</span>:<span class="number">1145</span>)</span><br><span class="line">  at java<span class="class">.util</span><span class="class">.concurrent</span><span class="class">.ThreadPoolExecutor</span><span class="variable">$Worker</span>.<span class="function"><span class="title">run</span><span class="params">(ThreadPoolExecutor.java:<span class="number">615</span>)</span></span></span><br><span class="line">  at java<span class="class">.lang</span><span class="class">.Thread</span><span class="class">.run</span>(Thread<span class="class">.java</span>:<span class="number">744</span>)</span><br><span class="line"></span><br><span class="line">Exception <span class="keyword">in</span> thread <span class="string">"main"</span> java<span class="class">.lang</span><span class="class">.OutOfMemoryError</span>: GC overhead limit exceeded</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.io</span><span class="class">.compress</span><span class="class">.CompressionMetadata</span><span class="class">.getChunksForSections</span>(CompressionMetadata<span class="class">.java</span>:<span class="number">226</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.streaming</span><span class="class">.messages</span><span class="class">.OutgoingFileMessage</span>.&lt;init&gt;(OutgoingFileMessage<span class="class">.java</span>:<span class="number">76</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.streaming</span><span class="class">.StreamTransferTask</span><span class="class">.addTransferFile</span>(StreamTransferTask<span class="class">.java</span>:<span class="number">56</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.streaming</span><span class="class">.StreamSession</span><span class="class">.addTransferFiles</span>(StreamSession<span class="class">.java</span>:<span class="number">340</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.streaming</span><span class="class">.StreamPlan</span><span class="class">.transferFiles</span>(StreamPlan<span class="class">.java</span>:<span class="number">138</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.io</span><span class="class">.sstable</span><span class="class">.SSTableLoader</span><span class="class">.stream</span>(SSTableLoader<span class="class">.java</span>:<span class="number">178</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.tools</span><span class="class">.BulkLoader</span><span class="class">.main</span>(BulkLoader<span class="class">.java</span>:<span class="number">95</span>)</span><br></pre></td></tr></table></figure>
<p><a href="http://stackoverflow.com/questions/32715401/cassandra-migrate-keyspace-data-from-multinode-cluster-to-singlenode-cluster" target="_blank" rel="external">http://stackoverflow.com/questions/32715401/cassandra-migrate-keyspace-data-from-multinode-cluster-to-singlenode-cluster</a></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">ERROR [StreamReceiveTask:<span class="number">124</span>] <span class="number">2016</span>-<span class="number">06</span>-<span class="number">10</span> <span class="number">18</span>:<span class="number">09</span>:<span class="number">31</span>,<span class="number">717</span> StreamReceiveTask<span class="class">.java</span>:<span class="number">183</span> - Error applying streamed data:</span><br><span class="line">org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.io</span><span class="class">.FSReadError</span>: java<span class="class">.io</span><span class="class">.IOException</span>: Map failed</span><br><span class="line">        at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.io</span><span class="class">.util</span><span class="class">.MmappedSegmentedFile</span><span class="variable">$Builder</span>.<span class="function"><span class="title">createSegments</span><span class="params">(MmappedSegmentedFile.java:<span class="number">399</span>)</span></span> ~[apache-cassandra-<span class="number">2.1</span>.<span class="number">13</span><span class="class">.jar</span>:<span class="number">2.1</span>.<span class="number">13</span>]</span><br><span class="line">        at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.io</span><span class="class">.util</span><span class="class">.MmappedSegmentedFile</span><span class="variable">$Builder</span>.<span class="function"><span class="title">complete</span><span class="params">(MmappedSegmentedFile.java:<span class="number">365</span>)</span></span> ~[apache-cassandra-<span class="number">2.1</span>.<span class="number">13</span><span class="class">.jar</span>:<span class="number">2.1</span>.<span class="number">13</span>]</span><br><span class="line">        at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.io</span><span class="class">.util</span><span class="class">.SegmentedFile</span><span class="variable">$Builder</span>.<span class="function"><span class="title">complete</span><span class="params">(SegmentedFile.java:<span class="number">174</span>)</span></span> ~[apache-cassandra-<span class="number">2.1</span>.<span class="number">13</span><span class="class">.jar</span>:<span class="number">2.1</span>.<span class="number">13</span>]</span><br><span class="line">        at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.io</span><span class="class">.sstable</span><span class="class">.SSTableWriter</span><span class="class">.finish</span>(SSTableWriter<span class="class">.java</span>:<span class="number">463</span>) ~[apache-cassandra-<span class="number">2.1</span>.<span class="number">13</span><span class="class">.jar</span>:<span class="number">2.1</span>.<span class="number">13</span>]</span><br><span class="line">        at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.io</span><span class="class">.sstable</span><span class="class">.SSTableWriter</span><span class="class">.closeAndOpenReader</span>(SSTableWriter<span class="class">.java</span>:<span class="number">447</span>) ~[apache-cassandra-<span class="number">2.1</span>.<span class="number">13</span><span class="class">.jar</span>:<span class="number">2.1</span>.<span class="number">13</span>]</span><br><span class="line">        at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.io</span><span class="class">.sstable</span><span class="class">.SSTableWriter</span><span class="class">.closeAndOpenReader</span>(SSTableWriter<span class="class">.java</span>:<span class="number">442</span>) ~[apache-cassandra-<span class="number">2.1</span>.<span class="number">13</span><span class="class">.jar</span>:<span class="number">2.1</span>.<span class="number">13</span>]</span><br><span class="line">        at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.streaming</span><span class="class">.StreamReceiveTask</span><span class="variable">$OnCompletionRunnable</span>.<span class="function"><span class="title">run</span><span class="params">(StreamReceiveTask.java:<span class="number">141</span>)</span></span> ~[apache-cassandra-<span class="number">2.1</span>.<span class="number">13</span><span class="class">.jar</span>:<span class="number">2.1</span>.<span class="number">13</span>]</span><br><span class="line">        at java<span class="class">.util</span><span class="class">.concurrent</span><span class="class">.Executors</span><span class="variable">$RunnableAdapter</span>.<span class="function"><span class="title">call</span><span class="params">(Executors.java:<span class="number">471</span>)</span></span> [na:<span class="number">1.7</span>.<span class="number">0</span>_51]</span><br><span class="line">        at java<span class="class">.util</span><span class="class">.concurrent</span><span class="class">.FutureTask</span><span class="class">.run</span>(FutureTask<span class="class">.java</span>:<span class="number">262</span>) [na:<span class="number">1.7</span>.<span class="number">0</span>_51]</span><br><span class="line">        at java<span class="class">.util</span><span class="class">.concurrent</span><span class="class">.ThreadPoolExecutor</span><span class="class">.runWorker</span>(ThreadPoolExecutor<span class="class">.java</span>:<span class="number">1145</span>) [na:<span class="number">1.7</span>.<span class="number">0</span>_51]</span><br><span class="line">        at java<span class="class">.util</span><span class="class">.concurrent</span><span class="class">.ThreadPoolExecutor</span><span class="variable">$Worker</span>.<span class="function"><span class="title">run</span><span class="params">(ThreadPoolExecutor.java:<span class="number">615</span>)</span></span> [na:<span class="number">1.7</span>.<span class="number">0</span>_51]</span><br><span class="line">        at java<span class="class">.lang</span><span class="class">.Thread</span><span class="class">.run</span>(Thread<span class="class">.java</span>:<span class="number">744</span>) [na:<span class="number">1.7</span>.<span class="number">0</span>_51]</span><br><span class="line">Caused by: java<span class="class">.io</span><span class="class">.IOException</span>: Map failed</span><br><span class="line">        at sun<span class="class">.nio</span><span class="class">.ch</span><span class="class">.FileChannelImpl</span><span class="class">.map</span>(FileChannelImpl<span class="class">.java</span>:<span class="number">888</span>) ~[na:<span class="number">1.7</span>.<span class="number">0</span>_51]</span><br><span class="line">        at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.io</span><span class="class">.util</span><span class="class">.MmappedSegmentedFile</span><span class="variable">$Builder</span>.<span class="function"><span class="title">createSegments</span><span class="params">(MmappedSegmentedFile.java:<span class="number">392</span>)</span></span> ~[apache-cassandra-<span class="number">2.1</span>.<span class="number">13</span><span class="class">.jar</span>:<span class="number">2.1</span>.<span class="number">13</span>]</span><br><span class="line">        ... <span class="number">11</span> common frames omitted</span><br><span class="line">Caused by: java<span class="class">.lang</span><span class="class">.OutOfMemoryError</span>: Map failed</span><br><span class="line">        at sun<span class="class">.nio</span><span class="class">.ch</span><span class="class">.FileChannelImpl</span><span class="class">.map0</span>(Native Method) ~[na:<span class="number">1.7</span>.<span class="number">0</span>_51]</span><br><span class="line">        at sun<span class="class">.nio</span><span class="class">.ch</span><span class="class">.FileChannelImpl</span><span class="class">.map</span>(FileChannelImpl<span class="class">.java</span>:<span class="number">885</span>) ~[na:<span class="number">1.7</span>.<span class="number">0</span>_51]</span><br><span class="line">        ... <span class="number">12</span> common frames omitted</span><br><span class="line">ERROR [StreamReceiveTask:<span class="number">124</span>] <span class="number">2016</span>-<span class="number">06</span>-<span class="number">10</span> <span class="number">18</span>:<span class="number">09</span>:<span class="number">31</span>,<span class="number">717</span> JVMStabilityInspector<span class="class">.java</span>:<span class="number">117</span> - JVM state determined to be unstable.  Exiting forcefully due to:</span><br><span class="line">java<span class="class">.lang</span><span class="class">.OutOfMemoryError</span>: Map failed</span><br></pre></td></tr></table></figure>
<h3 id="增量备份">增量备份</h3><p>先做snaptshot，然后修改配置，并重启集群</p>
<blockquote>
<p>在新版的Cassandra中有nodetool enablebackup选项可以直接修改，而不用重启！</p>
</blockquote>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">host=`ifconfig | grep <span class="string">"192.168.4"</span> | awk <span class="string">'/inet addr/&#123;sub("addr:",""); print $2&#125;'</span>`</span><br><span class="line">sed -i -e <span class="string">"s/incremental_backups: false/incremental_backups: true/g"</span> <span class="regexp">/usr/</span>install<span class="regexp">/cassandra/</span>conf/cassandra.yaml</span><br><span class="line">cat <span class="regexp">/usr/</span>install<span class="regexp">/cassandra/</span>conf/cassandra.yaml | grep incremental_backups</span><br><span class="line"><span class="regexp">/usr/</span>install<span class="regexp">/cassandra/</span>bin/nodetool -h $host snapshot forseti_fp</span><br><span class="line"><span class="regexp">/usr/</span>install<span class="regexp">/cassandra/</span>bin/nodetool flush</span><br><span class="line">kill -<span class="number">9</span> `<span class="regexp">/usr/</span>install<span class="regexp">/java/</span>bin/jps | grep CassandraDaemon |awk <span class="string">'&#123;print $1&#125;'</span>`</span><br><span class="line">ps -ef | grep cassandra</span><br><span class="line">sleep <span class="number">10</span>s</span><br><span class="line"><span class="regexp">/usr/</span>install<span class="regexp">/cassandra/</span>bin/cassandra</span><br><span class="line"></span><br><span class="line">ll <span class="regexp">/home/</span>admin<span class="regexp">/cassandra/</span>data<span class="regexp">/forseti_fp/</span>android_device_session/snapshots</span><br><span class="line">ll <span class="regexp">/home/</span>admin<span class="regexp">/cassandra/</span>data<span class="regexp">/forseti_fp/</span>android_device_session/backups</span><br><span class="line">du -sh <span class="regexp">/home/</span>admin<span class="regexp">/cassandra/</span>data<span class="regexp">/forseti_fp/</span>android_device_session/snapshots</span><br><span class="line">du -sh <span class="regexp">/home/</span>admin<span class="regexp">/cassandra/</span>data<span class="regexp">/forseti_fp/</span>android_device_session/backups</span><br></pre></td></tr></table></figure>
<p>After a system-wide snapshot is performed, you can enable incremental backups on each node to backup data that has changed<br>since the last snapshot: each time an SSTable is flushed, a hard link is copied into a /backups subdirectory of the data directory</p>
<p>是先做全局的快照（每个节点都做），然后再开启增量备份：修改配置，重启每个节点。<br>如果没有先做全局快照，而是每个节点做完快照后，立即修改配置，然后重启，接着处理下一个节点，有没有影响？<br>不过可以通过制定nodetool的-h选项一次性在一个节点上就做完全的快照，而不用登陆每个节点一个一个做快照！根本不用pssh！</p>
<p>快照后生成的文件在：data_directory_location/keyspace_name/table_name/snapshots/UUID/<br>增量备份后文件生成在：data_directory_location/keyspace_name/table_name/backups/</p>
<p>incremental backups combine with snapshots to provide a dependable, up-to-date backup mechanism.<br>增量备份依赖于快照中的内容，提供可靠的、最新的备份机制。</p>
<p>问题：如果把快照删除了，增量备份还可以正常工作吗？</p>
<h3 id="准备工作：新集群搭建和建表">准备工作：新集群搭建和建表</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cluster_name:</span> fp_back</span><br><span class="line"><span class="string">data_file_directories:</span> [<span class="regexp">/data01,/</span>data02,<span class="regexp">/data03,/</span>data04,<span class="regexp">/data05,/</span>data06,<span class="regexp">/data07,/</span>data08,<span class="regexp">/data09,/</span>data10,<span class="regexp">/data11,/</span>data12]</span><br><span class="line"><span class="string">saved_caches_directory:</span> <span class="regexp">/home/</span>admin<span class="regexp">/cassandra/</span>saved_caches</span><br><span class="line"><span class="string">commitlog_directory:</span> <span class="regexp">/home/</span>admin<span class="regexp">/cassandra/</span>commitlog</span><br></pre></td></tr></table></figure>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wget http:<span class="comment">//192.168.47.211:8000/apache-cassandra-2.1.13.tar.gz</span></span><br><span class="line">tar zxf apache-cassandra-2.1.13.tar.gz</span><br><span class="line">host=`ifconfig | grep <span class="string">"192.168.50"</span> | awk '/inet addr/&#123;sub(<span class="string">"addr:"</span>,<span class="string">""</span>); <span class="keyword">print</span> <span class="label">$2&#125;</span>'`</span><br><span class="line">sed -i -<span class="keyword">e</span> <span class="string">"s#192.168.47.211#$host#g"</span> apache-cassandra-2.1.13/<span class="keyword">conf</span>/cassandra.yaml</span><br><span class="line">sed -i -<span class="keyword">e</span> <span class="string">"s#192.168.47.211#$host#g"</span> apache-cassandra-2.1.13/<span class="keyword">conf</span>/cassandra-env.<span class="keyword">sh</span></span><br><span class="line"><span class="keyword">mkdir</span> /home/admin/cassandra</span><br><span class="line">apache-cassandra-2.1.13/bin/cassandra</span><br></pre></td></tr></table></figure>
<p>将原集群的脚本导成cql文件，并连接目标集群，导入数据库，可以修改副本数。 不需要登录目标集群操作！  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/usr/<span class="operator"><span class="keyword">install</span>/cassandra/<span class="keyword">bin</span>/cqlsh <span class="number">192.168</span><span class="number">.48</span><span class="number">.159</span> -<span class="keyword">e</span> <span class="string">'desc keyspace forseti_fp'</span> &gt; forseti_fp.cql</span><br><span class="line">/usr/<span class="keyword">install</span>/cassandra/<span class="keyword">bin</span>/cqlsh <span class="number">192.168</span><span class="number">.50</span><span class="number">.20</span> -<span class="keyword">f</span> forseti_fp.cql</span><br><span class="line"><span class="keyword">CREATE</span> KEYSPACE forseti_fp <span class="keyword">WITH</span> <span class="keyword">replication</span> = &#123;</span><br><span class="line">  <span class="string">'class'</span>: <span class="string">'NetworkTopologyStrategy'</span>,</span><br><span class="line">  <span class="string">'DC2'</span>: <span class="string">'1'</span>,</span><br><span class="line">  <span class="string">'DC1'</span>: <span class="string">'1'</span></span><br><span class="line">&#125;;</span></span><br></pre></td></tr></table></figure>
<h3 id="开始：先测试一张表的迁移">开始：先测试一张表的迁移</h3><p>快照文件不能直接用sstableloader操作</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ ll <span class="regexp">/home/</span>admin<span class="regexp">/cassandra/</span>data<span class="regexp">/forseti_fp/</span>android_device_session/snapshots</span><br><span class="line"><span class="number">1464167616242</span></span><br><span class="line">$ <span class="regexp">/usr/</span>install<span class="regexp">/cassandra/</span>bin<span class="regexp">/sstableloader -d 192.168.50.20 /</span>home<span class="regexp">/admin/</span>cassandra<span class="regexp">/data/</span>forseti_fp<span class="regexp">/android_device_session/</span>snapshots</span><br><span class="line">Could not retrieve endpoint <span class="string">ranges:</span></span><br><span class="line">InvalidRequestException(<span class="string">why:</span>No such <span class="string">keyspace:</span> android_device_session)</span><br><span class="line">$ <span class="regexp">/usr/</span>install<span class="regexp">/cassandra/</span>bin<span class="regexp">/sstableloader -d 192.168.50.20 /</span>home<span class="regexp">/admin/</span>cassandra<span class="regexp">/data/</span>forseti_fp<span class="regexp">/android_device_session/</span>snapshots/<span class="number">1464167616242</span></span><br><span class="line">Could not retrieve endpoint <span class="string">ranges:</span></span><br><span class="line">InvalidRequestException(<span class="string">why:</span>No such <span class="string">keyspace:</span> snapshots)</span><br><span class="line"></span><br><span class="line">snap=`ls <span class="regexp">/home/</span>admin<span class="regexp">/cassandra/</span>data<span class="regexp">/forseti_fp/</span>android_device_session/snapshots`</span><br><span class="line">mv <span class="regexp">/home/</span>admin<span class="regexp">/cassandra/</span>data<span class="regexp">/forseti_fp/</span>android_device_session<span class="regexp">/snapshots/</span>$snap <span class="regexp">/home/</span>admin<span class="regexp">/cassandra/</span> &amp;&amp; cd <span class="regexp">/home/</span>admin/cassandra &amp;&amp; mkdir forseti_fp</span><br><span class="line">mv $snap android_device_session &amp;&amp; mv android_device_session forseti_fp</span><br><span class="line">nohup <span class="regexp">/usr/</span>install<span class="regexp">/cassandra/</span>bin<span class="regexp">/sstableloader -d 192.168.50.20,192.168.50.21,192.168.50.22,192.168.50.23,192.168.50.24 /</span>home<span class="regexp">/admin/</span>cassandra<span class="regexp">/forseti_fp/</span>android_device_session &amp;</span><br></pre></td></tr></table></figure>
<p>默认sstableloader的内存只有512M，修改为<strong>3072M</strong>后，可以成功导入：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[admin@spark015010 ~]$ du -sh /data*/forseti_fp/android_device_session-*</span><br><span class="line"><span class="number">4.0</span>K    /data01/forseti_fp/android_device_session-<span class="number">980e940023</span>af11e6a5ea87f007ccb41c</span><br><span class="line"><span class="number">4.0</span>K    /data02/forseti_fp/android_device_session-<span class="number">980e940023</span>af11e6a5ea87f007ccb41c</span><br><span class="line"><span class="number">4.0</span>K    /data03/forseti_fp/android_device_session-<span class="number">980e940023</span>af11e6a5ea87f007ccb41c</span><br><span class="line"><span class="number">4.0</span>K    /data04/forseti_fp/android_device_session-<span class="number">980e940023</span>af11e6a5ea87f007ccb41c</span><br><span class="line"><span class="number">4.0</span>K    /data05/forseti_fp/android_device_session-<span class="number">980e940023</span>af11e6a5ea87f007ccb41c</span><br><span class="line"><span class="number">4.0</span>K    /data06/forseti_fp/android_device_session-<span class="number">980e940023</span>af11e6a5ea87f007ccb41c</span><br><span class="line"><span class="number">4.0</span>K    /data07/forseti_fp/android_device_session-<span class="number">980e940023</span>af11e6a5ea87f007ccb41c</span><br><span class="line"><span class="number">4.0</span>K    /data08/forseti_fp/android_device_session-<span class="number">980e940023</span>af11e6a5ea87f007ccb41c</span><br><span class="line"><span class="number">4.0</span>K    /data09/forseti_fp/android_device_session-<span class="number">980e940023</span>af11e6a5ea87f007ccb41c</span><br><span class="line"><span class="number">3.5</span>G    /data10/forseti_fp/android_device_session-<span class="number">980e940023</span>af11e6a5ea87f007ccb41c</span><br><span class="line"><span class="number">4.0</span>K    /data11/forseti_fp/android_device_session-<span class="number">980e940023</span>af11e6a5ea87f007ccb41c</span><br><span class="line"><span class="number">4.0</span>K    /data12/forseti_fp/android_device_session-<span class="number">980e940023</span>af11e6a5ea87f007ccb41c</span><br></pre></td></tr></table></figure>
<p>内存不足时报错：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">ERROR <span class="number">03</span>:<span class="number">58</span>:<span class="number">12</span> [Stream <span class="preprocessor">#<span class="number">4f</span>0fadf0-<span class="number">23</span>b1-<span class="number">11e6</span>-bbf2-<span class="number">2592342</span>d3b2e] Streaming <span class="keyword">error</span> occurred</span></span><br><span class="line">java.lang.OutOfMemoryError: GC overhead limit exceeded</span><br><span class="line">    at java.util.TreeMap.put(TreeMap.java:<span class="number">569</span>) ~[na:<span class="number">1.7</span><span class="number">.0</span>_51]</span><br><span class="line">    at java.util.TreeSet.add(TreeSet.java:<span class="number">255</span>) ~[na:<span class="number">1.7</span><span class="number">.0</span>_51]</span><br><span class="line">    at org.apache.cassandra.io.compress.CompressionMetadata.getChunksForSections(CompressionMetadata.java:<span class="number">287</span>) ~[apache-cassandra-<span class="number">2.1</span><span class="number">.13</span>.jar:<span class="number">2.1</span><span class="number">.13</span>]</span><br><span class="line">    at org.apache.cassandra.streaming.messages.FileMessageHeader$FileMessageHeaderSerializer.serialize(FileMessageHeader.java:<span class="number">172</span>) ~[apache-cassandra-<span class="number">2.1</span><span class="number">.13</span>.jar:<span class="number">2.1</span><span class="number">.13</span>]</span><br><span class="line">    at org.apache.cassandra.streaming.messages.OutgoingFileMessage.serialize(OutgoingFileMessage.java:<span class="number">82</span>) ~[apache-cassandra-<span class="number">2.1</span><span class="number">.13</span>.jar:<span class="number">2.1</span><span class="number">.13</span>]</span><br><span class="line">    at org.apache.cassandra.streaming.messages.OutgoingFileMessage$<span class="number">1.</span>serialize(OutgoingFileMessage.java:<span class="number">49</span>) ~[apache-cassandra-<span class="number">2.1</span><span class="number">.13</span>.jar:<span class="number">2.1</span><span class="number">.13</span>]</span><br><span class="line">    at org.apache.cassandra.streaming.messages.OutgoingFileMessage$<span class="number">1.</span>serialize(OutgoingFileMessage.java:<span class="number">41</span>) ~[apache-cassandra-<span class="number">2.1</span><span class="number">.13</span>.jar:<span class="number">2.1</span><span class="number">.13</span>]</span><br><span class="line">    at org.apache.cassandra.streaming.messages.StreamMessage.serialize(StreamMessage.java:<span class="number">45</span>) ~[apache-cassandra-<span class="number">2.1</span><span class="number">.13</span>.jar:<span class="number">2.1</span><span class="number">.13</span>]</span><br><span class="line">    at org.apache.cassandra.streaming.ConnectionHandler$OutgoingMessageHandler.sendMessage(ConnectionHandler.java:<span class="number">351</span>) ~[apache-cassandra-<span class="number">2.1</span><span class="number">.13</span>.jar:<span class="number">2.1</span><span class="number">.13</span>]</span><br><span class="line">    at org.apache.cassandra.streaming.ConnectionHandler$OutgoingMessageHandler.run(ConnectionHandler.java:<span class="number">323</span>) ~[apache-cassandra-<span class="number">2.1</span><span class="number">.13</span>.jar:<span class="number">2.1</span><span class="number">.13</span>]</span><br><span class="line">    at java.lang.Thread.run(Thread.java:<span class="number">744</span>) [na:<span class="number">1.7</span><span class="number">.0</span>_51]</span><br><span class="line">progress: [/<span class="number">192.168</span><span class="number">.50</span><span class="number">.24</span>]<span class="number">0</span>:<span class="number">0</span>/<span class="number">19</span> <span class="number">0</span>  % [/<span class="number">192.168</span><span class="number">.50</span><span class="number">.21</span>]<span class="number">0</span>:<span class="number">1</span>/<span class="number">19</span> <span class="number">0</span>  % [/<span class="number">192.168</span><span class="number">.50</span><span class="number">.20</span>]<span class="number">0</span>:<span class="number">0</span>/<span class="number">19</span> <span class="number">0</span>  % [/<span class="number">192.168</span><span class="number">.50</span><span class="number">.23</span>]<span class="number">0</span>:<span class="number">2</span>/<span class="number">19</span> <span class="number">0</span>  % [/<span class="number">192.168</span><span class="number">.50</span><span class="number">.22</span>]<span class="number">0</span>:<span class="number">1</span>/<span class="number">19</span> <span class="number">0</span>  % total: <span class="number">0</span>% <span class="number">0</span>  MB/s(avg: <span class="number">0</span> MB/s)</span><br><span class="line">ERROR <span class="number">03</span>:<span class="number">58</span>:<span class="number">12</span> [Stream <span class="preprocessor">#<span class="number">4f</span>0fadf0-<span class="number">23</span>b1-<span class="number">11e6</span>-bbf2-<span class="number">2592342</span>d3b2e] Remote peer <span class="number">192.168</span><span class="number">.50</span><span class="number">.23</span> failed stream session.</span></span><br><span class="line">progress: [/<span class="number">192.168</span><span class="number">.50</span><span class="number">.24</span>]<span class="number">0</span>:<span class="number">0</span>/<span class="number">19</span> <span class="number">0</span>  % [/<span class="number">192.168</span><span class="number">.50</span><span class="number">.21</span>]<span class="number">0</span>:<span class="number">1</span>/<span class="number">19</span> <span class="number">0</span>  % [/<span class="number">192.168</span><span class="number">.50</span><span class="number">.20</span>]<span class="number">0</span>:<span class="number">0</span>/<span class="number">19</span> <span class="number">0</span>  % [/<span class="number">192.168</span><span class="number">.50</span><span class="number">.23</span>]<span class="number">0</span>:<span class="number">2</span>/<span class="number">19</span> <span class="number">0</span>  % [/<span class="number">192.168</span><span class="number">.50</span><span class="number">.22</span>]<span class="number">0</span>:<span class="number">3</span>/<span class="number">19</span> <span class="number">0</span>  % total: <span class="number">0</span>% <span class="number">0</span>  MB/s(avg: <span class="number">0</span> MB/s)</span><br><span class="line">/usr/install/cassandra/bin/sstableloader: line <span class="number">53</span>: </span><br><span class="line"><span class="number">15459</span> 已杀死               <span class="string">"$JAVA"</span> $JAVA_AGENT -ea -cp <span class="string">"$CLASSPATH"</span> $JVM_OPTS -Xmx$MAX_HEAP_SIZE -Dcassandra.storagedir=<span class="string">"$cassandra_storagedir"</span> -Dlogback.configurationFile=logback-tools.xml org.apache.cassandra.tools.BulkLoader <span class="string">"$@"</span></span><br></pre></td></tr></table></figure>
<p>sstableloader完成后的日志：  </p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Established connection <span class="keyword">to</span> initial hosts</span><br><span class="line">Opening sstables <span class="subst">and</span> calculating sections <span class="keyword">to</span> stream</span><br><span class="line"><span class="attribute">...</span><span class="built_in">.</span><br><span class="line"></span><span class="number">100</span>% total: <span class="number">100</span>% <span class="number">0</span>  MB/s(avg: <span class="number">24</span> MB/s)</span><br><span class="line">Summary statistics:</span><br><span class="line">   Connections per host:         : <span class="number">1</span></span><br><span class="line">   Total files transferred:      : <span class="number">85</span></span><br><span class="line">   Total <span class="built_in">bytes</span> transferred:      : <span class="number">2291137192904</span></span><br><span class="line">   Total <span class="built_in">duration</span> (ms):          : <span class="number">87700111</span>  -<span class="subst">-&gt; </span><span class="number">24</span>小时！</span><br><span class="line">   <span class="keyword">Average</span> transfer rate (MB/s): : <span class="number">24</span></span><br><span class="line">   Peak transfer rate (MB/s):    : <span class="number">24</span></span><br></pre></td></tr></table></figure>
<p>一次完整的snapshot，android_device_session表在每个节点的耗时统计</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">节点             Load       耗时(ms)   传输量(bytes)   大小/实际大小</span><br><span class="line"><span class="number">192.168</span><span class="number">.48</span><span class="number">.228</span>  <span class="number">2.51</span> TB    <span class="number">69222991</span>  <span class="number">1808724189277</span>   <span class="number">80</span>G/<span class="number">1.7</span>T</span><br><span class="line"><span class="number">192.168</span><span class="number">.48</span><span class="number">.227</span>  <span class="number">2.67</span> TB    <span class="number">24897246</span>  <span class="number">590477418187</span>    <span class="number">284</span>G/<span class="number">1.9</span>T</span><br><span class="line"><span class="number">192.168</span><span class="number">.48</span><span class="number">.226</span>  <span class="number">2.58</span> TB    <span class="number">73820237</span>  <span class="number">1928301531978</span>   <span class="number">249</span>G/<span class="number">1.8</span>T </span><br><span class="line"><span class="number">192.168</span><span class="number">.48</span><span class="number">.176</span>  <span class="number">5.9</span> TB     <span class="number">77773491</span>  <span class="number">2032068642522</span>   <span class="number">1018</span>G/<span class="number">1.9</span>T   </span><br><span class="line"><span class="number">192.168</span><span class="number">.48</span><span class="number">.161</span>  <span class="number">4.28</span> TB    <span class="number">78947850</span>  <span class="number">2060434319116</span>   <span class="number">46</span>G/?</span><br><span class="line"><span class="number">192.168</span><span class="number">.48</span><span class="number">.160</span>  <span class="number">4.34</span> TB    <span class="number">87700111</span>  <span class="number">2291137192904</span>   ?/<span class="number">1.1</span>T</span><br><span class="line"><span class="number">192.168</span><span class="number">.48</span><span class="number">.175</span>  <span class="number">3.01</span> TB    <span class="number">68711040</span>  <span class="number">1794574379750</span>   <span class="number">178</span>G/?</span><br><span class="line"><span class="number">192.168</span><span class="number">.48</span><span class="number">.159</span>  <span class="number">4.46</span> TB    <span class="number">88088722</span>  <span class="number">2299781089484</span>   ?/<span class="number">1.4</span>T</span><br></pre></td></tr></table></figure>
<h3 id="整个集群做一次完整的快照迁移">整个集群做一次完整的快照迁移</h3><p>准备目录结构(只需执行一次)：<code>sh table.sh</code><br>在<code>/home/admin/cassandra/forseti_fp</code>下创建表目录</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/admin/cassandra/forseti_fp</span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> /home/admin/cassandra/data/forseti_fp/*</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">test</span> <span class="operator">-d</span> <span class="variable">$file</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        table=`basename <span class="variable">$file</span>`</span><br><span class="line">        snap=`ls <span class="variable">$file</span>/snapshots`</span><br><span class="line">        <span class="keyword">if</span> [ -n <span class="string">"<span class="variable">$snap</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="variable">$table</span> <span class="variable">$snap</span></span><br><span class="line">            mkdir <span class="variable">$table</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p>执行一次snapshot全量数据迁移(只需执行一次): <code>nohup sh snap.sh &gt; snap_alltable.log &amp;</code><br>拷贝<code>/home/admin/cassandra/data/forseti_fp/$table/snapshots/$snap/*</code> 到<code>/home/admin/cassandra/forseti_fp/$table</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> /home/admin/cassandra/data/forseti_fp/*</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">test</span> <span class="operator">-d</span> <span class="variable">$file</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        table=`basename <span class="variable">$file</span>`</span><br><span class="line">        snap=`ls <span class="variable">$file</span>/snapshots`</span><br><span class="line">        <span class="keyword">if</span> [ -n <span class="string">"<span class="variable">$snap</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">            mv <span class="variable">$file</span>/snapshots/<span class="variable">$snap</span>/* /home/admin/cassandra/forseti_fp/<span class="variable">$table</span></span><br><span class="line">            <span class="keyword">if</span> [ <span class="string">"smart_device_map"</span> == <span class="variable">$table</span> ]||[ <span class="string">"android_device_session_temp"</span> == <span class="variable">$table</span> ]||[ <span class="string">"android_device_session"</span> == <span class="variable">$table</span> ]||[ <span class="string">"android_device"</span> == <span class="variable">$table</span> ]||[ <span class="string">"analysis"</span> == <span class="variable">$table</span> ]||[ <span class="string">"device_session"</span> == <span class="variable">$table</span> ]; <span class="keyword">then</span></span><br><span class="line">              <span class="built_in">echo</span> <span class="string">" "</span></span><br><span class="line">            <span class="keyword">else</span> </span><br><span class="line">                <span class="built_in">echo</span> <span class="variable">$table</span> <span class="variable">$snap</span></span><br><span class="line">                /usr/install/cassandra/bin/sstableloader <span class="operator">-d</span> <span class="number">192.168</span>.<span class="number">50.20</span>,<span class="number">192.168</span>.<span class="number">50.21</span>,<span class="number">192.168</span>.<span class="number">50.22</span>,<span class="number">192.168</span>.<span class="number">50.23</span>,<span class="number">192.168</span>.<span class="number">50.24</span> /home/admin/cassandra/forseti_fp/<span class="variable">$table</span></span><br><span class="line">            <span class="keyword">fi</span>        </span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：android_device_session表已经同步过了，所以不需要再次同步</p>
</blockquote>
<h3 id="增量备份（需要多次执行）">增量备份（需要多次执行）</h3><p>执行增量迁移: nohup sh increment.sh  &gt; increment0616.log 2&gt;&amp;1 &amp;<br>把<code>/home/admin/cassandra/forseti_fp/$table/backups/*</code> 拷贝到 <code>/home/admin/cassandra/forseti_fp/$table</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> /home/admin/cassandra/data/forseti_fp/*</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">test</span> <span class="operator">-d</span> <span class="variable">$file</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        table=`basename <span class="variable">$file</span>`</span><br><span class="line">        <span class="keyword">if</span> [ <span class="operator">-d</span> <span class="string">"<span class="variable">$file</span>/backups"</span> ]; <span class="keyword">then</span></span><br><span class="line">            rm /home/admin/cassandra/forseti_fp/<span class="variable">$table</span>/*</span><br><span class="line">            <span class="built_in">cd</span> <span class="variable">$file</span>/backups</span><br><span class="line">            ls | xargs -t -I &#123;&#125; mv &#123;&#125; /home/admin/cassandra/forseti_fp/<span class="variable">$table</span>/</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> [ <span class="string">"smart_device_map"</span> == <span class="variable">$table</span> ]||[ <span class="string">"android_device_session_temp"</span> == <span class="variable">$table</span> ]||[ <span class="string">"android_device"</span> == <span class="variable">$table</span> ]||[ <span class="string">"analysis"</span> == <span class="variable">$table</span> ]||[ <span class="string">"device_session"</span> == <span class="variable">$table</span> ]; <span class="keyword">then</span></span><br><span class="line">              <span class="built_in">echo</span> <span class="string">" "</span></span><br><span class="line">            <span class="keyword">else</span> </span><br><span class="line">                <span class="built_in">echo</span> <span class="variable">$table</span></span><br><span class="line">                /usr/install/cassandra/bin/sstableloader <span class="operator">-d</span> <span class="number">192.168</span>.<span class="number">50.20</span>,<span class="number">192.168</span>.<span class="number">50.21</span>,<span class="number">192.168</span>.<span class="number">50.22</span>,<span class="number">192.168</span>.<span class="number">50.23</span>,<span class="number">192.168</span>.<span class="number">50.24</span> /home/admin/cassandra/forseti_fp/<span class="variable">$table</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：要把android_device_session表加上，backups都必须同步</p>
</blockquote>
<p>vi increment_timer.sh</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ps -fe|grep BulkLoader |grep -v grep</span><br><span class="line"><span class="keyword">if</span> [ $? <span class="operator">-ne</span> <span class="number">0</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">start=$(date +%s)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"可以开始处理。。。"</span></span><br><span class="line">sh increment.sh</span><br><span class="line">end=$(date +%s)</span><br><span class="line">timeT=$(( <span class="variable">$end</span> - <span class="variable">$start</span> ))</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"COST:<span class="variable">$timeT</span>, start:<span class="variable">$start</span>, end: <span class="variable">$end</span>"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"BulkLoader正在运行，请稍等"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<p>定时任务脚本：</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span> *<span class="regexp">/2 * * * sh /home</span><span class="regexp">/admin/cassandra</span><span class="regexp">/increment_timer.sh</span><br><span class="line">tail -f /var</span><span class="regexp">/spool/mail</span><span class="regexp">/admin</span><br><span class="line">crontab -e</span></span><br></pre></td></tr></table></figure>
<p>228一个节点所有表的耗时(一次backups), 大概1G花费1min</p>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="list">[<span class="keyword">admin@192-168-48-228</span> cassandra]$ cat nohup.out  | grep <span class="string">"Total duration"</span></span><br><span class="line"><span class="number">50</span>M     android_device_index        Total duration <span class="list">(<span class="keyword">s</span>)</span>:          : <span class="number">26</span></span><br><span class="line"><span class="number">525</span>G    android_device_session      Total duration <span class="list">(<span class="keyword">s</span>)</span>:          : <span class="number">25291</span><span class="list">(<span class="keyword">7h=420m</span>)</span></span><br><span class="line"><span class="number">71</span>M     android_device_time         Total duration <span class="list">(<span class="keyword">s</span>)</span>:          : <span class="number">30</span></span><br><span class="line"><span class="number">5.3</span>G    api_invoke_result           Total duration <span class="list">(<span class="keyword">s</span>)</span>:          : <span class="number">561</span></span><br><span class="line"><span class="number">1.6</span>G    device                      Total duration <span class="list">(<span class="keyword">s</span>)</span>:          : <span class="number">288</span></span><br><span class="line"><span class="number">3.9</span>G    devicedbmap                 Total duration <span class="list">(<span class="keyword">s</span>)</span>:          : <span class="number">316</span></span><br><span class="line"><span class="number">66</span>G     device_session_map          Total duration <span class="list">(<span class="keyword">s</span>)</span>:          : <span class="number">4563</span><span class="list">(<span class="keyword">76min</span>)</span></span><br><span class="line"><span class="number">2.1</span>G    ios_device_index            Total duration <span class="list">(<span class="keyword">s</span>)</span>:          : <span class="number">151</span></span><br><span class="line"><span class="number">4.5</span>G    ios_device_info             Total duration <span class="list">(<span class="keyword">s</span>)</span>:          : <span class="number">342</span></span><br><span class="line"><span class="number">4.8</span>G    ios_device_session          Total duration <span class="list">(<span class="keyword">s</span>)</span>:          : <span class="number">353</span></span><br><span class="line"><span class="number">373</span>M    ip_device_id                Total duration <span class="list">(<span class="keyword">s</span>)</span>:          : <span class="number">53</span></span><br><span class="line"><span class="number">7.3</span>G    page_info                   Total duration <span class="list">(<span class="keyword">s</span>)</span>:          : <span class="number">536</span></span><br><span class="line"><span class="number">3.3</span>G    tcp_stack_ua                Total duration <span class="list">(<span class="keyword">s</span>)</span>:          : <span class="number">276</span></span><br><span class="line"><span class="number">9.6</span>G    tcp_syn_data                Total duration <span class="list">(<span class="keyword">s</span>)</span>:          : <span class="number">686</span></span></span><br></pre></td></tr></table></figure>
<h3 id="机房迁移">机房迁移</h3><p>准备工作：</p>
<ol>
<li>老集群的snapshot和backups同步到新集群</li>
<li>？？</li>
</ol>
<h4 id="直接从当前集群同步到上海集群">直接从当前集群同步到上海集群</h4><p><strong>有节点挂掉</strong>  </p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[admin@<span class="number">192</span>-<span class="number">168</span>-<span class="number">48</span>-<span class="number">228</span> ~]$ /usr/install/cassandra/bin/sstableloader -d <span class="number">10.21</span>.<span class="number">21.20</span> -t <span class="number">50</span> /home/admin/cassandra/forseti_fp/device</span><br><span class="line">ERROR <span class="number">11</span>:<span class="number">11</span>:<span class="number">56</span> Error creating pool to /<span class="number">10.21</span>.<span class="number">21.22</span>:<span class="number">9042</span></span><br><span class="line">com<span class="class">.datastax</span><span class="class">.driver</span><span class="class">.core</span><span class="class">.TransportException</span>: [/<span class="number">10.21</span>.<span class="number">21.22</span>:<span class="number">9042</span>] Cannot connect</span><br><span class="line">  at com<span class="class">.datastax</span><span class="class">.driver</span><span class="class">.core</span><span class="class">.Connection</span>$<span class="number">1</span>.<span class="function"><span class="title">operationComplete</span><span class="params">(Connection.java:<span class="number">156</span>)</span></span> [cassandra-driver-core-<span class="number">2.2</span>.<span class="number">0</span>-rc2-SNAPSHOT-<span class="number">20150617</span>-shaded<span class="class">.jar</span>:na]</span><br><span class="line">  at com<span class="class">.datastax</span><span class="class">.driver</span><span class="class">.core</span><span class="class">.Connection</span>$<span class="number">1</span>.<span class="function"><span class="title">operationComplete</span><span class="params">(Connection.java:<span class="number">139</span>)</span></span> [cassandra-driver-core-<span class="number">2.2</span>.<span class="number">0</span>-rc2-SNAPSHOT-<span class="number">20150617</span>-shaded<span class="class">.jar</span>:na]</span><br><span class="line">  at com<span class="class">.datastax</span><span class="class">.shaded</span><span class="class">.netty</span><span class="class">.util</span><span class="class">.concurrent</span><span class="class">.DefaultPromise</span><span class="class">.notifyListener0</span>(DefaultPromise<span class="class">.java</span>:<span class="number">680</span>) [cassandra-driver-core-<span class="number">2.2</span>.<span class="number">0</span>-rc2-SNAPSHOT-<span class="number">20150617</span>-shaded<span class="class">.jar</span>:na]</span><br><span class="line">  at com<span class="class">.datastax</span><span class="class">.shaded</span><span class="class">.netty</span><span class="class">.util</span><span class="class">.concurrent</span><span class="class">.DefaultPromise</span><span class="class">.notifyListeners0</span>(DefaultPromise<span class="class">.java</span>:<span class="number">603</span>) [cassandra-driver-core-<span class="number">2.2</span>.<span class="number">0</span>-rc2-SNAPSHOT-<span class="number">20150617</span>-shaded<span class="class">.jar</span>:na]</span><br><span class="line">  at com<span class="class">.datastax</span><span class="class">.shaded</span><span class="class">.netty</span><span class="class">.util</span><span class="class">.concurrent</span><span class="class">.DefaultPromise</span><span class="class">.notifyListeners</span>(DefaultPromise<span class="class">.java</span>:<span class="number">563</span>) [cassandra-driver-core-<span class="number">2.2</span>.<span class="number">0</span>-rc2-SNAPSHOT-<span class="number">20150617</span>-shaded<span class="class">.jar</span>:na]</span><br><span class="line">  at com<span class="class">.datastax</span><span class="class">.shaded</span><span class="class">.netty</span><span class="class">.util</span><span class="class">.concurrent</span><span class="class">.DefaultPromise</span><span class="class">.tryFailure</span>(DefaultPromise<span class="class">.java</span>:<span class="number">424</span>) [cassandra-driver-core-<span class="number">2.2</span>.<span class="number">0</span>-rc2-SNAPSHOT-<span class="number">20150617</span>-shaded<span class="class">.jar</span>:na]</span><br><span class="line">  at com<span class="class">.datastax</span><span class="class">.shaded</span><span class="class">.netty</span><span class="class">.channel</span><span class="class">.nio</span><span class="class">.AbstractNioChannel</span><span class="variable">$AbstractNioUnsafe</span>.<span class="function"><span class="title">fulfillConnectPromise</span><span class="params">(AbstractNioChannel.java:<span class="number">268</span>)</span></span> [cassandra-driver-core-<span class="number">2.2</span>.<span class="number">0</span>-rc2-SNAPSHOT-<span class="number">20150617</span>-shaded<span class="class">.jar</span>:na]</span><br><span class="line">  at com<span class="class">.datastax</span><span class="class">.shaded</span><span class="class">.netty</span><span class="class">.channel</span><span class="class">.nio</span><span class="class">.AbstractNioChannel</span><span class="variable">$AbstractNioUnsafe</span>.<span class="function"><span class="title">finishConnect</span><span class="params">(AbstractNioChannel.java:<span class="number">284</span>)</span></span> [cassandra-driver-core-<span class="number">2.2</span>.<span class="number">0</span>-rc2-SNAPSHOT-<span class="number">20150617</span>-shaded<span class="class">.jar</span>:na]</span><br><span class="line">  at com<span class="class">.datastax</span><span class="class">.shaded</span><span class="class">.netty</span><span class="class">.channel</span><span class="class">.nio</span><span class="class">.NioEventLoop</span><span class="class">.processSelectedKey</span>(NioEventLoop<span class="class">.java</span>:<span class="number">528</span>) [cassandra-driver-core-<span class="number">2.2</span>.<span class="number">0</span>-rc2-SNAPSHOT-<span class="number">20150617</span>-shaded<span class="class">.jar</span>:na]</span><br><span class="line">  at com<span class="class">.datastax</span><span class="class">.shaded</span><span class="class">.netty</span><span class="class">.channel</span><span class="class">.nio</span><span class="class">.NioEventLoop</span><span class="class">.processSelectedKeysOptimized</span>(NioEventLoop<span class="class">.java</span>:<span class="number">468</span>) [cassandra-driver-core-<span class="number">2.2</span>.<span class="number">0</span>-rc2-SNAPSHOT-<span class="number">20150617</span>-shaded<span class="class">.jar</span>:na]</span><br><span class="line">  at com<span class="class">.datastax</span><span class="class">.shaded</span><span class="class">.netty</span><span class="class">.channel</span><span class="class">.nio</span><span class="class">.NioEventLoop</span><span class="class">.processSelectedKeys</span>(NioEventLoop<span class="class">.java</span>:<span class="number">382</span>) [cassandra-driver-core-<span class="number">2.2</span>.<span class="number">0</span>-rc2-SNAPSHOT-<span class="number">20150617</span>-shaded<span class="class">.jar</span>:na]</span><br><span class="line">  at com<span class="class">.datastax</span><span class="class">.shaded</span><span class="class">.netty</span><span class="class">.channel</span><span class="class">.nio</span><span class="class">.NioEventLoop</span><span class="class">.run</span>(NioEventLoop<span class="class">.java</span>:<span class="number">354</span>) [cassandra-driver-core-<span class="number">2.2</span>.<span class="number">0</span>-rc2-SNAPSHOT-<span class="number">20150617</span>-shaded<span class="class">.jar</span>:na]</span><br><span class="line">  at com<span class="class">.datastax</span><span class="class">.shaded</span><span class="class">.netty</span><span class="class">.util</span><span class="class">.concurrent</span><span class="class">.SingleThreadEventExecutor</span>$<span class="number">2</span>.<span class="function"><span class="title">run</span><span class="params">(SingleThreadEventExecutor.java:<span class="number">111</span>)</span></span> [cassandra-driver-core-<span class="number">2.2</span>.<span class="number">0</span>-rc2-SNAPSHOT-<span class="number">20150617</span>-shaded<span class="class">.jar</span>:na]</span><br><span class="line">  at java<span class="class">.lang</span><span class="class">.Thread</span><span class="class">.run</span>(Thread<span class="class">.java</span>:<span class="number">744</span>) [na:<span class="number">1.7</span>.<span class="number">0</span>_51]</span><br><span class="line">Caused by: java<span class="class">.net</span><span class="class">.ConnectException</span>: 拒绝连接: /<span class="number">10.21</span>.<span class="number">21.22</span>:<span class="number">9042</span></span><br><span class="line">  at sun<span class="class">.nio</span><span class="class">.ch</span><span class="class">.SocketChannelImpl</span><span class="class">.checkConnect</span>(Native Method) ~[na:<span class="number">1.7</span>.<span class="number">0</span>_51]</span><br><span class="line">  at sun<span class="class">.nio</span><span class="class">.ch</span><span class="class">.SocketChannelImpl</span><span class="class">.finishConnect</span>(SocketChannelImpl<span class="class">.java</span>:<span class="number">739</span>) ~[na:<span class="number">1.7</span>.<span class="number">0</span>_51]</span><br><span class="line">  at com<span class="class">.datastax</span><span class="class">.shaded</span><span class="class">.netty</span><span class="class">.channel</span><span class="class">.socket</span><span class="class">.nio</span><span class="class">.NioSocketChannel</span><span class="class">.doFinishConnect</span>(NioSocketChannel<span class="class">.java</span>:<span class="number">224</span>) ~[cassandra-driver-core-<span class="number">2.2</span>.<span class="number">0</span>-rc2-SNAPSHOT-<span class="number">20150617</span>-shaded<span class="class">.jar</span>:na]</span><br><span class="line">  at com<span class="class">.datastax</span><span class="class">.shaded</span><span class="class">.netty</span><span class="class">.channel</span><span class="class">.nio</span><span class="class">.AbstractNioChannel</span><span class="variable">$AbstractNioUnsafe</span>.<span class="function"><span class="title">finishConnect</span><span class="params">(AbstractNioChannel.java:<span class="number">281</span>)</span></span> [cassandra-driver-core-<span class="number">2.2</span>.<span class="number">0</span>-rc2-SNAPSHOT-<span class="number">20150617</span>-shaded<span class="class">.jar</span>:na]</span><br><span class="line">  ... <span class="number">6</span> common frames omitted</span><br><span class="line">Established connection to <span class="attribute">initial</span> hosts</span><br><span class="line">Opening sstables and calculating sections to stream</span><br><span class="line">..<span class="class">.Streaming</span> relevant part of /home/admin/cassan</span><br></pre></td></tr></table></figure>
<p><strong>版本不一样,拒绝连接</strong>  </p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[admin@fp-cass048159 device]$ /usr/install/cassandra/bin/sstableloader -d <span class="number">10.21</span>.<span class="number">21.20</span> -t <span class="number">50</span> /home/admin/cassandra/forseti_fp/<span class="variable">$table</span></span><br><span class="line">Could not retrieve endpoint ranges:</span><br><span class="line">org<span class="class">.apache</span><span class="class">.thrift</span><span class="class">.transport</span><span class="class">.TTransportException</span>: java<span class="class">.net</span><span class="class">.ConnectException</span>: 拒绝连接</span><br><span class="line">java<span class="class">.lang</span><span class="class">.RuntimeException</span>: Could not retrieve endpoint ranges:</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.tools</span><span class="class">.BulkLoader</span><span class="variable">$ExternalClient</span>.<span class="function"><span class="title">init</span><span class="params">(BulkLoader.java:<span class="number">342</span>)</span></span></span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.io</span><span class="class">.sstable</span><span class="class">.SSTableLoader</span><span class="class">.stream</span>(SSTableLoader<span class="class">.java</span>:<span class="number">156</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.tools</span><span class="class">.BulkLoader</span><span class="class">.main</span>(BulkLoader<span class="class">.java</span>:<span class="number">109</span>)</span><br><span class="line">Caused by: org<span class="class">.apache</span><span class="class">.thrift</span><span class="class">.transport</span><span class="class">.TTransportException</span>: java<span class="class">.net</span><span class="class">.ConnectException</span>: 拒绝连接</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.thrift</span><span class="class">.transport</span><span class="class">.TSocket</span><span class="class">.open</span>(TSocket<span class="class">.java</span>:<span class="number">187</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.thrift</span><span class="class">.transport</span><span class="class">.TFramedTransport</span><span class="class">.open</span>(TFramedTransport<span class="class">.java</span>:<span class="number">81</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.thrift</span><span class="class">.TFramedTransportFactory</span><span class="class">.openTransport</span>(TFramedTransportFactory<span class="class">.java</span>:<span class="number">41</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.tools</span><span class="class">.BulkLoader</span><span class="variable">$ExternalClient</span>.<span class="function"><span class="title">createThriftClient</span><span class="params">(BulkLoader.java:<span class="number">380</span>)</span></span></span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.tools</span><span class="class">.BulkLoader</span><span class="variable">$ExternalClient</span>.<span class="function"><span class="title">init</span><span class="params">(BulkLoader.java:<span class="number">302</span>)</span></span></span><br><span class="line">  ... <span class="number">2</span> more</span><br><span class="line">Caused by: java<span class="class">.net</span><span class="class">.ConnectException</span>: 拒绝连接</span><br><span class="line">  at java<span class="class">.net</span><span class="class">.PlainSocketImpl</span><span class="class">.socketConnect</span>(Native Method)</span><br><span class="line">  at java<span class="class">.net</span><span class="class">.AbstractPlainSocketImpl</span><span class="class">.doConnect</span>(AbstractPlainSocketImpl<span class="class">.java</span>:<span class="number">339</span>)</span><br><span class="line">  at java<span class="class">.net</span><span class="class">.AbstractPlainSocketImpl</span><span class="class">.connectToAddress</span>(AbstractPlainSocketImpl<span class="class">.java</span>:<span class="number">200</span>)</span><br><span class="line">  at java<span class="class">.net</span><span class="class">.AbstractPlainSocketImpl</span><span class="class">.connect</span>(AbstractPlainSocketImpl<span class="class">.java</span>:<span class="number">182</span>)</span><br><span class="line">  at java<span class="class">.net</span><span class="class">.SocksSocketImpl</span><span class="class">.connect</span>(SocksSocketImpl<span class="class">.java</span>:<span class="number">392</span>)</span><br><span class="line">  at java<span class="class">.net</span><span class="class">.Socket</span><span class="class">.connect</span>(Socket<span class="class">.java</span>:<span class="number">579</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.thrift</span><span class="class">.transport</span><span class="class">.TSocket</span><span class="class">.open</span>(TSocket<span class="class">.java</span>:<span class="number">182</span>)</span><br><span class="line">  ... <span class="number">6</span> more</span><br></pre></td></tr></table></figure>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[admin<span class="annotation">@fp</span>-cass048159 ~]$ <span class="regexp">/usr/</span>install<span class="regexp">/cassandra/</span>bin/cqlsh <span class="number">10.21</span><span class="number">.21</span><span class="number">.20</span></span><br><span class="line">Connection <span class="string">error:</span> (<span class="string">'Unable to connect to any servers'</span>, &#123;<span class="string">'10.21.21.20'</span>: </span><br><span class="line">ProtocolError(<span class="string">"cql_version '3.2.1' is not supported by remote (w/ native protocol). Supported versions: [u'3.3.1']"</span>,)&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>sstableloader 100%后卡住</strong>  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[admin@<span class="number">192</span>-<span class="number">168</span>-<span class="number">48</span>-<span class="number">228</span> ~]$ tail -c <span class="number">500</span> nohup.out</span><br><span class="line">progress: [/<span class="number">10.21</span><span class="number">.21</span><span class="number">.23</span>]<span class="number">0</span>:<span class="number">60</span>/<span class="number">60</span> <span class="number">100</span>% [/<span class="number">10.21</span><span class="number">.21</span><span class="number">.21</span>]<span class="number">0</span>:<span class="number">65</span>/<span class="number">65</span> <span class="number">100</span>% [/<span class="number">10.21</span><span class="number">.21</span><span class="number">.20</span>]<span class="number">0</span>:<span class="number">63</span>/<span class="number">63</span> <span class="number">100</span>% [/<span class="number">10.21</span><span class="number">.21</span><span class="number">.19</span>]<span class="number">0</span>:<span class="number">60</span>/<span class="number">60</span> <span class="number">100</span>% </span><br><span class="line">[/<span class="number">10.21</span><span class="number">.21</span><span class="number">.26</span>]<span class="number">0</span>:<span class="number">60</span>/<span class="number">60</span> <span class="number">100</span>% [/<span class="number">10.21</span><span class="number">.21</span><span class="number">.25</span>]<span class="number">0</span>:<span class="number">63</span>/<span class="number">63</span> <span class="number">100</span>% [/<span class="number">10.21</span><span class="number">.21</span><span class="number">.24</span>]<span class="number">0</span>:<span class="number">64</span>/<span class="number">64</span> <span class="number">100</span>%</span><br><span class="line">progress: [/<span class="number">10.21</span><span class="number">.21</span><span class="number">.23</span>]<span class="number">0</span>:<span class="number">60</span>/<span class="number">60</span> <span class="number">100</span>% [/<span class="number">10.21</span><span class="number">.21</span><span class="number">.21</span>]<span class="number">0</span>:<span class="number">65</span>/<span class="number">65</span> <span class="number">100</span>% [/<span class="number">10.21</span><span class="number">.21</span><span class="number">.20</span>]<span class="number">0</span>:<span class="number">63</span>/<span class="number">63</span> <span class="number">100</span>% [/<span class="number">10.21</span><span class="number">.21</span><span class="number">.19</span>]<span class="number">0</span>:<span class="number">60</span>/<span class="number">60</span> <span class="number">100</span>% </span><br><span class="line">[/<span class="number">10.21</span><span class="number">.21</span><span class="number">.26</span>]<span class="number">0</span>:<span class="number">60</span>/<span class="number">60</span> <span class="number">100</span>% [/<span class="number">10.21</span><span class="number">.21</span><span class="number">.25</span>]<span class="number">0</span>:<span class="number">63</span>/<span class="number">63</span> <span class="number">100</span>% [/<span class="number">10.21</span><span class="number">.21</span><span class="number">.24</span>]<span class="number">0</span>:<span class="number">64</span>/<span class="number">64</span> <span class="number">100</span>% total: <span class="number">100</span>% <span class="number">0</span>  MB/s(avg: <span class="number">2</span> MB/s)</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> S0C    S1C     S0U     S1U      EC       EU        OC         OU       PC     PU         YGC    YGCT    FGC    FGCT     GCT</span><br><span class="line"><span class="number">11264.0</span> <span class="number">11264.0</span> <span class="number">3525.9</span>  <span class="number">0.0</span>   <span class="number">1032704.0</span> <span class="number">346823.5</span>  <span class="number">342016.0</span>    <span class="number">9527.1</span>   <span class="number">21504.0</span> <span class="number">21335.9</span>     <span class="number">24</span>    <span class="number">0.466</span>   <span class="number">0</span>      <span class="number">0.000</span>    <span class="number">0.466</span></span><br><span class="line"><span class="number">11264.0</span> <span class="number">11264.0</span> <span class="number">3525.9</span>  <span class="number">0.0</span>   <span class="number">1032704.0</span> <span class="number">346823.5</span>  <span class="number">342016.0</span>    <span class="number">9527.1</span>   <span class="number">21504.0</span> <span class="number">21335.9</span>     <span class="number">24</span>    <span class="number">0.466</span>   <span class="number">0</span>      <span class="number">0.000</span>    <span class="number">0.466</span></span><br><span class="line"><span class="number">11264.0</span> <span class="number">11264.0</span> <span class="number">3525.9</span>  <span class="number">0.0</span>   <span class="number">1032704.0</span> <span class="number">346823.5</span>  <span class="number">342016.0</span>    <span class="number">9527.1</span>   <span class="number">21504.0</span> <span class="number">21335.9</span>     <span class="number">24</span>    <span class="number">0.466</span>   <span class="number">0</span>      <span class="number">0.000</span>    <span class="number">0.466</span></span><br><span class="line"><span class="number">11264.0</span> <span class="number">11264.0</span> <span class="number">3525.9</span>  <span class="number">0.0</span>   <span class="number">1032704.0</span> <span class="number">346823.5</span>  <span class="number">342016.0</span>    <span class="number">9527.1</span>   <span class="number">21504.0</span> <span class="number">21335.9</span>     <span class="number">24</span>    <span class="number">0.466</span>   <span class="number">0</span>      <span class="number">0.000</span>    <span class="number">0.466</span></span><br></pre></td></tr></table></figure>
<p><strong>FP主要的表迁移：</strong></p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">device</span></span><br><span class="line"><span class="keyword">android_device_index</span><br><span class="line"></span><span class="keyword">android_device_time</span><br><span class="line"></span><span class="label">ios_device_index</span></span><br><span class="line"><span class="label">ios_device_info</span></span><br></pre></td></tr></table></figure>
<p>查看数据量：</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ cd /home/admin/cassandra/data/forseti_fp</span><br><span class="line">$ du -sh <span class="keyword">*</span> |<span class="string"> egrep 'android_device_index</span>|<span class="string">android_device_time</span>|<span class="string">ios_device_index</span>|<span class="string">ios_device_info'</span><br><span class="line">869M  android_device_index</span><br><span class="line">1023M android_device_time</span><br><span class="line">23G ios_device_index</span><br><span class="line">54G ios_device_info</span></span><br></pre></td></tr></table></figure>
<p>48.228:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">/usr/<span class="operator"><span class="keyword">install</span>/cassandra/<span class="keyword">bin</span>/nodetool <span class="keyword">snapshot</span> forseti_fp</span><br><span class="line">Requested creating <span class="keyword">snapshot</span>(s) <span class="keyword">for</span> [forseti_fp] <span class="keyword">with</span> <span class="keyword">snapshot</span> <span class="keyword">name</span> [<span class="number">1467803258992</span>]</span><br><span class="line"><span class="keyword">Snapshot</span> <span class="keyword">directory</span>: <span class="number">1467803258992</span></span><br><span class="line"></span><br><span class="line">rm -rf /home/<span class="keyword">admin</span>/cassandra/forseti_fp/</span><br><span class="line">/usr/<span class="keyword">install</span>/cassandra/<span class="keyword">bin</span>/nodetool <span class="keyword">snapshot</span> forseti_fp &gt; snap.<span class="keyword">log</span></span><br><span class="line">snapTime=<span class="string">`cat snap.log | grep directory | awk '&#123;print $3&#125;'`</span></span><br><span class="line">#snapTime=<span class="number">1467803258992</span></span><br><span class="line"></span><br><span class="line">#####先测试一个表</span><br><span class="line">#ll /home/<span class="keyword">admin</span>/cassandra/<span class="keyword">data</span>/forseti_fp/android_device_index/snapshots/$snapTime</span><br><span class="line">#mkdir -<span class="keyword">p</span> /home/<span class="keyword">admin</span>/cassandra/forseti_fp/device</span><br><span class="line">#cd /home/<span class="keyword">admin</span>/cassandra/<span class="keyword">data</span>/forseti_fp/device/snapshots/$snapTime</span><br><span class="line">#ls | xargs -<span class="keyword">t</span> -<span class="keyword">I</span> &#123;&#125; mv &#123;&#125; /home/<span class="keyword">admin</span>/cassandra/forseti_fp/device/</span><br><span class="line">#/usr/<span class="keyword">install</span>/cassandra/<span class="keyword">bin</span>/sstableloader -<span class="keyword">d</span> <span class="number">10.21</span><span class="number">.21</span><span class="number">.20</span> -<span class="keyword">t</span> <span class="number">50</span> /home/<span class="keyword">admin</span>/cassandra/forseti_fp/device</span><br><span class="line"></span><br><span class="line">mkdir -<span class="keyword">p</span> /home/<span class="keyword">admin</span>/cassandra/forseti_fp/android_device_index</span><br><span class="line">mkdir -<span class="keyword">p</span> /home/<span class="keyword">admin</span>/cassandra/forseti_fp/android_device_time</span><br><span class="line">mkdir -<span class="keyword">p</span> /home/<span class="keyword">admin</span>/cassandra/forseti_fp/ios_device_index</span><br><span class="line">mkdir -<span class="keyword">p</span> /home/<span class="keyword">admin</span>/cassandra/forseti_fp/ios_device_info</span><br><span class="line">cd /home/<span class="keyword">admin</span>/cassandra/<span class="keyword">data</span>/forseti_fp/android_device_index/snapshots/$snapTime</span><br><span class="line">ls | xargs -<span class="keyword">t</span> -<span class="keyword">I</span> &#123;&#125; mv &#123;&#125; /home/<span class="keyword">admin</span>/cassandra/forseti_fp/android_device_index/</span><br><span class="line">cd /home/<span class="keyword">admin</span>/cassandra/<span class="keyword">data</span>/forseti_fp/android_device_time/snapshots/$snapTime</span><br><span class="line">ls | xargs -<span class="keyword">t</span> -<span class="keyword">I</span> &#123;&#125; mv &#123;&#125; /home/<span class="keyword">admin</span>/cassandra/forseti_fp/android_device_time/</span><br><span class="line">cd /home/<span class="keyword">admin</span>/cassandra/<span class="keyword">data</span>/forseti_fp/ios_device_index/snapshots/$snapTime</span><br><span class="line">ls | xargs -<span class="keyword">t</span> -<span class="keyword">I</span> &#123;&#125; mv &#123;&#125; /home/<span class="keyword">admin</span>/cassandra/forseti_fp/ios_device_index/</span><br><span class="line">cd /home/<span class="keyword">admin</span>/cassandra/<span class="keyword">data</span>/forseti_fp/ios_device_info/snapshots/$snapTime</span><br><span class="line">ls | xargs -<span class="keyword">t</span> -<span class="keyword">I</span> &#123;&#125; mv &#123;&#125; /home/<span class="keyword">admin</span>/cassandra/forseti_fp/ios_device_info/</span><br><span class="line">/usr/<span class="keyword">install</span>/cassandra/<span class="keyword">bin</span>/sstableloader -<span class="keyword">d</span> <span class="number">10.21</span><span class="number">.21</span><span class="number">.20</span> -<span class="keyword">t</span> <span class="number">100</span> /home/<span class="keyword">admin</span>/cassandra/forseti_fp/android_device_time</span><br><span class="line">/usr/<span class="keyword">install</span>/cassandra/<span class="keyword">bin</span>/sstableloader -<span class="keyword">d</span> <span class="number">10.21</span><span class="number">.21</span><span class="number">.20</span> -<span class="keyword">t</span> <span class="number">100</span> /home/<span class="keyword">admin</span>/cassandra/forseti_fp/android_device_index</span><br><span class="line">/usr/<span class="keyword">install</span>/cassandra/<span class="keyword">bin</span>/sstableloader -<span class="keyword">d</span> <span class="number">10.21</span><span class="number">.21</span><span class="number">.20</span> -<span class="keyword">t</span> <span class="number">100</span> /home/<span class="keyword">admin</span>/cassandra/forseti_fp/ios_device_index</span><br><span class="line">/usr/<span class="keyword">install</span>/cassandra/<span class="keyword">bin</span>/sstableloader -<span class="keyword">d</span> <span class="number">10.21</span><span class="number">.21</span><span class="number">.20</span> -<span class="keyword">t</span> <span class="number">100</span> /home/<span class="keyword">admin</span>/cassandra/forseti_fp/ios_device_info</span><br><span class="line"></span><br><span class="line">####脚本循环方式</span><br><span class="line">#snapTime=<span class="string">`cat snap.log | grep directory | awk '&#123;print $3&#125;'`</span></span><br><span class="line">snapTime=<span class="number">1467803258992</span></span><br><span class="line">nums=(<span class="string">'android_device_index'</span> <span class="string">'android_device_time'</span> <span class="string">'ios_device_index'</span> <span class="string">'ios_device_info'</span>)</span><br><span class="line"><span class="keyword">for</span> <span class="keyword">table</span> <span class="keyword">in</span> $&#123;nums[@]&#125;;</span></span><br><span class="line"><span class="operator"><span class="keyword">do</span></span><br><span class="line">  mkdir -<span class="keyword">p</span> /home/<span class="keyword">admin</span>/cassandra/forseti_fp/$<span class="keyword">table</span></span><br><span class="line">  cd /home/<span class="keyword">admin</span>/cassandra/<span class="keyword">data</span>/forseti_fp/$<span class="keyword">table</span>/snapshots/$snapTime</span><br><span class="line">  ls | xargs -<span class="keyword">t</span> -<span class="keyword">I</span> &#123;&#125; mv &#123;&#125; /home/<span class="keyword">admin</span>/cassandra/forseti_fp/$<span class="keyword">table</span>/</span><br><span class="line">  /usr/<span class="keyword">install</span>/cassandra/<span class="keyword">bin</span>/sstableloader -<span class="keyword">d</span> <span class="number">10.21</span><span class="number">.21</span><span class="number">.20</span> -<span class="keyword">t</span> <span class="number">100</span> /home/<span class="keyword">admin</span>/cassandra/forseti_fp/$<span class="keyword">table</span></span><br><span class="line">done</span><br><span class="line">echo <span class="string">"end."</span></span></span><br></pre></td></tr></table></figure>
<p>多个节点做快照</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">nodetool status |grep RAC|awk '&#123;<span class="keyword">print</span> <span class="label">$2&#125;</span>' | <span class="keyword">while</span> <span class="keyword">read</span> ip; <span class="keyword">do</span> echo <span class="label">$ip</span>; nodetool -<span class="keyword">h</span> <span class="label">$ip</span> snapshot forseti_fp; done</span><br><span class="line">192.168.48.227</span><br><span class="line">Snapshot directory: 1467716730094</span><br><span class="line">192.168.48.226</span><br><span class="line">Snapshot directory: 1467716742257</span><br><span class="line">192.168.48.176</span><br><span class="line">Snapshot directory: 1467716753938</span><br><span class="line">192.168.48.161</span><br><span class="line">Requested creating snapshot(s) <span class="keyword">for</span> [forseti_fp] with snapshot name [1467716770566]</span><br><span class="line">192.168.48.228</span><br><span class="line">Snapshot directory: 1467716780650</span><br><span class="line">192.168.48.160</span><br><span class="line">Requested creating snapshot(s) <span class="keyword">for</span> [forseti_fp] with snapshot name [1467716792487]</span><br><span class="line">192.168.48.175</span><br><span class="line">Requested creating snapshot(s) <span class="keyword">for</span> [forseti_fp] with snapshot name [1467716802910]</span><br><span class="line">192.168.48.159</span><br><span class="line">Requested creating snapshot(s) <span class="keyword">for</span> [forseti_fp] with snapshot name [1467716815575]</span><br><span class="line"></span><br><span class="line">以159为例：</span><br><span class="line">[admin@fp-cass048159 ~]$ ll /home/admin/cassandra/data/forseti_fp/android_device_session/snapshots/</span><br><span class="line">总用量 4</span><br><span class="line">drwxr-xr-x. 2 admin admin 4096 7月   5 19:07 1467716815575</span><br><span class="line"></span><br><span class="line">declare -A map=([<span class="string">"192.168.48.227"</span>]=<span class="string">"1467716730094"</span> [<span class="string">"192.168.48.226"</span>]=<span class="string">"1467716742257"</span> </span><br><span class="line">[<span class="string">"192.168.48.176"</span>]=<span class="string">"1467716753938"</span> [<span class="string">"192.168.48.161"</span>]=<span class="string">"1467716770566"</span> </span><br><span class="line">[<span class="string">"192.168.48.228"</span>]=<span class="string">"1467716780650"</span> [<span class="string">"192.168.48.160"</span>]=<span class="string">"1467716792487"</span> </span><br><span class="line">[<span class="string">"192.168.48.175"</span>]=<span class="string">"1467716802910"</span> [<span class="string">"192.168.48.159"</span>]=<span class="string">"1467716815575"</span>)</span><br><span class="line">host=`ifconfig | grep <span class="string">"192.168.4"</span> | awk '/inet addr/&#123;sub(<span class="string">"addr:"</span>,<span class="string">""</span>); <span class="keyword">print</span> <span class="label">$2&#125;</span>'`</span><br><span class="line">snapshot=<span class="label">$&#123;map</span>[<span class="string">"$host"</span>]&#125;</span><br><span class="line">snapshotAbs=<span class="string">"/home/admin/cassandra/data/forseti_fp/android_device_session/snapshots/$snapshot"</span></span><br><span class="line"></span><br><span class="line">#<span class="keyword">rm</span> -rf /home/admin/cassandra/forseti_fp/</span><br><span class="line">#<span class="keyword">mkdir</span> -p /home/admin/cassandra/forseti_fp/</span><br><span class="line"><span class="keyword">table</span>=<span class="string">"device"</span></span><br><span class="line"><span class="keyword">mkdir</span> -p /home/admin/cassandra/forseti_fp/<span class="label">$table</span></span><br><span class="line"><span class="keyword">cd</span> <span class="label">$snapshotAbs</span></span><br><span class="line"><span class="keyword">ls</span> | xargs -t -I &#123;&#125; mv &#123;&#125; /home/admin/cassandra/forseti_fp/<span class="label">$table</span>/</span><br><span class="line">/usr/install/cassandra/bin/sstableloader -t 50 -<span class="keyword">d</span> 10.21.21.20 /home/admin/cassandra/forseti_fp/<span class="label">$table</span></span><br></pre></td></tr></table></figure>
<h4 id="新集群安装">新集群安装</h4><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#<span class="keyword">rm</span> -rf apache-cassandra-2.2.6 &amp; <span class="keyword">rm</span> apache-cassandra-2.2.6-bin.tar.gz &amp; <span class="keyword">rm</span> -rf <span class="keyword">test</span></span><br><span class="line">wget http:<span class="comment">//192.168.47.211:8000/apache-cassandra-2.2.6-bin.tar.gz</span></span><br><span class="line">tar zxf apache-cassandra-2.2.6-bin.tar.gz</span><br><span class="line"></span><br><span class="line">#<span class="keyword">cluster</span>=sh_velocity</span><br><span class="line">#seeds=10.21.21.11,10.21.21.12,10.21.21.13</span><br><span class="line"></span><br><span class="line">#<span class="keyword">cluster</span>=sh_fp</span><br><span class="line">#seeds=10.21.21.19,10.21.21.20,10.21.21.21</span><br><span class="line"></span><br><span class="line"><span class="keyword">cluster</span>=sh_galaxy</span><br><span class="line">seeds=10.21.21.131,10.21.21.132</span><br><span class="line"></span><br><span class="line"><span class="keyword">mkdir</span> data</span><br><span class="line">host=`ifconfig | grep <span class="string">"10.21.21."</span> | awk '/inet addr/&#123;sub(<span class="string">"addr:"</span>,<span class="string">""</span>); <span class="keyword">print</span> <span class="label">$2&#125;</span>'`</span><br><span class="line">sed -i -<span class="keyword">e</span> <span class="string">"s/localhost/$host/g"</span> apache-cassandra-2.2.6/<span class="keyword">conf</span>/cassandra.yaml</span><br><span class="line">sed -i -<span class="keyword">e</span> <span class="string">"s#localhost#$host#g"</span> apache-cassandra-2.2.6/<span class="keyword">conf</span>/cassandra-env.<span class="keyword">sh</span></span><br><span class="line">sed -i -<span class="keyword">e</span> <span class="string">"s/127.0.0.1/$seeds/g"</span> apache-cassandra-2.2.6/<span class="keyword">conf</span>/cassandra.yaml</span><br><span class="line">sed -i -<span class="keyword">e</span> <span class="string">"s/Test Cluster/$cluster/g"</span> apache-cassandra-2.2.6/<span class="keyword">conf</span>/cassandra.yaml</span><br><span class="line">ln -s apache-cassandra-2.2.6 cassandra</span><br><span class="line"></span><br><span class="line">cassandra/bin/cassandra</span><br><span class="line">cassandra/bin/nodetool status</span><br><span class="line">cassandra/bin/nodetool -<span class="keyword">h</span> 10.21.21.10 status</span><br><span class="line">cassandra/bin/nodetool -<span class="keyword">h</span> 10.21.21.19 status</span><br><span class="line">cassandra/bin/nodetool -<span class="keyword">h</span> 10.21.21.131 status</span><br></pre></td></tr></table></figure>
<h4 id="1-_表结构">1. 表结构</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/usr/<span class="operator"><span class="keyword">install</span>/cassandra/<span class="keyword">bin</span>/cqlsh -<span class="keyword">e</span> <span class="string">'desc keyspace forseti'</span> <span class="number">192.168</span><span class="number">.47</span><span class="number">.202</span> &gt; forseti_api.cql</span><br><span class="line">/usr/<span class="keyword">install</span>/cassandra/<span class="keyword">bin</span>/cqlsh -<span class="keyword">e</span> <span class="string">'desc keyspace forseti'</span> <span class="number">192.168</span><span class="number">.48</span><span class="number">.162</span> &gt; forseti.cql</span><br><span class="line">/usr/<span class="keyword">install</span>/cassandra/<span class="keyword">bin</span>/cqlsh -<span class="keyword">e</span> <span class="string">'desc keyspace forseti_fp'</span> <span class="number">192.168</span><span class="number">.48</span><span class="number">.159</span> &gt; forseti_fp.cql</span><br><span class="line">/usr/<span class="keyword">install</span>/cassandra/<span class="keyword">bin</span>/cqlsh -<span class="keyword">e</span> <span class="string">'desc keyspace realtime'</span> <span class="number">192.168</span><span class="number">.49</span><span class="number">.56</span> &gt; forseti_galaxy.cql</span><br><span class="line"></span><br><span class="line">wget <span class="keyword">http</span>://<span class="number">192.168</span><span class="number">.48</span><span class="number">.162</span>:<span class="number">8000</span>/forseti.cql</span><br><span class="line">wget <span class="keyword">http</span>://<span class="number">192.168</span><span class="number">.48</span><span class="number">.162</span>:<span class="number">8000</span>/forseti_fp.cql</span><br><span class="line">wget <span class="keyword">http</span>://<span class="number">192.168</span><span class="number">.48</span><span class="number">.162</span>:<span class="number">8000</span>/forseti_galaxy.cql</span><br><span class="line">cassandra/<span class="keyword">bin</span>/cqlsh <span class="number">10.21</span><span class="number">.21</span><span class="number">.11</span> -<span class="keyword">f</span> forseti.cql</span><br><span class="line">cassandra/<span class="keyword">bin</span>/cqlsh <span class="number">10.21</span><span class="number">.21</span><span class="number">.19</span> -<span class="keyword">f</span> forseti_fp.cql</span><br><span class="line">cassandra/<span class="keyword">bin</span>/cqlsh <span class="number">10.21</span><span class="number">.21</span><span class="number">.131</span> -<span class="keyword">f</span> forseti_galaxy.cql</span></span><br></pre></td></tr></table></figure>
<h4 id="2-_数据迁移">2. 数据迁移</h4><h4 id="3-_增量数据迁移">3. 增量数据迁移</h4><h4 id="4-_数据验证">4. 数据验证</h4><figure class="highlight smalltalk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/usr/install/hadoop/bin/hadoop fs -cat /user/tongdun/velocity/raw/<span class="number">2016</span>-<span class="number">6</span>-<span class="number">9</span>/part-<span class="number">00000</span> | head</span><br><span class="line"> <span class="number">115.55</span><span class="number">.206</span><span class="localvars">|sdo|sdo_client|ip3|</span><span class="number">1465401548233</span>|<span class="number">1465401548238838</span>F30790E445243217|&#123;<span class="comment">"state"</span>:<span class="comment">"0"</span>,<span class="comment">"ipAddressProvince"</span>:<span class="comment">"河南省"</span>,<span class="comment">"ipAddressCity"</span>:<span class="comment">"鹤壁市"</span>,<span class="comment">"ipAddress"</span>:<span class="comment">"115.55.206.177"</span>,<span class="comment">"ext_is_gplus_login"</span>:<span class="comment">"0"</span>,<span class="comment">"ext_is_bingding_mobile"</span>:<span class="comment">"0"</span>,<span class="comment">"eventType"</span>:<span class="comment">"Login"</span>,<span class="comment">"eventOccurTime"</span>:<span class="comment">"1465401548233"</span>,<span class="comment">"deviceId"</span>:<span class="comment">"00-0C-29-BC-62-D1"</span>,<span class="comment">"accountLogin"</span>:<span class="comment">"166f751ebf90b9fbb38977d75b1265f6"</span>,<span class="comment">"eventId"</span>:<span class="comment">"login_client"</span>,<span class="comment">"partnerCode"</span>:<span class="comment">"sdo"</span>,<span class="comment">"ip3"</span>:<span class="comment">"115.55.206"</span>,<span class="comment">"location"</span>:<span class="comment">"鹤壁市"</span>,<span class="comment">"status"</span>:<span class="comment">"Review"</span>&#125;</span><br><span class="line"></span><br><span class="line">select * from velocity_app where attribute=<span class="string">'115.55.206'</span> and type=<span class="string">'ip3'</span> and partner_code=<span class="string">'sdo'</span> and app_name=<span class="string">'sdo_client'</span> and sequence_id &gt; <span class="string">'1465401548238838F30790E445243210'</span> and sequence_id &lt; <span class="string">'1465401548238838F30790E445243220'</span>;</span><br><span class="line"></span><br><span class="line"> <span class="number">115.55</span><span class="number">.206</span> <span class="localvars">|          sdo | sdo_client |  ip3 |</span> <span class="number">1465401548238838</span>F30790E445243217 | &#123;<span class="comment">"state"</span>:<span class="comment">"0"</span>,<span class="comment">"ipAddressProvince"</span>:<span class="comment">"河南省"</span>,<span class="comment">"ipAddressCity"</span>:<span class="comment">"鹤壁市"</span>,<span class="comment">"ipAddress"</span>:<span class="comment">"115.55.206.177"</span>,<span class="comment">"ext_is_gplus_login"</span>:<span class="comment">"0"</span>,<span class="comment">"ext_is_bingding_mobile"</span>:<span class="comment">"0"</span>,<span class="comment">"eventType"</span>:<span class="comment">"Login"</span>,<span class="comment">"eventOccurTime"</span>:<span class="comment">"1465401548233"</span>,<span class="comment">"deviceId"</span>:<span class="comment">"00-0C-29-BC-62-D1"</span>,<span class="comment">"accountLogin"</span>:<span class="comment">"166f751ebf90b9fbb38977d75b1265f6"</span>,<span class="comment">"eventId"</span>:<span class="comment">"login_client"</span>,<span class="comment">"partnerCode"</span>:<span class="comment">"sdo"</span>,<span class="comment">"ip3"</span>:<span class="comment">"115.55.206"</span>,<span class="comment">"location"</span>:<span class="comment">"鹤壁市"</span>,<span class="comment">"status"</span>:<span class="comment">"Review"</span>&#125; | <span class="number">1465401548233</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="nodetool工具">nodetool工具</h2><h3 id="集群状态:_nodetool_decribecluster">集群状态: nodetool decribecluster</h3><p>启动OpsCenter后, 在8888上新建Cluster时报异常:  </p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2015-10-31</span> <span class="number">13:46:07+08</span>00 [forseti_cluster]  WARN: Node <span class="number">192.168.47.206</span> is reporting a schema disagreement: </span><br><span class="line">&#123;UUID('bc083db4-b<span class="number">544-38d1</span>-a37c-be3e78db1df1'): ['<span class="number">192.168.47.229</span>'], </span><br><span class="line">UUID('<span class="number">67462d4</span>d-a<span class="number">9c9-38a1</span>-afd<span class="number">8-1a39172</span>32b8a'): ['<span class="number">192.168.47.203</span>', '<span class="number">192.168.47.228</span>', '<span class="number">192.168.47.227</span>', '<span class="number">192.168.47.202</span>', '<span class="number">192.168.47.225</span>', '<span class="number">192.168.47.204</span>', '<span class="number">192.168.47.205</span>', '<span class="number">192.168.47.206</span>', '<span class="number">192.168.47.221</span>', '<span class="number">192.168.47.222</span>', '<span class="number">192.168.47.224</span>']&#125;</span><br><span class="line"><span class="number">2015-10-31</span> <span class="number">13:46:07+08</span>00 []  WARN: [control connection] No schema built on connect<span class="comment">; retrying without wait for schema agreement</span></span><br><span class="line"><span class="number">2015-10-31</span> <span class="number">13:46:13+08</span>00 []  WARN: Host <span class="number">192.168.47.229</span> has been marked down</span><br><span class="line"><span class="number">2015-10-31</span> <span class="number">13:46:14+08</span>00 []  WARN: Failed to create connection pool for new host <span class="number">192.168.47.229</span>: errors=Timed out creating connection, last_host=None</span><br><span class="line"><span class="number">2015-10-31</span> <span class="number">13:47:07+08</span>00 []  INFO: Host <span class="number">192.168.47.229</span> may be up<span class="comment">; will prepare queries and open connection pool</span></span><br></pre></td></tr></table></figure>
<p>按照这里的方式, 如果状态为UNREACHABLE,则重启后再观察.<br><a href="http://docs.datastax.com/en/cassandra/2.1/cassandra/troubleshooting/trblshootSchemaDisagree.html" target="_blank" rel="external">http://docs.datastax.com/en/cassandra/2.1/cassandra/troubleshooting/trblshootSchemaDisagree.html</a>  </p>
<p>果然有一个状态是UNREACHABLE的:  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[qihuang.zheng@cass047202 ~]$ nodetool describecluster</span><br><span class="line">Cluster Information:</span><br><span class="line">    Name: forseti_cluster</span><br><span class="line">    Snitch: org.apache.cassandra.locator.DynamicEndpointSnitch</span><br><span class="line">    Partitioner: org.apache.cassandra.dht.Murmur3Partitioner</span><br><span class="line">    Schema versions:</span><br><span class="line">        <span class="number">3e4</span>c6580-<span class="number">3</span>d3c-<span class="number">327</span>b-<span class="number">986</span>c-<span class="number">63086e93</span>e94f: [<span class="number">192.168</span><span class="number">.47</span><span class="number">.206</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.222</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.221</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.204</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.205</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.202</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.203</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.228</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.224</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.225</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.227</span>]</span><br><span class="line">        UNREACHABLE: [<span class="number">192.168</span><span class="number">.47</span><span class="number">.229</span>]</span><br></pre></td></tr></table></figure>
<p>发现229当掉, 重启后, 版本不一致:  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[qihuang.zheng@cass047202 ~]$ nodetool describecluster</span><br><span class="line">Cluster Information:</span><br><span class="line">    Name: forseti_cluster</span><br><span class="line">    Snitch: org.apache.cassandra.locator.DynamicEndpointSnitch</span><br><span class="line">    Partitioner: org.apache.cassandra.dht.Murmur3Partitioner</span><br><span class="line">    Schema versions:</span><br><span class="line">        <span class="number">3e4</span>c6580-<span class="number">3</span>d3c-<span class="number">327</span>b-<span class="number">986</span>c-<span class="number">63086e93</span>e94f: [<span class="number">192.168</span><span class="number">.47</span><span class="number">.206</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.222</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.221</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.204</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.205</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.202</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.203</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.228</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.224</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.225</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.227</span>]</span><br><span class="line"></span><br><span class="line">        d2601534-c7ff-<span class="number">394</span>d-a656-<span class="number">33</span>d9da3dc574: [<span class="number">192.168</span><span class="number">.47</span><span class="number">.229</span>]</span><br></pre></td></tr></table></figure>
<p>但是在229上查看到所有节点都不可达:  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[qihuang.zheng@<span class="number">192</span>-<span class="number">168</span>-<span class="number">47</span>-<span class="number">229</span> ~]$ nodetool describecluster</span><br><span class="line">Cluster Information:</span><br><span class="line">    Name: forseti_cluster</span><br><span class="line">    Snitch: org.apache.cassandra.locator.DynamicEndpointSnitch</span><br><span class="line">    Partitioner: org.apache.cassandra.dht.Murmur3Partitioner</span><br><span class="line">    Schema versions:</span><br><span class="line">        UNREACHABLE: [<span class="number">192.168</span><span class="number">.47</span><span class="number">.206</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.222</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.221</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.204</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.205</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.202</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.203</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.228</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.229</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.224</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.225</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.227</span>]</span><br></pre></td></tr></table></figure>
<p>229过了段时间因为GC, 再次重启, 再次查看, 版本一样了:  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[qihuang.zheng@<span class="number">192</span>-<span class="number">168</span>-<span class="number">47</span>-<span class="number">229</span> ~]$ nodetool describecluster</span><br><span class="line">Cluster Information:</span><br><span class="line">  Name: forseti_cluster</span><br><span class="line">  Snitch: org.apache.cassandra.locator.DynamicEndpointSnitch</span><br><span class="line">  Partitioner: org.apache.cassandra.dht.Murmur3Partitioner</span><br><span class="line">  Schema versions:</span><br><span class="line">    <span class="number">977</span>ca50d-<span class="number">70</span>ab-<span class="number">3f</span>45-a1e6-ca18560b0c29: [<span class="number">192.168</span><span class="number">.47</span><span class="number">.206</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.222</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.221</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.204</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.205</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.202</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.203</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.228</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.229</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.224</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.225</span>, <span class="number">192.168</span><span class="number">.47</span><span class="number">.227</span>]</span><br></pre></td></tr></table></figure>
<h3 id="删除节点:_removenode">删除节点: removenode</h3><p><a href="http://zhaoyanblog.com/archives/533.html" target="_blank" rel="external">http://zhaoyanblog.com/archives/533.html</a></p>
<p><code>A</code>.对正在运行Cassandra进程的节点下线,或者在其他节点-h指定要下线的目标节点. 运行命令的节点会有NodeCmd进程.  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/install/apache-cassandra-<span class="number">2.0</span><span class="number">.16</span>/bin/nodetool decommission</span><br><span class="line">/usr/install/apache-cassandra-<span class="number">2.0</span><span class="number">.16</span>/bin/nodetool decommission -h <span class="number">192.168</span><span class="number">.47</span><span class="number">.226</span></span><br></pre></td></tr></table></figure>
<p><code>B</code>.如果节点已经下线,比如进程被杀死, 则在正常的节点上删除节点:  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/install/apache-cassandra-<span class="number">2.0</span><span class="number">.16</span>/bin/nodetool status 获取宕机节点的host-id</span><br><span class="line">/usr/install/apache-cassandra-<span class="number">2.0</span><span class="number">.16</span>/bin/nodetool removenode  <span class="number">2591</span>cec9-<span class="number">42f</span>9-<span class="number">4f</span>60-a622-<span class="number">00</span>d463910994</span><br></pre></td></tr></table></figure>
<p><code>C</code>.进程挂住的解决办法:<br>1).线上采用decommission后, 发现执行了很久都没有完成. 后来发现是streamming的一个bug:<br>nodetool removenode hangs: <a href="https://issues.apache.org/jira/browse/CASSANDRA-6542" target="_blank" rel="external">https://issues.apache.org/jira/browse/CASSANDRA-6542</a>,<br><a href="http://stackoverflow.com/questions/25943261/nodetool-removenode-stuck-during-removal" target="_blank" rel="external">http://stackoverflow.com/questions/25943261/nodetool-removenode-stuck-during-removal</a><br>Streams hang in repair: <a href="https://issues.apache.org/jira/browse/CASSANDRA-8472" target="_blank" rel="external">https://issues.apache.org/jira/browse/CASSANDRA-8472</a></p>
<blockquote>
<p>Streaming hanging is a familiar trouble in my cluster (2.0/2.1). In my experience,<br>the node that being restarted recently won’t hang the streaming.<br>So each time when I want to add or remove a node, I will restart all nodes one by one.<br>这种方式在线上是不可行的, 需要重启线上的每个节点. 于是尝试使用force直接中断.  </p>
</blockquote>
<p>2).杀掉226的Cassandra进程, 在202上使用B方式removenode删除226. 不过removenode也存在hang的情况.   </p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[qihuang.zheng@cass047202 ~]$ nodetool removenode status</span><br><span class="line">RemovalStatus: Removing token (-<span class="number">918468213369</span><span class="number">8409841</span>). Waiting for replication confirmation from [/<span class="number">192.168.47.206</span>,/<span class="number">192.168.47.222</span>,/<span class="number">192.168.47.221</span>,/<span class="number">192.168.47.204</span>,/<span class="number">192.168.47.205</span>,/<span class="number">192.168.47.202</span>,/<span class="number">192.168.47.224</span>,/<span class="number">192.168.47.225</span>].</span><br></pre></td></tr></table></figure>
<p>3).由于nodetool命令都是调用JMX方法,所以尽管kill掉进程,命令对应的进程实际是还存在的.  </p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[qihuang.zheng<span class="variable">@cass047202</span> ~]<span class="variable">$ </span>jps</span><br><span class="line"><span class="number">8596</span> <span class="constant">NodeCmd</span></span><br><span class="line">[qihuang.zheng<span class="variable">@cass047202</span> ~]<span class="variable">$ </span>kill -<span class="number">9</span> <span class="number">8596</span></span><br><span class="line">[qihuang.zheng<span class="variable">@cass047202</span> ~]<span class="variable">$ </span>nodetool removenode status</span><br><span class="line"><span class="constant">RemovalStatus</span>: <span class="constant">Removing</span> token (-<span class="number">9184682133698409841</span>). <span class="constant">Waiting</span> <span class="keyword">for</span> replication confirmation from [<span class="regexp">/192.168.47.206,/</span><span class="number">192.168</span>.<span class="number">47.222</span>,<span class="regexp">/192.168.47.221,/</span><span class="number">192.168</span>.<span class="number">47.204</span>,<span class="regexp">/192.168.47.205,/</span><span class="number">192.168</span>.<span class="number">47.202</span>,<span class="regexp">/192.168.47.224,/</span><span class="number">192.168</span>.<span class="number">47.225</span>].</span><br></pre></td></tr></table></figure>
<p>4).删除操作正在进行,不能重复执行removenode命令,不过提示信息给了我们另一种解决方案.  </p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[qihuang.zheng@cass047202 ~]$ /usr/install/cassandra/bin/nodetool status</span><br><span class="line">UN  <span class="number">192.168</span>.<span class="number">47.202</span>  <span class="number">612.13</span> GB  <span class="number">256</span>     <span class="number">7.4%</span>   abaa0cbc-<span class="number">09</span>d3-<span class="number">4990</span>-<span class="number">8698</span>-ff4d2f2bb4f7  RAC1</span><br><span class="line">DL  <span class="number">192.168</span>.<span class="number">47.226</span>  <span class="number">406.34</span> GB  <span class="number">256</span>     <span class="number">7.6%</span>   <span class="number">2591</span>cec9-<span class="number">42</span>f9-<span class="number">4</span>f60-a622-<span class="number">00</span>d463910994  RAC1</span><br><span class="line"></span><br><span class="line">[qihuang.zheng@cass047202 ~]$ nodetool removenode <span class="number">2591</span>cec9-<span class="number">42</span>f9-<span class="number">4</span>f60-a622-<span class="number">00</span>d463910994</span><br><span class="line">Exception <span class="keyword">in</span> thread <span class="string">"main"</span> java<span class="class">.lang</span><span class="class">.UnsupportedOperationException</span>: This node is already processing <span class="tag">a</span> removal. Wait <span class="keyword">for</span> it to complete, or use <span class="string">'removenode force'</span> <span class="keyword">if</span> this has failed.</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.service</span><span class="class">.StorageService</span><span class="class">.removeNode</span>(StorageService<span class="class">.java</span>:<span class="number">3342</span>)</span><br><span class="line">  ...</span><br><span class="line">  at com<span class="class">.sun</span><span class="class">.jmx</span><span class="class">.interceptor</span><span class="class">.DefaultMBeanServerInterceptor</span><span class="class">.invoke</span>(DefaultMBeanServerInterceptor<span class="class">.java</span>:<span class="number">819</span>)</span><br><span class="line">  at com<span class="class">.sun</span><span class="class">.jmx</span><span class="class">.mbeanserver</span><span class="class">.JmxMBeanServer</span><span class="class">.invoke</span>(JmxMBeanServer<span class="class">.java</span>:<span class="number">801</span>)</span><br></pre></td></tr></table></figure>
<p>5).如果removenode失败, 则强制删除, 使用<code>nodetool removenode force</code>命令,不需要跟上host-id.  </p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[qihuang.zheng@cass047202 ~]$ nodetool removenode force 2591cec<span class="number">9-42f9-4</span>f60-a<span class="number">622-00d46</span><span class="number">3910994</span></span><br><span class="line">Missing an argument for removenode (either status, force, or an ID)</span><br><span class="line">usage: java org.apache.cassandra.tools.NodeCmd --host &lt;arg&gt; &lt;command&gt;</span><br><span class="line"></span><br><span class="line">[qihuang.zheng@cass047202 ~]$ nodetool removenode force</span><br><span class="line">RemovalStatus: Removing token (-<span class="number">918468213369</span><span class="number">8409841</span>). Waiting for replication confirmation from [/<span class="number">192.168.47.206</span>,/<span class="number">192.168.47.222</span>,/<span class="number">192.168.47.221</span>,/<span class="number">192.168.47.204</span>,/<span class="number">192.168.47.205</span>,/<span class="number">192.168.47.202</span>,/<span class="number">192.168.47.224</span>,/<span class="number">192.168.47.225</span>].</span><br></pre></td></tr></table></figure>
<p>6).成功删除后, 下线的226节点不会出现在状态列表中, 并且集群的Owns也发生了变化. gossipinfo可以查看状态为removed.   </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[qihuang.zheng@cass047202 ~]$ nodetool removenode status</span><br><span class="line">RemovalStatus: No token removals in process.</span><br><span class="line"></span><br><span class="line">[qihuang.zheng@cass047202 ~]$ /usr/install/cassandra/bin/nodetool status</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.47</span><span class="number">.202</span>  <span class="number">612.13</span> GB  <span class="number">256</span>     <span class="number">8.1</span>%   abaa0cbc-<span class="number">09</span>d3-<span class="number">4990</span>-<span class="number">8698</span>-ff4d2f2bb4f7  RAC1</span><br><span class="line"></span><br><span class="line">[qihuang.zheng@cass047204 ~]$ nodetool gossipinfo</span><br><span class="line">/<span class="number">192.168</span><span class="number">.47</span><span class="number">.226</span></span><br><span class="line">  STATUS:removed,<span class="number">2591</span>cec9-<span class="number">42f</span>9-<span class="number">4f</span>60-a622-<span class="number">00</span>d463910994,<span class="number">1446339305944</span></span><br><span class="line">  REMOVAL_COORDINATOR:REMOVER,abaa0cbc-<span class="number">09</span>d3-<span class="number">4990</span>-<span class="number">8698</span>-ff4d2f2bb4f7</span><br></pre></td></tr></table></figure>
<p><code>D</code>.Active Streams:  </p>
<p>下图是对225进行decommission,225的数据通过streams转移到其他节点:  </p>
<p><img src="http://img.blog.csdn.net/20151030101713671" alt="streams"></p>
<h3 id="替换节点:_replace_address">替换节点: replace_address</h3><p><a href="http://zhaoyanblog.com/archives/591.html" target="_blank" rel="external">http://zhaoyanblog.com/archives/591.html</a><br><a href="http://docs.datastax.com/en/cassandra/2.0/cassandra/operations/ops_replace_node_t.html" target="_blank" rel="external">http://docs.datastax.com/en/cassandra/2.0/cassandra/operations/ops_replace_node_t.html</a></p>
<blockquote>
<p>CAUTION:<br>1.Wait at least 72 hours to ensure that old node information is removed from gossip.<br>If removed from the property file too soon, problems may result.<br>2.auto_bootstrap不能设置为false:<br>java.lang.RuntimeException: Trying to replace_address with auto_bootstrap disabled will not work, check your configuration</p>
</blockquote>
<p>要被替换的节点状态为DN, 新启动的节点启动时加上-Dcassandra.replace_address选项:  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo -u admin /usr/install/cassandra/bin/cassandra -Dcassandra.replace_address=<span class="number">192.168</span><span class="number">.47</span><span class="number">.229</span></span><br><span class="line"></span><br><span class="line"> WARN <span class="number">13</span>:<span class="number">49</span>:<span class="number">37</span>,<span class="number">423</span> Token -<span class="number">3920394820366823756</span> changing ownership from /<span class="number">192.168</span><span class="number">.47</span><span class="number">.229</span> to /<span class="number">192.168</span><span class="number">.48</span><span class="number">.160</span></span><br><span class="line"> INFO <span class="number">13</span>:<span class="number">50</span>:<span class="number">40</span>,<span class="number">122</span> Node /<span class="number">192.168</span><span class="number">.47</span><span class="number">.229</span> is now part of the cluster</span><br><span class="line"> WARN <span class="number">13</span>:<span class="number">50</span>:<span class="number">40</span>,<span class="number">127</span> Not updating token metadata <span class="keyword">for</span> /<span class="number">192.168</span><span class="number">.47</span><span class="number">.229</span> because I am replacing it</span><br><span class="line"> INFO <span class="number">13</span>:<span class="number">50</span>:<span class="number">40</span>,<span class="number">127</span> Nodes /<span class="number">192.168</span><span class="number">.47</span><span class="number">.229</span> and /<span class="number">192.168</span><span class="number">.48</span><span class="number">.160</span> have the same token -<span class="number">1001533036333769848.</span>  Ignoring /<span class="number">192.168</span><span class="number">.47</span><span class="number">.229</span> </span><br><span class="line"> INFO <span class="number">13</span>:<span class="number">51</span>:<span class="number">10</span>,<span class="number">272</span> FatClient /<span class="number">192.168</span><span class="number">.47</span><span class="number">.229</span> has been silent <span class="keyword">for</span> <span class="number">30000</span>ms, removing from gossip</span><br></pre></td></tr></table></figure>
<p>查看节点的状态:  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[qihuang.zheng@fp-cass048160 ~]$ nodetool status</span><br><span class="line">--  Address         Load       Tokens  Owns   Host ID                               Rack</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.161</span>  <span class="number">460.9</span> GB   <span class="number">256</span>     <span class="number">20.1</span>%  <span class="number">54</span>b3a7e0-f778-<span class="number">4087</span>-<span class="number">98</span>c3-ac84e56f77e6  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.160</span>  <span class="number">6.02</span> MB    <span class="number">256</span>     <span class="number">21.2</span>%  <span class="number">18</span>a87c56-dcba-<span class="number">4614</span>-adba-<span class="number">804</span>aa7761a06  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.47</span><span class="number">.228</span>  <span class="number">5.4</span> TB     <span class="number">256</span>     <span class="number">19.2</span>%  f3d26148-d2da-<span class="number">479</span>c-ae9e-ae41aced1be9  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.159</span>  <span class="number">483.48</span> GB  <span class="number">256</span>     <span class="number">19.5</span>%  df9a693b-efc1-<span class="number">41</span>bc-<span class="number">9</span>a42-cf868ea75e65  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.47</span><span class="number">.227</span>  <span class="number">686.97</span> GB  <span class="number">256</span>     <span class="number">20.0</span>%  <span class="number">02575631</span>-<span class="number">6</span>ccb-<span class="number">4803</span>-<span class="number">81f</span>d-<span class="number">5</span>bf7a978726d  RAC1</span><br><span class="line"></span><br><span class="line">[qihuang.zheng@<span class="number">192</span>-<span class="number">168</span>-<span class="number">47</span>-<span class="number">227</span> ~]$ nodetool status</span><br><span class="line">--  Address         Load       Tokens  Owns   Host ID                               Rack</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.161</span>  <span class="number">460.78</span> GB  <span class="number">256</span>     <span class="number">20.1</span>%  <span class="number">54</span>b3a7e0-f778-<span class="number">4087</span>-<span class="number">98</span>c3-ac84e56f77e6  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.47</span><span class="number">.228</span>  <span class="number">5.4</span> TB     <span class="number">256</span>     <span class="number">19.2</span>%  f3d26148-d2da-<span class="number">479</span>c-ae9e-ae41aced1be9  RAC1</span><br><span class="line">DN  <span class="number">192.168</span><span class="number">.47</span><span class="number">.229</span>  <span class="number">937.05</span> GB  <span class="number">256</span>     <span class="number">21.2</span>%  <span class="number">18</span>a87c56-dcba-<span class="number">4614</span>-adba-<span class="number">804</span>aa7761a06  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.159</span>  <span class="number">483.41</span> GB  <span class="number">256</span>     <span class="number">19.5</span>%  df9a693b-efc1-<span class="number">41</span>bc-<span class="number">9</span>a42-cf868ea75e65  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.47</span><span class="number">.227</span>  <span class="number">686.93</span> GB  <span class="number">256</span>     <span class="number">20.0</span>%  <span class="number">02575631</span>-<span class="number">6</span>ccb-<span class="number">4803</span>-<span class="number">81f</span>d-<span class="number">5</span>bf7a978726d  RAC1</span><br></pre></td></tr></table></figure>
<blockquote>
<p>1.上面发现一个奇怪的现象就是229和160的HostID都是一样的, 所以日志中会有<code>have the same token ignoring</code><br>2.227并不认识160, 而是认为229状态为DN<br>3.160上能看到其他节点, 但是看不到229.  </p>
</blockquote>
<p>过了有一周, 再次查看发现还是上面的状况, 而且160的日志还是经常打印Ignoring…</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[qihuang.zheng@fp-cass048160 ~]$ nodetool status</span><br><span class="line">--  Address         Load       Tokens  Owns   Host ID                               Rack</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.161</span>  <span class="number">972.25</span> GB  <span class="number">256</span>     <span class="number">20.1</span>%  <span class="number">54</span>b3a7e0-f778-<span class="number">4087</span>-<span class="number">98</span>c3-ac84e56f77e6  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.160</span>  <span class="number">250.64</span> GB  <span class="number">256</span>     <span class="number">21.2</span>%  <span class="number">18</span>a87c56-dcba-<span class="number">4614</span>-adba-<span class="number">804</span>aa7761a06  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.47</span><span class="number">.228</span>  <span class="number">5.89</span> TB    <span class="number">256</span>     <span class="number">19.2</span>%  f3d26148-d2da-<span class="number">479</span>c-ae9e-ae41aced1be9  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.159</span>  <span class="number">1</span> TB       <span class="number">256</span>     <span class="number">19.5</span>%  df9a693b-efc1-<span class="number">41</span>bc-<span class="number">9</span>a42-cf868ea75e65  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.47</span><span class="number">.227</span>  <span class="number">1.15</span> TB    <span class="number">256</span>     <span class="number">20.0</span>%  <span class="number">02575631</span>-<span class="number">6</span>ccb-<span class="number">4803</span>-<span class="number">81f</span>d-<span class="number">5</span>bf7a978726d  RAC1</span><br><span class="line"></span><br><span class="line">[qihuang.zheng@<span class="number">192</span>-<span class="number">168</span>-<span class="number">47</span>-<span class="number">227</span> ~]$ nodetool status</span><br><span class="line">--  Address         Load       Tokens  Owns   Host ID                               Rack</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.161</span>  <span class="number">972.16</span> GB  <span class="number">256</span>     <span class="number">20.1</span>%  <span class="number">54</span>b3a7e0-f778-<span class="number">4087</span>-<span class="number">98</span>c3-ac84e56f77e6  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.47</span><span class="number">.228</span>  <span class="number">5.89</span> TB    <span class="number">256</span>     <span class="number">19.2</span>%  f3d26148-d2da-<span class="number">479</span>c-ae9e-ae41aced1be9  RAC1</span><br><span class="line">DN  <span class="number">192.168</span><span class="number">.47</span><span class="number">.229</span>  <span class="number">937.05</span> GB  <span class="number">256</span>     <span class="number">21.2</span>%  <span class="number">18</span>a87c56-dcba-<span class="number">4614</span>-adba-<span class="number">804</span>aa7761a06  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.159</span>  <span class="number">1</span> TB       <span class="number">256</span>     <span class="number">19.5</span>%  df9a693b-efc1-<span class="number">41</span>bc-<span class="number">9</span>a42-cf868ea75e65  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.47</span><span class="number">.227</span>  <span class="number">1.15</span> TB    <span class="number">256</span>     <span class="number">20.0</span>%  <span class="number">02575631</span>-<span class="number">6</span>ccb-<span class="number">4803</span>-<span class="number">81f</span>d-<span class="number">5</span>bf7a978726d  RAC1</span><br></pre></td></tr></table></figure>
<p>索性把160停掉重启(注意要加上auto_bootstrap:false), 现在227上能观察到160了. 但是160上还是看不到229.<br>不过更加奇怪的是229的HostID变成了null(因为出现160就不能同时再出现229了).这样子没办法removenode了.<br>其实也不能removenode了, 因为229和160的HostID之前是一样的!如果根据hostId删除,会把160也都删除掉了.  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[qihuang.zheng@<span class="number">192</span>-<span class="number">168</span>-<span class="number">47</span>-<span class="number">227</span> ~]$ nodetool status</span><br><span class="line">--  Address         Load       Tokens  Owns   Host ID                               Rack</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.161</span>  <span class="number">973.32</span> GB  <span class="number">256</span>     <span class="number">17.4</span>%  <span class="number">54</span>b3a7e0-f778-<span class="number">4087</span>-<span class="number">98</span>c3-ac84e56f77e6  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.160</span>  <span class="number">250.93</span> GB  <span class="number">256</span>     <span class="number">15.4</span>%  <span class="number">18</span>a87c56-dcba-<span class="number">4614</span>-adba-<span class="number">804</span>aa7761a06  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.47</span><span class="number">.228</span>  <span class="number">5.89</span> TB    <span class="number">256</span>     <span class="number">16.5</span>%  f3d26148-d2da-<span class="number">479</span>c-ae9e-ae41aced1be9  RAC1</span><br><span class="line">DN  <span class="number">192.168</span><span class="number">.47</span><span class="number">.229</span>  <span class="number">937.05</span> GB  <span class="number">256</span>     <span class="number">17.8</span>%  null                                  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.159</span>  <span class="number">1</span> TB       <span class="number">256</span>     <span class="number">16.4</span>%  df9a693b-efc1-<span class="number">41</span>bc-<span class="number">9</span>a42-cf868ea75e65  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.47</span><span class="number">.227</span>  <span class="number">1.15</span> TB    <span class="number">256</span>     <span class="number">16.5</span>%  <span class="number">02575631</span>-<span class="number">6</span>ccb-<span class="number">4803</span>-<span class="number">81f</span>d-<span class="number">5</span>bf7a978726d  RAC1</span><br></pre></td></tr></table></figure>
<p>不能根据hostId来removenode 229, 那怎么删除229节点?  </p>
<p>下面采用JMX的方式也不行: <a href="https://gist.github.com/justenwalker/8338334" target="_blank" rel="external">https://gist.github.com/justenwalker/8338334</a>  </p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[qihuang.zheng@<span class="number">192</span>-<span class="number">168</span>-<span class="number">47</span>-<span class="number">227</span> ~]$ java -jar ./jmxterm<span class="class">.jar</span></span><br><span class="line">Welcome to JMX terminal. Type <span class="string">"help"</span> <span class="keyword">for</span> available commands.</span><br><span class="line">$&gt;open localhost:<span class="number">7199</span></span><br><span class="line"><span class="id">#Connection</span> to localhost:<span class="number">7199</span> is opened</span><br><span class="line">$&gt;bean org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.net</span>:type=Gossiper</span><br><span class="line"><span class="hexcolor">#bea</span>n is set to org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.net</span>:type=Gossiper</span><br><span class="line">$&gt;run unsafeAssassinateEndpoint <span class="number">192.168</span>.<span class="number">47.229</span></span><br><span class="line"><span class="id">#calling</span> operation unsafeAssassinateEndpoint of mbean org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.net</span>:type=Gossiper</span><br><span class="line"><span class="id">#RuntimeMBeanException</span>: java<span class="class">.lang</span><span class="class">.NullPointerException</span></span><br></pre></td></tr></table></figure>
<p><a href="https://gist.github.com/nstielau/3373649" target="_blank" rel="external">https://gist.github.com/nstielau/3373649</a>  </p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">java -jar jmxsh-R*.jar -h <span class="number">192.168</span><span class="number">.47</span><span class="number">.227</span> -p <span class="number">7199</span></span><br><span class="line"></span><br><span class="line">% [Hit Enter <span class="keyword">to</span> go into Browse Mode]</span><br><span class="line"><span class="keyword">Select</span> a domain: [Enter <span class="built_in">number</span> <span class="keyword">for</span> org.apache.cassandra.net]</span><br><span class="line"><span class="keyword">Select</span> an mbean: [Enter <span class="built_in">number</span> <span class="keyword">for</span> org.apache.cassandra.net:type=Gossiper]</span><br><span class="line"><span class="keyword">Select</span> an attribute <span class="literal">or</span> operation: [Enter <span class="built_in">number</span> <span class="keyword">for</span> unsafeAssassinateEndpoint(<span class="built_in">String</span>  p1)]</span><br><span class="line">p1 (<span class="built_in">String</span>): <span class="number">192.168</span><span class="number">.47</span><span class="number">.229</span></span><br><span class="line"></span><br><span class="line">It may also be possible <span class="keyword">to</span> <span class="built_in">run</span> it directly (untested):</span><br><span class="line">% jmx_invoke -m org.apache.cassandra.net:type=Gossiper unsafeAssassinateEndpoint &lt;STALE-IP-ADDRESS&gt;</span><br></pre></td></tr></table></figure>
<p>但最后还是报错NPE:  </p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">%</span><br><span class="line"><span class="header">Entering browse mode.</span><br><span class="line">====================================================</span></span><br><span class="line"><span class="code"> Available Domains:</span></span><br><span class="line"><span class="code">       1. org.apache.cassandra.internal</span></span><br><span class="line"><span class="code">       2. org.apache.cassandra.metrics</span></span><br><span class="line"><span class="code">       6. org.apache.cassandra.request</span></span><br><span class="line"><span class="code">       7. org.apache.cassandra.net      ⬅️</span></span><br><span class="line"><span class="code">      10. org.apache.cassandra.db</span></span><br><span class="line"><span class="code">  SERVER: service:jmx:rmi:///jndi/rmi://192.168.47.227:7199/jmxrmi</span></span><br><span class="line"></span><br><span class="line">Exception caught: java.lang.NullPointerException</span><br></pre></td></tr></table></figure>
<p>查看每个节点自己的peers, 发现229和160的host_id一样:  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[qihuang.zheng@<span class="number">192</span>-<span class="number">168</span>-<span class="number">47</span>-<span class="number">227</span> ~]$ cqlsh -e <span class="string">"select peer, host_id from system.peers;"</span> <span class="number">192.168</span><span class="number">.47</span><span class="number">.227</span></span><br><span class="line"> peer           | host_id</span><br><span class="line">----------------+--------------------------------------</span><br><span class="line"> <span class="number">192.168</span><span class="number">.47</span><span class="number">.228</span> | f3d26148-d2da-<span class="number">479</span>c-ae9e-ae41aced1be9</span><br><span class="line"> <span class="number">192.168</span><span class="number">.47</span><span class="number">.229</span> | <span class="number">18</span>a87c56-dcba-<span class="number">4614</span>-adba-<span class="number">804</span>aa7761a06</span><br><span class="line"> <span class="number">192.168</span><span class="number">.48</span><span class="number">.160</span> | <span class="number">18</span>a87c56-dcba-<span class="number">4614</span>-adba-<span class="number">804</span>aa7761a06</span><br><span class="line"> <span class="number">192.168</span><span class="number">.48</span><span class="number">.161</span> | <span class="number">54</span>b3a7e0-f778-<span class="number">4087</span>-<span class="number">98</span>c3-ac84e56f77e6</span><br><span class="line"> <span class="number">192.168</span><span class="number">.48</span><span class="number">.159</span> | df9a693b-efc1-<span class="number">41</span>bc-<span class="number">9</span>a42-cf868ea75e65</span><br><span class="line"></span><br><span class="line">[qihuang.zheng@<span class="number">192</span>-<span class="number">168</span>-<span class="number">47</span>-<span class="number">227</span> ~]$ cqlsh -e <span class="string">"select peer, host_id from system.peers;"</span> <span class="number">192.168</span><span class="number">.48</span><span class="number">.159</span></span><br><span class="line"></span><br><span class="line"> peer           | host_id</span><br><span class="line">----------------+--------------------------------------</span><br><span class="line"> <span class="number">192.168</span><span class="number">.47</span><span class="number">.228</span> | f3d26148-d2da-<span class="number">479</span>c-ae9e-ae41aced1be9</span><br><span class="line"> <span class="number">192.168</span><span class="number">.47</span><span class="number">.227</span> | <span class="number">02575631</span>-<span class="number">6</span>ccb-<span class="number">4803</span>-<span class="number">81f</span>d-<span class="number">5</span>bf7a978726d</span><br><span class="line"> <span class="number">192.168</span><span class="number">.47</span><span class="number">.229</span> | <span class="number">18</span>a87c56-dcba-<span class="number">4614</span>-adba-<span class="number">804</span>aa7761a06</span><br><span class="line"> <span class="number">192.168</span><span class="number">.48</span><span class="number">.160</span> | <span class="number">18</span>a87c56-dcba-<span class="number">4614</span>-adba-<span class="number">804</span>aa7761a06</span><br><span class="line"> <span class="number">192.168</span><span class="number">.48</span><span class="number">.161</span> | <span class="number">54</span>b3a7e0-f778-<span class="number">4087</span>-<span class="number">98</span>c3-ac84e56f77e6</span><br><span class="line"></span><br><span class="line">[qihuang.zheng@<span class="number">192</span>-<span class="number">168</span>-<span class="number">47</span>-<span class="number">227</span> ~]$ nodetool status -h <span class="number">192.168</span><span class="number">.48</span><span class="number">.159</span></span><br><span class="line">--  Address         Load       Tokens  Owns   Host ID                               Rack</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.161</span>  <span class="number">1.15</span> TB    <span class="number">256</span>     <span class="number">17.4</span>%  <span class="number">54</span>b3a7e0-f778-<span class="number">4087</span>-<span class="number">98</span>c3-ac84e56f77e6  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.160</span>  <span class="number">461.6</span> GB   <span class="number">256</span>     <span class="number">15.4</span>%  <span class="number">18</span>a87c56-dcba-<span class="number">4614</span>-adba-<span class="number">804</span>aa7761a06  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.47</span><span class="number">.228</span>  <span class="number">6.09</span> TB    <span class="number">256</span>     <span class="number">16.5</span>%  f3d26148-d2da-<span class="number">479</span>c-ae9e-ae41aced1be9  RAC1</span><br><span class="line">DN  <span class="number">192.168</span><span class="number">.47</span><span class="number">.229</span>  <span class="number">937.05</span> GB  <span class="number">256</span>     <span class="number">17.8</span>%  null                                  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.159</span>  <span class="number">1.2</span> TB     <span class="number">256</span>     <span class="number">16.4</span>%  df9a693b-efc1-<span class="number">41</span>bc-<span class="number">9</span>a42-cf868ea75e65  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.47</span><span class="number">.227</span>  <span class="number">1.34</span> TB    <span class="number">256</span>     <span class="number">16.5</span>%  <span class="number">02575631</span>-<span class="number">6</span>ccb-<span class="number">4803</span>-<span class="number">81f</span>d-<span class="number">5</span>bf7a978726d  RAC1</span><br></pre></td></tr></table></figure>
<p>因为peers表的主键是peer, 所以可以根据peer删除一条记录:  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">cqlsh -e <span class="string">"delete from system.peers where peer='192.168.47.229';"</span> <span class="number">192.168</span><span class="number">.47</span><span class="number">.227</span></span><br><span class="line">cqlsh -e <span class="string">"delete from system.peers where peer='192.168.47.229';"</span> <span class="number">192.168</span><span class="number">.47</span><span class="number">.228</span></span><br><span class="line">cqlsh -e <span class="string">"delete from system.peers where peer='192.168.47.229';"</span> <span class="number">192.168</span><span class="number">.48</span><span class="number">.159</span></span><br><span class="line">cqlsh -e <span class="string">"delete from system.peers where peer='192.168.47.229';"</span> <span class="number">192.168</span><span class="number">.48</span><span class="number">.161</span></span><br><span class="line"></span><br><span class="line">[qihuang.zheng@<span class="number">192</span>-<span class="number">168</span>-<span class="number">47</span>-<span class="number">227</span> ~]$ cqlsh -e <span class="string">"select peer, host_id from system.peers;"</span> <span class="number">192.168</span><span class="number">.48</span><span class="number">.159</span></span><br><span class="line"> peer           | host_id</span><br><span class="line">----------------+--------------------------------------</span><br><span class="line"> <span class="number">192.168</span><span class="number">.47</span><span class="number">.228</span> | f3d26148-d2da-<span class="number">479</span>c-ae9e-ae41aced1be9</span><br><span class="line"> <span class="number">192.168</span><span class="number">.47</span><span class="number">.227</span> | <span class="number">02575631</span>-<span class="number">6</span>ccb-<span class="number">4803</span>-<span class="number">81f</span>d-<span class="number">5</span>bf7a978726d</span><br><span class="line"> <span class="number">192.168</span><span class="number">.48</span><span class="number">.160</span> | <span class="number">18</span>a87c56-dcba-<span class="number">4614</span>-adba-<span class="number">804</span>aa7761a06</span><br><span class="line"> <span class="number">192.168</span><span class="number">.48</span><span class="number">.161</span> | <span class="number">54</span>b3a7e0-f778-<span class="number">4087</span>-<span class="number">98</span>c3-ac84e56f77e6</span><br><span class="line"></span><br><span class="line">nodetool status -h <span class="number">192.168</span><span class="number">.48</span><span class="number">.159</span></span><br><span class="line">虽然peers中已经把<span class="number">229</span>移除了, 但是staus还是能看到<span class="number">229</span>为null</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.160</span>  <span class="number">467.14</span> GB  <span class="number">256</span>     <span class="number">15.4</span>%  <span class="number">18</span>a87c56-dcba-<span class="number">4614</span>-adba-<span class="number">804</span>aa7761a06  RAC1</span><br><span class="line">DN  <span class="number">192.168</span><span class="number">.47</span><span class="number">.229</span>  <span class="number">937.05</span> GB  <span class="number">256</span>     <span class="number">17.8</span>%  null                                  RAC1</span><br></pre></td></tr></table></figure>
<p><a href="http://stackoverflow.com/questions/20549284/cassandra-how-to-remove-a-dead-node" target="_blank" rel="external">http://stackoverflow.com/questions/20549284/cassandra-how-to-remove-a-dead-node</a></p>
<p>另一种方式: 重启229, 这时候会分配一个新的HostID, 然后停掉, 再用removenode移除229.  </p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[qihuang.zheng@<span class="number">192-168-47-227</span> ~]$ nodetool status</span><br><span class="line">--  Address         Load       Tokens  Owns   Host ID                               Rack</span><br><span class="line">UN  <span class="number">192.168.48.161</span>  1.16 TB    256     17.1%  <span class="number">54b3a7e0</span>-f<span class="number">778-4087</span>-98c3-ac<span class="number">84e56f77e6</span>  RAC1</span><br><span class="line">UN  <span class="number">192.168.48.160</span>  473.62 GB  256     16.1%  18a87c56-dcba-4614-adba-804aa7761a06  RAC1</span><br><span class="line">UN  <span class="number">192.168.47.228</span>  6.1 TB     256     16.8%  f<span class="number">3d26148</span>-d2da-479c-ae9e-ae41aced1be9  RAC1</span><br><span class="line">UN  <span class="number">192.168.47.229</span>  44.07 KB   256     16.7%  <span class="number">41211503-27</span>cd-47b0-b7c0-e<span class="number">5a7a4074</span>d34  RAC1    ⬅️</span><br><span class="line">UN  <span class="number">192.168.48.159</span>  1.22 TB    256     17.8%  df9a693b-efc1-41bc-9a42-cf868ea75e65  RAC1</span><br><span class="line">UN  <span class="number">192.168.47.227</span>  1.35 TB    256     15.4%  <span class="number">02575631-6</span>ccb-4803-81fd-5bf<span class="number">7a978726</span>d  RAC1</span><br><span class="line"></span><br><span class="line">[qihuang.zheng@<span class="number">192-168-47-227</span> ~]$ nodetool removenode status</span><br><span class="line">RemovalStatus: Removing token (-<span class="number">91890739788</span><span class="number">95940412</span>). Waiting for replication confirmation from [/<span class="number">192.168.48.161</span>,/<span class="number">192.168.48.160</span>,/<span class="number">192.168.47.228</span>,/<span class="number">192.168.48.159</span>,/<span class="number">192.168.47.227</span>].</span><br><span class="line"></span><br><span class="line">[qihuang.zheng@<span class="number">192-168-47-227</span> ~]$ nodetool ring | grep <span class="number">91890739788</span><span class="number">95940412</span></span><br><span class="line"><span class="number">192.168.47.229</span>  RAC1        Down   Leaving 44.07 KB        16.73%              -<span class="number">91890739788</span><span class="number">95940412</span></span><br><span class="line"></span><br><span class="line">[qihuang.zheng@<span class="number">192-168-47-227</span> ~]$ nodetool removenode force</span><br><span class="line">RemovalStatus: Removing token (-<span class="number">91890739788</span><span class="number">95940412</span>). Waiting for replication confirmation from [/<span class="number">192.168.48.161</span>,/<span class="number">192.168.48.160</span>,/<span class="number">192.168.47.228</span>,/<span class="number">192.168.48.159</span>,/<span class="number">192.168.47.227</span>].</span><br><span class="line">[qihuang.zheng@<span class="number">192-168-47-227</span> ~]$ nodetool status</span><br><span class="line">--  Address         Load       Tokens  Owns   Host ID                               Rack</span><br><span class="line">UN  <span class="number">192.168.48.161</span>  1.16 TB    256     20.6%  <span class="number">54b3a7e0</span>-f<span class="number">778-4087</span>-98c3-ac<span class="number">84e56f77e6</span>  RAC1</span><br><span class="line">UN  <span class="number">192.168.48.160</span>  474.38 GB  256     20.2%  18a87c56-dcba-4614-adba-804aa7761a06  RAC1</span><br><span class="line">UN  <span class="number">192.168.47.228</span>  6.1 TB     256     20.4%  f<span class="number">3d26148</span>-d2da-479c-ae9e-ae41aced1be9  RAC1</span><br><span class="line">UN  <span class="number">192.168.48.159</span>  1.22 TB    256     20.1%  df9a693b-efc1-41bc-9a42-cf868ea75e65  RAC1</span><br><span class="line">UN  <span class="number">192.168.47.227</span>  1.35 TB    256     18.8%  <span class="number">02575631-6</span>ccb-4803-81fd-5bf<span class="number">7a978726</span>d  RAC1</span><br></pre></td></tr></table></figure>
<h3 id="重新加入">重新加入</h3><p>228节点正在sstablelader，它实际上没有挂，但是其他节点确认为228挂了。 手动removenode后，其他节点认为228挂了。  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[admin@fp-cass048160 ~]$ /usr/install/cassandra/bin/nodetool status</span><br><span class="line">--  Address         Load       Tokens  Owns    Host ID                               Rack</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.227</span>  <span class="number">2.89</span> TB    <span class="number">256</span>     ?       f6136233-<span class="number">08</span>b3-<span class="number">4</span>cad-bd37-<span class="number">57</span>ab6dc4622b  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.226</span>  <span class="number">2.81</span> TB    <span class="number">256</span>     ?       <span class="number">6f</span>4416e1-<span class="number">4493</span>-<span class="number">4909</span>-<span class="number">8427</span>-<span class="number">3738</span>ae72fd82  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.176</span>  <span class="number">6.12</span> TB    <span class="number">256</span>     ?       <span class="number">08491</span>b7a-<span class="number">8e9</span>f-<span class="number">4</span>b5e-b22b-<span class="number">2e73</span>c455fd3f  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.161</span>  <span class="number">4.48</span> TB    <span class="number">256</span>     ?       <span class="number">54</span>b3a7e0-f778-<span class="number">4087</span>-<span class="number">98</span>c3-ac84e56f77e6  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.160</span>  <span class="number">4.57</span> TB    <span class="number">256</span>     ?       <span class="number">18</span>a87c56-dcba-<span class="number">4614</span>-adba-<span class="number">804</span>aa7761a06  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.175</span>  <span class="number">3.21</span> TB    <span class="number">256</span>     ?       <span class="number">5</span>bbd4400-<span class="number">2132</span>-<span class="number">42</span>b6-<span class="number">91</span>c5-<span class="number">389592</span>b75423  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.159</span>  <span class="number">4.69</span> TB    <span class="number">256</span>     ?       df9a693b-efc1-<span class="number">41</span>bc-<span class="number">9</span>a42-cf868ea75e65  RAC1</span><br><span class="line">DN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.228</span>  <span class="number">2.72</span> TB    <span class="number">256</span>     ?       dbf53446-<span class="number">35</span>b6-<span class="number">4</span>d18-<span class="number">80e2</span>-<span class="number">396</span>bc633924c  RAC1</span><br><span class="line">[admin@fp-cass048160 ~]$ nohup nodetool removenode dbf53446-<span class="number">35</span>b6-<span class="number">4</span>d18-<span class="number">80e2</span>-<span class="number">396</span>bc633924c &amp;</span><br><span class="line">[admin@fp-cass048160 ~]$ nodetool removenode force</span><br><span class="line">[admin@fp-cass048160 ~]$ /usr/install/cassandra/bin/nodetool status</span><br><span class="line">--  Address         Load       Tokens  Owns    Host ID                               Rack</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.227</span>  <span class="number">2.89</span> TB    <span class="number">256</span>     ?       f6136233-<span class="number">08</span>b3-<span class="number">4</span>cad-bd37-<span class="number">57</span>ab6dc4622b  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.226</span>  <span class="number">2.81</span> TB    <span class="number">256</span>     ?       <span class="number">6f</span>4416e1-<span class="number">4493</span>-<span class="number">4909</span>-<span class="number">8427</span>-<span class="number">3738</span>ae72fd82  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.176</span>  <span class="number">6.12</span> TB    <span class="number">256</span>     ?       <span class="number">08491</span>b7a-<span class="number">8e9</span>f-<span class="number">4</span>b5e-b22b-<span class="number">2e73</span>c455fd3f  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.161</span>  <span class="number">4.48</span> TB    <span class="number">256</span>     ?       <span class="number">54</span>b3a7e0-f778-<span class="number">4087</span>-<span class="number">98</span>c3-ac84e56f77e6  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.160</span>  <span class="number">4.57</span> TB    <span class="number">256</span>     ?       <span class="number">18</span>a87c56-dcba-<span class="number">4614</span>-adba-<span class="number">804</span>aa7761a06  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.175</span>  <span class="number">3.21</span> TB    <span class="number">256</span>     ?       <span class="number">5</span>bbd4400-<span class="number">2132</span>-<span class="number">42</span>b6-<span class="number">91</span>c5-<span class="number">389592</span>b75423  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.159</span>  <span class="number">4.69</span> TB    <span class="number">256</span>     ?       df9a693b-efc1-<span class="number">41</span>bc-<span class="number">9</span>a42-cf868ea75e65  RAC1</span><br></pre></td></tr></table></figure>
<p>但是228节点认为其他节点都是好的。 如果尝试加入，会说已经在组中了。但是实际上它并不属于组了。</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[admin@<span class="number">192-168-48-228</span> ~]$ /usr/install/cassandra/bin/nodetool status</span><br><span class="line">--  Address         Load       Tokens  Owns    Host ID                               Rack</span><br><span class="line">UN  <span class="number">192.168.48.227</span>  2.88 TB    256     ?       f<span class="number">6136233-08</span>b3-4cad-bd37-57ab6dc4622b  RAC1</span><br><span class="line">UN  <span class="number">192.168.48.226</span>  2.79 TB    256     ?       <span class="number">6f4416e1</span>-<span class="number">4493-4909</span>-<span class="number">8427-3738</span>ae72fd82  RAC1</span><br><span class="line">UN  <span class="number">192.168.48.176</span>  6.1 TB     256     ?       <span class="number">08491b7</span>a-8e9f-4b5e-b22b-<span class="number">2e73c455</span>fd3f  RAC1</span><br><span class="line">UN  <span class="number">192.168.48.161</span>  4.47 TB    256     ?       <span class="number">54b3a7e0</span>-f<span class="number">778-4087</span>-98c3-ac<span class="number">84e56f77e6</span>  RAC1</span><br><span class="line">UN  <span class="number">192.168.48.228</span>  2.72 TB    256     ?       dbf<span class="number">53446-35b6</span>-<span class="number">4d18-80e2</span>-396bc633924c  RAC1</span><br><span class="line">UN  <span class="number">192.168.48.160</span>  4.55 TB    256     ?       18a87c56-dcba-4614-adba-804aa7761a06  RAC1</span><br><span class="line">UN  <span class="number">192.168.48.175</span>  3.2 TB     256     ?       5bbd<span class="number">4400-2132</span>-<span class="number">42b6-91c5</span>-<span class="number">389592b75</span>423  RAC1</span><br><span class="line">UN  <span class="number">192.168.48.159</span>  4.67 TB    256     ?       df9a693b-efc1-41bc-9a42-cf868ea75e65  RAC1</span><br><span class="line"></span><br><span class="line">Note: Non-system keyspaces don't have the same replication settings, effective ownership information is meaningless</span><br><span class="line">[admin@<span class="number">192-168-48-228</span> ~]$ /usr/install/cassandra/bin/nodetool join</span><br><span class="line">nodetool: This node has already joined the ring.</span><br></pre></td></tr></table></figure>
<h3 id="网络状态netstats:_显示一个节点的Active_Stream">网络状态netstats: 显示一个节点的Active Stream</h3><p>1.正在加入集群的节点JOINING:   </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[qihuang.zheng@cass047224 cassandra]$ /usr/install/cassandra/bin/nodetool netstats</span><br><span class="line">Mode: JOINING</span><br><span class="line">Bootstrap fcca1bf0-<span class="number">4</span>a6e-<span class="number">11e5</span>-<span class="number">8677</span>-<span class="number">6</span>da22c7e072c</span><br><span class="line">    /<span class="number">192.168</span><span class="number">.47</span><span class="number">.222</span></span><br><span class="line">        Receiving <span class="number">929</span> files, <span class="number">259726626064</span> bytes total</span><br><span class="line">            /home/admin/cassandra/data/forseti_fp/tcp_syn_data/forseti_fp-tcp_syn_data-tmp-jb-<span class="number">198</span>-Data.db <span class="number">120433605</span>/<span class="number">120433605</span> bytes(<span class="number">100</span>%) received from /<span class="number">192.168</span><span class="number">.47</span><span class="number">.222</span></span><br><span class="line">    /<span class="number">192.168</span><span class="number">.47</span><span class="number">.203</span></span><br><span class="line">        Receiving <span class="number">976</span> files, <span class="number">214785965744</span> bytes total</span><br><span class="line">            /home/admin/cassandra/data/forseti/ip_mobilephone/forseti-ip_mobilephone-tmp-jb-<span class="number">16</span>-Data.db <span class="number">30801577</span>/<span class="number">30801577</span> bytes(<span class="number">100</span>%) received from /<span class="number">192.168</span><span class="number">.47</span><span class="number">.203</span></span><br></pre></td></tr></table></figure>
<p>2.离开集群的节点LEAVING:  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[qihuang.zheng@cass047225 snapshots]$ nodetool netstats | head</span><br><span class="line">Mode: LEAVING</span><br><span class="line">Restore replica count dad915d0-<span class="number">7</span>d6f-<span class="number">11e5</span>-<span class="number">8681</span>-<span class="number">9f</span>6f9f8ad5ca</span><br><span class="line">    /<span class="number">192.168</span><span class="number">.47</span><span class="number">.221</span></span><br><span class="line">        Sending <span class="number">243</span> files, <span class="number">7877174416</span> bytes total</span><br></pre></td></tr></table></figure>
<p>下线的节点除了发送数据给其他节点, 也会接收数据.  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[qihuang.zheng@cass047225 ~]$ nodetool netstats | grep <span class="string">"files"</span></span><br><span class="line">        Sending <span class="number">183</span> files, <span class="number">2169787693</span> bytes total</span><br><span class="line">        Sending <span class="number">223</span> files, <span class="number">6492707205</span> bytes total</span><br><span class="line">        ....</span><br><span class="line">        Receiving <span class="number">242</span> files, <span class="number">10438497913</span> bytes total</span><br><span class="line">        Receiving <span class="number">279</span> files, <span class="number">12407597530</span> bytes total</span><br></pre></td></tr></table></figure>
<p>3.正常的节点NORMAL, 会发送文件给其他节点, 并从下线的节点接收文件:  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[qihuang.zheng@spark047245 ~]$ /usr/install/cassandra/bin/nodetool netstats | head</span><br><span class="line">Mode: NORMAL</span><br><span class="line">Restore replica count db2a4310-<span class="number">7</span>d6f-<span class="number">11e5</span>-a4ef-<span class="number">8f</span>719a2aece0</span><br><span class="line">    /<span class="number">192.168</span><span class="number">.47</span><span class="number">.205</span></span><br><span class="line">        Sending <span class="number">309</span> files, <span class="number">25090493062</span> bytes total</span><br><span class="line"></span><br><span class="line">Unbootstrap <span class="number">00</span>ecfbb0-<span class="number">7</span>ea6-<span class="number">11e5</span>-<span class="number">9266</span>-f38b27f65aa6</span><br><span class="line">    /<span class="number">192.168</span><span class="number">.47</span><span class="number">.225</span></span><br><span class="line">        Receiving <span class="number">556</span> files, <span class="number">58062261421</span> bytes total</span><br></pre></td></tr></table></figure>
<h3 id="节点信息:_nodetool_info">节点信息: nodetool info</h3><p>主要关注KeyCache, 容量为512M(key_cache_size_in_mb), 用了500M左右, 命中率为65%. 没有开启RowCache(row_cache_size_in_mb:0).<br>堆内存16G, 用了6G(执行命令的这一时刻,并不是说总是占用这么点), 堆外内存off-heap使用了1G. 异常50个.    </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[qihuang.zheng@cass047202 ~]$ nodetool info</span><br><span class="line">Token                  : (invoke with -T/<span class="comment">--tokens to see all 256 tokens)</span></span><br><span class="line">ID                     : abaa0cbc-09d3-4990-8698-ff4d2f2bb4f7</span><br><span class="line">Gossip active          : true</span><br><span class="line">Thrift active          : true</span><br><span class="line">Native Transport active: true</span><br><span class="line"><span class="operator"><span class="keyword">Load</span>                   : <span class="number">618.81</span> GB</span><br><span class="line">Generation <span class="keyword">No</span>          : <span class="number">1445525962</span></span><br><span class="line">Uptime (seconds)       : <span class="number">651191</span></span><br><span class="line"><span class="keyword">Heap</span> <span class="keyword">Memory</span> (MB)       : <span class="number">6167.96</span> / <span class="number">15974.44</span></span><br><span class="line"><span class="keyword">Off</span> <span class="keyword">Heap</span> <span class="keyword">Memory</span> (MB)   : <span class="number">1154.13</span></span><br><span class="line"><span class="keyword">Data</span> Center            : DC1</span><br><span class="line">Rack                   : RAC1</span><br><span class="line"><span class="keyword">Exceptions</span>             : <span class="number">50</span></span><br><span class="line"><span class="keyword">Key</span> <span class="keyword">Cache</span>              : <span class="keyword">size</span> <span class="number">520120120</span> (<span class="keyword">bytes</span>), <span class="keyword">capacity</span> <span class="number">536870912</span> (<span class="keyword">bytes</span>), <span class="number">112077861</span> hits, <span class="number">182128983</span> requests, <span class="number">0.656</span> recent hit rate, <span class="number">14400</span> <span class="keyword">save</span> <span class="keyword">period</span> <span class="keyword">in</span> seconds</span><br><span class="line"><span class="keyword">Row</span> <span class="keyword">Cache</span>              : <span class="keyword">size</span> <span class="number">0</span> (<span class="keyword">bytes</span>), <span class="keyword">capacity</span> <span class="number">0</span> (<span class="keyword">bytes</span>), <span class="number">0</span> hits, <span class="number">0</span> requests, <span class="keyword">NaN</span> recent hit rate, <span class="number">0</span> <span class="keyword">save</span> <span class="keyword">period</span> <span class="keyword">in</span> seconds</span></span><br></pre></td></tr></table></figure>
<p>仅仅查看每个节点的KeyCache:  </p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./pssh<span class="class">.sh</span> ip_all<span class="class">.txt</span> <span class="string">"/usr/install/cassandra/bin/nodetool info | tail -2 | head -1"</span></span><br><span class="line">./pssh<span class="class">.sh</span> ip_all<span class="class">.txt</span> <span class="string">"/usr/install/cassandra/bin/nodetool info | sed -n '14p'"</span></span><br></pre></td></tr></table></figure>
<h3 id="Gossip信息:_nodetool_gossipinfo">Gossip信息: nodetool gossipinfo</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">nodetool gossipinfo</span><br><span class="line">/<span class="number">192.168</span><span class="number">.47</span><span class="number">.205</span></span><br><span class="line">  STATUS:NORMAL,-<span class="number">1027890057681052346</span></span><br><span class="line">/<span class="number">192.168</span><span class="number">.47</span><span class="number">.206</span></span><br><span class="line">  STATUS:NORMAL,-<span class="number">1004054309250591595</span></span><br><span class="line">/<span class="number">192.168</span><span class="number">.47</span><span class="number">.202</span></span><br><span class="line">  STATUS:NORMAL,-<span class="number">1062467338696068910</span></span><br><span class="line">/<span class="number">192.168</span><span class="number">.47</span><span class="number">.204</span></span><br><span class="line">  STATUS:NORMAL,-<span class="number">1130382709140432588</span></span><br><span class="line">/<span class="number">192.168</span><span class="number">.47</span><span class="number">.224</span></span><br><span class="line">  STATUS:NORMAL,-<span class="number">1137590811836749748</span></span><br><span class="line">/<span class="number">192.168</span><span class="number">.47</span><span class="number">.203</span></span><br><span class="line">  STATUS:NORMAL,-<span class="number">1024266383569750575</span></span><br><span class="line">/<span class="number">192.168</span><span class="number">.47</span><span class="number">.222</span></span><br><span class="line">  STATUS:NORMAL,-<span class="number">105769922317262244</span></span><br><span class="line">/<span class="number">192.168</span><span class="number">.47</span><span class="number">.225</span></span><br><span class="line">  STATUS:NORMAL,-<span class="number">1061781412716791842</span></span><br><span class="line">/<span class="number">192.168</span><span class="number">.47</span><span class="number">.221</span></span><br><span class="line">  STATUS:NORMAL,-<span class="number">104095308743394398</span></span><br><span class="line">/<span class="number">192.168</span><span class="number">.47</span><span class="number">.229</span></span><br><span class="line">  STATUS:LEFT,-<span class="number">9088453765955214068</span>,<span class="number">1448966282585</span></span><br></pre></td></tr></table></figure>
<h3 id="表相关的信息:nodetool_cfstats_forseti-velocity">表相关的信息:nodetool cfstats forseti.velocity</h3><p>1.查看表的信息, 前面四行是当前的读写延迟和读写次数.  </p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line">[qihuang.zheng<span class="annotation">@cass</span>047202 cassandra]$ nodetool cfstats forseti.velocity</span><br><span class="line"><span class="string">Keyspace:</span> forseti</span><br><span class="line">    Read <span class="string">Count:</span> <span class="number">10470099</span></span><br><span class="line">    Read <span class="string">Latency:</span> <span class="number">1.3186399419909973</span> ms.</span><br><span class="line">    Write <span class="string">Count:</span> <span class="number">146970362</span></span><br><span class="line">    Write <span class="string">Latency:</span> <span class="number">0.06062576270989929</span> ms.</span><br><span class="line">    Pending <span class="string">Tasks:</span> <span class="number">0</span></span><br><span class="line"><span class="label">        Table:</span> velocity</span><br><span class="line">        SSTable <span class="string">count:</span> <span class="number">2144</span></span><br><span class="line">        SSTables <span class="keyword">in</span> each <span class="string">level:</span> [<span class="number">1</span>, <span class="number">10</span>, <span class="number">96</span>, <span class="number">723</span>, <span class="number">1314</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">        Space used (live), <span class="string">bytes:</span> <span class="number">509031385679</span></span><br><span class="line">        Space used (total), <span class="string">bytes:</span> <span class="number">523815500936</span></span><br><span class="line">        Off heap memory used (total), <span class="string">bytes:</span> <span class="number">558210701</span></span><br><span class="line">        SSTable Compression <span class="string">Ratio:</span> <span class="number">0.23635049381008288</span></span><br><span class="line">        Number of keys (estimate): <span class="number">269787648</span></span><br><span class="line">        Memtable cell <span class="string">count:</span> <span class="number">271431</span></span><br><span class="line">        Memtable data size, <span class="string">bytes:</span> <span class="number">141953019</span></span><br><span class="line">        Memtable <span class="keyword">switch</span> <span class="string">count:</span> <span class="number">1713</span></span><br><span class="line">        Local read <span class="string">count:</span> <span class="number">10470099</span></span><br><span class="line">        Local read <span class="string">latency:</span> <span class="number">1.266</span> ms</span><br><span class="line">        Local write <span class="string">count:</span> <span class="number">146970371</span></span><br><span class="line">        Local write <span class="string">latency:</span> <span class="number">0.053</span> ms</span><br><span class="line">        Pending <span class="string">tasks:</span> <span class="number">0</span></span><br><span class="line">        Bloom filter <span class="literal">false</span> <span class="string">positives:</span> <span class="number">534721</span></span><br><span class="line">        Bloom filter <span class="literal">false</span> <span class="string">ratio:</span> <span class="number">0.13542</span></span><br><span class="line">        Bloom filter space used, <span class="string">bytes:</span> <span class="number">180529808</span></span><br><span class="line">        Bloom filter off heap memory used, <span class="string">bytes:</span> <span class="number">180512656</span></span><br><span class="line">        Index summary off heap memory used, <span class="string">bytes:</span> <span class="number">118613037</span></span><br><span class="line">        Compression metadata off heap memory used, <span class="string">bytes:</span> <span class="number">259085008</span></span><br><span class="line">        Compacted partition minimum <span class="string">bytes:</span> <span class="number">104</span></span><br><span class="line">        Compacted partition maximum <span class="string">bytes:</span> <span class="number">190420296972</span></span><br><span class="line">        Compacted partition mean <span class="string">bytes:</span> <span class="number">8656</span></span><br><span class="line">        Average live cells per slice (last five minutes): <span class="number">0.0</span></span><br><span class="line">        Average tombstones per slice (last five minutes): <span class="number">0.0</span></span><br><span class="line"></span><br><span class="line">[qihuang.zheng<span class="annotation">@spark</span>047211 ~]$ nodetool -h <span class="number">192.168</span><span class="number">.48</span><span class="number">.159</span> cfstats forseti_fp.android_device_session</span><br><span class="line"><span class="string">Keyspace:</span> forseti_fp</span><br><span class="line">  Read <span class="string">Count:</span> <span class="number">3436820</span></span><br><span class="line">  Read <span class="string">Latency:</span> <span class="number">0.7271564521854504</span> ms.</span><br><span class="line">  Write <span class="string">Count:</span> <span class="number">1242325989</span></span><br><span class="line">  Write <span class="string">Latency:</span> <span class="number">0.01608114556074058</span> ms.</span><br><span class="line">  Pending <span class="string">Flushes:</span> <span class="number">0</span></span><br><span class="line"><span class="label">    Table:</span> android_device_session</span><br><span class="line">    SSTable <span class="string">count:</span> <span class="number">14</span></span><br><span class="line">    Space used (live): <span class="number">3315056965329</span></span><br><span class="line">    Space used (total): <span class="number">3315312862453</span></span><br><span class="line">    Space used by snapshots (total): <span class="number">0</span></span><br><span class="line">    Off heap memory used (total): <span class="number">1813094460</span></span><br><span class="line">    SSTable Compression <span class="string">Ratio:</span> <span class="number">0.37206192803944754</span> </span><br><span class="line">    Number of keys (estimate): <span class="number">954623103</span>             -&gt; <span class="number">9</span>亿</span><br><span class="line">    Memtable cell <span class="string">count:</span> <span class="number">92654</span></span><br><span class="line">    Memtable data <span class="string">size:</span> <span class="number">104729033</span></span><br><span class="line">    Memtable off heap memory <span class="string">used:</span> <span class="number">0</span></span><br><span class="line">    Memtable <span class="keyword">switch</span> <span class="string">count:</span> <span class="number">13386</span></span><br><span class="line">    Local read <span class="string">count:</span> <span class="number">3436820</span></span><br><span class="line">    Local read <span class="string">latency:</span> <span class="number">0.728</span> ms</span><br><span class="line">    Local write <span class="string">count:</span> <span class="number">1242326281</span></span><br><span class="line">    Local write <span class="string">latency:</span> <span class="number">0.017</span> ms</span><br><span class="line">    Pending <span class="string">flushes:</span> <span class="number">0</span></span><br><span class="line">    Bloom filter <span class="literal">false</span> <span class="string">positives:</span> <span class="number">15</span></span><br><span class="line">    Bloom filter <span class="literal">false</span> <span class="string">ratio:</span> <span class="number">0.00000</span></span><br><span class="line">    Bloom filter space <span class="string">used:</span> <span class="number">607412928</span></span><br><span class="line">    Bloom filter off heap memory <span class="string">used:</span> <span class="number">607412816</span></span><br><span class="line">    Index summary off heap memory <span class="string">used:</span> <span class="number">138144620</span></span><br><span class="line">    Compression metadata off heap memory <span class="string">used:</span> <span class="number">1067537024</span></span><br><span class="line">    Compacted partition minimum <span class="string">bytes:</span> <span class="number">125</span></span><br><span class="line">    Compacted partition maximum <span class="string">bytes:</span> <span class="number">4866323</span></span><br><span class="line">    Compacted partition mean <span class="string">bytes:</span> <span class="number">10051</span></span><br><span class="line">    Average live cells per slice (last five minutes): <span class="number">0.10287086386072478</span></span><br><span class="line">    Maximum live cells per slice (last five minutes): <span class="number">7.0</span></span><br><span class="line">    Average tombstones per slice (last five minutes): <span class="number">0.14188850295078587</span></span><br><span class="line">    Maximum tombstones per slice (last five minutes): <span class="number">2164.0</span></span><br><span class="line"></span><br><span class="line">[qihuang.zheng<span class="annotation">@spark</span>047211 ~]$ nodetool -h <span class="number">192.168</span><span class="number">.48</span><span class="number">.162</span> cfstats forseti.velocity_app</span><br><span class="line"><span class="string">Keyspace:</span> forseti</span><br><span class="line">  Read <span class="string">Count:</span> <span class="number">120443046</span></span><br><span class="line">  Read <span class="string">Latency:</span> <span class="number">1.1013535886995087</span> ms.</span><br><span class="line">  Write <span class="string">Count:</span> <span class="number">2058015125</span></span><br><span class="line">  Write <span class="string">Latency:</span> <span class="number">0.016679299918653415</span> ms.</span><br><span class="line">  Pending <span class="string">Tasks:</span> <span class="number">0</span></span><br><span class="line"><span class="label">    Table:</span> velocity_app</span><br><span class="line">    SSTable <span class="string">count:</span> <span class="number">24</span></span><br><span class="line">    Space used (live), <span class="string">bytes:</span> <span class="number">2670044515793</span></span><br><span class="line">    Space used (total), <span class="string">bytes:</span> <span class="number">2670239936283</span></span><br><span class="line">    Off heap memory used (total), <span class="string">bytes:</span> <span class="number">2958340937</span></span><br><span class="line">    SSTable Compression <span class="string">Ratio:</span> <span class="number">0.28255581535232427</span></span><br><span class="line">    Number of keys (estimate): <span class="number">1976325248</span>   (<span class="number">19</span>亿)</span><br><span class="line">    Memtable cell <span class="string">count:</span> <span class="number">613404</span></span><br><span class="line">    Memtable data size, <span class="string">bytes:</span> <span class="number">233170920</span></span><br><span class="line">    Memtable <span class="keyword">switch</span> <span class="string">count:</span> <span class="number">4214</span></span><br><span class="line">    Local read <span class="string">count:</span> <span class="number">120443053</span></span><br><span class="line">    Local read <span class="string">latency:</span> <span class="number">0.931</span> ms</span><br><span class="line">    Local write <span class="string">count:</span> <span class="number">2058015151</span></span><br><span class="line">    Local write <span class="string">latency:</span> <span class="number">0.015</span> ms</span><br><span class="line">    Pending <span class="string">tasks:</span> <span class="number">0</span></span><br><span class="line">    Bloom filter <span class="literal">false</span> <span class="string">positives:</span> <span class="number">45097</span></span><br><span class="line">    Bloom filter <span class="literal">false</span> <span class="string">ratio:</span> <span class="number">0.00732</span></span><br><span class="line">    Bloom filter space used, <span class="string">bytes:</span> <span class="number">1230425688</span></span><br><span class="line">    Bloom filter off heap memory used, <span class="string">bytes:</span> <span class="number">1230425496</span></span><br><span class="line">    Index summary off heap memory used, <span class="string">bytes:</span> <span class="number">578011001</span></span><br><span class="line">    Compression metadata off heap memory used, <span class="string">bytes:</span> <span class="number">1149904440</span></span><br><span class="line">    Compacted partition minimum <span class="string">bytes:</span> <span class="number">150</span></span><br><span class="line">    Compacted partition maximum <span class="string">bytes:</span> <span class="number">158</span>(GB),<span class="number">683</span>(MB),<span class="number">580</span>(KB),<span class="number">810</span></span><br><span class="line">    Compacted partition mean <span class="string">bytes:</span> <span class="number">5225</span></span><br><span class="line"></span><br><span class="line">[qihuang.zheng<span class="annotation">@spark</span>047211 ~]$ nodetool -h <span class="number">192.168</span><span class="number">.48</span><span class="number">.162</span> cfstats forseti.velocity_partner</span><br><span class="line"><span class="string">Keyspace:</span> forseti</span><br><span class="line">  Read <span class="string">Count:</span> <span class="number">3664048</span></span><br><span class="line">  Read <span class="string">Latency:</span> <span class="number">1.265197941730021</span> ms.</span><br><span class="line">  Write <span class="string">Count:</span> <span class="number">1963754310</span></span><br><span class="line">  Write <span class="string">Latency:</span> <span class="number">0.017543929064120042</span> ms.</span><br><span class="line">  Pending <span class="string">Tasks:</span> <span class="number">0</span></span><br><span class="line"><span class="label">    Table:</span> velocity_partner</span><br><span class="line">    SSTable <span class="string">count:</span> <span class="number">5798</span></span><br><span class="line">    SSTables <span class="keyword">in</span> each <span class="string">level:</span> [<span class="number">1</span>, <span class="number">11</span>/<span class="number">10</span>, <span class="number">90</span>, <span class="number">881</span>, <span class="number">4813</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">    Space used (live), <span class="string">bytes:</span> <span class="number">1237251258441</span></span><br><span class="line">    Space used (total), <span class="string">bytes:</span> <span class="number">1240223108780</span></span><br><span class="line">    Off heap memory used (total), <span class="string">bytes:</span> <span class="number">1220821758</span></span><br><span class="line">    SSTable Compression <span class="string">Ratio:</span> <span class="number">0.2518164031088747</span></span><br><span class="line">    Number of keys (estimate): <span class="number">821395584</span>      <span class="number">8</span>亿</span><br><span class="line">    Memtable cell <span class="string">count:</span> <span class="number">775752</span></span><br><span class="line">    Memtable data size, <span class="string">bytes:</span> <span class="number">265533044</span></span><br><span class="line">    Memtable <span class="keyword">switch</span> <span class="string">count:</span> <span class="number">4217</span></span><br><span class="line">    Local read <span class="string">count:</span> <span class="number">3664048</span></span><br><span class="line">    Local read <span class="string">latency:</span> <span class="number">1.200</span> ms</span><br><span class="line">    Local write <span class="string">count:</span> <span class="number">1963754352</span></span><br><span class="line">    Local write <span class="string">latency:</span> <span class="number">0.017</span> ms</span><br><span class="line">    Pending <span class="string">tasks:</span> <span class="number">0</span></span><br><span class="line">    Bloom filter <span class="literal">false</span> <span class="string">positives:</span> <span class="number">599</span></span><br><span class="line">    Bloom filter <span class="literal">false</span> <span class="string">ratio:</span> <span class="number">0.00000</span></span><br><span class="line">    Bloom filter space used, <span class="string">bytes:</span> <span class="number">503778320</span></span><br><span class="line">    Bloom filter off heap memory used, <span class="string">bytes:</span> <span class="number">503731936</span></span><br><span class="line">    Index summary off heap memory used, <span class="string">bytes:</span> <span class="number">144796454</span></span><br><span class="line">    Compression metadata off heap memory used, <span class="string">bytes:</span> <span class="number">572293368</span></span><br><span class="line">    Compacted partition minimum <span class="string">bytes:</span> <span class="number">259</span></span><br><span class="line">    Compacted partition maximum <span class="string">bytes:</span> <span class="number">91</span>,<span class="number">830</span>,<span class="number">775</span>,<span class="number">932</span></span><br><span class="line">    Compacted partition mean <span class="string">bytes:</span> <span class="number">6265</span></span><br><span class="line">    Average live cells per slice (last five minutes): <span class="number">1.0</span></span><br><span class="line">    Average tombstones per slice (last five minutes): <span class="number">0.0</span></span><br><span class="line"></span><br><span class="line">[qihuang.zheng<span class="annotation">@spark</span>047211 ~]$ nodetool -h <span class="number">192.168</span><span class="number">.48</span><span class="number">.162</span> cfstats forseti.velocity_global</span><br><span class="line"><span class="string">Keyspace:</span> forseti</span><br><span class="line">  Read <span class="string">Count:</span> <span class="number">27019937</span></span><br><span class="line">  Read <span class="string">Latency:</span> <span class="number">0.8387888214173111</span> ms.</span><br><span class="line">  Write <span class="string">Count:</span> <span class="number">2057412727</span></span><br><span class="line">  Write <span class="string">Latency:</span> <span class="number">0.01946266525841317</span> ms.</span><br><span class="line">  Pending <span class="string">Tasks:</span> <span class="number">0</span></span><br><span class="line"><span class="label">    Table:</span> velocity_global</span><br><span class="line">    SSTable <span class="string">count:</span> <span class="number">5468</span></span><br><span class="line">    SSTables <span class="keyword">in</span> each <span class="string">level:</span> [<span class="number">7</span><span class="regexp">/4, 12/</span><span class="number">10</span>, <span class="number">77</span>, <span class="number">703</span>, <span class="number">4667</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">    Space used (live), <span class="string">bytes:</span> <span class="number">1476150066588</span></span><br><span class="line">    Space used (total), <span class="string">bytes:</span> <span class="number">1477238480867</span></span><br><span class="line">    Off heap memory used (total), <span class="string">bytes:</span> <span class="number">1092884433</span></span><br><span class="line">    SSTable Compression <span class="string">Ratio:</span> <span class="number">0.24933201816062378</span></span><br><span class="line">    Number of keys (estimate): <span class="number">558798080</span>     <span class="number">5</span>亿</span><br><span class="line">    Memtable cell <span class="string">count:</span> <span class="number">120625</span></span><br><span class="line">    Memtable data size, <span class="string">bytes:</span> <span class="number">38130612</span></span><br><span class="line">    Memtable <span class="keyword">switch</span> <span class="string">count:</span> <span class="number">4250</span></span><br><span class="line">    Local read <span class="string">count:</span> <span class="number">27019937</span></span><br><span class="line">    Local read <span class="string">latency:</span> <span class="number">1.128</span> ms</span><br><span class="line">    Local write <span class="string">count:</span> <span class="number">2057412797</span></span><br><span class="line">    Local write <span class="string">latency:</span> <span class="number">0.016</span> ms</span><br><span class="line">    Pending <span class="string">tasks:</span> <span class="number">0</span></span><br><span class="line">    Bloom filter <span class="literal">false</span> <span class="string">positives:</span> <span class="number">1700</span></span><br><span class="line">    Bloom filter <span class="literal">false</span> <span class="string">ratio:</span> <span class="number">0.00000</span></span><br><span class="line">    Bloom filter space used, <span class="string">bytes:</span> <span class="number">319642480</span></span><br><span class="line">    Bloom filter off heap memory used, <span class="string">bytes:</span> <span class="number">319598736</span></span><br><span class="line">    Index summary off heap memory used, <span class="string">bytes:</span> <span class="number">100862649</span></span><br><span class="line">    Compression metadata off heap memory used, <span class="string">bytes:</span> <span class="number">672423048</span></span><br><span class="line">    Compacted partition minimum <span class="string">bytes:</span> <span class="number">311</span></span><br><span class="line">    Compacted partition maximum <span class="string">bytes:</span> <span class="number">568</span>G,<span class="number">591</span>M,<span class="number">960</span>K,<span class="number">032</span></span><br><span class="line">    Compacted partition mean <span class="string">bytes:</span> <span class="number">10777</span></span><br><span class="line">    Average live cells per slice (last five minutes): <span class="number">0.0</span></span><br><span class="line">    Average tombstones per slice (last five minutes): <span class="number">0.0</span></span><br></pre></td></tr></table></figure>
<p>velocity在当前节点的keys有2.6亿. 其中最大的partition有190G! 说明存在一些很宽的行wide rows. 平均每个partition的大小是104Byte.   </p>
<p><a href="http://docs.datastax.com/en/cql/3.1/cql/cql_reference/compactSubprop.html" target="_blank" rel="external">http://docs.datastax.com/en/cql/3.1/cql/cql_reference/compactSubprop.html</a>  </p>
<blockquote>
<p>sstable_size_in_mb默认是160MB. The target size for SSTables that use the leveled compaction strategy.<br>Although SSTable sizes should be less or equal to sstable_size_in_mb, 尽管SSTable的大小应该比默认的160M要小或相等.<br>it is possible to have a larger SSTable during compaction. 在Compaction过程中,可能产生更大的SSTable.<br>This occurs when data for a given partition key is exceptionally large. 当某个分区键的数据非常大时,<br>The data is not split into two SSTables. 分区很大的键在compact时不会拆分到两个SSTable文件中(因为partition key只会在一个SSTable中).  </p>
</blockquote>
<p>2.线程池状态: tpstatus可以查看的内容和system.log中打印的StatsLogger差不多.  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[qihuang.zheng@cass047202 cassandra]$ nodetool tpstats</span><br><span class="line">Pool Name                    Active   Pending      Completed   Blocked  All time blocked</span><br><span class="line">ReadStage                         <span class="number">2</span>         <span class="number">0</span>       <span class="number">10960442</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line">RequestResponseStage              <span class="number">0</span>         <span class="number">0</span>      <span class="number">447942623</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line">MutationStage                     <span class="number">0</span>         <span class="number">0</span>      <span class="number">239315421</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line">ReadRepairStage                   <span class="number">0</span>         <span class="number">0</span>        <span class="number">1124868</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line">ReplicateOnWriteStage             <span class="number">0</span>         <span class="number">0</span>              <span class="number">0</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line">GossipStage                       <span class="number">0</span>         <span class="number">0</span>        <span class="number">1477282</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line">CacheCleanupExecutor              <span class="number">0</span>         <span class="number">0</span>              <span class="number">0</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line">MigrationStage                    <span class="number">0</span>         <span class="number">0</span>             <span class="number">46</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line">MemoryMeter                       <span class="number">0</span>         <span class="number">0</span>          <span class="number">10694</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line">FlushWriter                       <span class="number">0</span>         <span class="number">0</span>          <span class="number">11360</span>         <span class="number">0</span>               <span class="number">511</span></span><br><span class="line">ValidationExecutor                <span class="number">0</span>         <span class="number">0</span>              <span class="number">0</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line">InternalResponseStage             <span class="number">0</span>         <span class="number">0</span>              <span class="number">0</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line">AntiEntropyStage                  <span class="number">0</span>         <span class="number">0</span>              <span class="number">0</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line">MemtablePostFlusher               <span class="number">0</span>         <span class="number">0</span>          <span class="number">16487</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line">MiscStage                         <span class="number">0</span>         <span class="number">0</span>              <span class="number">0</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line">PendingRangeCalculator            <span class="number">0</span>         <span class="number">0</span>             <span class="number">39</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line">CompactionExecutor                <span class="number">3</span>         <span class="number">3</span>          <span class="number">47113</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line">commitlog_archiver                <span class="number">0</span>         <span class="number">0</span>              <span class="number">0</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line">HintedHandoff                     <span class="number">0</span>         <span class="number">1</span>            <span class="number">867</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line"></span><br><span class="line">Message type           Dropped</span><br><span class="line">RANGE_SLICE                  <span class="number">0</span></span><br><span class="line">READ_REPAIR                  <span class="number">0</span></span><br><span class="line">PAGED_RANGE                  <span class="number">0</span></span><br><span class="line">BINARY                       <span class="number">0</span></span><br><span class="line">READ                         <span class="number">0</span></span><br><span class="line">MUTATION                     <span class="number">0</span></span><br><span class="line">_TRACE                       <span class="number">0</span></span><br><span class="line">REQUEST_RESPONSE             <span class="number">2</span></span><br><span class="line">COUNTER_MUTATION             <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>比如正在运行的CompactionExecutor有3个, 用compactionstats可以查看正在运行Compaction的表:   </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[qihuang.zheng@cass047202 cassandra]$ nodetool compactionstats</span><br><span class="line">pending tasks: <span class="number">4</span></span><br><span class="line">          compaction type        keyspace           table       completed           total      unit  progress</span><br><span class="line">               Compaction         forseti        velocity      <span class="number">9600330302</span>     <span class="number">12886138624</span>     bytes    <span class="number">74.50</span>%</span><br><span class="line">               Compaction         forseti  device_account        <span class="number">64712962</span>      <span class="number">1923986398</span>     bytes     <span class="number">3.36</span>%</span><br><span class="line">     Tombstone Compaction         forseti        velocity        <span class="number">95382333</span>    <span class="number">170991248015</span>     bytes     <span class="number">0.06</span>%</span><br><span class="line">Active compaction remaining time :   <span class="number">0</span>h00m38s</span><br></pre></td></tr></table></figure>
<h3 id="compactionhistory">compactionhistory</h3><p><a href="https://docs.datastax.com/en/cassandra/2.1/cassandra/tools/toolsCompactionHistory.html" target="_blank" rel="external">https://docs.datastax.com/en/cassandra/2.1/cassandra/tools/toolsCompactionHistory.html</a></p>
<p>最后一列表示rows_merged：{tables:rows}. For example: {1:3, 3:1} means 3 rows were taken from one SSTable (1:3)<br>and 1 row taken from 3 SSTables (3:1) to make the one SSTable in that compaction operation.  </p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">nodetool compactionhistory | grep velocity | sort -r -k 4 &gt; compactionhistory.log</span><br><span class="line">nodetool compactionhistory | grep velocity | sort -r -k 4 | awk '&#123;for(i=4<span class="comment">;i&lt;=NF;i++) printf"%s\t",$i&#125; &#123;print ""&#125;' | head </span></span><br><span class="line">nodetool compactionhistory | grep velocity | sort -r -k 4 | awk '&#123;if(NF&gt;9) print $0&#125;'</span><br><span class="line"></span><br><span class="line">3cb01450-e<span class="number">5d7-11e5</span>-8fe9-2bcdca057dae     forseti            velocity                     <span class="number">145751483035</span>7             <span class="number">985256393</span>      <span class="number">869306399</span>      &#123;<span class="number">1:325289</span>, <span class="number">2:11651</span>&#125;</span><br><span class="line">ff100470-e<span class="number">5d6-11e5</span>-8fe9-2bcdca057dae     forseti            velocity                     <span class="number">145751472696</span>7             <span class="number">161269131</span>      <span class="number">159732166</span>      &#123;<span class="number">1:207378</span>, 2:9918&#125;</span><br><span class="line">bafef020-e<span class="number">5d6-11e5</span>-8fe9-2bcdca057dae     forseti            velocity                     <span class="number">145751461277</span>0             <span class="number">1171434739</span>     <span class="number">1167942768</span>     &#123;<span class="number">1:811453</span>, <span class="number">2:28598</span>&#125;</span><br><span class="line">b7c08e00-e<span class="number">5d6-11e5</span>-8fe9-2bcdca057dae     forseti            velocity                     <span class="number">145751460732</span>8             <span class="number">144946713</span>      <span class="number">143529681</span>      &#123;<span class="number">1:187320</span>, <span class="number">2:10070</span>&#125;</span><br><span class="line"><span class="number">6f66d380</span>-e<span class="number">5d6-11e5</span>-8fe9-2bcdca057dae     forseti            velocity                     <span class="number">145751448594</span>4             <span class="number">128493647</span>      <span class="number">127148807</span>      &#123;<span class="number">1:167405</span>, 2:9312&#125;</span><br><span class="line">2be5ca30-e<span class="number">5d6-11e5</span>-8fe9-2bcdca057dae     forseti            velocity                     <span class="number">145751437269</span>1             <span class="number">112061194</span>      <span class="number">111124311</span>      &#123;<span class="number">1:151315</span>, 2:6405&#125;</span><br><span class="line"><span class="number">2a335f40</span>-e<span class="number">5d6-11e5</span>-8fe9-2bcdca057dae     forseti            velocity                     <span class="number">145751436984</span>4             <span class="number">2078394794</span>     <span class="number">2073816751</span>     &#123;<span class="number">1:1298699</span>, <span class="number">2:39956</span>&#125;</span><br><span class="line"><span class="number">04070880</span>-e<span class="number">5d6-11e5</span>-8fe9-2bcdca057dae     forseti            velocity                     <span class="number">145751430579</span>9             <span class="number">103532684</span>      <span class="number">102206816</span>      &#123;<span class="number">1:137231</span>, 2:9020&#125;</span><br><span class="line">bb648530-e<span class="number">5d5-11e5</span>-8fe9-2bcdca057dae     forseti            velocity                     <span class="number">1457514183938</span>             <span class="number">86832984</span>       <span class="number">85571719</span>       &#123;<span class="number">1:115214</span>, 2:8749&#125;</span><br><span class="line"><span class="number">750254f0</span>-e<span class="number">5d5-11e5</span>-8fe9-2bcdca057dae     forseti            velocity                     <span class="number">145751406585</span>5             <span class="number">69678994</span>       <span class="number">68516377</span>       &#123;<span class="number">1:93817</span>, 2:7968&#125;</span><br><span class="line"><span class="number">3b9a2260</span>-e<span class="number">5d5-11e5</span>-8fe9-2bcdca057dae     forseti            velocity                     <span class="number">145751396954</span>2             <span class="number">53715409</span>       <span class="number">51918781</span>       &#123;<span class="number">1:69930</span>, 2:6969, 3:2522&#125;</span><br></pre></td></tr></table></figure>
<p>system.log中对于每次Compaction操作都有记录本次合并了多少个文件：  </p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">INFO [CompactionExecutor:<span class="number">48884</span>] <span class="number">2016</span>-<span class="number">03</span>-<span class="number">11</span> <span class="number">08</span>:<span class="number">08</span>:<span class="number">34</span>,<span class="number">162</span> CompactionTask.java (<span class="built_in">line</span> <span class="number">120</span>) Compacting [</span><br><span class="line">  SSTableReader(path=<span class="string">'/home/admin/cassandra/data/system/compactions_in_progress/system-compactions_in_progress-jb-947338-Data.db'</span>), </span><br><span class="line">  SSTableReader(path=<span class="string">'/home/admin/cassandra/data/system/compactions_in_progress/system-compactions_in_progress-jb-947335-Data.db'</span>), </span><br><span class="line">  SSTableReader(path=<span class="string">'/home/admin/cassandra/data/system/compactions_in_progress/system-compactions_in_progress-jb-947334-Data.db'</span>), </span><br><span class="line">  SSTableReader(path=<span class="string">'/home/admin/cassandra/data/system/compactions_in_progress/system-compactions_in_progress-jb-947336-Data.db'</span>), </span><br><span class="line">  SSTableReader(path=<span class="string">'/home/admin/cassandra/data/system/compactions_in_progress/system-compactions_in_progress-jb-947337-Data.db'</span>)]</span><br><span class="line">INFO [CompactionExecutor:<span class="number">48884</span>] <span class="number">2016</span>-<span class="number">03</span>-<span class="number">11</span> <span class="number">08</span>:<span class="number">08</span>:<span class="number">34</span>,<span class="number">181</span> CompactionTask.java (<span class="built_in">line</span> <span class="number">299</span>) Compacted <span class="number">5</span> sstables <span class="built_in">to</span> [</span><br><span class="line">/home/admin/cassandra/data/<span class="keyword">system</span>/compactions_in_progress/<span class="keyword">system</span>-compactions_in_progress-jb-<span class="number">947339</span>,].  </span><br><span class="line"><span class="number">1</span>,<span class="number">803</span> <span class="keyword">bytes</span> <span class="built_in">to</span> <span class="number">1</span>,<span class="number">044</span> (~<span class="number">57</span>% <span class="operator">of</span> original) <span class="operator">in</span> <span class="number">18</span>ms = <span class="number">0.055313</span>MB/s.  </span><br><span class="line"><span class="number">12</span> total partitions merged <span class="built_in">to</span> <span class="number">8.</span>  Partition <span class="built_in">merge</span> counts were &#123;<span class="number">1</span>:<span class="number">8</span>, <span class="number">2</span>:<span class="number">2</span>, &#125;</span><br></pre></td></tr></table></figure>
<p>1:8表示：有8行从一个sstables中获取<br>2:2表示：有2行从两个sstables中获取</p>
<p>疑问：partitions数量从12个被合并为8个，为什么partition会减少呢？<br>totalSourceRows=12, totalkeysWritten=8<br>rows和keys的概念是不同的。 相同key可以有多个rows。<br>所以12条记录中，会有4条记录的row-key和8条中的相同。最后的keys数量也就只有4个。  </p>
<h3 id="节点sstable数量异常">节点sstable数量异常</h3><p>某个节点读延迟异常高，700ms</p>
<p><img src="http://img.blog.csdn.net/20160317181038372" alt="fp_readrt_high"></p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[qihuang.zheng<span class="annotation">@fp</span>-cass048160 ~]$ nodetool cfstats forseti_fp.android_device_session</span><br><span class="line"><span class="string">Keyspace:</span> forseti_fp</span><br><span class="line">    Read <span class="string">Count:</span> <span class="number">608718</span></span><br><span class="line">    Read <span class="string">Latency:</span> <span class="number">414.3243900525366</span> ms.</span><br><span class="line">    Write <span class="string">Count:</span> <span class="number">594753618</span></span><br><span class="line">    Write <span class="string">Latency:</span> <span class="number">0.025195973536725928</span> ms.</span><br><span class="line">    Pending <span class="string">Tasks:</span> <span class="number">0</span></span><br><span class="line"><span class="label">        Table:</span> android_device_session</span><br><span class="line">        SSTable <span class="string">count:</span> <span class="number">32459</span></span><br><span class="line">        Space used (live), <span class="string">bytes:</span> <span class="number">2788804636549</span></span><br><span class="line">        Space used (total), <span class="string">bytes:</span> <span class="number">2795041174866</span></span><br><span class="line">        Off heap memory used (total), <span class="string">bytes:</span> <span class="number">2909029224</span></span><br><span class="line">        SSTable Compression <span class="string">Ratio:</span> <span class="number">0.3635126499232498</span></span><br><span class="line">        Number of keys (estimate): <span class="number">1299672448</span></span><br><span class="line">        Memtable cell <span class="string">count:</span> <span class="number">30494</span></span><br><span class="line">        Memtable data size, <span class="string">bytes:</span> <span class="number">109313490</span></span><br><span class="line">        Memtable <span class="keyword">switch</span> <span class="string">count:</span> <span class="number">19297</span></span><br><span class="line">        Local read <span class="string">count:</span> <span class="number">608718</span></span><br><span class="line">        Local read <span class="string">latency:</span> <span class="number">866.253</span> ms</span><br><span class="line">        Local write <span class="string">count:</span> <span class="number">594753660</span></span><br><span class="line">        Local write <span class="string">latency:</span> <span class="number">0.024</span> ms</span><br></pre></td></tr></table></figure>
<p>同一个集群其他节点的读延迟很少，sstable数量不超过20个。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[qihuang.zheng<span class="annotation">@fp</span>-cass048159 ~]$ nodetool cfstats forseti_fp.android_device_session</span><br><span class="line"><span class="string">Keyspace:</span> forseti_fp</span><br><span class="line">    Read <span class="string">Count:</span> <span class="number">266951</span></span><br><span class="line">    Read <span class="string">Latency:</span> <span class="number">0.9562793471461055</span> ms.</span><br><span class="line">    Write <span class="string">Count:</span> <span class="number">799860155</span></span><br><span class="line">    Write <span class="string">Latency:</span> <span class="number">0.024167126153446163</span> ms.</span><br><span class="line">    Pending <span class="string">Tasks:</span> <span class="number">0</span></span><br><span class="line"><span class="label">        Table:</span> android_device_session</span><br><span class="line">        SSTable <span class="string">count:</span> <span class="number">16</span></span><br><span class="line">        Space used (live), <span class="string">bytes:</span> <span class="number">4644725077858</span></span><br><span class="line">        Space used (total), <span class="string">bytes:</span> <span class="number">4659648681740</span></span><br><span class="line">        Off heap memory used (total), <span class="string">bytes:</span> <span class="number">2942472988</span></span><br><span class="line">        SSTable Compression <span class="string">Ratio:</span> <span class="number">0.3659509172064071</span></span><br><span class="line">        Number of keys (estimate): <span class="number">1344413568</span></span><br><span class="line">        Memtable cell <span class="string">count:</span> <span class="number">30468</span></span><br><span class="line">        Memtable data size, <span class="string">bytes:</span> <span class="number">107505453</span></span><br><span class="line">        Memtable <span class="keyword">switch</span> <span class="string">count:</span> <span class="number">25428</span></span><br><span class="line">        Local read <span class="string">count:</span> <span class="number">266951</span></span><br><span class="line">        Local read <span class="string">latency:</span> <span class="number">0.774</span> ms</span><br><span class="line">        Local write <span class="string">count:</span> <span class="number">799860178</span></span><br><span class="line">        Local write <span class="string">latency:</span> <span class="number">0.022</span> ms</span><br></pre></td></tr></table></figure>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[qihuang.zheng@cass048169 ~]$ nodetool status |grep RAC|awk '&#123;<span class="keyword">print</span> <span class="label">$2&#125;</span>' | <span class="keyword">while</span> <span class="keyword">read</span> ip; <span class="keyword">do</span> echo <span class="label">$ip</span>; nodetool -<span class="keyword">h</span> <span class="label">$ip</span> cfstats forseti.velocity_app | grep <span class="string">"SSTable count"</span>; done</span><br><span class="line">192.168.48.163</span><br><span class="line">        SSTable <span class="keyword">count</span>: 42</span><br><span class="line">192.168.48.162</span><br><span class="line">        SSTable <span class="keyword">count</span>: 34</span><br><span class="line">192.168.48.174</span><br><span class="line">        SSTable <span class="keyword">count</span>: 26</span><br><span class="line">192.168.48.173</span><br><span class="line">        SSTable <span class="keyword">count</span>: 26</span><br><span class="line">192.168.48.171</span><br><span class="line">        SSTable <span class="keyword">count</span>: 30</span><br><span class="line">192.168.48.169</span><br><span class="line">        SSTable <span class="keyword">count</span>: 2620</span><br></pre></td></tr></table></figure>
<p>磁盘空间和status的负载不同，差距不是一般大：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[qihuang.zheng@cass048169 ~]$ df -h</span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sda3       <span class="number">271</span>G  <span class="number">8.3</span>G  <span class="number">249</span>G   <span class="number">4</span>% /</span><br><span class="line">tmpfs            <span class="number">16</span>G     <span class="number">0</span>   <span class="number">16</span>G   <span class="number">0</span>% /dev/shm</span><br><span class="line">/dev/sda1       <span class="number">190</span>M   <span class="number">30</span>M  <span class="number">151</span>M  <span class="number">17</span>% /boot</span><br><span class="line">/dev/sdb1        <span class="number">11</span>T  <span class="number">8.3</span>T  <span class="number">1.6</span>T  <span class="number">85</span>% /home</span><br><span class="line"></span><br><span class="line">[qihuang.zheng@cass048169 ~]$ nodetool status</span><br><span class="line">Note: Ownership information does not include topology; <span class="keyword">for</span> complete information, specify a keyspace</span><br><span class="line">--  Address         Load       Tokens  Owns   Host ID                               Rack</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.163</span>  <span class="number">2.34</span> TB    <span class="number">256</span>     <span class="number">15.9</span>%  <span class="number">003</span>a7621-a62b-<span class="number">4</span>c29-<span class="number">83</span>ac-<span class="number">6724</span>d2d749ab  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.162</span>  <span class="number">2.11</span> TB    <span class="number">256</span>     <span class="number">15.3</span>%  <span class="number">9</span>d507979-f309-<span class="number">4</span>a8b-<span class="number">98e2</span>-<span class="number">92385701</span>dcfe  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.174</span>  <span class="number">2.35</span> TB    <span class="number">256</span>     <span class="number">17.9</span>%  bc66ae3b-d694-<span class="number">4286</span>-<span class="number">9</span>c89-<span class="number">09</span>ea46ea740d  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.173</span>  <span class="number">2.39</span> TB    <span class="number">256</span>     <span class="number">17.4</span>%  <span class="number">6</span>de0bf8b-<span class="number">620</span>b-<span class="number">4</span>b47-b47b-<span class="number">1</span>d8ecb82f20d  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.171</span>  <span class="number">2.24</span> TB    <span class="number">256</span>     <span class="number">15.6</span>%  d9b4f2e3-<span class="number">54</span>a4-<span class="number">47</span>d6-<span class="number">95e1</span>-<span class="number">55</span>a6f9734e79  RAC1</span><br><span class="line">UN  <span class="number">192.168</span><span class="number">.48</span><span class="number">.169</span>  <span class="number">2.63</span> TB    <span class="number">256</span>     <span class="number">17.9</span>%  <span class="number">2</span>a80470e-<span class="number">1</span>dc4-<span class="number">4734</span>-a268-<span class="number">946886f</span>e25b7  RAC1</span><br><span class="line"></span><br><span class="line">[qihuang.zheng@cass048169 ~]$ du -sh /home/admin/cassandra/data/forseti<span class="comment">/*</span><br><span class="line">3.4T    /home/admin/cassandra/data/forseti/velocity_app</span><br><span class="line">2.5T    /home/admin/cassandra/data/forseti/velocity_global</span><br><span class="line">2.5T    /home/admin/cassandra/data/forseti/velocity_partner</span></span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[qihuang.zheng@cass048169 ~]$ nodetool compactionstats</span><br><span class="line">pending tasks: <span class="number">4117</span></span><br><span class="line">          compaction type        keyspace           table       completed           total      unit  progress</span><br><span class="line">               Compaction         forsetivelocity_partner       <span class="number">454792709</span>       <span class="number">608062664</span>     bytes    <span class="number">74.79</span>%</span><br><span class="line">               Compaction         forseti    velocity_app   <span class="number">5711586451164</span>   <span class="number">6322585431145</span>     bytes    <span class="number">90.34</span>%</span><br><span class="line">               Compaction         forseti velocity_global     <span class="number">11137129414</span>     <span class="number">79062862183</span>     bytes    <span class="number">14.09</span>%</span><br><span class="line">               Compaction         forsetivelocity_partner      <span class="number">3724946719</span>      <span class="number">3887650106</span>     bytes    <span class="number">95.81</span>%</span><br><span class="line">               Compaction         forseti    velocity_app       <span class="number">145281458</span>       <span class="number">167205065</span>     bytes    <span class="number">86.89</span>%</span><br><span class="line">               Compaction         forsetivelocity_partner    <span class="number">112338305659</span>    <span class="number">774832769029</span>     bytes    <span class="number">14.50</span>%</span><br><span class="line">               Compaction         forseti velocity_global     <span class="number">24832092819</span>     <span class="number">41353336206</span>     bytes    <span class="number">60.05</span>%</span><br><span class="line">               Compaction         forseti velocity_global      <span class="number">4981924282</span>      <span class="number">6189383778</span>     bytes    <span class="number">80.49</span>%</span><br><span class="line">Active compaction remaining time :   <span class="number">2</span>h48m48s</span><br><span class="line"></span><br><span class="line">[qihuang.zheng@fp-cass048162 velocity_app]$ nodetool compactionstats</span><br><span class="line">pending tasks: <span class="number">3082</span></span><br><span class="line">          compaction type        keyspace           table       completed           total      unit  progress</span><br><span class="line">               Compaction         forseti velocity_global     <span class="number">11519537972</span>     <span class="number">58891073447</span>     bytes    <span class="number">19.56</span>%</span><br><span class="line">               Compaction         forsetivelocity_partner       <span class="number">519435163</span>       <span class="number">900884457</span>     bytes    <span class="number">57.66</span>%</span><br><span class="line">               Compaction         forsetivelocity_partner    <span class="number">218779482632</span>    <span class="number">268314967832</span>     bytes    <span class="number">81.54</span>%</span><br><span class="line">               Compaction         forsetivelocity_partner     <span class="number">53136709412</span>     <span class="number">77669440754</span>     bytes    <span class="number">68.41</span>%</span><br><span class="line">               Compaction         forsetivelocity_partner        <span class="number">96402475</span>       <span class="number">225578061</span>     bytes    <span class="number">42.74</span>%</span><br><span class="line">               Compaction         forsetivelocity_partner        <span class="number">13945308</span>       <span class="number">205008051</span>     bytes     <span class="number">6.80</span>%</span><br><span class="line">               Compaction         forseti    velocity_app     <span class="number">92188611730</span>    <span class="number">284042451190</span>     bytes    <span class="number">32.46</span>%</span><br><span class="line">               Compaction         forsetivelocity_partner       <span class="number">205665564</span>       <span class="number">700947805</span>     bytes    <span class="number">29.34</span>%</span><br><span class="line">Active compaction remaining time :   <span class="number">0</span>h39m03s</span><br><span class="line"></span><br><span class="line">[qihuang.zheng@cass047202 ~]$ nodetool compactionstats</span><br><span class="line">pending tasks: <span class="number">1</span></span><br><span class="line">          compaction type        keyspace           table       completed           total      unit  progress</span><br><span class="line">               Compaction         forseti        velocity      <span class="number">4094787925</span>      <span class="number">6749331650</span>     bytes    <span class="number">60.67</span>%</span><br><span class="line">Active compaction remaining time :   <span class="number">0</span>h00m19s</span><br></pre></td></tr></table></figure>
<h2 id="tpstats">tpstats</h2><p>正常情况下不应该出现有Dropped的，但是在Driver报错：All host(s) tried for query failed,… connection has been closed.<br>是不是连接数过多，直接拒绝？</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[admin@mysql047012 ~]$ /usr/install/cassandra/bin/nodetool tpstats</span><br><span class="line">Pool Name                    Active   Pending      Completed   Blocked  All time blocked</span><br><span class="line">CounterMutationStage              <span class="number">0</span>         <span class="number">0</span>              <span class="number">0</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line">ReadStage                         <span class="number">0</span>         <span class="number">0</span>        <span class="number">4302492</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line">RequestResponseStage              <span class="number">0</span>         <span class="number">0</span>              <span class="number">0</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line">MutationStage                    <span class="number">15</span>         <span class="number">0</span>       <span class="number">44176401</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line">ReadRepairStage                   <span class="number">0</span>         <span class="number">0</span>              <span class="number">0</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line">GossipStage                       <span class="number">0</span>         <span class="number">0</span>              <span class="number">0</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line">CacheCleanupExecutor              <span class="number">0</span>         <span class="number">0</span>              <span class="number">0</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line">AntiEntropyStage                  <span class="number">0</span>         <span class="number">0</span>              <span class="number">0</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line">MigrationStage                    <span class="number">0</span>         <span class="number">0</span>              <span class="number">0</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line">Sampler                           <span class="number">0</span>         <span class="number">0</span>              <span class="number">0</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line">ValidationExecutor                <span class="number">0</span>         <span class="number">0</span>              <span class="number">0</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line">CommitLogArchiver                 <span class="number">0</span>         <span class="number">0</span>              <span class="number">0</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line">MiscStage                         <span class="number">0</span>         <span class="number">0</span>              <span class="number">0</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line">MemtableFlushWriter               <span class="number">0</span>         <span class="number">0</span>            <span class="number">920</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line">MemtableReclaimMemory             <span class="number">0</span>         <span class="number">0</span>            <span class="number">925</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line">PendingRangeCalculator            <span class="number">0</span>         <span class="number">0</span>              <span class="number">1</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line">MemtablePostFlush                 <span class="number">0</span>         <span class="number">0</span>           <span class="number">5245</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line">CompactionExecutor                <span class="number">1</span>         <span class="number">1</span>         <span class="number">328827</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line">InternalResponseStage             <span class="number">0</span>         <span class="number">0</span>              <span class="number">0</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line">HintedHandoff                     <span class="number">0</span>         <span class="number">0</span>              <span class="number">0</span>         <span class="number">0</span>                 <span class="number">0</span></span><br><span class="line">Native-Transport-Requests        <span class="number">19</span>         <span class="number">0</span>       <span class="number">13670768</span>         <span class="number">0</span>              <span class="number">6885</span></span><br><span class="line"></span><br><span class="line">Message type           Dropped</span><br><span class="line">RANGE_SLICE                  <span class="number">0</span></span><br><span class="line">READ_REPAIR                  <span class="number">0</span></span><br><span class="line">PAGED_RANGE                  <span class="number">0</span></span><br><span class="line">BINARY                       <span class="number">0</span></span><br><span class="line">READ                         <span class="number">0</span></span><br><span class="line">MUTATION                  <span class="number">1808</span></span><br><span class="line">_TRACE                       <span class="number">0</span></span><br><span class="line">REQUEST_RESPONSE             <span class="number">0</span></span><br><span class="line">COUNTER_MUTATION             <span class="number">0</span></span><br></pre></td></tr></table></figure>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">INFO  [SharedPool-Worker-<span class="number">40</span>] <span class="number">2016</span>-<span class="number">06</span>-<span class="number">23</span> <span class="number">17</span>:<span class="number">38</span>:<span class="number">19</span>,<span class="number">848</span> Message.java:<span class="number">532</span> - Unexpected exception during request; channel = [id: <span class="number">0</span>x04539b0a, /<span class="number">192.168</span>.<span class="number">47.34</span>:<span class="number">64733</span> :&gt; /<span class="number">192.168</span>.<span class="number">47.12</span>:<span class="number">9042</span>]</span><br><span class="line">java.io.IOException: Error <span class="keyword">while</span> <span class="keyword">read</span>(...): Connection reset <span class="keyword">by</span> peer</span><br><span class="line">        at io.netty.channel.epoll.Native.readAddress(Native <span class="function"><span class="keyword">Method</span>) ~[<span class="title">netty</span>-<span class="title">all</span>-4.0.23.<span class="title">Final</span>.<span class="title">jar</span>:</span><span class="number">4.0</span>.<span class="number">23</span>.<span class="keyword">Final</span>]</span><br><span class="line">        at io.netty.channel.epoll.EpollSocketChannel$EpollSocketUnsafe.doReadBytes(EpollSocketChannel.java:<span class="number">675</span>) ~[netty-all-<span class="number">4.0</span>.<span class="number">23</span>.<span class="keyword">Final</span>.jar:<span class="number">4.0</span>.<span class="number">23</span>.<span class="keyword">Final</span>]</span><br><span class="line">        at io.netty.channel.epoll.EpollSocketChannel$EpollSocketUnsafe.epollInReady(EpollSocketChannel.java:<span class="number">714</span>) ~[netty-all-<span class="number">4.0</span>.<span class="number">23</span>.<span class="keyword">Final</span>.jar:<span class="number">4.0</span>.<span class="number">23</span>.<span class="keyword">Final</span>]</span><br><span class="line">        at io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:<span class="number">326</span>) ~[netty-all-<span class="number">4.0</span>.<span class="number">23</span>.<span class="keyword">Final</span>.jar:<span class="number">4.0</span>.<span class="number">23</span>.<span class="keyword">Final</span>]</span><br><span class="line">        at io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:<span class="number">264</span>) ~[netty-all-<span class="number">4.0</span>.<span class="number">23</span>.<span class="keyword">Final</span>.jar:<span class="number">4.0</span>.<span class="number">23</span>.<span class="keyword">Final</span>]</span><br><span class="line">        at io.netty.util.concurrent.SingleThreadEventExecutor$<span class="number">2</span>.run(SingleThreadEventExecutor.java:<span class="number">116</span>) ~[netty-all-<span class="number">4.0</span>.<span class="number">23</span>.<span class="keyword">Final</span>.jar:<span class="number">4.0</span>.<span class="number">23</span>.<span class="keyword">Final</span>]</span><br><span class="line">        at io.netty.util.concurrent.DefaultThreadFactory$DefaultRunnableDecorator.run(DefaultThreadFactory.java:<span class="number">137</span>) ~[netty-all-<span class="number">4.0</span>.<span class="number">23</span>.<span class="keyword">Final</span>.jar:<span class="number">4.0</span>.<span class="number">23</span>.<span class="keyword">Final</span>]</span><br><span class="line">        at java.lang.Thread.run(Thread.java:<span class="number">745</span>) [na:<span class="number">1.7</span>.<span class="number">0</span>_71]</span><br></pre></td></tr></table></figure>
<h2 id="sstable_writer">sstable writer</h2><blockquote>
<p>Loads newly placed SSTables onto the system without a restart.</p>
</blockquote>
<p><a href="http://www.planetcassandra.org/blog/bulk-loading-options-for-cassandra/" target="_blank" rel="external">http://www.planetcassandra.org/blog/bulk-loading-options-for-cassandra/</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">小批量测试</span><br><span class="line">cp /home/admin/md5id_20160601/data/md5_id/data-md5_id-ka-<span class="number">2165</span>* </span><br><span class="line"><span class="built_in">cd</span> ~/cassandra/data/md5/md5_id<span class="operator">-f</span>88d3930345811e694a62bcdca057dae/ </span><br><span class="line">rename data md5 *</span><br><span class="line">nodetool -h <span class="number">192.168</span>.<span class="number">47.202</span> refresh md5 md5_id</span><br><span class="line"></span><br><span class="line"><span class="comment">#重命名所有文件</span></span><br><span class="line"><span class="built_in">cd</span> /home/admin/md5id_20160601/data/md5_id/</span><br><span class="line">rename data md5 * </span><br><span class="line"></span><br><span class="line"><span class="comment">#找出所有不同编号</span></span><br><span class="line"><span class="keyword">for</span> f <span class="keyword">in</span> $( ls | cut <span class="operator">-d</span><span class="string">'-'</span> <span class="operator">-f</span>-<span class="number">4</span> | uniq | head -<span class="number">5</span> ); <span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$f</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#一次多个，但是如何循环所有，直到文件夹都处理完毕？ --》使用while循环判断文件夹下存在文件时处理</span></span><br><span class="line">ls | cut <span class="operator">-d</span><span class="string">'-'</span> <span class="operator">-f</span>-<span class="number">4</span> | uniq | head -<span class="number">5</span> | <span class="keyword">while</span> <span class="built_in">read</span> f; <span class="keyword">do</span>   <span class="comment">#分组，一次可以多个数据文件，而一个数据文件总共包含8个相关组件</span></span><br><span class="line">  mv <span class="variable">$f</span>-* ~/cassandra/data/md5/md5_id<span class="operator">-f</span>88d3930345811e694a62bcdca057dae/   <span class="comment">#移动到cassandra的目标位置</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">nodetool -h <span class="number">192.168</span>.<span class="number">47.202</span> refresh md5 md5_id         <span class="comment">#刷新sstable</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#模拟把分多次把一个文件夹test的文件搬到另一个文件夹test1</span></span><br><span class="line">rm -rf <span class="built_in">test</span> <span class="built_in">test</span>1 &amp;&amp; mkdir <span class="built_in">test</span> &amp;&amp; <span class="built_in">cd</span> <span class="built_in">test</span> &amp;&amp; touch <span class="number">10</span> <span class="number">11</span> <span class="number">12</span> <span class="number">13</span> <span class="number">14</span> <span class="number">15</span> <span class="number">20</span> <span class="number">21</span> <span class="number">22</span> <span class="number">23</span> <span class="number">30</span> <span class="number">31</span> <span class="number">32</span> &amp;&amp; <span class="built_in">cd</span> ~/ &amp;&amp; mkdir <span class="built_in">test</span>1 </span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="built_in">test</span></span><br><span class="line">flag=<span class="string">"BEGIN"</span></span><br><span class="line"><span class="keyword">while</span> [ ! <span class="operator">-d</span> <span class="built_in">test</span> ]; <span class="keyword">do</span></span><br><span class="line">  ls | head -<span class="number">2</span> | <span class="keyword">while</span> <span class="built_in">read</span> f; <span class="keyword">do</span> </span><br><span class="line">    mv <span class="variable">$f</span> ~/<span class="built_in">test</span>1</span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line">  <span class="comment">#确保只需要执行一次, test的文件都被移动到test1后，test下没有文件，判断依据是：ls -A为空</span></span><br><span class="line">  <span class="comment">#但是如果没有加任何条件，while循环会无条件判断，因为while中是判断存在文件夹</span></span><br><span class="line">  <span class="keyword">if</span> [[ <span class="string">"`ls -A ~/test`"</span> = <span class="string">""</span> &amp;&amp; <span class="variable">$flag</span> != <span class="string">"OVER"</span> ]]; <span class="keyword">then</span></span><br><span class="line">    flag=<span class="string">"OVER"</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"DONE"</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#可以把判断放在while循环里！--GOOD</span></span><br><span class="line"><span class="built_in">cd</span> <span class="built_in">test</span></span><br><span class="line">flag=<span class="string">"BEGIN"</span></span><br><span class="line"><span class="keyword">while</span> [[ ! <span class="operator">-d</span> <span class="built_in">test</span> &amp;&amp; <span class="variable">$flag</span> != <span class="string">"OVER"</span> ]]; <span class="keyword">do</span></span><br><span class="line">  ls | head -<span class="number">2</span> | <span class="keyword">while</span> <span class="built_in">read</span> f; <span class="keyword">do</span> </span><br><span class="line">    mv <span class="variable">$f</span> ~/<span class="built_in">test</span>1</span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"`ls -A ~/test`"</span> = <span class="string">""</span> ]; <span class="keyword">then</span></span><br><span class="line">    flag=<span class="string">"OVER"</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"OVER..."</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#当然可以把if的所有条件都放到while里</span></span><br><span class="line"><span class="built_in">cd</span> <span class="built_in">test</span></span><br><span class="line"><span class="keyword">while</span> [[ ! <span class="operator">-d</span> <span class="built_in">test</span> &amp;&amp; <span class="string">"`ls -A ~/test`"</span> != <span class="string">""</span> ]]; <span class="keyword">do</span></span><br><span class="line">  ls | head -<span class="number">2</span> | <span class="keyword">while</span> <span class="built_in">read</span> f; <span class="keyword">do</span> </span><br><span class="line">    mv <span class="variable">$f</span> ~/<span class="built_in">test</span>1</span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"OVER..."</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##最终脚本</span></span><br><span class="line">startT=$(date +%s)</span><br><span class="line"><span class="built_in">cd</span> /home/admin/md5id_20160601/data/md5_id</span><br><span class="line"><span class="keyword">while</span> [[ ! <span class="operator">-d</span> /home/admin/md5id_20160601/data/md5_id &amp;&amp;  <span class="string">"`ls -A /home/admin/md5id_20160601/data/md5_id`"</span> != <span class="string">""</span> ]]; <span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"......"</span></span><br><span class="line">  start=$(date +%s)</span><br><span class="line">  ls | cut <span class="operator">-d</span><span class="string">'-'</span> <span class="operator">-f</span>-<span class="number">4</span> | uniq | head -<span class="number">5</span> | <span class="keyword">while</span> <span class="built_in">read</span> f; <span class="keyword">do</span></span><br><span class="line">    cfile=<span class="string">"<span class="variable">$f</span>-*"</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$cfile</span></span><br><span class="line">    mv <span class="variable">$cfile</span> /home/admin/cassandra/data/md5/md5_id<span class="operator">-f</span>88d3930345811e694a62bcdca057dae/</span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line">  nodetool -h <span class="number">192.168</span>.<span class="number">47.202</span> refresh md5 md5_id</span><br><span class="line">  end=$(date +%s)</span><br><span class="line">  time=$(( <span class="variable">$end</span> - <span class="variable">$start</span> ))</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"耗时:<span class="variable">$time</span>"</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"OVER..."</span></span><br><span class="line">endT=$(date +%s)</span><br><span class="line">timeT=$(( <span class="variable">$endT</span> - <span class="variable">$startT</span> ))</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Total耗时:<span class="variable">$timeT</span>"</span></span><br></pre></td></tr></table></figure>
<p>ONLY ONE SHELL: IF RUN TOO LONG, JUST <code>CTRL+z, bg, jobs</code>:  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/admin/md5id_20160601/data/md5_id</span><br><span class="line">ls | cut <span class="operator">-d</span><span class="string">'-'</span> <span class="operator">-f</span>-<span class="number">4</span> | uniq | <span class="keyword">while</span> <span class="built_in">read</span> f; <span class="keyword">do</span> <span class="built_in">echo</span> <span class="string">"batch <span class="variable">$f</span>"</span>; mv <span class="variable">$f</span>-* /home/admin/cassandra/data/md5/md5_id<span class="operator">-f</span>88d3930345811e694a62bcdca057dae/; nodetool -h <span class="number">192.168</span>.<span class="number">47.202</span> refresh md5 md5_id; <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<h3 id="文件数过多">文件数过多</h3><p>大批量同时进行，报错生成hs_err_pid9998.log</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line"># There is insufficient memory for the Java Runtime Environment to continue.</span><br><span class="line"># Native memory allocation (malloc) failed to allocate 350224384 bytes for committing reserved memory.</span><br><span class="line"># Possible reasons:</span><br><span class="line">#   The system is out of physical RAM or swap space</span><br><span class="line">#   In 32 bit mode, the process size limit was hit</span><br><span class="line"># Possible solutions:</span><br><span class="line">#   Reduce memory <span class="operator"><span class="keyword">load</span> <span class="keyword">on</span> the <span class="keyword">system</span></span><br><span class="line">#   Increase <span class="keyword">physical</span> <span class="keyword">memory</span> <span class="keyword">or</span> swap <span class="keyword">space</span></span><br><span class="line">#   <span class="keyword">Check</span> <span class="keyword">if</span> swap backing <span class="keyword">store</span> <span class="keyword">is</span> <span class="keyword">full</span></span><br><span class="line">#   <span class="keyword">Use</span> <span class="number">64</span> <span class="built_in">bit</span> <span class="keyword">Java</span> <span class="keyword">on</span> a <span class="number">64</span> <span class="built_in">bit</span> OS</span><br><span class="line">#   Decrease <span class="keyword">Java</span> <span class="keyword">heap</span> <span class="keyword">size</span> (-Xmx/-Xms)</span><br><span class="line">#   Decrease <span class="built_in">number</span> <span class="keyword">of</span> <span class="keyword">Java</span> threads</span><br><span class="line">#   Decrease <span class="keyword">Java</span> <span class="keyword">thread</span> stack <span class="keyword">sizes</span> (-Xss)</span><br><span class="line">#   <span class="keyword">Set</span> larger code <span class="keyword">cache</span> <span class="keyword">with</span> -XX:ReservedCodeCacheSize=</span><br><span class="line"># This <span class="keyword">output</span> <span class="keyword">file</span> may be truncated <span class="keyword">or</span> incomplete.</span><br><span class="line">#</span><br><span class="line">#  <span class="keyword">Out</span> <span class="keyword">of</span> <span class="keyword">Memory</span> <span class="keyword">Error</span> (os_linux.cpp:<span class="number">2726</span>), pid=<span class="number">9998</span>, tid=<span class="number">140593796617984</span></span><br><span class="line">#</span><br><span class="line"># JRE <span class="keyword">version</span>:  (<span class="number">7.0</span>_51-b13) (<span class="keyword">build</span> )</span><br><span class="line"># <span class="keyword">Java</span> VM: <span class="keyword">Java</span> HotSpot(TM) <span class="number">64</span>-<span class="built_in">Bit</span> <span class="keyword">Server</span> VM (<span class="number">24.51</span>-b03 mixed <span class="keyword">mode</span> linux-amd64 compressed oops)</span><br><span class="line"># <span class="keyword">Failed</span> <span class="keyword">to</span> write core dump. Core dumps have been disabled. <span class="keyword">To</span> <span class="keyword">enable</span> core dumping, try <span class="string">"ulimit -c unlimited"</span> <span class="keyword">before</span> <span class="keyword">starting</span> <span class="keyword">Java</span> again</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line"><span class="comment">---------------  T H R E A D  ---------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Current</span> <span class="keyword">thread</span> (<span class="number">0x00007fde84009800</span>):  JavaThread <span class="string">"Unknown thread"</span> [_thread_in_vm, <span class="keyword">id</span>=<span class="number">10000</span>, stack(<span class="number">0x00007fde8b3e1000</span>,<span class="number">0x00007fde8b4e2000</span>)]</span><br><span class="line"></span><br><span class="line">Stack: [<span class="number">0x00007fde8b3e1000</span>,<span class="number">0x00007fde8b4e2000</span>],  sp=<span class="number">0x00007fde8b4e01a0</span>,  free <span class="keyword">space</span>=<span class="number">1020</span><span class="keyword">k</span></span><br><span class="line"><span class="keyword">Native</span> frames: (J=<span class="keyword">compiled</span> <span class="keyword">Java</span> code, j=interpreted, Vv=VM code, <span class="keyword">C</span>=<span class="keyword">native</span> code)</span><br><span class="line">V  [libjvm.so+<span class="number">0x992f4a</span>]  VMError::report_and_die()+<span class="number">0x2ea</span></span><br><span class="line">V  [libjvm.so+<span class="number">0x4931ab</span>]  report_vm_out_of_memory(<span class="built_in">char</span> const*, <span class="built_in">int</span>, <span class="keyword">unsigned</span> <span class="keyword">long</span>, <span class="built_in">char</span> const*)+<span class="number">0x9b</span></span><br><span class="line">V  [libjvm.so+<span class="number">0x81338e</span>]  os::Linux::commit_memory_impl(<span class="built_in">char</span>*, <span class="keyword">unsigned</span> <span class="keyword">long</span>, bool)+<span class="number">0xfe</span></span><br><span class="line">V  [libjvm.so+<span class="number">0x81383f</span>]  os::Linux::commit_memory_impl(<span class="built_in">char</span>*, <span class="keyword">unsigned</span> <span class="keyword">long</span>, <span class="keyword">unsigned</span> <span class="keyword">long</span>, bool)+<span class="number">0x4f</span></span><br><span class="line">V  [libjvm.so+<span class="number">0x813a2c</span>]  os::pd_commit_memory(<span class="built_in">char</span>*, <span class="keyword">unsigned</span> <span class="keyword">long</span>, <span class="keyword">unsigned</span> <span class="keyword">long</span>, bool)+<span class="number">0xc</span></span><br><span class="line">V  [libjvm.so+<span class="number">0x80daea</span>]  os::commit_memory(<span class="built_in">char</span>*, <span class="keyword">unsigned</span> <span class="keyword">long</span>, <span class="keyword">unsigned</span> <span class="keyword">long</span>, bool)+<span class="number">0x2a</span></span><br><span class="line">V  [libjvm.so+<span class="number">0x87fcd3</span>]  PSVirtualSpace::expand_by(<span class="keyword">unsigned</span> <span class="keyword">long</span>)+<span class="number">0x53</span></span><br><span class="line">V  [libjvm.so+<span class="number">0x86eaf3</span>]  PSOldGen::initialize(ReservedSpace, <span class="keyword">unsigned</span> <span class="keyword">long</span>, <span class="built_in">char</span> const*, <span class="built_in">int</span>)+<span class="number">0x103</span></span><br><span class="line">V  [libjvm.so+<span class="number">0x299043</span>]  AdjoiningGenerations::AdjoiningGenerations(ReservedSpace, <span class="keyword">unsigned</span> <span class="keyword">long</span>, <span class="keyword">unsigned</span> <span class="keyword">long</span>, <span class="keyword">unsigned</span> <span class="keyword">long</span>, <span class="keyword">unsigned</span> <span class="keyword">long</span>, <span class="keyword">unsigned</span> <span class="keyword">long</span>, <span class="keyword">unsigned</span> <span class="keyword">long</span>, <span class="keyword">unsigned</span> <span class="keyword">long</span>)+<span class="number">0x3e3</span></span><br><span class="line">V  [libjvm.so+<span class="number">0x8341e0</span>]  ParallelScavengeHeap::initialize()+<span class="number">0x550</span></span><br><span class="line">V  [libjvm.so+<span class="number">0x9664ca</span>]  Universe::initialize_heap()+<span class="number">0xca</span></span><br><span class="line">V  [libjvm.so+<span class="number">0x967699</span>]  universe_init()+<span class="number">0x79</span></span><br><span class="line">V  [libjvm.so+<span class="number">0x5a9625</span>]  init_globals()+<span class="number">0x65</span></span><br><span class="line">V  [libjvm.so+<span class="number">0x94ef8d</span>]  Threads::create_vm(JavaVMInitArgs*, bool*)+<span class="number">0x1ed</span></span><br><span class="line">V  [libjvm.so+<span class="number">0x6307e4</span>]  JNI_CreateJavaVM+<span class="number">0x74</span></span><br><span class="line"><span class="keyword">C</span>  [libjli.so+<span class="number">0x2f8e</span>]  JavaMain+<span class="number">0x9e</span></span></span><br></pre></td></tr></table></figure>
<p>因为内存不足，直接挂掉，日志文件中并不会有报错信息！</p>
<p>节点挂掉后，重启报错：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">ERROR <span class="number">01</span>:<span class="number">47</span>:<span class="number">33</span> Exception encountered during startup</span><br><span class="line">org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.io</span><span class="class">.FSReadError</span>: java<span class="class">.lang</span><span class="class">.NullPointerException</span></span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.db</span><span class="class">.ColumnFamilyStore</span><span class="class">.removeUnfinishedCompactionLeftovers</span>(ColumnFamilyStore<span class="class">.java</span>:<span class="number">668</span>) ~[apache-cassandra-<span class="number">2.1</span>.<span class="number">13</span><span class="class">.jar</span>:<span class="number">2.1</span>.<span class="number">13</span>]</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.service</span><span class="class">.CassandraDaemon</span><span class="class">.setup</span>(CassandraDaemon<span class="class">.java</span>:<span class="number">308</span>) [apache-cassandra-<span class="number">2.1</span>.<span class="number">13</span><span class="class">.jar</span>:<span class="number">2.1</span>.<span class="number">13</span>]</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.service</span><span class="class">.CassandraDaemon</span><span class="class">.activate</span>(CassandraDaemon<span class="class">.java</span>:<span class="number">564</span>) [apache-cassandra-<span class="number">2.1</span>.<span class="number">13</span><span class="class">.jar</span>:<span class="number">2.1</span>.<span class="number">13</span>]</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.service</span><span class="class">.CassandraDaemon</span><span class="class">.main</span>(CassandraDaemon<span class="class">.java</span>:<span class="number">653</span>) [apache-cassandra-<span class="number">2.1</span>.<span class="number">13</span><span class="class">.jar</span>:<span class="number">2.1</span>.<span class="number">13</span>]</span><br><span class="line">Caused by: java<span class="class">.lang</span><span class="class">.NullPointerException</span>: null</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.db</span><span class="class">.ColumnFamilyStore</span><span class="class">.removeUnfinishedCompactionLeftovers</span>(ColumnFamilyStore<span class="class">.java</span>:<span class="number">660</span>) ~[apache-cassandra-<span class="number">2.1</span>.<span class="number">13</span><span class="class">.jar</span>:<span class="number">2.1</span>.<span class="number">13</span>]</span><br><span class="line">  ... <span class="number">3</span> common frames omitted</span><br><span class="line">FSReadError <span class="keyword">in</span> Failed to remove unfinished compaction leftovers (file: /home/admin/cassandra/data/md5/md5_id-f88d3930345811e694a62bcdca057dae/md5-md5_id-ka-<span class="number">1051</span>-Statistics.db).  See log <span class="keyword">for</span> <span class="tag">details</span>.</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.db</span><span class="class">.ColumnFamilyStore</span><span class="class">.removeUnfinishedCompactionLeftovers</span>(ColumnFamilyStore<span class="class">.java</span>:<span class="number">668</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.service</span><span class="class">.CassandraDaemon</span><span class="class">.setup</span>(CassandraDaemon<span class="class">.java</span>:<span class="number">308</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.service</span><span class="class">.CassandraDaemon</span><span class="class">.activate</span>(CassandraDaemon<span class="class">.java</span>:<span class="number">564</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.service</span><span class="class">.CassandraDaemon</span><span class="class">.main</span>(CassandraDaemon<span class="class">.java</span>:<span class="number">653</span>)</span><br><span class="line">Caused by: java<span class="class">.lang</span><span class="class">.NullPointerException</span></span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.db</span><span class="class">.ColumnFamilyStore</span><span class="class">.removeUnfinishedCompactionLeftovers</span>(ColumnFamilyStore<span class="class">.java</span>:<span class="number">660</span>)</span><br><span class="line">  ... <span class="number">3</span> more</span><br><span class="line">Exception encountered during startup: java<span class="class">.lang</span><span class="class">.NullPointerException</span></span><br><span class="line"></span><br><span class="line">Polling page always armed</span><br><span class="line">Deoptimize                         <span class="number">4</span></span><br><span class="line">GenCollectForAllocation            <span class="number">1</span></span><br><span class="line">CMS_Initial_Mark                   <span class="number">1</span></span><br><span class="line">CMS_Final_Remark                   <span class="number">1</span></span><br><span class="line">EnableBiasedLocking                <span class="number">1</span></span><br><span class="line">RevokeBias                        <span class="number">77</span></span><br><span class="line">BulkRevokeBias                     <span class="number">5</span></span><br><span class="line">Exit                               <span class="number">1</span></span><br><span class="line">   <span class="number">15</span> VM operations coalesced during safepoint</span><br><span class="line">Maximum sync <span class="tag">time</span>   <span class="number">6133</span> ms</span><br><span class="line">Maximum vm operation <span class="tag">time</span> (except <span class="keyword">for</span> Exit VM operation)    <span class="number">521</span> ms</span><br></pre></td></tr></table></figure>
<p>正常来说，一个Data文件附属多个其他组件</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">正常的文件</span><br><span class="line">[admin@cass047202 md5_id-f88d3930345811e694a62bcdca057dae]$ ll md5-md5_id-ka-<span class="number">996</span>-*</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin     <span class="number">66859</span> <span class="number">6</span>月   <span class="number">2</span> <span class="number">23</span>:<span class="number">06</span> md5-md5_id-ka-<span class="number">996</span>-CompressionInfo.db</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin <span class="number">298635289</span> <span class="number">6</span>月   <span class="number">2</span> <span class="number">23</span>:<span class="number">06</span> md5-md5_id-ka-<span class="number">996</span>-Data.db</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin        <span class="number">10</span> <span class="number">6</span>月   <span class="number">2</span> <span class="number">23</span>:<span class="number">06</span> md5-md5_id-ka-<span class="number">996</span>-Digest.sha1</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin        <span class="number">16</span> <span class="number">6</span>月   <span class="number">2</span> <span class="number">23</span>:<span class="number">06</span> md5-md5_id-ka-<span class="number">996</span>-Filter.db</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin <span class="number">242118240</span> <span class="number">6</span>月   <span class="number">2</span> <span class="number">23</span>:<span class="number">06</span> md5-md5_id-ka-<span class="number">996</span>-Index.db</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin      <span class="number">9895</span> <span class="number">6</span>月  <span class="number">17</span> <span class="number">17</span>:<span class="number">53</span> md5-md5_id-ka-<span class="number">996</span>-Statistics.db</span><br><span class="line">-rw-r--r--. <span class="number">1</span> admin admin    <span class="number">113248</span> <span class="number">6</span>月  <span class="number">16</span> <span class="number">16</span>:<span class="number">23</span> md5-md5_id-ka-<span class="number">996</span>-Summary.db</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin        <span class="number">91</span> <span class="number">6</span>月   <span class="number">2</span> <span class="number">23</span>:<span class="number">06</span> md5-md5_id-ka-<span class="number">996</span>-TOC.txt</span><br><span class="line"></span><br><span class="line">但是报错的这个文件只有三个，没有statics等。。。</span><br><span class="line">[admin@cass047202 md5_id-f88d3930345811e694a62bcdca057dae]$ ll md5-md5_id-ka-<span class="number">1051</span>*</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin <span class="number">282</span>M <span class="number">6</span>月   <span class="number">1</span> <span class="number">17</span>:<span class="number">56</span> /home/admin/cassandra/data/md5/md5_id-f88d3930345811e694a62bcdca057dae/md5-md5_id-ka-<span class="number">1051</span>-Data.db</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin <span class="number">231</span>M <span class="number">6</span>月   <span class="number">1</span> <span class="number">17</span>:<span class="number">56</span> /home/admin/cassandra/data/md5/md5_id-f88d3930345811e694a62bcdca057dae/md5-md5_id-ka-<span class="number">1051</span>-Index.db</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin <span class="number">1.8</span>M <span class="number">6</span>月  <span class="number">17</span> <span class="number">17</span>:<span class="number">55</span> /home/admin/cassandra/data/md5/md5_id-f88d3930345811e694a62bcdca057dae/md5-md5_id-ka-<span class="number">1051</span>-Summary.db</span><br><span class="line"></span><br><span class="line">tmp临时文件中也没有</span><br><span class="line">[admin@cass047202 md5_id-f88d3930345811e694a62bcdca057dae]$ ll | grep tmp</span><br><span class="line">-rw-rw-r--. <span class="number">2</span> admin admin <span class="number">9967157248</span> <span class="number">6</span>月  <span class="number">17</span> <span class="number">18</span>:<span class="number">54</span> md5-md5_id-tmp-ka-<span class="number">354</span>-Data.db</span><br><span class="line">-rw-rw-r--. <span class="number">2</span> admin admin <span class="number">7710769152</span> <span class="number">6</span>月  <span class="number">17</span> <span class="number">18</span>:<span class="number">54</span> md5-md5_id-tmp-ka-<span class="number">354</span>-Index.db</span><br><span class="line">-rw-rw-r--. <span class="number">2</span> admin admin <span class="number">1224817304</span> <span class="number">6</span>月  <span class="number">17</span> <span class="number">10</span>:<span class="number">01</span> md5-md5_id-tmp-ka-<span class="number">4329</span>-Data.db</span><br><span class="line">-rw-rw-r--. <span class="number">2</span> admin admin  <span class="number">950730752</span> <span class="number">6</span>月  <span class="number">17</span> <span class="number">10</span>:<span class="number">01</span> md5-md5_id-tmp-ka-<span class="number">4329</span>-Index.db</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin          <span class="number">0</span> <span class="number">6</span>月  <span class="number">17</span> <span class="number">18</span>:<span class="number">54</span> md5-md5_id-tmp-ka-<span class="number">48053</span>-Data.db</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin          <span class="number">0</span> <span class="number">6</span>月  <span class="number">17</span> <span class="number">18</span>:<span class="number">54</span> md5-md5_id-tmp-ka-<span class="number">48053</span>-Index.db</span><br><span class="line">-rw-rw-r--. <span class="number">2</span> admin admin <span class="number">9049241296</span> <span class="number">6</span>月  <span class="number">17</span> <span class="number">18</span>:<span class="number">54</span> md5-md5_id-tmp-ka-<span class="number">526</span>-Data.db</span><br><span class="line">-rw-rw-r--. <span class="number">2</span> admin admin <span class="number">6999441408</span> <span class="number">6</span>月  <span class="number">17</span> <span class="number">18</span>:<span class="number">54</span> md5-md5_id-tmp-ka-<span class="number">526</span>-Index.db</span><br><span class="line">-rw-rw-r--. <span class="number">2</span> admin admin <span class="number">9967157248</span> <span class="number">6</span>月  <span class="number">17</span> <span class="number">18</span>:<span class="number">54</span> md5-md5_id-tmplink-ka-<span class="number">354</span>-Data.db</span><br><span class="line">-rw-rw-r--. <span class="number">2</span> admin admin <span class="number">7710769152</span> <span class="number">6</span>月  <span class="number">17</span> <span class="number">18</span>:<span class="number">54</span> md5-md5_id-tmplink-ka-<span class="number">354</span>-Index.db</span><br><span class="line">-rw-rw-r--. <span class="number">2</span> admin admin <span class="number">1224817304</span> <span class="number">6</span>月  <span class="number">17</span> <span class="number">10</span>:<span class="number">01</span> md5-md5_id-tmplink-ka-<span class="number">4329</span>-Data.db</span><br><span class="line">-rw-rw-r--. <span class="number">2</span> admin admin  <span class="number">950730752</span> <span class="number">6</span>月  <span class="number">17</span> <span class="number">10</span>:<span class="number">01</span> md5-md5_id-tmplink-ka-<span class="number">4329</span>-Index.db</span><br><span class="line">-rw-rw-r--. <span class="number">2</span> admin admin <span class="number">9049241296</span> <span class="number">6</span>月  <span class="number">17</span> <span class="number">18</span>:<span class="number">54</span> md5-md5_id-tmplink-ka-<span class="number">526</span>-Data.db</span><br><span class="line">-rw-rw-r--. <span class="number">2</span> admin admin <span class="number">6999441408</span> <span class="number">6</span>月  <span class="number">17</span> <span class="number">18</span>:<span class="number">54</span> md5-md5_id-tmplink-ka-<span class="number">526</span>-Index.db</span><br></pre></td></tr></table></figure>
<p>删除这些文件后， 重启没有问题，但是查询时报错：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">WARN  [SharedPool-Worker-<span class="number">52</span>] <span class="number">2016</span>-<span class="number">06</span>-<span class="number">19</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">30</span>,<span class="number">376</span> AbstractTracingAwareExecutorService.<span class="string">java:</span><span class="number">169</span> - Uncaught exception on thread Thread[SharedPool-Worker-<span class="number">52</span>,<span class="number">5</span>,main]: &#123;&#125;</span><br><span class="line">java.lang.<span class="string">RuntimeException:</span> java.lang.<span class="string">RuntimeException:</span> java.io.<span class="string">FileNotFoundException:</span> <span class="regexp">/home/</span>admin<span class="regexp">/cassandra/</span>data<span class="regexp">/md5/</span>md5_id-f88d3930345811e694a62bcdca057dae/md5-md5_id-ka-<span class="number">139</span>-Data.db (打开的文件过&gt;多)</span><br><span class="line">        at org.apache.cassandra.service.StorageProxy$DroppableRunnable.run(StorageProxy.<span class="string">java:</span><span class="number">2244</span>) ~[apache-cassandra-<span class="number">2.1</span><span class="number">.13</span>.<span class="string">jar:</span><span class="number">2.1</span><span class="number">.13</span>]</span><br><span class="line">        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.<span class="string">java:</span><span class="number">471</span>) ~[<span class="string">na:</span><span class="number">1.7</span><span class="number">.0</span>_51]</span><br><span class="line">        at org.apache.cassandra.concurrent.AbstractTracingAwareExecutorService$FutureTask.run(AbstractTracingAwareExecutorService.<span class="string">java:</span><span class="number">164</span>) ~[apache-cassandra-<span class="number">2.1</span><span class="number">.13</span>.<span class="string">jar:</span><span class="number">2.1</span><span class="number">.13</span>]</span><br><span class="line">        at org.apache.cassandra.concurrent.SEPWorker.run(SEPWorker.<span class="string">java:</span><span class="number">105</span>) [apache-cassandra-<span class="number">2.1</span><span class="number">.13</span>.<span class="string">jar:</span><span class="number">2.1</span><span class="number">.13</span>]</span><br><span class="line">        at java.lang.Thread.run(Thread.<span class="string">java:</span><span class="number">744</span>) [<span class="string">na:</span><span class="number">1.7</span><span class="number">.0</span>_51]</span><br><span class="line">Caused <span class="string">by:</span> java.lang.<span class="string">RuntimeException:</span> java.io.<span class="string">FileNotFoundException:</span> <span class="regexp">/home/</span>admin<span class="regexp">/cassandra/</span>data<span class="regexp">/md5/</span>md5_id-f88d3930345811e694a62bcdca057dae/md5-md5_id-ka-<span class="number">139</span>-Data.db (打开的文件过多)</span><br><span class="line">        at org.apache.cassandra.io.compress.CompressedRandomAccessReader.open(CompressedRandomAccessReader.<span class="string">java:</span><span class="number">52</span>) ~[apache-cassandra-<span class="number">2.1</span><span class="number">.13</span>.<span class="string">jar:</span><span class="number">2.1</span><span class="number">.13</span>]</span><br><span class="line">        at org.apache.cassandra.io.util.CompressedPoolingSegmentedFile.createReader(CompressedPoolingSegmentedFile.<span class="string">java:</span><span class="number">85</span>) ~[apache-cassandra-<span class="number">2.1</span><span class="number">.13</span>.<span class="string">jar:</span><span class="number">2.1</span><span class="number">.13</span>]</span><br><span class="line">        at org.apache.cassandra.io.sstable.SSTableReader.openDataReader(SSTableReader.<span class="string">java:</span><span class="number">2075</span>) ~[apache-cassandra-<span class="number">2.1</span><span class="number">.13</span>.<span class="string">jar:</span><span class="number">2.1</span><span class="number">.13</span>]</span><br><span class="line">        at org.apache.cassandra.io.sstable.SSTableScanner.&lt;init&gt;(SSTableScanner.<span class="string">java:</span><span class="number">84</span>) ~[apache-cassandra-<span class="number">2.1</span><span class="number">.13</span>.<span class="string">jar:</span><span class="number">2.1</span><span class="number">.13</span>]</span><br><span class="line">        at org.apache.cassandra.io.sstable.SSTableScanner.getScanner(SSTableScanner.<span class="string">java:</span><span class="number">63</span>) ~[apache-cassandra-<span class="number">2.1</span><span class="number">.13</span>.<span class="string">jar:</span><span class="number">2.1</span><span class="number">.13</span>]</span><br><span class="line">        at org.apache.cassandra.io.sstable.SSTableReader.getScanner(SSTableReader.<span class="string">java:</span><span class="number">1859</span>) ~[apache-cassandra-<span class="number">2.1</span><span class="number">.13</span>.<span class="string">jar:</span><span class="number">2.1</span><span class="number">.13</span>]</span><br><span class="line">        at org.apache.cassandra.db.RowIteratorFactory.getIterator(RowIteratorFactory.<span class="string">java:</span><span class="number">67</span>) ~[apache-cassandra-<span class="number">2.1</span><span class="number">.13</span>.<span class="string">jar:</span><span class="number">2.1</span><span class="number">.13</span>]</span><br><span class="line">        at org.apache.cassandra.db.ColumnFamilyStore.getSequentialIterator(ColumnFamilyStore.<span class="string">java:</span><span class="number">2074</span>) ~[apache-cassandra-<span class="number">2.1</span><span class="number">.13</span>.<span class="string">jar:</span><span class="number">2.1</span><span class="number">.13</span>]</span><br><span class="line">        at org.apache.cassandra.db.ColumnFamilyStore.getRangeSlice(ColumnFamilyStore.<span class="string">java:</span><span class="number">2191</span>) ~[apache-cassandra-<span class="number">2.1</span><span class="number">.13</span>.<span class="string">jar:</span><span class="number">2.1</span><span class="number">.13</span>]</span><br><span class="line">        at org.apache.cassandra.db.RangeSliceCommand.executeLocally(RangeSliceCommand.<span class="string">java:</span><span class="number">132</span>) ~[apache-cassandra-<span class="number">2.1</span><span class="number">.13</span>.<span class="string">jar:</span><span class="number">2.1</span><span class="number">.13</span>]</span><br><span class="line">        at org.apache.cassandra.service.StorageProxy$LocalRangeSliceRunnable.runMayThrow(StorageProxy.<span class="string">java:</span><span class="number">1567</span>) ~[apache-cassandra-<span class="number">2.1</span><span class="number">.13</span>.<span class="string">jar:</span><span class="number">2.1</span><span class="number">.13</span>]</span><br><span class="line">        at org.apache.cassandra.service.StorageProxy$DroppableRunnable.run(StorageProxy.<span class="string">java:</span><span class="number">2241</span>) ~[apache-cassandra-<span class="number">2.1</span><span class="number">.13</span>.<span class="string">jar:</span><span class="number">2.1</span><span class="number">.13</span>]</span><br><span class="line">        ... <span class="number">4</span> common frames omitted</span><br><span class="line">Caused <span class="string">by:</span> java.io.<span class="string">FileNotFoundException:</span> <span class="regexp">/home/</span>admin<span class="regexp">/cassandra/</span>data<span class="regexp">/md5/</span>md5_id-f88d3930345811e694a62bcdca057dae/md5-md5_id-ka-<span class="number">139</span>-Data.db (打开的文件过多)</span><br><span class="line">        at java.io.RandomAccessFile.open(Native Method) ~[<span class="string">na:</span><span class="number">1.7</span><span class="number">.0</span>_51]</span><br><span class="line">        at java.io.RandomAccessFile.&lt;init&gt;(RandomAccessFile.<span class="string">java:</span><span class="number">241</span>) ~[<span class="string">na:</span><span class="number">1.7</span><span class="number">.0</span>_51]</span><br><span class="line">        at org.apache.cassandra.io.util.RandomAccessReader.&lt;init&gt;(RandomAccessReader.<span class="string">java:</span><span class="number">65</span>) ~[apache-cassandra-<span class="number">2.1</span><span class="number">.13</span>.<span class="string">jar:</span><span class="number">2.1</span><span class="number">.13</span>]</span><br><span class="line">        at org.apache.cassandra.io.compress.CompressedRandomAccessReader.&lt;init&gt;(CompressedRandomAccessReader.<span class="string">java:</span><span class="number">70</span>) ~[apache-cassandra-<span class="number">2.1</span><span class="number">.13</span>.<span class="string">jar:</span><span class="number">2.1</span><span class="number">.13</span>]</span><br><span class="line">        at org.apache.cassandra.io.compress.CompressedRandomAccessReader.open(CompressedRandomAccessReader.<span class="string">java:</span><span class="number">48</span>) ~[apache-cassandra-<span class="number">2.1</span><span class="number">.13</span>.<span class="string">jar:</span><span class="number">2.1</span><span class="number">.13</span>]</span><br><span class="line">        ... <span class="number">15</span> common frames omitted</span><br><span class="line"></span><br><span class="line">WARN  [epollEventLoopGroup-<span class="number">2</span>-<span class="number">1</span>] <span class="number">2016</span>-<span class="number">06</span>-<span class="number">19</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">54</span>,<span class="number">839</span> Slf4JLogger.<span class="string">java:</span><span class="number">151</span> - An exceptionCaught() event was fired, and it reached at the tail of the pipeline. It usually means the last handler <span class="keyword">in</span> the pipeline did not handle the exception.</span><br><span class="line">java.io.<span class="string">IOException:</span> Error during accept(...): 打开的文件过多</span><br><span class="line">  at io.netty.channel.epoll.Native.accept(Native Method) ~[netty-all-<span class="number">4.0</span><span class="number">.23</span>.Final.<span class="string">jar:</span><span class="number">4.0</span><span class="number">.23</span>.Final]</span><br><span class="line">  at io.netty.channel.epoll.EpollServerSocketChannel$EpollServerSocketUnsafe.epollInReady(EpollServerSocketChannel.<span class="string">java:</span><span class="number">102</span>) ~[netty-all-<span class="number">4.0</span><span class="number">.23</span>.Final.<span class="string">jar:</span><span class="number">4.0</span><span class="number">.23</span>.Final]</span><br><span class="line">  at io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.<span class="string">java:</span><span class="number">326</span>) [netty-all-<span class="number">4.0</span><span class="number">.23</span>.Final.<span class="string">jar:</span><span class="number">4.0</span><span class="number">.23</span>.Final]</span><br><span class="line">  at io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.<span class="string">java:</span><span class="number">264</span>) [netty-all-<span class="number">4.0</span><span class="number">.23</span>.Final.<span class="string">jar:</span><span class="number">4.0</span><span class="number">.23</span>.Final]</span><br><span class="line">  at io.netty.util.concurrent.SingleThreadEventExecutor$<span class="number">2.</span>run(SingleThreadEventExecutor.<span class="string">java:</span><span class="number">116</span>) [netty-all-<span class="number">4.0</span><span class="number">.23</span>.Final.<span class="string">jar:</span><span class="number">4.0</span><span class="number">.23</span>.Final]</span><br><span class="line">  at io.netty.util.concurrent.DefaultThreadFactory$DefaultRunnableDecorator.run(DefaultThreadFactory.<span class="string">java:</span><span class="number">137</span>) [netty-all-<span class="number">4.0</span><span class="number">.23</span>.Final.<span class="string">jar:</span><span class="number">4.0</span><span class="number">.23</span>.Final]</span><br><span class="line">  at java.lang.Thread.run(Thread.<span class="string">java:</span><span class="number">744</span>) [<span class="string">na:</span><span class="number">1.7</span><span class="number">.0</span>_51]</span><br></pre></td></tr></table></figure>
<p>文件夹数过多：–&gt;生成时确保每个文件大点，比如1G</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[admin@cass047202 md5_id-f88d3930345811e694a62bcdca057dae]$ ll -rth | grep Data | wc -l</span><br><span class="line"><span class="number">2127</span></span><br><span class="line">[admin@cass047202 md5_id-f88d3930345811e694a62bcdca057dae]$ ll -rth | grep Data | head</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin <span class="number">281</span>M <span class="number">6</span>月   <span class="number">1</span> <span class="number">11</span>:<span class="number">20</span> md5-md5_id-ka-<span class="number">4225</span>-Data.db</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin <span class="number">282</span>M <span class="number">6</span>月   <span class="number">1</span> <span class="number">11</span>:<span class="number">21</span> md5-md5_id-ka-<span class="number">46880</span>-Data.db</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin <span class="number">285</span>M <span class="number">6</span>月   <span class="number">1</span> <span class="number">11</span>:<span class="number">22</span> md5-md5_id-ka-<span class="number">632</span>-Data.db</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin <span class="number">284</span>M <span class="number">6</span>月   <span class="number">1</span> <span class="number">11</span>:<span class="number">23</span> md5-md5_id-ka-<span class="number">47652</span>-Data.db</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin <span class="number">281</span>M <span class="number">6</span>月   <span class="number">1</span> <span class="number">11</span>:<span class="number">25</span> md5-md5_id-ka-<span class="number">3954</span>-Data.db</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin <span class="number">287</span>M <span class="number">6</span>月   <span class="number">1</span> <span class="number">11</span>:<span class="number">26</span> md5-md5_id-ka-<span class="number">47131</span>-Data.db</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin <span class="number">281</span>M <span class="number">6</span>月   <span class="number">1</span> <span class="number">11</span>:<span class="number">27</span> md5-md5_id-ka-<span class="number">1002</span>-Data.db</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin <span class="number">281</span>M <span class="number">6</span>月   <span class="number">1</span> <span class="number">11</span>:<span class="number">28</span> md5-md5_id-ka-<span class="number">491</span>-Data.db</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin <span class="number">286</span>M <span class="number">6</span>月   <span class="number">1</span> <span class="number">11</span>:<span class="number">29</span> md5-md5_id-ka-<span class="number">210</span>-Data.db</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin <span class="number">281</span>M <span class="number">6</span>月   <span class="number">1</span> <span class="number">11</span>:<span class="number">30</span> md5-md5_id-ka-<span class="number">43627</span>-Data.db</span><br></pre></td></tr></table></figure>
<h3 id="导入数据后，用refresh">导入数据后，用refresh</h3><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">[admin@cass047202 cassandra]$ cqlsh <span class="number">192.168.47.202</span></span><br><span class="line">Connected to forseti_cluster at <span class="number">192.168.47.202</span>:9042.</span><br><span class="line">[cqlsh 5.0.1 | Cassandra 2.1.13 | CQL spec 3.2.1 | Native protocol v3]</span><br><span class="line">Use HELP for help.</span><br><span class="line">cqlsh&gt; use data<span class="comment">;</span></span><br><span class="line">cqlsh:data&gt; select * from md5_id limit 1<span class="comment">;</span></span><br><span class="line">Warning: schema version mismatch detected, which might be caused by DOWN nodes<span class="comment">; if this is not the case, check the schema versions of your nodes in system.local and system.peers.</span></span><br><span class="line">Schema metadata was not refreshed. See log for details.</span><br><span class="line">cqlsh:data&gt; quit</span><br><span class="line">[admin@cass047202 cassandra]$ cqlsh <span class="number">192.168.47.202</span></span><br><span class="line">Connection error: ('Unable to connect to any servers', &#123;'<span class="number">192.168.47.202</span>': OperationTimedOut('errors=None, last_host=None',)&#125;)</span><br><span class="line">[admin@cass047202 cassandra]$ nodetool status</span><br><span class="line">--  Address         Load       Tokens  Owns    Host ID                               Rack</span><br><span class="line">UN  <span class="number">192.168.47.206</span>  802.88 GB  256     ?       <span class="number">75f42842</span>-e3ac-4bbe-947d-<span class="number">6b7537a52</span>1da  RAC1</span><br><span class="line">UN  <span class="number">192.168.47.222</span>  670.08 GB  256     ?       1cc<span class="number">2c236-8</span>def-4f2b-<span class="number">8149-28d59</span>1fc6b05  RAC1</span><br><span class="line">UN  <span class="number">192.168.47.204</span>  627.63 GB  256     ?       91ad<span class="number">3d42-4207</span>-46fe-<span class="number">8188-34c3</span>f0b2dbd2  RAC1</span><br><span class="line">UN  <span class="number">192.168.47.221</span>  677.56 GB  256     ?       87e100ed-85c4-44cb-9d9f-<span class="number">2d602d01</span>6038  RAC1</span><br><span class="line">UN  <span class="number">192.168.47.205</span>  724.58 GB  256     ?       ac6313c8-e<span class="number">0b5-463</span>b-8f90-55dc<span class="number">0f59e476</span>  RAC1</span><br><span class="line">UN  <span class="number">192.168.47.202</span>  1.72 TB    256     ?       abaa0cbc-<span class="number">09d3-4990</span>-8698-ff4d2f2bb4f7  RAC1</span><br><span class="line">UN  <span class="number">192.168.47.203</span>  1.01 TB    256     ?       19b0b9cc-cad<span class="number">2-4b61-8</span>da<span class="number">6-95423</span>fe94af8  RAC1</span><br><span class="line">UN  <span class="number">192.168.47.224</span>  739.47 GB  256     ?       27e84abe-fb06-47ff-<span class="number">8861-130767</span>ee006b  RAC1</span><br><span class="line">UN  <span class="number">192.168.47.225</span>  677.46 GB  256     ?       216c67cf-de7d-<span class="number">4190-9d0</span>d-441fc16a7f71  RAC1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">select key,bootstrapped,broadcast_address,cluster_name,cql_version,data_center,gossip_generation,host_id,listen_address,native_protocol_version,partitioner,</span><br><span class="line">    rack,release_version,rpc_address,schema_version,thrift_version from system.local<span class="comment">;</span></span><br><span class="line"></span><br><span class="line"> key   | bootstrapped | broadcast_address | cluster_name    | cql_version | data_center | gossip_generation | host_id                              | listen_address | native_protocol_version |  rack | release_version | rpc_address    | schema_version                       | thrift_version</span><br><span class="line">-------+--------------+-------------------+-----------------+-------------+-------------+-------------------+--------------------------------------+----------------+-------------------------+-------+-----------------+----------------+--------------------------------------+----------------</span><br><span class="line"> local |    COMPLETED |    <span class="number">192.168.47.203</span> | forseti_cluster |       3.2.1 |         DC1 |        <span class="number">1464055043</span> | 19b0b9cc-cad<span class="number">2-4b61-8</span>da<span class="number">6-95423</span>fe94af8 | <span class="number">192.168.47.203</span> |                       3 |  RAC1 |          2.1.13 | <span class="number">192.168.47.203</span> | <span class="number">73e0e7c4</span>-03b1-3db6-8967-d7c0144faa5c |        19.39.0</span><br><span class="line"></span><br><span class="line">    select peer,data_center,host_id,preferred_ip,rack,release_version,rpc_address,schema_version from system.peers<span class="comment">;</span></span><br><span class="line"> peer           | data_center | host_id                              | preferred_ip | rack | release_version | rpc_address    | schema_version</span><br><span class="line">----------------+-------------+--------------------------------------+--------------+------+-----------------+----------------+--------------------------------------</span><br><span class="line"> <span class="number">192.168.47.205</span> |         DC1 | ac6313c8-e<span class="number">0b5-463</span>b-8f90-55dc<span class="number">0f59e476</span> |         null | RAC1 |          2.1.13 | <span class="number">192.168.47.205</span> | <span class="number">73e0e7c4</span>-03b1-3db6-8967-d7c0144faa5c</span><br><span class="line"> <span class="number">192.168.47.221</span> |         DC1 | 87e100ed-85c4-44cb-9d9f-<span class="number">2d602d01</span>6038 |         null | RAC1 |          2.1.13 | <span class="number">192.168.47.221</span> | <span class="number">73e0e7c4</span>-03b1-3db6-8967-d7c0144faa5c</span><br><span class="line"> <span class="number">192.168.47.202</span> |         DC1 | abaa0cbc-<span class="number">09d3-4990</span>-8698-ff4d2f2bb4f7 |         null | RAC1 |          2.1.13 | <span class="number">192.168.47.202</span> | <span class="number">73e0e7c4</span>-03b1-3db6-8967-d7c0144faa5c</span><br><span class="line"> <span class="number">192.168.47.225</span> |         DC1 | 216c67cf-de7d-<span class="number">4190-9d0</span>d-441fc16a7f71 |         null | RAC1 |          2.1.13 | <span class="number">192.168.47.225</span> | <span class="number">73e0e7c4</span>-03b1-3db6-8967-d7c0144faa5c</span><br><span class="line"> <span class="number">192.168.47.224</span> |         DC1 | 27e84abe-fb06-47ff-<span class="number">8861-130767</span>ee006b |         null | RAC1 |          2.1.13 | <span class="number">192.168.47.224</span> | <span class="number">73e0e7c4</span>-03b1-3db6-8967-d7c0144faa5c</span><br><span class="line"> <span class="number">192.168.47.204</span> |         DC1 | 91ad<span class="number">3d42-4207</span>-46fe-<span class="number">8188-34c3</span>f0b2dbd2 |         null | RAC1 |          2.1.13 | <span class="number">192.168.47.204</span> | <span class="number">73e0e7c4</span>-03b1-3db6-8967-d7c0144faa5c</span><br><span class="line"> <span class="number">192.168.47.206</span> |         DC1 | <span class="number">75f42842</span>-e3ac-4bbe-947d-<span class="number">6b7537a52</span>1da |         null | RAC1 |          2.1.13 | <span class="number">192.168.47.206</span> | <span class="number">73e0e7c4</span>-03b1-3db6-8967-d7c0144faa5c</span><br><span class="line"> <span class="number">192.168.47.222</span> |         DC1 | 1cc<span class="number">2c236-8</span>def-4f2b-<span class="number">8149-28d59</span>1fc6b05 |         null | RAC1 |          2.1.13 | <span class="number">192.168.47.222</span> | <span class="number">73e0e7c4</span>-03b1-3db6-8967-d7c0144faa5c</span><br><span class="line"></span><br><span class="line">[admin@cass047202 cassandra]$ nodetool describecluster</span><br><span class="line">Cluster Information:</span><br><span class="line">  Name: forseti_cluster</span><br><span class="line">  Snitch: org.apache.cassandra.locator.DynamicEndpointSnitch</span><br><span class="line">  Partitioner: org.apache.cassandra.dht.Murmur3Partitioner</span><br><span class="line">  Schema versions:</span><br><span class="line">    <span class="number">73e0e7c4</span>-03b1-3db6-8967-d7c0144faa5c: [<span class="number">192.168.47.206</span>, <span class="number">192.168.47.222</span>, <span class="number">192.168.47.221</span>, <span class="number">192.168.47.204</span>, <span class="number">192.168.47.205</span>, <span class="number">192.168.47.202</span>, <span class="number">192.168.47.203</span>, <span class="number">192.168.47.224</span>, <span class="number">192.168.47.225</span>]</span><br><span class="line"></span><br><span class="line">[admin@cass047202 cassandra]$ nodetool -h <span class="number">192.168.47.203</span> describecluster</span><br><span class="line">Cluster Information:</span><br><span class="line">  Name: forseti_cluster</span><br><span class="line">  Snitch: org.apache.cassandra.locator.DynamicEndpointSnitch</span><br><span class="line">  Partitioner: org.apache.cassandra.dht.Murmur3Partitioner</span><br><span class="line">  Schema versions:</span><br><span class="line">    <span class="number">73e0e7c4</span>-03b1-3db6-8967-d7c0144faa5c: [<span class="number">192.168.47.206</span>, <span class="number">192.168.47.222</span>, <span class="number">192.168.47.221</span>, <span class="number">192.168.47.204</span>, <span class="number">192.168.47.205</span>, <span class="number">192.168.47.203</span>, <span class="number">192.168.47.224</span>, <span class="number">192.168.47.225</span>]</span><br><span class="line">    UNREACHABLE: [<span class="number">192.168.47.202</span>] </span><br><span class="line"></span><br><span class="line">[admin@cass047203 ~]$ nodetool status</span><br><span class="line">--  Address         Load       Tokens  Owns    Host ID                               Rack</span><br><span class="line">UN  <span class="number">192.168.47.205</span>  724.58 GB  256     ?       ac6313c8-e<span class="number">0b5-463</span>b-8f90-55dc<span class="number">0f59e476</span>  RAC1</span><br><span class="line">DN  <span class="number">192.168.47.202</span>  1.72 TB    256     ?       abaa0cbc-<span class="number">09d3-4990</span>-8698-ff4d2f2bb4f7  RAC1</span><br><span class="line">UN  <span class="number">192.168.47.203</span>  1.01 TB    256     ?       19b0b9cc-cad<span class="number">2-4b61-8</span>da<span class="number">6-95423</span>fe94af8  RAC1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INFO  01:50:05 Harmless error reading saved cache /home/admin/cassandra/saved_caches/KeyCache-ba.db</span><br><span class="line">java.lang.RuntimeException: Cache schema version b48bf712-fad2-3951-bb18-aa<span class="number">178e738b30</span> does not match current schema version <span class="number">73e0e7c4</span>-03b1-3db6-8967-d7c0144faa5c</span><br><span class="line">  at org.apache.cassandra.cache.AutoSavingCache.loadSaved(AutoSavingCache.java:188) ~[apache-cassandra-2.1.13.jar:2.1.13]</span><br><span class="line">  at org.apache.cassandra.cache.AutoSavingCache$3.call(AutoSavingCache.java:148) [apache-cassandra-2.1.13.jar:2.1.13]</span><br><span class="line">  at org.apache.cassandra.cache.AutoSavingCache$3.call(AutoSavingCache.java:144) [apache-cassandra-2.1.13.jar:2.1.13]</span><br><span class="line">  at java.util.concurrent.FutureTask.run(FutureTask.java:262) [na:<span class="number">1.7.0_51</span>]</span><br><span class="line">  at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) [na:<span class="number">1.7.0_51</span>]</span><br><span class="line">  at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) [na:<span class="number">1.7.0_51</span>]</span><br><span class="line">  at java.lang.Thread.run(Thread.java:744) [na:<span class="number">1.7.0_51</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">只要不操作：select * from md5_id limit 1<span class="comment">;  其他节点就不会认为202DN掉了。</span></span><br></pre></td></tr></table></figure>
<h3 id="通过增大内存来增大sstable大小（内存不足）">通过增大内存来增大sstable大小（内存不足）</h3><p>内存为512M，每个数据文件和索引文件的大小都差不多（281M，231M）。能不能减少Index文件的占用？？</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[admin@cass047203 md5_id]$ ll -rth|grep Data | wc -l</span><br><span class="line"><span class="number">2576</span></span><br><span class="line">[admin@cass047203 md5_id]$ cd ..</span><br><span class="line">[admin@cass047203 data]$ du -sh *</span><br><span class="line"><span class="number">1.3</span>T    md5_id</span><br><span class="line">[admin@cass047204 md5_id]$ ll data-md5_id-ka-<span class="number">2010</span>-* -h</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin  <span class="number">66</span>K <span class="number">6</span>月   <span class="number">2</span> <span class="number">22</span>:<span class="number">26</span> data-md5_id-ka-<span class="number">2010</span>-CompressionInfo.db</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin <span class="number">281</span>M <span class="number">6</span>月   <span class="number">2</span> <span class="number">22</span>:<span class="number">26</span> data-md5_id-ka-<span class="number">2010</span>-Data.db</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin   <span class="number">10</span> <span class="number">6</span>月   <span class="number">2</span> <span class="number">22</span>:<span class="number">26</span> data-md5_id-ka-<span class="number">2010</span>-Digest.sha1</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin   <span class="number">16</span> <span class="number">6</span>月   <span class="number">2</span> <span class="number">22</span>:<span class="number">26</span> data-md5_id-ka-<span class="number">2010</span>-Filter.db</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin <span class="number">231</span>M <span class="number">6</span>月   <span class="number">2</span> <span class="number">22</span>:<span class="number">26</span> data-md5_id-ka-<span class="number">2010</span>-Index.db</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin <span class="number">9.7</span>K <span class="number">6</span>月   <span class="number">2</span> <span class="number">22</span>:<span class="number">26</span> data-md5_id-ka-<span class="number">2010</span>-Statistics.db</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin   <span class="number">91</span> <span class="number">6</span>月   <span class="number">2</span> <span class="number">22</span>:<span class="number">26</span> data-md5_id-ka-<span class="number">2010</span>-TOC.txt</span><br></pre></td></tr></table></figure>
<p>内存为2048，直接在运行Cassnadra的线上跑</p>
<p>nohup java -cp guava-19.0.jar:rainbow-table-1.0.0-SNAPSHOT-jar-with-dependencies.jar \<br>cn.fraudmetrix.vulcan.rainbowtable.sstable.BulkLoadIdCard -table md5_id -partition 13 -memory 1024 &gt; rainbow-table-idcard.log.1 2&gt;&amp;1 &amp;</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Exception <span class="keyword">in</span> thread <span class="string">"main"</span> java.lang.OutOfMemoryError: GC overhead limit exceeded</span><br><span class="line">    <span class="keyword">at</span> java.util.Arrays.copyOfRange(Arrays.java:<span class="number">2694</span>)</span><br><span class="line">    <span class="keyword">at</span> java.lang.String.&lt;init&gt;(String.java:<span class="number">203</span>)</span><br><span class="line">    <span class="keyword">at</span> java.lang.StringBuilder.toString(StringBuilder.java:<span class="number">405</span>)</span><br><span class="line">    <span class="keyword">at</span> cn.fraudmetrix.vulcan.rainbowtable.util.AbstractGenData.last1(AbstractGenData.java:<span class="number">220</span>)</span><br><span class="line">    <span class="keyword">at</span> cn.fraudmetrix.vulcan.rainbowtable.util.AbstractGenData.genIdCardOneProvince(AbstractGenData.java:<span class="number">82</span>)</span><br><span class="line">    <span class="keyword">at</span> cn.fraudmetrix.vulcan.rainbowtable.util.AbstractGenData.genIdCard(AbstractGenData.java:<span class="number">63</span>)</span><br><span class="line">    <span class="keyword">at</span> cn.fraudmetrix.vulcan.rainbowtable.util.AbstractGenData.genData(AbstractGenData.java:<span class="number">55</span>)</span><br><span class="line">    <span class="keyword">at</span> cn.fraudmetrix.vulcan.rainbowtable.sstable.BulkLoadIdCard.main(BulkLoadIdCard.java:<span class="number">116</span>)</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) <span class="number">64</span>-Bit Server VM warning: INFO: os::commit_memory(<span class="number">0x0000000632f80000</span>, <span class="number">436731904</span>, <span class="number">0</span>) failed; <span class="keyword">error</span>='无法分配内存' (errno=<span class="number">12</span>)</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># There is insufficient memory for the Java Runtime Environment to continue.</span></span><br><span class="line"><span class="comment"># Native memory allocation (malloc) failed to allocate 436731904 bytes for committing reserved memory.</span></span><br><span class="line"><span class="comment"># An error report file with more information is saved as:</span></span><br><span class="line"><span class="comment"># /home/admin/hs_err_pid33681.log</span></span><br></pre></td></tr></table></figure>
<p>因为Cassandra本身占用了很大内存，运行sstable的程序内存不足，可以先停掉Cassandra。为了不影响线上，只能停掉一个节点，生成完数据，再停另一个节点。。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[admin@cass047225 ~]$ <span class="built_in">free</span> -h</span><br><span class="line">             total       used       <span class="built_in">free</span>     shared    buffers     cached</span><br><span class="line">Mem:           <span class="number">31</span>G        <span class="number">30</span>G       <span class="number">470</span>M       <span class="number">716</span>K        <span class="number">30</span>M       <span class="number">3.8</span>G</span><br><span class="line">-/+ buffers/cache:        <span class="number">27</span>G       <span class="number">4.3</span>G</span><br><span class="line">Swap:           <span class="number">0</span>B         <span class="number">0</span>B         <span class="number">0</span>B</span><br></pre></td></tr></table></figure>
<p>设置内存大小，并使用G1，刚开始还好，过了一段时间，控制台打印的WriteCount几乎不动了，查看GC，这个时候会发现OC=OU。只能等FGC完成后，才有可能继续打印，<br>不过没过多久，这种情况会继续下去。</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">nohup java -Xmx16g -Xms16g -XX:+UseG1GC -XX:MaxGCPauseMillis=1000 -cp guava-19.0.jar:rainbow-table-1.0.0-SNAPSHOT-jar-with-dependencies.jar \</span><br><span class="line">cn.fraudmetrix.vulcan.rainbowtable.sstable.BulkLoadIdCard -table md5_id -partition $myRange -memory 4096 &gt; rainbow-table-idcard.log 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br><span class="line">jstat -gc -h 10 `jps | grep BulkLoadIdCard |awk '&#123;print $1&#125;'` 1000 | \</span><br><span class="line">awk '&#123;printf("%10s\t%10s\t%10s\t%10s\t%10s\t%10s\t%10s\t%10s\t%10s\t%10s\t\n",$1,$5,$3,$4,$6,$8,$11,$12,$13,$14)&#125;'</span><br><span class="line"></span><br><span class="line">[admin@cass047225 ~]$ jstat -gc -h 10 `jps | grep BulkLoadIdCard |awk '&#123;print $1&#125;'` 1000</span><br><span class="line"> S0C    S1C      S0U   S1U      EC        EU       OC         OU         PC       PU         YGC  YGCT    FGC     FGCT     GCT</span><br><span class="line"> 0.0   <span class="number">106496.0</span>  0.0   <span class="number">106496.0 46</span><span class="number">03904.0 50</span><span class="number">7904.0 120</span><span class="number">66816.0 101</span><span class="number">33504.0 163</span><span class="number">84.0 12784</span>.5     52   30.335   0      0.000   30.335</span><br><span class="line"> 0.0   <span class="number">106496.0</span>  0.0   <span class="number">106496.0 46</span><span class="number">03904.0 113</span><span class="number">8688.0 120</span><span class="number">66816.0 101</span><span class="number">33504.0 163</span><span class="number">84.0 12784</span>.5     52   30.335   0      0.000   30.335</span><br><span class="line"> 0.0   <span class="number">106496.0</span>  0.0   <span class="number">106496.0 46</span><span class="number">03904.0 200</span><span class="number">7040.0 120</span><span class="number">66816.0 101</span><span class="number">33504.0 163</span><span class="number">84.0 12784</span>.5     52   30.335   0      0.000   30.335</span><br><span class="line"> 0.0   <span class="number">106496.0</span>  0.0   <span class="number">106496.0 46</span><span class="number">03904.0 28</span><span class="number">83584.0 120</span><span class="number">66816.0 101</span><span class="number">33504.0 163</span><span class="number">84.0 12784</span>.5     52   30.335   0      0.000   30.335</span><br><span class="line"> 0.0   <span class="number">106496.0</span>  0.0   <span class="number">106496.0 46</span><span class="number">03904.0 37</span><span class="number">02784.0 120</span><span class="number">66816.0 101</span><span class="number">33504.0 163</span><span class="number">84.0 12784</span>.5     52   30.335   0      0.000   30.335</span><br><span class="line"> 0.0   <span class="number">106496.0</span>  0.0   <span class="number">106496.0 46</span><span class="number">03904.0 43</span><span class="number">33568.0 120</span><span class="number">66816.0 101</span><span class="number">33504.0 163</span><span class="number">84.0 12784</span>.5     52   30.335   0      0.000   30.335</span><br><span class="line"> 0.0   <span class="number">425984.0</span>  0.0   <span class="number">425984.0</span> <span class="number">4333568.0</span> <span class="number">229376.0 120</span><span class="number">17664.0 101</span><span class="number">29408.0 163</span><span class="number">84.0 12784</span>.5     53   30.975   0      0.000   30.975</span><br><span class="line"> 0.0   <span class="number">425984.0</span>  0.0   <span class="number">425984.0</span> <span class="number">4333568.0</span> <span class="number">942080.0</span> <span class="number">12017664.0</span> <span class="number">10129408.0</span> <span class="number">16384.0 127</span>84.5     53   30.975   0      0.000   30.975</span><br><span class="line"> 0.0   <span class="number">425984.0</span>  0.0   <span class="number">425984.0</span> <span class="number">4333568.0</span> <span class="number">1433600.0</span> <span class="number">12017664.0</span> <span class="number">10129408.0</span> <span class="number">16384.0 127</span>84.5     53   30.975   0      0.000   30.975</span><br><span class="line"> 0.0   <span class="number">425984.0</span>  0.0   <span class="number">425984.0</span> <span class="number">4333568.0</span> <span class="number">1785856.0</span> <span class="number">12017664.0</span> <span class="number">10129408.0</span> <span class="number">16384.0 127</span>84.5     54   30.975   0      0.000   30.975</span><br><span class="line"> 0.0   <span class="number">106496.0</span>  0.0   <span class="number">106496.0 41</span><span class="number">28768.0 245</span><span class="number">760.0 125</span><span class="number">41952.0 105</span><span class="number">79968.0 163</span><span class="number">84.0 12784</span>.5     54   32.056   0      0.000   32.056</span><br><span class="line"> 0.0   <span class="number">106496.0</span>  0.0   <span class="number">106496.0 41</span><span class="number">28768.0 106</span><span class="number">4960.0 125</span><span class="number">41952.0 105</span><span class="number">79968.0 163</span><span class="number">84.0 12784</span>.5     54   32.056   0      0.000   32.056</span><br><span class="line"> 0.0   <span class="number">106496.0</span>  0.0   <span class="number">106496.0 41</span><span class="number">28768.0 167</span><span class="number">1168.0 125</span><span class="number">41952.0 105</span><span class="number">79968.0 163</span><span class="number">84.0 12784</span>.5     54   32.056   0      0.000   32.056</span><br><span class="line"> 0.0   <span class="number">106496.0</span>  0.0   <span class="number">106496.0 41</span><span class="number">28768.0 243</span><span class="number">3024.0 125</span><span class="number">41952.0 105</span><span class="number">79968.0 163</span><span class="number">84.0 12784</span>.5     54   32.056   0      0.000   32.056</span><br><span class="line"> 0.0   <span class="number">106496.0</span>  0.0   <span class="number">106496.0 41</span><span class="number">28768.0 31</span><span class="number">70304.0 125</span><span class="number">41952.0 105</span><span class="number">79968.0 163</span><span class="number">84.0 12784</span>.5     54   32.056   0      0.000   32.056</span><br><span class="line"> 0.0   <span class="number">106496.0</span>  0.0   <span class="number">106496.0 41</span><span class="number">28768.0 38</span><span class="number">33856.0 125</span><span class="number">41952.0 105</span><span class="number">79968.0 163</span><span class="number">84.0 12784</span>.5     54   32.056   0      0.000   32.056</span><br><span class="line"> 0.0   <span class="number">409600.0</span>  0.0   <span class="number">409600.0</span> <span class="number">3457024.0</span> <span class="number">147456.0 129</span><span class="number">10592.0 105</span><span class="number">75872.0 163</span><span class="number">84.0 12784</span>.5     55   32.641   0      0.000   32.641</span><br><span class="line"> 0.0   <span class="number">409600.0</span>  0.0   <span class="number">409600.0</span> <span class="number">3457024.0</span> <span class="number">655360.0</span> <span class="number">12910592.0</span> <span class="number">10575872.0</span> <span class="number">16384.0 127</span>84.5     55   32.641   0      0.000   32.641</span><br><span class="line"> 0.0   <span class="number">409600.0</span>  0.0   <span class="number">409600.0</span> <span class="number">3457024.0</span> <span class="number">1269760.0</span> <span class="number">12910592.0</span> <span class="number">10575872.0</span> <span class="number">16384.0 127</span>84.5     55   32.641   0      0.000   32.641</span><br><span class="line"> 0.0   <span class="number">409600.0</span>  0.0   <span class="number">409600.0</span> <span class="number">3457024.0</span> <span class="number">1900544.0</span> <span class="number">12910592.0</span> <span class="number">10575872.0</span> <span class="number">16384.0 127</span>84.5     55   32.641   0      0.000   32.641</span><br><span class="line"></span><br><span class="line">0.0    0.0    0.0    0.0     0.0      0.0    <span class="number">16777216.0</span> <span class="number">16770048.5</span> <span class="number">16384.0 127</span>84.5    133   65.236   2     61.382  <span class="number">126.618</span></span><br><span class="line"> S0C    S1C    S0U    S1U      EC       EU        OC         OU       PC     PU    YGC     YGCT    FGC    FGCT     GCT</span><br><span class="line"> 0.0    0.0    0.0    0.0     0.0      0.0    <span class="number">16777216.0</span> <span class="number">16770048.5</span> <span class="number">16384.0 127</span>84.5    133   65.236   2     61.382  <span class="number">126.618</span></span><br><span class="line"> 0.0    0.0    0.0    0.0     0.0      0.0    <span class="number">16777216.0</span> <span class="number">16770048.5</span> <span class="number">16384.0 127</span>84.5    133   65.236   2     61.382  <span class="number">126.618</span></span><br><span class="line"> 0.0    0.0    0.0    0.0     0.0      0.0    <span class="number">16777216.0</span> <span class="number">16770048.5</span> <span class="number">16384.0 127</span>84.5    133   65.236   2     61.382  <span class="number">126.618</span></span><br><span class="line"> 0.0    0.0    0.0    0.0     0.0      0.0    <span class="number">16777216.0</span> <span class="number">16770048.5</span> <span class="number">16384.0 127</span>84.5    133   65.236   2     61.382  <span class="number">126.618</span></span><br><span class="line"> 0.0    0.0    0.0    0.0     0.0      0.0    <span class="number">16777216.0</span> <span class="number">16770048.5</span> <span class="number">16384.0 127</span>84.5    133   65.236   2     61.382  <span class="number">126.618</span></span><br><span class="line"> 0.0    0.0    0.0    0.0     0.0      0.0    <span class="number">16777216.0</span> <span class="number">16770048.5</span> <span class="number">16384.0 127</span>84.5    133   65.236   2     61.382  <span class="number">126.618</span></span><br><span class="line"> 0.0    0.0    0.0    0.0     0.0      0.0    <span class="number">16777216.0</span> <span class="number">16770048.5</span> <span class="number">16384.0 127</span>84.5    133   65.236   2     61.382  <span class="number">126.618</span></span><br><span class="line"> 0.0    0.0    0.0    0.0     0.0      0.0    <span class="number">16777216.0</span> <span class="number">16770048.5</span> <span class="number">16384.0 127</span>84.5    133   65.236   2     61.382  <span class="number">126.618</span></span><br><span class="line"> 0.0    0.0    0.0    0.0     0.0      0.0    <span class="number">16777216.0</span> <span class="number">16770048.5</span> <span class="number">16384.0 127</span>84.5    133   65.236   2     61.382  <span class="number">126.618</span></span><br><span class="line"> 0.0    0.0    0.0    0.0   <span class="number">884736.0</span> <span class="number">450560.0</span> <span class="number">15892480.0</span> <span class="number">15681440.2</span> <span class="number">16384.0 127</span>84.5    133   65.236   2    <span class="number">122.783</span>  <span class="number">188.019</span></span><br><span class="line"> S0C    S1C    S0U    S1U      EC       EU        OC         OU       PC     PU    YGC     YGCT    FGC    FGCT     GCT</span><br><span class="line"> 0.0   <span class="number">57344.0</span>  0.0   <span class="number">57344.0 82</span><span class="number">7392.0 37</span><span class="number">6832.0 158</span><span class="number">92480.0 156</span><span class="number">80244.2 163</span><span class="number">84.0 12784</span>.5    134   65.394   2    <span class="number">122.783</span>  <span class="number">188.177</span></span><br><span class="line"> 0.0   <span class="number">106496.0</span>  0.0   <span class="number">106496.0 77</span><span class="number">8240.0 163</span><span class="number">840.0 158</span><span class="number">92480.0 157</span><span class="number">01920.2 163</span><span class="number">84.0 12784</span>.5    135   65.691   2    <span class="number">122.783</span>  <span class="number">188.474</span></span><br><span class="line"> 0.0   <span class="number">106496.0</span>  0.0   <span class="number">106496.0 77</span><span class="number">8240.0 72</span><span class="number">9088.0 158</span><span class="number">92480.0 157</span><span class="number">01920.2 163</span><span class="number">84.0 12784</span>.5    136   65.691   2    <span class="number">122.783</span>  <span class="number">188.474</span></span><br><span class="line"> 0.0   <span class="number">73728.0</span>  0.0   <span class="number">73728.0 81</span><span class="number">1008.0 60</span><span class="number">6208.0 158</span><span class="number">92480.0 157</span><span class="number">96935.3 163</span><span class="number">84.0 12784</span>.5    136   66.004   2    <span class="number">122.783</span>  <span class="number">188.786</span></span><br><span class="line"> 0.0   <span class="number">65536.0</span>  0.0   <span class="number">65536.0 81</span><span class="number">9200.0 53</span><span class="number">2480.0 158</span><span class="number">92480.0 158</span><span class="number">69856.2 163</span><span class="number">84.0 12784</span>.5    137   66.209   2    <span class="number">122.783</span>  <span class="number">188.992</span></span><br><span class="line"> 0.0   <span class="number">65536.0</span>  0.0   <span class="number">65536.0 81</span><span class="number">9200.0 77</span><span class="number">0048.0 158</span><span class="number">92480.0 158</span><span class="number">69856.2 163</span><span class="number">84.0 12784</span>.5    138   66.209   2    <span class="number">122.783</span>  <span class="number">188.992</span></span><br><span class="line"> 0.0   <span class="number">65536.0</span>  0.0   <span class="number">65536.0 81</span><span class="number">9200.0 77</span><span class="number">0048.0 158</span><span class="number">92480.0 158</span><span class="number">69856.2 163</span><span class="number">84.0 12784</span>.5    138   66.209   2    <span class="number">122.783</span>  <span class="number">188.992</span></span><br><span class="line"> 0.0   <span class="number">65536.0</span>  0.0   <span class="number">65536.0 35</span><span class="number">2256.0 35</span><span class="number">2256.0 163</span><span class="number">59424.0 163</span><span class="number">53184.2 163</span><span class="number">84.0 12784</span>.5    139   67.845   2    <span class="number">122.783</span>  <span class="number">190.628</span></span><br><span class="line"> 0.0   <span class="number">65536.0</span>  0.0   <span class="number">65536.0 35</span><span class="number">2256.0 35</span><span class="number">2256.0 163</span><span class="number">59424.0 163</span><span class="number">53184.2 163</span><span class="number">84.0 12784</span>.5    139   67.845   2    <span class="number">122.783</span>  <span class="number">190.628</span></span><br><span class="line"> 0.0   <span class="number">65536.0</span>  0.0   <span class="number">65536.0 35</span><span class="number">2256.0 35</span><span class="number">2256.0 163</span><span class="number">59424.0 163</span><span class="number">53184.2 163</span><span class="number">84.0 12784</span>.5    139   67.845   2    <span class="number">122.783</span>  <span class="number">190.628</span></span><br><span class="line"> S0C    S1C    S0U    S1U      EC       EU        OC         OU       PC     PU    YGC     YGCT    FGC    FGCT     GCT</span><br><span class="line"> 0.0   <span class="number">65536.0</span>  0.0   <span class="number">65536.0 35</span><span class="number">2256.0 35</span><span class="number">2256.0 163</span><span class="number">59424.0 163</span><span class="number">53184.2 163</span><span class="number">84.0 12784</span>.5    139   67.845   2    <span class="number">122.783</span>  <span class="number">190.628</span></span><br><span class="line"> 0.0    0.0    0.0    0.0     0.0      0.0    <span class="number">16777216.0</span> <span class="number">16770976.2</span> <span class="number">16384.0 127</span>84.5    140   71.751   3    <span class="number">122.783</span>  <span class="number">194.533</span></span><br><span class="line"> 0.0    0.0    0.0    0.0     0.0      0.0    <span class="number">16777216.0</span> <span class="number">16770976.2</span> <span class="number">16384.0 127</span>84.5    140   71.751   3    <span class="number">122.783</span>  <span class="number">194.533</span></span><br><span class="line"> 0.0    0.0    0.0    0.0     0.0      0.0    <span class="number">16777216.0</span> <span class="number">16770976.2</span> <span class="number">16384.0 127</span>84.5    140   71.751   3    <span class="number">122.783</span>  <span class="number">194.533</span></span><br><span class="line"> 0.0    0.0    0.0    0.0     0.0      0.0    <span class="number">16777216.0</span> <span class="number">16770976.2</span> <span class="number">16384.0 127</span>84.5    140   71.751   3    <span class="number">122.783</span>  <span class="number">194.533</span></span><br><span class="line"> 0.0    0.0    0.0    0.0     0.0      0.0    <span class="number">16777216.0</span> <span class="number">16770976.2</span> <span class="number">16384.0 127</span>84.5    140   71.751   3    <span class="number">122.783</span>  <span class="number">194.533</span></span><br><span class="line"> 0.0    0.0    0.0    0.0     0.0      0.0    <span class="number">16777216.0</span> <span class="number">16770976.2</span> <span class="number">16384.0 127</span>84.5    140   71.751   3    <span class="number">122.783</span>  <span class="number">194.533</span></span><br><span class="line"> 0.0    0.0    0.0    0.0     0.0      0.0    <span class="number">16777216.0</span> <span class="number">16770976.2</span> <span class="number">16384.0 127</span>84.5    140   71.751   3    <span class="number">122.783</span>  <span class="number">194.533</span></span><br><span class="line"> 0.0    0.0    0.0    0.0     0.0      0.0    <span class="number">16777216.0</span> <span class="number">16770976.2</span> <span class="number">16384.0 127</span>84.5    140   71.751   3    <span class="number">122.783</span>  <span class="number">194.533</span></span><br><span class="line"> 0.0    0.0    0.0    0.0     0.0      0.0    <span class="number">16777216.0</span> <span class="number">16770976.2</span> <span class="number">16384.0 127</span>84.5    140   71.751   3    <span class="number">122.783</span>  <span class="number">194.533</span></span><br><span class="line"> S0C    S1C    S0U    S1U      EC       EU        OC         OU       PC     PU    YGC     YGCT    FGC    FGCT     GCT</span><br><span class="line"> 0.0    0.0    0.0    0.0     0.0      0.0    <span class="number">16777216.0</span> <span class="number">16770976.2</span> <span class="number">16384.0 127</span>84.5    140   71.751   3    <span class="number">122.783</span>  <span class="number">194.533</span></span><br><span class="line"> 0.0    0.0    0.0    0.0     0.0      0.0    <span class="number">16777216.0</span> <span class="number">16770976.2</span> <span class="number">16384.0 127</span>84.5    140   71.751   3    <span class="number">122.783</span>  <span class="number">194.533</span></span><br><span class="line"> 0.0    0.0    0.0    0.0     0.0      0.0    <span class="number">16777216.0</span> <span class="number">16770976.2</span> <span class="number">16384.0 127</span>84.5    140   71.751   3    <span class="number">122.783</span>  <span class="number">194.533</span></span><br><span class="line"> 0.0    0.0    0.0    0.0   <span class="number">811008.0</span> <span class="number">385024.0</span> <span class="number">15966208.0</span> <span class="number">15960817.7</span> <span class="number">16384.0 127</span>84.5    140   71.751   3    <span class="number">173.703</span>  <span class="number">245.454</span></span><br><span class="line"> 0.0    0.0    0.0    0.0   <span class="number">811008.0</span> <span class="number">811008.0</span> <span class="number">15966208.0</span> <span class="number">15960817.7</span> <span class="number">16384.0 127</span>84.5    141   71.751   3    <span class="number">173.703</span>  <span class="number">245.454</span></span><br><span class="line"> 0.0    0.0    0.0    0.0   <span class="number">811008.0</span> <span class="number">811008.0</span> <span class="number">15966208.0</span> <span class="number">15960817.7</span> <span class="number">16384.0 127</span>84.5    141   71.751   3    <span class="number">173.703</span>  <span class="number">245.454</span></span><br><span class="line"> 0.0    0.0    0.0    0.0   <span class="number">286720.0</span> <span class="number">155648.0 164</span><span class="number">90496.0 164</span><span class="number">85105.7 163</span><span class="number">84.0 12784</span>.5    141   73.666   3    <span class="number">173.703</span>  <span class="number">247.369</span></span><br><span class="line"> 0.0    0.0    0.0    0.0   <span class="number">286720.0</span> <span class="number">286720.0</span> <span class="number">16490496.0</span> <span class="number">16485105.7</span> <span class="number">16384.0 127</span>84.5    142   73.666   3    <span class="number">173.703</span>  <span class="number">247.369</span></span><br><span class="line"> 0.0    0.0    0.0    0.0     0.0      0.0    <span class="number">16777216.0</span> <span class="number">16771825.7</span> <span class="number">16384.0 127</span>84.5    143   75.252   4    <span class="number">173.703</span>  <span class="number">248.955</span></span><br><span class="line"> 0.0    0.0    0.0    0.0     0.0      0.0    <span class="number">16777216.0</span> <span class="number">16771825.7</span> <span class="number">16384.0 127</span>84.5    143   75.252   4    <span class="number">173.703</span>  <span class="number">248.955</span></span><br><span class="line"> 0.0    0.0    0.0    0.0     0.0      0.0    <span class="number">16777216.0</span> <span class="number">16771825.7</span> <span class="number">16384.0 127</span>84.5    143   75.252   4    <span class="number">173.703</span>  <span class="number">248.955</span></span><br><span class="line"> S0C    S1C    S0U    S1U      EC       EU        OC         OU       PC     PU    YGC     YGCT    FGC    FGCT     GCT</span><br></pre></td></tr></table></figure>
<p>为什么FGC之后，几乎马上又重现？实际上内存中的数据还没有刷写到磁盘上，当然这部分内存就不能回收了。这就导致FGC实际上并没有回收多少内存。</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[admin@cass047225 ~]$ tail -f rainbow-<span class="keyword">table</span>-idcard.<span class="literal">log</span></span><br><span class="line">WriteCount:65531,<span class="keyword">SAMPLE</span>:92FF12AE4A27EC01692DC05F041ECF44,13010219701011217X</span><br><span class="line">[admin@cass047225 ~]$ <span class="keyword">cat</span> rainbow-<span class="keyword">table</span>-idcard.<span class="keyword">log</span> | grep <span class="string">"WriteCount"</span> | wc -<span class="keyword">l</span></span><br><span class="line">515</span><br><span class="line">[admin@cass047225 ~]$ du -<span class="keyword">sh</span> *</span><br><span class="line">12K md5_id20160622</span><br></pre></td></tr></table></figure>
<p>写了将近515<em>65531=3000万，还是没有生成一个sstable文件。 因为buffer size设置为4G，只有Memtable达到4G时，才会刷写一个sstable文件。<br>一条记录”92FF12AE4A27EC01692DC05F041ECF44,13010219701011217X”只有52个字符(52byte)，再加上写sstable还有其他组件比如index，<br>就算一条记录=1KB=1024byte，1万记录=10000kb=10M, 3000万=3000</em>10M=300G  </p>
<p>以buffer=4G为例，总内存=4G=4000M=4000M<em>1000KB=4000000KB=400万KB,如果内存中只以一条记录=52byte计算。<br>总共可以存放最大记录数=`400万</em>1000byte/50byte=400万*20=800万`，但是上面将近3000万，为什么没有结果？  </p>
<p>唯一的办法是减少buffer大小到2G/1G…。通过让内存中的数据尽快刷写到磁盘上！释放掉内存中的数据。<br>否则数据源源不断写到内存中，无法及时释放，即使FGC也无能为力。</p>
<p>运行过程，查看堆栈信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">[admin@cass047225 md5_id]$ jps -lm</span><br><span class="line">7594 cn.fraudmetrix.vulcan.rainbowtable.sstable.BulkLoadIdCard -table md5_id -partition 13,14,15,21 -memory 2048</span><br><span class="line">[admin@cass047225 md5_id]$ top -Hp 7594</span><br><span class="line">top - 10:19:32 up 211 days, 15:36,  3 users,  <span class="operator"><span class="keyword">load</span> average: <span class="number">2.77</span>, <span class="number">3.62</span>, <span class="number">3.68</span></span><br><span class="line">Tasks:  <span class="number">34</span> total,   <span class="number">4</span> running,  <span class="number">30</span> sleeping,   <span class="number">0</span> stopped,   <span class="number">0</span> zombie</span><br><span class="line">Cpu(s):  <span class="number">8.6</span>%us,  <span class="number">3.0</span>%sy, <span class="number">17.3</span>%ni, <span class="number">70.6</span>%<span class="keyword">id</span>,  <span class="number">0.2</span>%wa,  <span class="number">0.0</span>%hi,  <span class="number">0.3</span>%si,  <span class="number">0.0</span>%st</span><br><span class="line">Mem:  <span class="number">32794428</span><span class="keyword">k</span> total, <span class="number">32493800</span><span class="keyword">k</span> used,   <span class="number">300628</span><span class="keyword">k</span> free,    <span class="number">31944</span><span class="keyword">k</span> buffers</span><br><span class="line">Swap:        <span class="number">0</span><span class="keyword">k</span> total,        <span class="number">0</span><span class="keyword">k</span> used,        <span class="number">0</span><span class="keyword">k</span> free, <span class="number">10400404</span><span class="keyword">k</span> cached</span><br><span class="line"></span><br><span class="line">  PID <span class="keyword">USER</span>      PR  NI  VIRT  RES  SHR S %CPU %MEM    <span class="keyword">TIME</span>+  COMMAND</span><br><span class="line"> <span class="number">7625</span> <span class="keyword">admin</span>     <span class="number">20</span>   <span class="number">0</span> <span class="number">21.8</span><span class="keyword">g</span>  <span class="number">19</span><span class="keyword">g</span>  <span class="number">16</span><span class="keyword">m</span> R <span class="number">101.7</span> <span class="number">63.6</span>  <span class="number">17</span>:<span class="number">55.41</span> <span class="keyword">java</span></span><br><span class="line"> <span class="number">7603</span> <span class="keyword">admin</span>     <span class="number">20</span>   <span class="number">0</span> <span class="number">21.8</span><span class="keyword">g</span>  <span class="number">19</span><span class="keyword">g</span>  <span class="number">16</span><span class="keyword">m</span> R <span class="number">99.7</span> <span class="number">63.6</span>  <span class="number">28</span>:<span class="number">13.74</span> <span class="keyword">java</span></span><br><span class="line"> <span class="number">7627</span> <span class="keyword">admin</span>     <span class="number">20</span>   <span class="number">0</span> <span class="number">21.8</span><span class="keyword">g</span>  <span class="number">19</span><span class="keyword">g</span>  <span class="number">16</span><span class="keyword">m</span> R <span class="number">99.7</span> <span class="number">63.6</span>  <span class="number">13</span>:<span class="number">13.43</span> <span class="keyword">java</span></span><br><span class="line"> <span class="number">7628</span> <span class="keyword">admin</span>     <span class="number">20</span>   <span class="number">0</span> <span class="number">21.8</span><span class="keyword">g</span>  <span class="number">19</span><span class="keyword">g</span>  <span class="number">16</span><span class="keyword">m</span> R <span class="number">99.7</span> <span class="number">63.6</span>  <span class="number">13</span>:<span class="number">13.73</span> <span class="keyword">java</span></span><br><span class="line"></span><br><span class="line">[<span class="keyword">admin</span>@cass047225 ~]$ ./<span class="keyword">show</span>-busy-javathreads.sh</span><br><span class="line">Busy(<span class="number">73.4</span>%) <span class="keyword">thread</span>(<span class="number">7603</span>/<span class="number">0x1db3</span>) stack <span class="keyword">of</span> <span class="keyword">java</span> process(<span class="number">7594</span>) <span class="keyword">under</span> <span class="keyword">user</span>(<span class="keyword">admin</span>):</span><br><span class="line"><span class="string">"main"</span> prio=<span class="number">10</span> tid=<span class="number">0x00007f7468009000</span> nid=<span class="number">0x1db3</span> runnable [<span class="number">0x00007f7471aa9000</span>]</span><br><span class="line">   <span class="keyword">java</span>.lang.<span class="keyword">Thread</span>.State: RUNNABLE</span><br><span class="line">  <span class="keyword">at</span> <span class="keyword">java</span>.util.Arrays.copyOf(Arrays.<span class="keyword">java</span>:<span class="number">2271</span>)</span><br><span class="line">  <span class="keyword">at</span> <span class="keyword">java</span>.lang.StringCoding.safeTrim(StringCoding.<span class="keyword">java</span>:<span class="number">79</span>)</span><br><span class="line">  <span class="keyword">at</span> <span class="keyword">java</span>.lang.StringCoding.<span class="keyword">encode</span>(StringCoding.<span class="keyword">java</span>:<span class="number">365</span>)</span><br><span class="line">  <span class="keyword">at</span> <span class="keyword">java</span>.lang.<span class="keyword">String</span>.getBytes(<span class="keyword">String</span>.<span class="keyword">java</span>:<span class="number">939</span>)</span><br><span class="line">  <span class="keyword">at</span> org.apache.cassandra.utils.ByteBufferUtil.<span class="keyword">bytes</span>(ByteBufferUtil.<span class="keyword">java</span>:<span class="number">225</span>)</span><br><span class="line">  <span class="keyword">at</span> org.apache.cassandra.serializers.AbstractTextSerializer.serialize(AbstractTextSerializer.<span class="keyword">java</span>:<span class="number">49</span>)</span><br><span class="line">  <span class="keyword">at</span> org.apache.cassandra.serializers.AbstractTextSerializer.serialize(AbstractTextSerializer.<span class="keyword">java</span>:<span class="number">26</span>)</span><br><span class="line">  <span class="keyword">at</span> org.apache.cassandra.db.marshal.AbstractType.<span class="keyword">decompose</span>(AbstractType.<span class="keyword">java</span>:<span class="number">73</span>)</span><br><span class="line">  <span class="keyword">at</span> org.apache.cassandra.io.sstable.CQLSSTableWriter.addRow(CQLSSTableWriter.<span class="keyword">java</span>:<span class="number">142</span>)</span><br><span class="line">  <span class="keyword">at</span> org.apache.cassandra.io.sstable.CQLSSTableWriter.addRow(CQLSSTableWriter.<span class="keyword">java</span>:<span class="number">118</span>)</span><br><span class="line">  <span class="keyword">at</span> cn.fraudmetrix.vulcan.rainbowtable.sstable.BulkLoadIdCard.batchWrite(BulkLoadIdCard.<span class="keyword">java</span>:<span class="number">55</span>)</span><br><span class="line">  <span class="keyword">at</span> cn.fraudmetrix.vulcan.rainbowtable.util.AbstractGenData.genIdCardOneProvince(AbstractGenData.<span class="keyword">java</span>:<span class="number">86</span>)</span><br><span class="line">  <span class="keyword">at</span> cn.fraudmetrix.vulcan.rainbowtable.util.AbstractGenData.genIdCard(AbstractGenData.<span class="keyword">java</span>:<span class="number">63</span>)</span><br><span class="line">  <span class="keyword">at</span> cn.fraudmetrix.vulcan.rainbowtable.util.AbstractGenData.genData(AbstractGenData.<span class="keyword">java</span>:<span class="number">55</span>)</span><br><span class="line">  <span class="keyword">at</span> cn.fraudmetrix.vulcan.rainbowtable.sstable.BulkLoadIdCard.<span class="keyword">main</span>(BulkLoadIdCard.<span class="keyword">java</span>:<span class="number">116</span>)</span><br><span class="line"></span><br><span class="line">Busy(<span class="number">46.8</span>%) <span class="keyword">thread</span>(<span class="number">7625</span>/<span class="number">0x1dc9</span>) stack <span class="keyword">of</span> <span class="keyword">java</span> process(<span class="number">7594</span>) <span class="keyword">under</span> <span class="keyword">user</span>(<span class="keyword">admin</span>):</span><br><span class="line"><span class="string">"G1 Concurrent Refinement Thread#0"</span> prio=<span class="number">10</span> tid=<span class="number">0x00007f746803c800</span> nid=<span class="number">0x1dc9</span> runnable</span><br><span class="line"></span><br><span class="line">Busy(<span class="number">34.5</span>%) <span class="keyword">thread</span>(<span class="number">7628</span>/<span class="number">0x1dcc</span>) stack <span class="keyword">of</span> <span class="keyword">java</span> process(<span class="number">7594</span>) <span class="keyword">under</span> <span class="keyword">user</span>(<span class="keyword">admin</span>):</span><br><span class="line"><span class="string">"Gang worker#1 (G1 Parallel Marking Threads)"</span> prio=<span class="number">10</span> tid=<span class="number">0x00007f746806b800</span> nid=<span class="number">0x1dcc</span> runnable</span><br><span class="line"></span><br><span class="line">Busy(<span class="number">34.5</span>%) <span class="keyword">thread</span>(<span class="number">7627</span>/<span class="number">0x1dcb</span>) stack <span class="keyword">of</span> <span class="keyword">java</span> process(<span class="number">7594</span>) <span class="keyword">under</span> <span class="keyword">user</span>(<span class="keyword">admin</span>):</span><br><span class="line"><span class="string">"Gang worker#0 (G1 Parallel Marking Threads)"</span> prio=<span class="number">10</span> tid=<span class="number">0x00007f7468069800</span> nid=<span class="number">0x1dcb</span> runnable</span><br><span class="line"></span><br><span class="line">Busy(<span class="number">25.6</span>%) <span class="keyword">thread</span>(<span class="number">7688</span>/<span class="number">0x1e08</span>) stack <span class="keyword">of</span> <span class="keyword">java</span> process(<span class="number">7594</span>) <span class="keyword">under</span> <span class="keyword">user</span>(<span class="keyword">admin</span>):</span><br><span class="line"><span class="string">"Thread-2"</span> prio=<span class="number">10</span> tid=<span class="number">0x00007f7469e3b000</span> nid=<span class="number">0x1e08</span> waiting <span class="keyword">on</span> condition [<span class="number">0x00007f73f012c000</span>]</span><br><span class="line">   <span class="keyword">java</span>.lang.<span class="keyword">Thread</span>.State: WAITING (parking)</span><br><span class="line">  <span class="keyword">at</span> sun.misc.<span class="keyword">Unsafe</span>.park(<span class="keyword">Native</span> Method)</span><br><span class="line">  - parking <span class="keyword">to</span> <span class="keyword">wait</span> <span class="keyword">for</span>  &lt;<span class="number">0x00000003fb131618</span>&gt; (a <span class="keyword">java</span>.util.<span class="keyword">concurrent</span>.SynchronousQueue$TransferStack)</span><br><span class="line">  <span class="keyword">at</span> <span class="keyword">java</span>.util.<span class="keyword">concurrent</span>.locks.LockSupport.park(LockSupport.<span class="keyword">java</span>:<span class="number">186</span>)</span><br><span class="line">  <span class="keyword">at</span> <span class="keyword">java</span>.util.<span class="keyword">concurrent</span>.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.<span class="keyword">java</span>:<span class="number">458</span>)</span><br><span class="line">  <span class="keyword">at</span> <span class="keyword">java</span>.util.<span class="keyword">concurrent</span>.SynchronousQueue$TransferStack.transfer(SynchronousQueue.<span class="keyword">java</span>:<span class="number">359</span>)</span><br><span class="line">  <span class="keyword">at</span> <span class="keyword">java</span>.util.<span class="keyword">concurrent</span>.SynchronousQueue.take(SynchronousQueue.<span class="keyword">java</span>:<span class="number">925</span>)</span><br><span class="line">  <span class="keyword">at</span> org.apache.cassandra.io.sstable.SSTableSimpleUnsortedWriter$DiskWriter.run(SSTableSimpleUnsortedWriter.<span class="keyword">java</span>:<span class="number">240</span>)</span></span><br></pre></td></tr></table></figure>
<p>打印存活的对象占比</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[admin@cass047225 ~]$ jmap -histo:live <span class="number">7594</span></span><br><span class="line"></span><br><span class="line"> num     <span class="preprocessor">#instances         #bytes  class name</span></span><br><span class="line">----------------------------------------------</span><br><span class="line">   <span class="number">1</span>:      <span class="number">48953579</span>     <span class="number">2</span>,<span class="number">349</span>,<span class="number">771</span>,<span class="number">792</span>  java.nio.HeapByteBuffer</span><br><span class="line">   <span class="number">2</span>:      <span class="number">48959365</span>     <span class="number">2</span>,<span class="number">154</span>,<span class="number">707</span>,<span class="number">824</span>  [B</span><br><span class="line">   <span class="number">3</span>:      <span class="number">48953434</span>     <span class="number">1566509888</span>  org.apache.cassandra.db.BufferCell</span><br><span class="line">   <span class="number">4</span>:      <span class="number">24476718</span>     <span class="number">1370696168</span>  [Lorg.apache.cassandra.db.Cell;</span><br><span class="line">   <span class="number">5</span>:      <span class="number">24533905</span>      <span class="number">981356200</span>  java.util.TreeMap$Entry</span><br><span class="line">   <span class="number">6</span>:      <span class="number">24476720</span>      <span class="number">979068800</span>  org.apache.cassandra.io.sstable.CQLSSTableWriter$BufferedWriter$<span class="number">1</span></span><br><span class="line">   <span class="number">7</span>:      <span class="number">24476718</span>      <span class="number">783254976</span>  org.apache.cassandra.db.composites.CompoundSparseCellName</span><br><span class="line">   <span class="number">8</span>:      <span class="number">24476720</span>      <span class="number">587441280</span>  org.apache.cassandra.dht.LongToken</span><br><span class="line">   <span class="number">9</span>:      <span class="number">24476720</span>      <span class="number">587441280</span>  org.apache.cassandra.db.DeletionInfo</span><br><span class="line">  <span class="number">10</span>:      <span class="number">24476719</span>      <span class="number">587441256</span>  org.apache.cassandra.db.BufferDecoratedKey</span><br><span class="line">  <span class="number">11</span>:         <span class="number">94817</span>        <span class="number">9075720</span>  [C</span><br><span class="line">  <span class="number">12</span>:         <span class="number">27311</span>        <span class="number">3820688</span>  &lt;constMethodKlass&gt;</span><br><span class="line">  <span class="number">13</span>:         <span class="number">27311</span>        <span class="number">3505968</span>  &lt;methodKlass&gt;</span><br><span class="line">  <span class="number">14</span>:          <span class="number">2349</span>        <span class="number">2919216</span>  &lt;constantPoolKlass&gt;</span><br><span class="line">  <span class="number">15</span>:         <span class="number">94761</span>        <span class="number">2274264</span>  java.lang.String</span><br><span class="line">  <span class="number">16</span>:          <span class="number">2349</span>        <span class="number">1619680</span>  &lt;instanceKlassKlass&gt;</span><br><span class="line">  <span class="number">17</span>:          <span class="number">1882</span>        <span class="number">1474880</span>  &lt;constantPoolCacheKlass&gt;</span><br><span class="line">  <span class="number">18</span>:         <span class="number">57261</span>        <span class="number">1374264</span>  java.lang.Long</span><br><span class="line">  <span class="number">19</span>:         <span class="number">28499</span>        <span class="number">1367952</span>  org.apache.cassandra.io.sstable.IndexSummaryBuilder$ReadableBoundary</span><br></pre></td></tr></table></figure>
<p>内存缓冲区设置为2G时，运行省份13花费：69385；内存为512，花费：75597<br>2G时每个SSTable的文件大小为1G多，512M时，每个文件的大小为281M<br>只有一半的原因是Data文件和Index文件都差不多大。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">内存为<span class="number">512</span>M</span><br><span class="line">[admin@cass047221 md5_id]$ ll data-md5_id-ka-<span class="number">1578</span>-* -rth</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin   <span class="number">16</span> <span class="number">6</span>月  <span class="number">24</span> <span class="number">06</span>:<span class="number">23</span> data-md5_id-ka-<span class="number">1578</span>-Filter.db</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin <span class="number">231</span>M <span class="number">6</span>月  <span class="number">24</span> <span class="number">06</span>:<span class="number">23</span> data-md5_id-ka-<span class="number">1578</span>-Index.db</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin <span class="number">282</span>M <span class="number">6</span>月  <span class="number">24</span> <span class="number">06</span>:<span class="number">23</span> data-md5_id-ka-<span class="number">1578</span>-Data.db</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin  <span class="number">66</span>K <span class="number">6</span>月  <span class="number">24</span> <span class="number">06</span>:<span class="number">23</span> data-md5_id-ka-<span class="number">1578</span>-CompressionInfo.db</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin <span class="number">9.7</span>K <span class="number">6</span>月  <span class="number">24</span> <span class="number">06</span>:<span class="number">23</span> data-md5_id-ka-<span class="number">1578</span>-Statistics.db</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin    <span class="number">8</span> <span class="number">6</span>月  <span class="number">24</span> <span class="number">06</span>:<span class="number">23</span> data-md5_id-ka-<span class="number">1578</span>-Digest.sha1</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin   <span class="number">91</span> <span class="number">6</span>月  <span class="number">24</span> <span class="number">06</span>:<span class="number">23</span> data-md5_id-ka-<span class="number">1578</span>-TOC.txt</span><br><span class="line"></span><br><span class="line">内存为<span class="number">2</span>G</span><br><span class="line">[admin@cass047225 md5_id]$ ll data-md5_id-ka-<span class="number">1</span>-* -rth</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin   <span class="number">16</span> <span class="number">6</span>月  <span class="number">22</span> <span class="number">09</span>:<span class="number">47</span> data-md5_id-ka-<span class="number">1</span>-Filter.db</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin <span class="number">924</span>M <span class="number">6</span>月  <span class="number">22</span> <span class="number">09</span>:<span class="number">47</span> data-md5_id-ka-<span class="number">1</span>-Index.db</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin <span class="number">1.2</span>G <span class="number">6</span>月  <span class="number">22</span> <span class="number">09</span>:<span class="number">47</span> data-md5_id-ka-<span class="number">1</span>-Data.db</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin <span class="number">262</span>K <span class="number">6</span>月  <span class="number">22</span> <span class="number">09</span>:<span class="number">47</span> data-md5_id-ka-<span class="number">1</span>-CompressionInfo.db</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin   <span class="number">10</span> <span class="number">6</span>月  <span class="number">22</span> <span class="number">09</span>:<span class="number">47</span> data-md5_id-ka-<span class="number">1</span>-Digest.sha1</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin <span class="number">9.7</span>K <span class="number">6</span>月  <span class="number">22</span> <span class="number">09</span>:<span class="number">47</span> data-md5_id-ka-<span class="number">1</span>-Statistics.db</span><br><span class="line">-rw-rw-r--. <span class="number">1</span> admin admin   <span class="number">91</span> <span class="number">6</span>月  <span class="number">22</span> <span class="number">09</span>:<span class="number">47</span> data-md5_id-ka-<span class="number">1</span>-TOC.txt</span><br></pre></td></tr></table></figure>
<h3 id="分表？">分表？</h3><p>生成数据按照省份，对应表为md5<em>id</em>省份编号，比如md5_id_13。<br>key - value = B566B86D791DB56E4F149B42A2E84B5A,130100196303225584  </p>
<p>最终表有： md5_id_13， md5_id_14，md5_id_15… 总共有30张表<br>每张表数据量大概1000亿/30=30亿  </p>
<p>问题： 给定md5值，怎么知道要查询哪张表？<br>建立md5值和省份的对应关系？ 或者不用建立，查询时所有表依次查询</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">du -<span class="keyword">sh</span> * | <span class="keyword">grep</span> md5_id201606</span><br><span class="line"><span class="keyword">cat</span> rainbow-table-idcard.<span class="built_in">log</span>.<span class="number">2</span> | <span class="keyword">grep</span> seconds</span><br><span class="line"><span class="keyword">cat</span> rainbow-table-idcard.<span class="built_in">log</span>.<span class="number">2</span> | <span class="keyword">grep</span> WriteCount | wc -<span class="keyword">l</span></span><br><span class="line"><span class="keyword">ll</span> md5_id20160623/data/md5_id | <span class="keyword">grep</span> Data | wc -<span class="keyword">l</span></span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>运行节点</th>
<th>省份</th>
<th>数据源个数</th>
<th>耗时(s)</th>
<th>数据占用空间</th>
<th>数据条数</th>
<th>SSTable数量</th>
<th>导入耗时(s)</th>
<th>状态</th>
</tr>
</thead>
<tbody>
<tr>
<td>192.168.47.202</td>
<td>22,23,31,32</td>
<td>156,301,32,289=778</td>
<td>29580,59443,6066,57166</td>
<td>1.1T</td>
<td>173812*65531+16516</td>
<td>2164</td>
<td>✅</td>
</tr>
<tr>
<td>192.168.47.203</td>
<td>33,34,35,36</td>
<td>230,256,201,239=926</td>
<td>38062,41404,32837,41002</td>
<td>1.3T</td>
<td>206875*65531</td>
<td>2576</td>
<td>✅</td>
</tr>
<tr>
<td>192.168.47.204</td>
<td>37,41</td>
<td>383,367</td>
<td>61807,60992</td>
</tr>
<tr>
<td>192.168.47.206</td>
<td>46,50,51</td>
<td>72,51,512=635</td>
<td>13851,10217,95683</td>
<td>885G</td>
<td>141864*65531</td>
<td>1767</td>
<td>✅</td>
</tr>
<tr>
<td>192.168.47.221</td>
<td>52,53,54</td>
<td>161,246,161=</td>
<td>20690,31109,20306</td>
<td>791G</td>
<td>126896*65531+20992=8315642768=83亿</td>
<td>1580</td>
<td>25758</td>
<td>✅✅</td>
</tr>
<tr>
<td>192.168.47.225</td>
<td>13,14,15,21</td>
<td>390,274,210,209=1083</td>
<td>69385,47905,36801,36486</td>
<td>1.5T</td>
<td></td>
<td>784</td>
<td>✅</td>
</tr>
<tr>
<td>192.168.48.168</td>
<td>61,62,63,64,65,11,12</td>
<td>231,199,70,65,172,28,23=788</td>
<td>29579,25761,9046,8602,22679,3699,3040</td>
<td>176047*65531</td>
<td>2192</td>
<td>1.1T</td>
</tr>
<tr>
<td>192.168.48.165</td>
<td>43,44,45</td>
<td>284,383,253=920</td>
<td>36764,49562,32799</td>
</tr>
</tbody>
</table>
<p>,42  ==?259</p>
<h2 id="sstableloader">sstableloader</h2><p>168 </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cd md5_id20160623 &amp;&amp; mv data md5 &amp;&amp; cd md5_id &amp;&amp; <span class="operator"><span class="keyword">rename</span> <span class="keyword">data</span> <span class="keyword">md5</span> *</span><br><span class="line">MAX_HEAP_SIZE=<span class="string">"256M"</span></span><br><span class="line">MAX_HEAP_SIZE=<span class="string">"3096M"</span></span><br><span class="line">nohup /usr/<span class="keyword">install</span>/cassandra/<span class="keyword">bin</span>/sstableloader -<span class="keyword">d</span> <span class="number">192.168</span><span class="number">.47</span><span class="number">.202</span> /home/<span class="keyword">admin</span>/md5_id20160623/<span class="keyword">md5</span>/md5_id &amp; </span><br><span class="line">nohup apache-cassandra-<span class="number">2.1</span><span class="number">.13</span>/<span class="keyword">bin</span>/sstableloader -<span class="keyword">d</span> <span class="number">192.168</span><span class="number">.47</span><span class="number">.202</span> /home/<span class="keyword">admin</span>/md5_id20160627/<span class="keyword">md5</span>/md5_id &amp; </span><br><span class="line"></span><br><span class="line">Summary <span class="keyword">statistics</span>:</span><br><span class="line">   Connections per host:         : <span class="number">1</span></span><br><span class="line">   Total files transferred:      : <span class="number">14220</span></span><br><span class="line">   Total <span class="keyword">bytes</span> transferred:      : <span class="number">579</span>(gb),<span class="number">024</span>(mb),<span class="number">927</span>(kb),<span class="number">946</span>(b)</span><br><span class="line">   Total <span class="keyword">duration</span> (ms):          : <span class="number">25758</span>,<span class="number">956</span> = <span class="number">7</span><span class="keyword">hour</span></span><br><span class="line">   Average transfer rate (MB/s): : <span class="number">21</span></span><br><span class="line">   Peak transfer rate (MB/s):    : <span class="number">21</span></span><br><span class="line"></span><br><span class="line">[<span class="keyword">admin</span>@cass047202 ~]$ nodetool cfstats <span class="keyword">md5</span>.md5_id | grep <span class="keyword">keys</span></span><br><span class="line">    <span class="built_in">Number</span> <span class="keyword">of</span> <span class="keyword">keys</span> (estimate): <span class="number">5567257543</span></span></span><br></pre></td></tr></table></figure>
<p>如果遇到节点挂掉：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[/<span class="number">192.168</span>.<span class="number">47.222</span>, /<span class="number">192.168</span>.<span class="number">47.204</span>, /<span class="number">192.168</span>.<span class="number">47.203</span>, /<span class="number">192.168</span>.<span class="number">47.224</span>]</span><br><span class="line">java<span class="class">.util</span><span class="class">.concurrent</span><span class="class">.ExecutionException</span>: org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.streaming</span><span class="class">.StreamException</span>: Stream failed</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.common</span><span class="class">.util</span><span class="class">.concurrent</span><span class="class">.AbstractFuture</span><span class="variable">$Sync</span>.<span class="function"><span class="title">getValue</span><span class="params">(AbstractFuture.java:<span class="number">299</span>)</span></span></span><br><span class="line">  at com<span class="class">.google</span><span class="class">.common</span><span class="class">.util</span><span class="class">.concurrent</span><span class="class">.AbstractFuture</span><span class="variable">$Sync</span>.<span class="function"><span class="title">get</span><span class="params">(AbstractFuture.java:<span class="number">286</span>)</span></span></span><br><span class="line">  at com<span class="class">.google</span><span class="class">.common</span><span class="class">.util</span><span class="class">.concurrent</span><span class="class">.AbstractFuture</span><span class="class">.get</span>(AbstractFuture<span class="class">.java</span>:<span class="number">116</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.tools</span><span class="class">.BulkLoader</span><span class="class">.main</span>(BulkLoader<span class="class">.java</span>:<span class="number">125</span>)</span><br><span class="line">Caused by: org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.streaming</span><span class="class">.StreamException</span>: Stream failed</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.streaming</span><span class="class">.management</span><span class="class">.StreamEventJMXNotifier</span><span class="class">.onFailure</span>(StreamEventJMXNotifier<span class="class">.java</span>:<span class="number">85</span>)</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.common</span><span class="class">.util</span><span class="class">.concurrent</span><span class="class">.Futures</span>$<span class="number">4</span>.<span class="function"><span class="title">run</span><span class="params">(Futures.java:<span class="number">1172</span>)</span></span></span><br><span class="line">  at com<span class="class">.google</span><span class="class">.common</span><span class="class">.util</span><span class="class">.concurrent</span><span class="class">.MoreExecutors</span><span class="variable">$SameThreadExecutorService</span>.<span class="function"><span class="title">execute</span><span class="params">(MoreExecutors.java:<span class="number">297</span>)</span></span></span><br><span class="line">  at com<span class="class">.google</span><span class="class">.common</span><span class="class">.util</span><span class="class">.concurrent</span><span class="class">.ExecutionList</span><span class="class">.executeListener</span>(ExecutionList<span class="class">.java</span>:<span class="number">156</span>)</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.common</span><span class="class">.util</span><span class="class">.concurrent</span><span class="class">.ExecutionList</span><span class="class">.execute</span>(ExecutionList<span class="class">.java</span>:<span class="number">145</span>)</span><br><span class="line">  at com<span class="class">.google</span><span class="class">.common</span><span class="class">.util</span><span class="class">.concurrent</span><span class="class">.AbstractFuture</span><span class="class">.setException</span>(AbstractFuture<span class="class">.java</span>:<span class="number">202</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.streaming</span><span class="class">.StreamResultFuture</span><span class="class">.maybeComplete</span>(StreamResultFuture<span class="class">.java</span>:<span class="number">208</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.streaming</span><span class="class">.StreamResultFuture</span><span class="class">.handleSessionComplete</span>(StreamResultFuture<span class="class">.java</span>:<span class="number">184</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.streaming</span><span class="class">.StreamSession</span><span class="class">.closeSession</span>(StreamSession<span class="class">.java</span>:<span class="number">415</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.streaming</span><span class="class">.StreamSession</span><span class="class">.complete</span>(StreamSession<span class="class">.java</span>:<span class="number">607</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.streaming</span><span class="class">.StreamSession</span><span class="class">.messageReceived</span>(StreamSession<span class="class">.java</span>:<span class="number">471</span>)</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.streaming</span><span class="class">.ConnectionHandler</span><span class="variable">$IncomingMessageHandler</span>.<span class="function"><span class="title">run</span><span class="params">(ConnectionHandler.java:<span class="number">256</span>)</span></span></span><br><span class="line">  at java<span class="class">.lang</span><span class="class">.Thread</span><span class="class">.run</span>(Thread<span class="class">.java</span>:<span class="number">744</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">ERROR [CompactionExecutor:<span class="number">19</span>] <span class="number">2016</span>-<span class="number">06</span>-<span class="number">29</span> <span class="number">10</span>:<span class="number">06</span>:<span class="number">19</span>,<span class="number">266</span> CassandraDaemon<span class="class">.java</span>:<span class="number">229</span> - Exception <span class="keyword">in</span> thread Thread[CompactionExecutor:<span class="number">19</span>,<span class="number">1</span>,main]</span><br><span class="line">java<span class="class">.lang</span><span class="class">.RuntimeException</span>: Not enough space <span class="keyword">for</span> compaction, estimated sstables = <span class="number">1</span>, expected write size = <span class="number">221195610</span></span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.db</span><span class="class">.compaction</span><span class="class">.CompactionTask</span><span class="class">.checkAvailableDiskSpace</span>(CompactionTask<span class="class">.java</span>:<span class="number">296</span>) ~[apache-cassandra-<span class="number">2.1</span>.<span class="number">13</span><span class="class">.jar</span>:<span class="number">2.1</span>.<span class="number">13</span>]</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.db</span><span class="class">.compaction</span><span class="class">.CompactionTask</span><span class="class">.runMayThrow</span>(CompactionTask<span class="class">.java</span>:<span class="number">124</span>) ~[apache-cassandra-<span class="number">2.1</span>.<span class="number">13</span><span class="class">.jar</span>:<span class="number">2.1</span>.<span class="number">13</span>]</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.utils</span><span class="class">.WrappedRunnable</span><span class="class">.run</span>(WrappedRunnable<span class="class">.java</span>:<span class="number">28</span>) ~[apache-cassandra-<span class="number">2.1</span>.<span class="number">13</span><span class="class">.jar</span>:<span class="number">2.1</span>.<span class="number">13</span>]</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.db</span><span class="class">.compaction</span><span class="class">.CompactionTask</span><span class="class">.executeInternal</span>(CompactionTask<span class="class">.java</span>:<span class="number">73</span>) ~[apache-cassandra-<span class="number">2.1</span>.<span class="number">13</span><span class="class">.jar</span>:<span class="number">2.1</span>.<span class="number">13</span>]</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.db</span><span class="class">.compaction</span><span class="class">.AbstractCompactionTask</span><span class="class">.execute</span>(AbstractCompactionTask<span class="class">.java</span>:<span class="number">59</span>) ~[apache-cassandra-<span class="number">2.1</span>.<span class="number">13</span><span class="class">.jar</span>:<span class="number">2.1</span>.<span class="number">13</span>]</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.db</span><span class="class">.compaction</span><span class="class">.CompactionManager</span>$<span class="number">8</span>.<span class="function"><span class="title">runMayThrow</span><span class="params">(CompactionManager.java:<span class="number">626</span>)</span></span> ~[apache-cassandra-<span class="number">2.1</span>.<span class="number">13</span><span class="class">.jar</span>:<span class="number">2.1</span>.<span class="number">13</span>]</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.utils</span><span class="class">.WrappedRunnable</span><span class="class">.run</span>(WrappedRunnable<span class="class">.java</span>:<span class="number">28</span>) ~[apache-cassandra-<span class="number">2.1</span>.<span class="number">13</span><span class="class">.jar</span>:<span class="number">2.1</span>.<span class="number">13</span>]</span><br><span class="line">  at java<span class="class">.util</span><span class="class">.concurrent</span><span class="class">.Executors</span><span class="variable">$RunnableAdapter</span>.<span class="function"><span class="title">call</span><span class="params">(Executors.java:<span class="number">471</span>)</span></span> ~[na:<span class="number">1.7</span>.<span class="number">0</span>_51]</span><br><span class="line">  at java<span class="class">.util</span><span class="class">.concurrent</span><span class="class">.FutureTask</span><span class="class">.run</span>(FutureTask<span class="class">.java</span>:<span class="number">262</span>) ~[na:<span class="number">1.7</span>.<span class="number">0</span>_51]</span><br><span class="line">  at java<span class="class">.util</span><span class="class">.concurrent</span><span class="class">.ThreadPoolExecutor</span><span class="class">.runWorker</span>(ThreadPoolExecutor<span class="class">.java</span>:<span class="number">1145</span>) ~[na:<span class="number">1.7</span>.<span class="number">0</span>_51]</span><br><span class="line">  at java<span class="class">.util</span><span class="class">.concurrent</span><span class="class">.ThreadPoolExecutor</span><span class="variable">$Worker</span>.<span class="function"><span class="title">run</span><span class="params">(ThreadPoolExecutor.java:<span class="number">615</span>)</span></span> [na:<span class="number">1.7</span>.<span class="number">0</span>_51]</span><br><span class="line">  at java<span class="class">.lang</span><span class="class">.Thread</span><span class="class">.run</span>(Thread<span class="class">.java</span>:<span class="number">744</span>) [na:<span class="number">1.7</span>.<span class="number">0</span>_51]</span><br><span class="line">ERROR [HintedHandoffManager:<span class="number">1</span>] <span class="number">2016</span>-<span class="number">06</span>-<span class="number">29</span> <span class="number">10</span>:<span class="number">06</span>:<span class="number">19</span>,<span class="number">267</span> CassandraDaemon<span class="class">.java</span>:<span class="number">229</span> - Exception <span class="keyword">in</span> thread Thread[HintedHandoffManager:<span class="number">1</span>,<span class="number">1</span>,main]</span><br><span class="line">java<span class="class">.lang</span><span class="class">.RuntimeException</span>: java<span class="class">.util</span><span class="class">.concurrent</span><span class="class">.ExecutionException</span>: java<span class="class">.lang</span><span class="class">.RuntimeException</span>: Not enough space <span class="keyword">for</span> compaction, estimated sstables = <span class="number">1</span>, expected write size = <span class="number">221195610</span></span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.db</span><span class="class">.HintedHandOffManager</span><span class="class">.compact</span>(HintedHandOffManager<span class="class">.java</span>:<span class="number">282</span>) ~[apache-cassandra-<span class="number">2.1</span>.<span class="number">13</span><span class="class">.jar</span>:<span class="number">2.1</span>.<span class="number">13</span>]</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.db</span><span class="class">.HintedHandOffManager</span><span class="class">.scheduleAllDeliveries</span>(HintedHandOffManager<span class="class">.java</span>:<span class="number">522</span>) ~[apache-cassandra-<span class="number">2.1</span>.<span class="number">13</span><span class="class">.jar</span>:<span class="number">2.1</span>.<span class="number">13</span>]</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.db</span><span class="class">.HintedHandOffManager</span><span class="class">.access</span>$<span class="number">000</span>(HintedHandOffManager<span class="class">.java</span>:<span class="number">93</span>) ~[apache-cassandra-<span class="number">2.1</span>.<span class="number">13</span><span class="class">.jar</span>:<span class="number">2.1</span>.<span class="number">13</span>]</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.db</span><span class="class">.HintedHandOffManager</span>$<span class="number">1</span>.<span class="function"><span class="title">run</span><span class="params">(HintedHandOffManager.java:<span class="number">182</span>)</span></span> ~[apache-cassandra-<span class="number">2.1</span>.<span class="number">13</span><span class="class">.jar</span>:<span class="number">2.1</span>.<span class="number">13</span>]</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.concurrent</span><span class="class">.DebuggableScheduledThreadPoolExecutor</span><span class="variable">$UncomplainingRunnable</span>.<span class="function"><span class="title">run</span><span class="params">(DebuggableScheduledThreadPoolExecutor.java:<span class="number">118</span>)</span></span> ~[apache-cassandra-<span class="number">2.1</span>.<span class="number">13</span><span class="class">.jar</span>:<span class="number">2.1</span>.<span class="number">13</span>]</span><br><span class="line">  at java<span class="class">.util</span><span class="class">.concurrent</span><span class="class">.Executors</span><span class="variable">$RunnableAdapter</span>.<span class="function"><span class="title">call</span><span class="params">(Executors.java:<span class="number">471</span>)</span></span> [na:<span class="number">1.7</span>.<span class="number">0</span>_51]</span><br><span class="line">  at java<span class="class">.util</span><span class="class">.concurrent</span><span class="class">.FutureTask</span><span class="class">.runAndReset</span>(FutureTask<span class="class">.java</span>:<span class="number">304</span>) [na:<span class="number">1.7</span>.<span class="number">0</span>_51]</span><br><span class="line">  at java<span class="class">.util</span><span class="class">.concurrent</span><span class="class">.ScheduledThreadPoolExecutor</span><span class="variable">$ScheduledFutureTask</span>.access$<span class="number">301</span>(ScheduledThreadPoolExecutor<span class="class">.java</span>:<span class="number">178</span>) [na:<span class="number">1.7</span>.<span class="number">0</span>_51]</span><br><span class="line">  at java<span class="class">.util</span><span class="class">.concurrent</span><span class="class">.ScheduledThreadPoolExecutor</span><span class="variable">$ScheduledFutureTask</span>.<span class="function"><span class="title">run</span><span class="params">(ScheduledThreadPoolExecutor.java:<span class="number">293</span>)</span></span> [na:<span class="number">1.7</span>.<span class="number">0</span>_51]</span><br><span class="line">  at java<span class="class">.util</span><span class="class">.concurrent</span><span class="class">.ThreadPoolExecutor</span><span class="class">.runWorker</span>(ThreadPoolExecutor<span class="class">.java</span>:<span class="number">1145</span>) [na:<span class="number">1.7</span>.<span class="number">0</span>_51]</span><br><span class="line">  at java<span class="class">.util</span><span class="class">.concurrent</span><span class="class">.ThreadPoolExecutor</span><span class="variable">$Worker</span>.<span class="function"><span class="title">run</span><span class="params">(ThreadPoolExecutor.java:<span class="number">615</span>)</span></span> [na:<span class="number">1.7</span>.<span class="number">0</span>_51]</span><br><span class="line">  at java<span class="class">.lang</span><span class="class">.Thread</span><span class="class">.run</span>(Thread<span class="class">.java</span>:<span class="number">744</span>) [na:<span class="number">1.7</span>.<span class="number">0</span>_51]</span><br><span class="line">Caused by: java<span class="class">.util</span><span class="class">.concurrent</span><span class="class">.ExecutionException</span>: java<span class="class">.lang</span><span class="class">.RuntimeException</span>: Not enough space <span class="keyword">for</span> compaction, estimated sstables = <span class="number">1</span>, expected write size = <span class="number">221195610</span></span><br><span class="line">  at java<span class="class">.util</span><span class="class">.concurrent</span><span class="class">.FutureTask</span><span class="class">.report</span>(FutureTask<span class="class">.java</span>:<span class="number">122</span>) [na:<span class="number">1.7</span>.<span class="number">0</span>_51]</span><br><span class="line">  at java<span class="class">.util</span><span class="class">.concurrent</span><span class="class">.FutureTask</span><span class="class">.get</span>(FutureTask<span class="class">.java</span>:<span class="number">188</span>) [na:<span class="number">1.7</span>.<span class="number">0</span>_51]</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.db</span><span class="class">.HintedHandOffManager</span><span class="class">.compact</span>(HintedHandOffManager<span class="class">.java</span>:<span class="number">278</span>) ~[apache-cassandra-<span class="number">2.1</span>.<span class="number">13</span><span class="class">.jar</span>:<span class="number">2.1</span>.<span class="number">13</span>]</span><br><span class="line">  ... <span class="number">11</span> common frames omitted</span><br><span class="line">Caused by: java<span class="class">.lang</span><span class="class">.RuntimeException</span>: Not enough space <span class="keyword">for</span> compaction, estimated sstables = <span class="number">1</span>, expected write size = <span class="number">221195610</span></span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.db</span><span class="class">.compaction</span><span class="class">.CompactionTask</span><span class="class">.checkAvailableDiskSpace</span>(CompactionTask<span class="class">.java</span>:<span class="number">296</span>) ~[apache-cassandra-<span class="number">2.1</span>.<span class="number">13</span><span class="class">.jar</span>:<span class="number">2.1</span>.<span class="number">13</span>]</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.db</span><span class="class">.compaction</span><span class="class">.CompactionTask</span><span class="class">.runMayThrow</span>(CompactionTask<span class="class">.java</span>:<span class="number">124</span>) ~[apache-cassandra-<span class="number">2.1</span>.<span class="number">13</span><span class="class">.jar</span>:<span class="number">2.1</span>.<span class="number">13</span>]</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.utils</span><span class="class">.WrappedRunnable</span><span class="class">.run</span>(WrappedRunnable<span class="class">.java</span>:<span class="number">28</span>) ~[apache-cassandra-<span class="number">2.1</span>.<span class="number">13</span><span class="class">.jar</span>:<span class="number">2.1</span>.<span class="number">13</span>]</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.db</span><span class="class">.compaction</span><span class="class">.CompactionTask</span><span class="class">.executeInternal</span>(CompactionTask<span class="class">.java</span>:<span class="number">73</span>) ~[apache-cassandra-<span class="number">2.1</span>.<span class="number">13</span><span class="class">.jar</span>:<span class="number">2.1</span>.<span class="number">13</span>]</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.db</span><span class="class">.compaction</span><span class="class">.AbstractCompactionTask</span><span class="class">.execute</span>(AbstractCompactionTask<span class="class">.java</span>:<span class="number">59</span>) ~[apache-cassandra-<span class="number">2.1</span>.<span class="number">13</span><span class="class">.jar</span>:<span class="number">2.1</span>.<span class="number">13</span>]</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.db</span><span class="class">.compaction</span><span class="class">.CompactionManager</span>$<span class="number">8</span>.<span class="function"><span class="title">runMayThrow</span><span class="params">(CompactionManager.java:<span class="number">626</span>)</span></span> ~[apache-cassandra-<span class="number">2.1</span>.<span class="number">13</span><span class="class">.jar</span>:<span class="number">2.1</span>.<span class="number">13</span>]</span><br><span class="line">  at org<span class="class">.apache</span><span class="class">.cassandra</span><span class="class">.utils</span><span class="class">.WrappedRunnable</span><span class="class">.run</span>(WrappedRunnable<span class="class">.java</span>:<span class="number">28</span>) ~[apache-cassandra-<span class="number">2.1</span>.<span class="number">13</span><span class="class">.jar</span>:<span class="number">2.1</span>.<span class="number">13</span>]</span><br><span class="line">  at java<span class="class">.util</span><span class="class">.concurrent</span><span class="class">.Executors</span><span class="variable">$RunnableAdapter</span>.<span class="function"><span class="title">call</span><span class="params">(Executors.java:<span class="number">471</span>)</span></span> [na:<span class="number">1.7</span>.<span class="number">0</span>_51]</span><br><span class="line">  at java<span class="class">.util</span><span class="class">.concurrent</span><span class="class">.FutureTask</span><span class="class">.run</span>(FutureTask<span class="class">.java</span>:<span class="number">262</span>) [na:<span class="number">1.7</span>.<span class="number">0</span>_51]</span><br><span class="line">  ... <span class="number">3</span> common frames omitted</span><br><span class="line">WARN  [STREAM-IN-/<span class="number">127.0</span>.<span class="number">0.1</span>] <span class="number">2016</span>-<span class="number">06</span>-<span class="number">29</span> <span class="number">10</span>:<span class="number">06</span>:<span class="number">29</span>,<span class="number">500</span> CompressedStreamReader<span class="class">.java</span>:<span class="number">115</span> - [Stream ab888f50-<span class="number">3</span>d8f-<span class="number">11</span>e6-<span class="number">8</span>b24-dff3aadcb7ef] Error while reading partition <span class="function"><span class="title">DecoratedKey</span><span class="params">(-<span class="number">677751571849691691</span>, <span class="number">4435344444443536393133383636353144303931304334383341363032413842</span>)</span></span> from stream on ks=<span class="string">'md5'</span> and table=<span class="string">'md5_id'</span>./usr</span><br></pre></td></tr></table></figure>
<h2 id="jHiccup">jHiccup</h2><p><a href="http://hao.jobbole.com/jhiccup/" target="_blank" rel="external">http://hao.jobbole.com/jhiccup/</a></p>
<ol>
<li>给bin/cassandra启动命令，添加jHiccup：</li>
</ol>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /usr/install/cassandra/bin/cassandra</span><br><span class="line">exec <span class="string">"/usr/install/jHiccup-2.0.6/jHiccup"</span> <span class="variable">$NUMACTL</span> <span class="string">"$JAVA"</span> <span class="variable">$JVM</span>_OPTS <span class="variable">$cassandra</span>_parms -cp <span class="string">"$CLASSPATH"</span> <span class="variable">$props</span> <span class="string">"$class"</span></span><br></pre></td></tr></table></figure>
<p>注意必须先停止Cassanra，然后再启动（废话，不停止，再次启动肯定有问题）</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">HiccupMeter:</span> Failed to open log file.</span><br><span class="line">INFO  <span class="number">06</span>:<span class="number">02</span>:<span class="number">01</span> <span class="string">Classpath:</span> <span class="regexp">/usr/</span>install<span class="regexp">/cassandra/</span>bin<span class="regexp">/../</span><span class="string">conf:</span>...<span class="regexp">/usr/</span>install<span class="regexp">/jHiccup-2.0.6/</span>jHiccup.<span class="string">jar:</span><span class="regexp">/usr/</span>install<span class="regexp">/cassandra/</span>bin<span class="regexp">/../</span>lib/jamm-<span class="number">0.3</span><span class="number">.0</span>.jar</span><br><span class="line">INFO  <span class="number">06</span>:<span class="number">02</span>:<span class="number">01</span> JVM <span class="string">Arguments:</span> [-<span class="string">javaagent:</span><span class="regexp">/usr/</span>install<span class="regexp">/jHiccup-2.0.6/</span>jHiccup.jar=, -ea, -<span class="string">javaagent:</span><span class="regexp">/usr/</span>install<span class="regexp">/cassandra/</span>bin<span class="regexp">/../</span>lib/jamm-<span class="number">0.3</span><span class="number">.0</span>.jar, -<span class="string">XX:</span></span><br><span class="line">WARN  <span class="number">06</span>:<span class="number">02</span>:<span class="number">01</span> Unable to lock JVM memory (ENOMEM). This can result <span class="keyword">in</span> part of the JVM being swapped out, especially with mmapped I/O enabled. Increase RLIMIT_MEMLOCK or run Cassandra <span class="keyword">as</span> root.</span><br><span class="line">WARN  <span class="number">06</span>:<span class="number">02</span>:<span class="number">01</span> JMX is not enabled to receive remote connections. Please see cassandra-env.sh <span class="keyword">for</span> more info.</span><br><span class="line">ERROR <span class="number">06</span>:<span class="number">02</span>:<span class="number">01</span> Error starting local jmx <span class="string">server:</span></span><br><span class="line">java.rmi.server.<span class="string">ExportException:</span> Port already <span class="keyword">in</span> <span class="string">use:</span> <span class="number">7199</span>; nested exception <span class="string">is:</span></span><br><span class="line">  java.net.<span class="string">BindException:</span> 地址已在使用</span><br><span class="line"></span><br><span class="line">[qihuang.zheng<span class="annotation">@dp</span>0652 ~]$ export _JAVA_OPTIONS=<span class="string">'-javaagent:/usr/install/jHiccup-2.0.6/jHiccup.jar="-d 20000 -i 1000"'</span> &amp;&amp; sudo -u admin <span class="regexp">/usr/</span>install<span class="regexp">/cassandra/</span>bin/cassandra</span><br><span class="line">[qihuang.zheng<span class="annotation">@dp</span>0652 ~]$ Picked up <span class="string">_JAVA_OPTIONS:</span> -<span class="string">javaagent:</span><span class="regexp">/usr/</span>install<span class="regexp">/jHiccup-2.0.6/</span>jHiccup.jar=<span class="string">"-d 20000 -i 1000"</span></span><br><span class="line"><span class="string">HiccupMeter:</span> Failed to open log file.</span><br><span class="line">INFO  <span class="number">06</span>:<span class="number">24</span>:<span class="number">09</span> JVM <span class="string">Arguments:</span> [-ea, -<span class="string">javaagent:</span><span class="regexp">/usr/</span>install<span class="regexp">/cassandra/</span>bin<span class="regexp">/../</span>lib<span class="regexp">/jamm-0.3.0.jar, -Dcassandra.storagedir=/</span>usr<span class="regexp">/install/</span>cassandra<span class="regexp">/bin/</span>..<span class="regexp">/data, -javaagent:/</span>usr<span class="regexp">/install/</span>jHiccup-<span class="number">2.0</span><span class="number">.6</span>/jHiccup.jar=-d <span class="number">20000</span> -i <span class="number">1000</span>]</span><br><span class="line">WARN  <span class="number">06</span>:<span class="number">24</span>:<span class="number">09</span> Unable to lock JVM memory (ENOMEM). This can result <span class="keyword">in</span> part of the JVM being swapped out, especially with mmapped I/O enabled. Increase RLIMIT_MEMLOCK or run Cassandra <span class="keyword">as</span> root.</span><br><span class="line">WARN  <span class="number">06</span>:<span class="number">24</span>:<span class="number">09</span> JMX is not enabled to receive remote connections. Please see cassandra-env.sh <span class="keyword">for</span> more info.</span><br><span class="line">ERROR <span class="number">06</span>:<span class="number">24</span>:<span class="number">09</span> Error starting local jmx <span class="string">server:</span></span><br><span class="line">java.rmi.server.<span class="string">ExportException:</span> Port already <span class="keyword">in</span> <span class="string">use:</span> <span class="number">7199</span>; nested exception <span class="string">is:</span></span><br><span class="line">  java.net.<span class="string">BindException:</span> 地址已在使用</span><br><span class="line"></span><br><span class="line">[qihuang.zheng<span class="annotation">@dp</span>0652 ~]$ jps -lm</span><br><span class="line">Picked up <span class="string">_JAVA_OPTIONS:</span> -<span class="string">javaagent:</span><span class="regexp">/usr/</span>install<span class="regexp">/jHiccup-2.0.6/</span>jHiccup.jar=<span class="string">"-d 20000 -i 1000"</span></span><br><span class="line"><span class="number">35054</span> sun.tools.jps.Jps -lm  </span><br><span class="line">[qihuang.zheng<span class="annotation">@dp</span>0652 ~]$ sudo -u admin jps -lm</span><br><span class="line">Picked up <span class="string">_JAVA_OPTIONS:</span> -<span class="string">javaagent:</span><span class="regexp">/usr/</span>install<span class="regexp">/jHiccup-2.0.6/</span>jHiccup.jar=<span class="string">"-d 20000 -i 1000"</span></span><br><span class="line"><span class="string">HiccupMeter:</span> Failed to open log file.</span><br></pre></td></tr></table></figure>
<p>正常启动Cassandra后，jHiccup.jar会作为agent：</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[qihuang.zheng<span class="variable">@dp0652</span> ~]<span class="variable">$ </span>ps -ef|grep cassandra</span><br><span class="line">/usr/java/jdk1.<span class="number">7.0_51</span>/bin/java -<span class="symbol">javaagent:</span>/usr/install/jHiccup-<span class="number">2.0</span>.<span class="number">6</span>/jHiccup.jar= -ea -<span class="symbol">javaagent:</span>/usr/install/cassandra/bin/../<span class="class"><span class="keyword">lib</span>/<span class="title">jamm</span>-0.3.0.<span class="title">jar</span> -<span class="title">XX</span>:...</span></span><br></pre></td></tr></table></figure>
<p>正常生成的文件格式：hiccup.160505.1429.34233.hlog<br>会生成到pid指定的目录下，比如pid是cassandra的进程，则生成到/usr/install/cassandra下</p>
<p>但是在生产环境测试时，无法生产日志文件：</p>
<p>ps: the problem of jHiccup tool not working:  </p>
<p>We use jHiccup -p $pid to attach jHiccup to Cassandra Service,<br>but unfortunately, there are non hlog file generated which should be in Cassandra install home.<br>Last week I had demonstration to Daniel, and Daniel say he will checkout.<br>Here is our steps on production environment</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[admin@<span class="number">192</span>-<span class="number">168</span>-<span class="number">48</span>-<span class="number">47</span> ~]$ ps -ef|grep cassandra</span><br><span class="line">admin    <span class="number">27021</span>     <span class="number">1</span> <span class="number">10</span> Apr29 ?        <span class="number">1</span>-<span class="number">22</span>:<span class="number">50</span>:<span class="number">40</span> /usr/java/jdk1<span class="number">.7</span><span class="number">.0</span>_51/bin/java ... org.apache.cassandra.service.CassandraDaemon</span><br><span class="line"></span><br><span class="line">[admin@<span class="number">192</span>-<span class="number">168</span>-<span class="number">48</span>-<span class="number">47</span> ~]$ /usr/install/jHiccup-<span class="number">2.0</span><span class="number">.6</span>/jHiccup -p <span class="number">27021</span> -v</span><br><span class="line">jHiccup version <span class="number">2.0</span><span class="number">.5</span></span><br><span class="line">jHiccup executing: /usr/java/jdk1<span class="number">.7</span><span class="number">.0</span>_51/bin/java -cp /usr/java/jdk1<span class="number">.7</span><span class="number">.0</span>_51/lib/tools.jar:/usr/install/jHiccup-<span class="number">2.0</span><span class="number">.6</span>/jHiccup.jar </span><br><span class="line">org.jhiccup.HiccupMeterAttacher -v -j /usr/install/jHiccup-<span class="number">2.0</span><span class="number">.6</span>/jHiccup.jar -p <span class="number">27021</span></span><br><span class="line">Attaching to process <span class="number">27021</span> and launching jHiccup agent from jar <span class="number">27021</span> with args: -d <span class="number">0</span> -i <span class="number">5000</span> -s <span class="number">2</span> -r <span class="number">1.0</span> -v</span><br><span class="line"></span><br><span class="line">[admin@<span class="number">192</span>-<span class="number">168</span>-<span class="number">48</span>-<span class="number">47</span> ~]$ ll /usr/install/cassandra/</span><br><span class="line">drwxr-xr-x. <span class="number">2</span> admin admin   <span class="number">4096</span> <span class="number">4</span>月  <span class="number">25</span> <span class="number">11</span>:<span class="number">08</span> bin</span><br><span class="line">-rw-r--r--. <span class="number">1</span> admin admin <span class="number">263216</span> <span class="number">1</span>月  <span class="number">26</span> <span class="number">22</span>:<span class="number">21</span> CHANGES.txt</span><br><span class="line">drwxr-xr-x. <span class="number">3</span> admin admin   <span class="number">4096</span> <span class="number">4</span>月  <span class="number">29</span> <span class="number">10</span>:<span class="number">35</span> conf</span><br><span class="line">drwxr-xr-x. <span class="number">2</span> admin admin   <span class="number">4096</span> <span class="number">4</span>月  <span class="number">25</span> <span class="number">11</span>:<span class="number">08</span> interface</span><br><span class="line">drwxr-xr-x. <span class="number">3</span> admin admin   <span class="number">4096</span> <span class="number">4</span>月  <span class="number">25</span> <span class="number">11</span>:<span class="number">08</span> javadoc</span><br><span class="line">drwxr-xr-x. <span class="number">3</span> admin admin   <span class="number">4096</span> <span class="number">4</span>月  <span class="number">25</span> <span class="number">11</span>:<span class="number">08</span> lib</span><br><span class="line">-rw-r--r--. <span class="number">1</span> admin admin  <span class="number">11609</span> <span class="number">1</span>月  <span class="number">26</span> <span class="number">22</span>:<span class="number">21</span> LICENSE.txt</span><br><span class="line">drwxr-xr-x. <span class="number">2</span> admin admin   <span class="number">4096</span> <span class="number">5</span>月  <span class="number">13</span> <span class="number">12</span>:<span class="number">43</span> logs</span><br><span class="line">-rw-r--r--. <span class="number">1</span> admin admin  <span class="number">67603</span> <span class="number">1</span>月  <span class="number">26</span> <span class="number">22</span>:<span class="number">21</span> NEWS.txt</span><br><span class="line">-rw-r--r--. <span class="number">1</span> admin admin   <span class="number">2117</span> <span class="number">1</span>月  <span class="number">26</span> <span class="number">22</span>:<span class="number">21</span> NOTICE.txt</span><br><span class="line">drwxr-xr-x. <span class="number">3</span> admin admin   <span class="number">4096</span> <span class="number">4</span>月  <span class="number">25</span> <span class="number">11</span>:<span class="number">08</span> pylib</span><br><span class="line">drwxr-xr-x. <span class="number">4</span> admin admin   <span class="number">4096</span> <span class="number">4</span>月  <span class="number">25</span> <span class="number">11</span>:<span class="number">08</span> tools</span><br></pre></td></tr></table></figure>
<p>原因是启动Cassandra用普通用户，然后通过sudo -u admin方式启动，但是/home/admin用户却无法访问普通用户的权限。</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[admin@fp-cass048162 ~]$ pwdx <span class="number">19649</span></span><br><span class="line"><span class="number">19649</span>: /home/qihuang.zheng</span><br><span class="line"></span><br><span class="line">[admin@fp-cass048162 ~]$ lsof -p <span class="number">19649</span> | grep cwd</span><br><span class="line">java    <span class="number">19649</span> admin  cwd    <span class="type">DIR</span>               <span class="number">8</span>,<span class="number">17</span>         <span class="number">4096</span>  <span class="number">490733569</span> /home/qihuang.zheng</span><br><span class="line"></span><br><span class="line">[admin@fp-cass048162 ~]$ readlink -e /<span class="keyword">proc</span>/<span class="number">19649</span>/cwd</span><br></pre></td></tr></table></figure>
<p>解决方法：停止Cassandra，用admin用户登陆， 用admin用户启动，不需要sudo -u admin。<br>最后会生成文件到/home/admin下。正常的日志如下：  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># Executing: HiccupMeter -d <span class="number">0</span> -i <span class="number">5000</span> -s <span class="number">2</span> -r <span class="number">1.0</span> -v</span></span><br><span class="line"><span class="preprocessor">#[Logged with jHiccup version <span class="number">2.0</span><span class="number">.6</span>]</span></span><br><span class="line"><span class="preprocessor">#[Histogram log format version <span class="number">1.1</span>]</span></span><br><span class="line"><span class="preprocessor">#[StartTime: <span class="number">1463708353.327</span> (seconds since epoch), Fri May <span class="number">20</span> <span class="number">09</span>:<span class="number">39</span>:<span class="number">13</span> CST <span class="number">2016</span>]</span></span><br><span class="line"><span class="string">"StartTimestamp"</span>,<span class="string">"Interval_Length"</span>,<span class="string">"Interval_Max"</span>,<span class="string">"Interval_Compressed_Histogram"</span></span><br><span class="line"><span class="number">1166.248</span>,<span class="number">5.002</span>,<span class="number">570.425</span>,HISTIgAAAKp42pNpmazIwMApwAABTBDKT4GBgdnNYMcCBvsPUJlfDO8Yt3GfY1jCwM3AzsDIwAIUYwRCJjCJCZiwimITIx4w0kAlpW4amTYzUmAqI0UuGiibGfHqYCTaPEaK4oVxgGTR5RkpkB08qkkxi5EompEGqgfOTEweAjNiiGDDxKkaCiqxQyacMuSqpL6J1LGbCQyZoTQyxCZGvErq66aNe1igkBVMMgMAUHALXQ==</span><br><span class="line"><span class="number">1171.250</span>,<span class="number">5.000</span>,<span class="number">42.729</span>,HISTIgAAAHt42pNpmazIwMDqxgABTBDKT4GBgdnNYMcCBvsPUJk/jDwMf/huM8gzcDOwglWyMjDC1EMBIwN2gEscP2AkWjcjmSaT77aRaTP++GWkoe6BsxlTDyMBmxjJlCVs9mCxmRCfiWaqGQnELCMJsqSpZsRKM+KVxVAFADZ8CIQ=</span><br><span class="line"><span class="number">1176.250</span>,<span class="number">5.000</span>,<span class="number">406.847</span>,HISTIgAAAJt42pNpmazIwMDRwgABTBDKT4GBgdnNYMcCBvsPUJlnDJ8YhXjDGOoYBBnYgOpYGBiBJEg9IxgzMjCDSUYG8gAjDeQoN2PgbGagui5KzWCksbsYB0gv6boZaSY7VMxmJKCXdqoHymZGkmhqqqKFmeTYzIiCGTFEcOGBU0lN83BBJjxy5KijhUpqmMgEhsxQGhUyUyBGgm4AXGIJ5w==</span><br><span class="line"><span class="number">1181.250</span>,<span class="number">5.000</span>,<span class="number">125.829</span>,HISTIgAAAG942pNpmazIwMD2gAECmCCUnwIDA7ObwY4FDPYfoDK/Gf4wcvFlMnQzcABVsTEwAiEDFEPY2AAu8cEFGEdtHgRmMg4ZmxlpJjtUzGYkoJd2qgfKZkaSaGqqooWZ5NjMiIIZMURw4YFTSYJ5AGq7CUM=</span><br><span class="line"><span class="number">1186.250</span>,<span class="number">5.000</span>,<span class="number">444.596</span>,HISTIgAAAIR42pNpmazIwMCxggECmCCUnwIDA7ObwY4FDPYfoDIXGVkZvvGaMBxm4GBgAapjBGJmoDgjFA9mwEgnPSPNZka6u3BgbWakmSwtzaa2zYwk8SmRHTyqGUmi6a+K9mYyEsSMRKkaKiqxicAgEwoPH2SisrqBsxtU2zNhQErEaKIbAEcEChs=</span><br></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/work/">work</a>
	</div>


      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cassandra/">cassandra</a></li></ul>
	</div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
</article>











    
        <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
        <script>
        var yiliaConfig = {
        fancybox: true,
        mathjax: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        open_in_new: false
        }
        </script>
        

  
    <article id="post-2015-09-10-Storm-Window" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/09/10/2015-09-10-Storm-Window/" class="article-date">
  	<time datetime="2015-09-09T16:00:00.000Z" itemprop="datePublished">2015-09-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/09/10/2015-09-10-Storm-Window/">Storm的滑动窗口</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Storm滑动窗口的实现, 使用TickTuple</p>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/bigdata/">bigdata</a>
	</div>


      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/storm/">storm</a></li></ul>
	</div>

      
        <p class="article-more-link">
          <a  href="/2015/09/10/2015-09-10-Storm-Window/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
</article>











    
        <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
        <script>
        var yiliaConfig = {
        fancybox: true,
        mathjax: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        open_in_new: false
        }
        </script>
        

  
    <article id="post-2015-08-25-Apache-Cassandra" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/08/25/2015-08-25-Apache-Cassandra/" class="article-date">
  	<time datetime="2015-08-24T16:00:00.000Z" itemprop="datePublished">2015-08-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/08/25/2015-08-25-Apache-Cassandra/">Apache Cassandra入门</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Hello Cassandra</p>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/bigdata/">bigdata</a>
	</div>


      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cassandra/">cassandra</a></li></ul>
	</div>

      
        <p class="article-more-link">
          <a  href="/2015/08/25/2015-08-25-Apache-Cassandra/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
  
</article>











    
        <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
        <script>
        var yiliaConfig = {
        fancybox: true,
        mathjax: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        open_in_new: false
        }
        </script>
        

  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/4/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/6/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2016 任何忧伤,都抵不过世界的美丽
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的静态博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减双栏 Hexo 博客主题">Yelee</a> by MOxFIVE
        </div>
    </div>
    <div class="visit">
      <span id="busuanzi_container_site_pv" style='display:none'>
        <span id="site-visit" >本站到访数: 
        <span id="busuanzi_value_site_uv"></span>
        </span>
      </span>
      <span id="busuanzi_container_page_pv" style='display:none'>
        <span id="page-visit">, 本页阅读量: 
        <span id="busuanzi_value_page_pv"></span>
        </span>
      </span>
    </div>
  </div>
</footer>
    </div>
    
	<script>
		var yiliaConfig = {
			fancybox: false,
			mathjax: true,
			animate: true,
			isHome: true,
			isPost: false,
			isArchive: false,
			isTag: false,
			isCategory: false,
			open_in_new: false
		}
	</script>


<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>

<script>
  var backgroundnum = 5;
  var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));

  $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
</script>




<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<div class="scroll" id="scroll">
<a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
<a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>